(this.webpackJsonpappcraft=this.webpackJsonpappcraft||[]).push([[1],{2917:function(t,e,i){"use strict";i.r(e),i.d(e,"BlockAllocator",(function(){return s})),i.d(e,"Draw",(function(){return l})),i.d(e,"Color",(function(){return o})),i.d(e,"DrawFlags",(function(){return a})),i.d(e,"GrowableStack",(function(){return ot})),i.d(e,"Mat22",(function(){return Lt})),i.d(e,"Mat33",(function(){return Rt})),i.d(e,"Rot",(function(){return jt})),i.d(e,"Sweep",(function(){return Ot})),i.d(e,"Transform",(function(){return Tt})),i.d(e,"Vec2",(function(){return It})),i.d(e,"Vec3",(function(){return Ft})),i.d(e,"_pi_over_180",(function(){return at})),i.d(e,"_180_over_pi",(function(){return ut})),i.d(e,"two_pi",(function(){return lt})),i.d(e,"Abs",(function(){return ht})),i.d(e,"Acos",(function(){return bt})),i.d(e,"Asin",(function(){return gt})),i.d(e,"Atan2",(function(){return Vt})),i.d(e,"Cos",(function(){return At})),i.d(e,"IsValid",(function(){return dt})),i.d(e,"Pow",(function(){return xt})),i.d(e,"Sin",(function(){return Ct})),i.d(e,"Sqrt",(function(){return pt})),i.d(e,"Vec2_zero",(function(){return Gt})),i.d(e,"Clamp",(function(){return ct})),i.d(e,"DegToRad",(function(){return Bt})),i.d(e,"InvSqrt",(function(){return yt})),i.d(e,"IsPowerOfTwo",(function(){return kt})),i.d(e,"Max",(function(){return mt})),i.d(e,"Min",(function(){return _t})),i.d(e,"NextPowerOfTwo",(function(){return wt})),i.d(e,"RadToDeg",(function(){return St})),i.d(e,"Random",(function(){return Mt})),i.d(e,"RandomRange",(function(){return Pt})),i.d(e,"Sq",(function(){return vt})),i.d(e,"Swap",(function(){return ft})),i.d(e,"Version",(function(){return W})),i.d(e,"aabbExtension",(function(){return B})),i.d(e,"aabbMultiplier",(function(){return S})),i.d(e,"angularSleepTolerance",(function(){return U})),i.d(e,"angularSlop",(function(){return C})),i.d(e,"barrierCollisionTime",(function(){return J})),i.d(e,"baumgarte",(function(){return D})),i.d(e,"branch",(function(){return Y})),i.d(e,"commit",(function(){return K})),i.d(e,"epsilon",(function(){return f})),i.d(e,"epsilon_sq",(function(){return d})),i.d(e,"invalidParticleIndex",(function(){return L})),i.d(e,"lengthUnitsPerMeter",(function(){return y})),i.d(e,"linearSleepTolerance",(function(){return Z})),i.d(e,"linearSlop",(function(){return A})),i.d(e,"maxAngularCorrection",(function(){return k})),i.d(e,"maxFloat",(function(){return c})),i.d(e,"maxLinearCorrection",(function(){return w})),i.d(e,"maxManifoldPoints",(function(){return x})),i.d(e,"maxParticleForce",(function(){return q})),i.d(e,"maxParticleIndex",(function(){return R})),i.d(e,"maxParticlePressure",(function(){return O})),i.d(e,"maxPolygonVertices",(function(){return p})),i.d(e,"maxRotation",(function(){return I})),i.d(e,"maxRotationSquared",(function(){return G})),i.d(e,"maxSubSteps",(function(){return g})),i.d(e,"maxTOIContacts",(function(){return V})),i.d(e,"maxTranslation",(function(){return M})),i.d(e,"maxTranslationSquared",(function(){return P})),i.d(e,"maxTriadDistance",(function(){return z})),i.d(e,"maxTriadDistanceSquared",(function(){return E})),i.d(e,"minParticleSystemBufferCapacity",(function(){return N})),i.d(e,"minParticleWeight",(function(){return T})),i.d(e,"particleStride",(function(){return j})),i.d(e,"pi",(function(){return v})),i.d(e,"polygonRadius",(function(){return b})),i.d(e,"timeToSleep",(function(){return X})),i.d(e,"toiBaumgarte",(function(){return F})),i.d(e,"version",(function(){return Q})),i.d(e,"Alloc",(function(){return nt})),i.d(e,"Assert",(function(){return _})),i.d(e,"Free",(function(){return st})),i.d(e,"Log",(function(){return rt})),i.d(e,"MakeArray",(function(){return tt})),i.d(e,"MakeNullArray",(function(){return et})),i.d(e,"MakeNumberArray",(function(){return it})),i.d(e,"Maybe",(function(){return m})),i.d(e,"ParseInt",(function(){return H})),i.d(e,"ParseUInt",(function(){return $})),i.d(e,"StackAllocator",(function(){return qt})),i.d(e,"Counter",(function(){return Et})),i.d(e,"Timer",(function(){return zt})),i.d(e,"BroadPhase",(function(){return Ne})),i.d(e,"Pair",(function(){return Ee})),i.d(e,"ChainShape",(function(){return Ke})),i.d(e,"CircleShape",(function(){return He})),i.d(e,"CollideCircles",(function(){return ei})),i.d(e,"CollidePolygonAndCircle",(function(){return ri})),i.d(e,"CollideEdgeAndCircle",(function(){return di})),i.d(e,"CollideEdgeAndPolygon",(function(){return Fi})),i.d(e,"CollidePolygons",(function(){return $i})),i.d(e,"AABB",(function(){return Ie})),i.d(e,"ClipVertex",(function(){return ke})),i.d(e,"ContactFeature",(function(){return Se})),i.d(e,"ContactID",(function(){return Ae})),i.d(e,"Manifold",(function(){return ge})),i.d(e,"ManifoldPoint",(function(){return Ce})),i.d(e,"RayCastInput",(function(){return Me})),i.d(e,"RayCastOutput",(function(){return Pe})),i.d(e,"WorldManifold",(function(){return Ve})),i.d(e,"ContactFeatureType",(function(){return he})),i.d(e,"ManifoldType",(function(){return Be})),i.d(e,"PointState",(function(){return be})),i.d(e,"ClipSegmentToLine",(function(){return De})),i.d(e,"GetPointStates",(function(){return we})),i.d(e,"TestOverlapAABB",(function(){return Ge})),i.d(e,"TestOverlapShape",(function(){return je})),i.d(e,"DistanceInput",(function(){return Xt})),i.d(e,"DistanceOutput",(function(){return Zt})),i.d(e,"DistanceProxy",(function(){return Nt})),i.d(e,"ShapeCastInput",(function(){return Ut})),i.d(e,"ShapeCastOutput",(function(){return Wt})),i.d(e,"Simplex",(function(){return te})),i.d(e,"SimplexCache",(function(){return Jt})),i.d(e,"SimplexVertex",(function(){return $t})),i.d(e,"Distance",(function(){return le})),i.d(e,"gjk_reset",(function(){return Ht})),i.d(e,"ShapeCast",(function(){return xe})),i.d(e,"gjkCalls",(function(){return Qt})),i.d(e,"gjkIters",(function(){return Yt})),i.d(e,"gjkMaxIters",(function(){return Kt})),i.d(e,"DynamicTree",(function(){return qe})),i.d(e,"TreeNode",(function(){return Oe})),i.d(e,"EdgeShape",(function(){return Ye})),i.d(e,"PolygonShape",(function(){return tn})),i.d(e,"Shape",(function(){return Qe})),i.d(e,"MassData",(function(){return We})),i.d(e,"ShapeType",(function(){return ze})),i.d(e,"SeparationFunction",(function(){return An})),i.d(e,"TOIInput",(function(){return pn})),i.d(e,"TOIOutput",(function(){return Bn})),i.d(e,"SeparationFunctionType",(function(){return xn})),i.d(e,"TOIOutputState",(function(){return hn})),i.d(e,"TimeOfImpact",(function(){return Gn})),i.d(e,"toi_reset",(function(){return ln})),i.d(e,"toiCalls",(function(){return sn})),i.d(e,"toiIters",(function(){return rn})),i.d(e,"toiMaxIters",(function(){return on})),i.d(e,"toiMaxRootIters",(function(){return un})),i.d(e,"toiMaxTime",(function(){return nn})),i.d(e,"toiRootIters",(function(){return an})),i.d(e,"toiTime",(function(){return en})),i.d(e,"AreaJointDef",(function(){return zn})),i.d(e,"AreaJoint",(function(){return En})),i.d(e,"Body",(function(){return Yn})),i.d(e,"BodyDef",(function(){return Qn})),i.d(e,"BodyType",(function(){return Un})),i.d(e,"staticBody",(function(){return io})),i.d(e,"kinematicBody",(function(){return no})),i.d(e,"dynamicBody",(function(){return so})),i.d(e,"ChainAndCircleContact",(function(){return is})),i.d(e,"ChainAndPolygonContact",(function(){return ns})),i.d(e,"CircleContact",(function(){return ss})),i.d(e,"ContactFactory",(function(){return hs})),i.d(e,"ContactRegister",(function(){return ls})),i.d(e,"ContactManager",(function(){return ys})),i.d(e,"ContactPositionConstraint",(function(){return ks})),i.d(e,"ContactSolver",(function(){return Is})),i.d(e,"ContactSolverDef",(function(){return Ms})),i.d(e,"ContactVelocityConstraint",(function(){return ws})),i.d(e,"PositionSolverManifold",(function(){return Ps})),i.d(e,"VelocityConstraintPoint",(function(){return Vs})),i.d(e,"blockSolve",(function(){return Cs})),i.d(e,"get_g_blockSolve",(function(){return bs})),i.d(e,"set_g_blockSolve",(function(){return gs})),i.d(e,"Contact",(function(){return es})),i.d(e,"ContactEdge",(function(){return ts})),i.d(e,"MixFriction",(function(){return Kn})),i.d(e,"MixRestitution",(function(){return Hn})),i.d(e,"MixRestitutionThreshold",(function(){return $n})),i.d(e,"DistanceJointDef",(function(){return On})),i.d(e,"DistanceJoint",(function(){return qn})),i.d(e,"EdgeAndCircleContact",(function(){return as})),i.d(e,"EdgeAndPolygonContact",(function(){return us})),i.d(e,"Filter",(function(){return Jn})),i.d(e,"Fixture",(function(){return Wn})),i.d(e,"FixtureDef",(function(){return Xn})),i.d(e,"FixtureProxy",(function(){return Zn})),i.d(e,"FrictionJointDef",(function(){return Gs})),i.d(e,"FrictionJoint",(function(){return Ds})),i.d(e,"GearJointDef",(function(){return Fs})),i.d(e,"GearJoint",(function(){return Ls})),i.d(e,"Island",(function(){return Rs})),i.d(e,"JointDef",(function(){return Ln})),i.d(e,"Joint",(function(){return Tn})),i.d(e,"Jacobian",(function(){return Dn})),i.d(e,"JointEdge",(function(){return Fn})),i.d(e,"JointType",(function(){return Sn})),i.d(e,"AngularStiffness",(function(){return jn})),i.d(e,"LinearStiffness",(function(){return Rn})),i.d(e,"MotorJointDef",(function(){return js})),i.d(e,"MotorJoint",(function(){return Ts})),i.d(e,"MouseJointDef",(function(){return Os})),i.d(e,"MouseJoint",(function(){return qs})),i.d(e,"PolygonAndCircleContact",(function(){return os})),i.d(e,"PolygonContact",(function(){return rs})),i.d(e,"PrismaticJointDef",(function(){return zs})),i.d(e,"PrismaticJoint",(function(){return Es})),i.d(e,"PulleyJointDef",(function(){return Js})),i.d(e,"PulleyJoint",(function(){return Xs})),i.d(e,"minPulleyLength",(function(){return Ns})),i.d(e,"RevoluteJointDef",(function(){return Zs})),i.d(e,"RevoluteJoint",(function(){return Us})),i.d(e,"Position",(function(){return Bs})),i.d(e,"Profile",(function(){return ps})),i.d(e,"SolverData",(function(){return As})),i.d(e,"TimeStep",(function(){return xs})),i.d(e,"Velocity",(function(){return Ss})),i.d(e,"WeldJointDef",(function(){return Ws})),i.d(e,"WeldJoint",(function(){return Qs})),i.d(e,"WheelJointDef",(function(){return Ks})),i.d(e,"WheelJoint",(function(){return Hs})),i.d(e,"ContactFilter",(function(){return ms})),i.d(e,"ContactImpulse",(function(){return cs})),i.d(e,"ContactListener",(function(){return fs})),i.d(e,"DestructionListener",(function(){return _s})),i.d(e,"QueryCallback",(function(){return ds})),i.d(e,"RayCastCallback",(function(){return vs})),i.d(e,"World",(function(){return Nr})),i.d(e,"RopeDef",(function(){return Xr})),i.d(e,"Rope",(function(){return Wr})),i.d(e,"RopeTuning",(function(){return Jr})),i.d(e,"BendingModel",(function(){return Er})),i.d(e,"springAngleBendingModel",(function(){return ro})),i.d(e,"pbdAngleBendingModel",(function(){return oo})),i.d(e,"xpbdAngleBendingModel",(function(){return ao})),i.d(e,"pbdDistanceBendingModel",(function(){return uo})),i.d(e,"pbdHeightBendingModel",(function(){return lo})),i.d(e,"pbdTriangleBendingModel",(function(){return ho})),i.d(e,"StretchingModel",(function(){return zr})),i.d(e,"pbdStretchingModel",(function(){return _o})),i.d(e,"xpbdStretchingModel",(function(){return mo})),i.d(e,"BuoyancyController",(function(){return Kr})),i.d(e,"ConstantAccelController",(function(){return Hr})),i.d(e,"ConstantForceController",(function(){return $r})),i.d(e,"Controller",(function(){return Yr})),i.d(e,"ControllerEdge",(function(){return Qr})),i.d(e,"GravityController",(function(){return to})),i.d(e,"TensorDampingController",(function(){return eo})),i.d(e,"ParticleGroup",(function(){return sr})),i.d(e,"ParticleGroupDef",(function(){return nr})),i.d(e,"ParticleGroupFlag",(function(){return er})),i.d(e,"FixtureParticleQueryCallback",(function(){return pr})),i.d(e,"GrowableBuffer",(function(){return yr})),i.d(e,"ParticleBodyContact",(function(){return Br})),i.d(e,"ParticleContact",(function(){return xr})),i.d(e,"ParticlePair",(function(){return Sr})),i.d(e,"ParticlePairSet",(function(){return Gr})),i.d(e,"ParticleSystem",(function(){return br})),i.d(e,"ParticleSystem_CompositeShape",(function(){return jr})),i.d(e,"ParticleSystem_ConnectionFilter",(function(){return Fr})),i.d(e,"ParticleSystemDef",(function(){return Cr})),i.d(e,"ParticleSystem_DestroyParticlesInShapeCallback",(function(){return Lr})),i.d(e,"ParticleSystem_FixedSetAllocator",(function(){return Mr})),i.d(e,"ParticleSystem_FixtureParticleSet",(function(){return Pr})),i.d(e,"ParticleSystem_InsideBoundsEnumerator",(function(){return wr})),i.d(e,"ParticleSystem_JoinParticleGroupsFilter",(function(){return Rr})),i.d(e,"ParticleSystem_ParticleListNode",(function(){return kr})),i.d(e,"ParticleSystem_Proxy",(function(){return Vr})),i.d(e,"ParticleSystem_ReactiveFilter",(function(){return Tr})),i.d(e,"ParticleSystem_SolveCollisionCallback",(function(){return qr})),i.d(e,"ParticleSystem_UpdateBodyContactsCallback",(function(){return Or})),i.d(e,"ParticleSystem_UserOverridableBuffer",(function(){return gr})),i.d(e,"ParticleTriad",(function(){return Ar})),i.d(e,"ParticleDef",(function(){return $s})),i.d(e,"ParticleHandle",(function(){return ir})),i.d(e,"ParticleFlag",(function(){return Ys})),i.d(e,"CalculateParticleIterations",(function(){return tr})),i.d(e,"StackQueue",(function(){return rr})),i.d(e,"VoronoiDiagram",(function(){return or})),i.d(e,"VoronoiDiagram_Generator",(function(){return ar})),i.d(e,"VoronoiDiagram_Task",(function(){return ur}));var n=i(33),s=function t(){Object(n.a)(this,t)},r=i(40),o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(n.a)(this,t),this.r=e,this.g=i,this.b=s,this.a=r}return Object(r.a)(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"IsEqual",value:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}},{key:"IsZero",value:function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}},{key:"Set",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.a;this.SetRGBA(t,e,i,n)}},{key:"SetByteRGB",value:function(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this}},{key:"SetByteRGBA",value:function(t,e,i,n){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=n/255,this}},{key:"SetRGB",value:function(t,e,i){return this.r=t,this.g=e,this.b=i,this}},{key:"SetRGBA",value:function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this}},{key:"SelfAdd",value:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}},{key:"Add",value:function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e}},{key:"SelfSub",value:function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}},{key:"Sub",value:function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e}},{key:"SelfMul",value:function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}},{key:"Mul",value:function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e}},{key:"Mix",value:function(e,i){t.MixColors(this,e,i)}},{key:"MakeStyleString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.a;return t.MakeStyleString(this.r,this.g,this.b,e)}}],[{key:"MixColors",value:function(t,e,i){var n=i*(e.r-t.r),s=i*(e.g-t.g),r=i*(e.b-t.b),o=i*(e.a-t.a);t.r+=n,t.g+=s,t.b+=r,t.a+=o,e.r-=n,e.g-=s,e.b-=r,e.a-=o}},{key:"MakeStyleString",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return t*=255,e*=255,i*=255,n<1?"rgba(".concat(t,",").concat(e,",").concat(i,",").concat(n,")"):"rgb(".concat(t,",").concat(e,",").concat(i,")")}}]),t}();o.ZERO=new o(0,0,0,0),o.RED=new o(1,0,0),o.GREEN=new o(0,1,0),o.BLUE=new o(0,0,1);var a,u=function(){function t(){Object(n.a)(this,t);for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];if(i[0]instanceof Float32Array){if(4!==i[0].length)throw new Error;this.data=i[0]}else{var r="number"===typeof i[0]?i[0]:.5,o="number"===typeof i[1]?i[1]:.5,a="number"===typeof i[2]?i[2]:.5,u="number"===typeof i[3]?i[3]:1;this.data=new Float32Array([r,o,a,u])}}return Object(r.a)(t,[{key:"r",get:function(){return this.data[0]},set:function(t){this.data[0]=t}},{key:"g",get:function(){return this.data[1]},set:function(t){this.data[1]=t}},{key:"b",get:function(){return this.data[2]},set:function(t){this.data[2]=t}},{key:"a",get:function(){return this.data[3]},set:function(t){this.data[3]=t}},{key:"Clone",value:function(){return new t(new Float32Array(this.data))}},{key:"Copy",value:function(e){return e instanceof t?this.data.set(e.data):(this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a),this}},{key:"IsEqual",value:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}},{key:"IsZero",value:function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}},{key:"Set",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.a;this.SetRGBA(t,e,i,n)}},{key:"SetByteRGB",value:function(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this}},{key:"SetByteRGBA",value:function(t,e,i,n){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=n/255,this}},{key:"SetRGB",value:function(t,e,i){return this.r=t,this.g=e,this.b=i,this}},{key:"SetRGBA",value:function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this}},{key:"SelfAdd",value:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}},{key:"Add",value:function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e}},{key:"SelfSub",value:function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}},{key:"Sub",value:function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e}},{key:"SelfMul",value:function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}},{key:"Mul",value:function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e}},{key:"Mix",value:function(t,e){o.MixColors(this,t,e)}},{key:"MakeStyleString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.a;return o.MakeStyleString(this.r,this.g,this.b,t)}}]),t}();!function(t){t[t.e_none=0]="e_none",t[t.e_shapeBit=1]="e_shapeBit",t[t.e_jointBit=2]="e_jointBit",t[t.e_aabbBit=4]="e_aabbBit",t[t.e_pairBit=8]="e_pairBit",t[t.e_centerOfMassBit=16]="e_centerOfMassBit",t[t.e_particleBit=32]="e_particleBit",t[t.e_particleTriadBit=128]="e_particleTriadBit",t[t.e_controllerBit=64]="e_controllerBit",t[t.e_all=63]="e_all"}(a||(a={}));var l=function(){function t(){Object(n.a)(this,t),this.m_drawFlags=0}return Object(r.a)(t,[{key:"SetFlags",value:function(t){this.m_drawFlags=t}},{key:"GetFlags",value:function(){return this.m_drawFlags}},{key:"AppendFlags",value:function(t){this.m_drawFlags|=t}},{key:"ClearFlags",value:function(t){this.m_drawFlags&=~t}}]),t}(),h=i(400);function _(t){if(!t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];throw Object(h.a)(Error,i)}}function m(t,e){return void 0!==t?t:e}var c=1e37,f=1e-5,d=f*f,v=3.14159265359,y=1,p=8,x=2,B=.1*y,S=4,A=.005*y,C=2/180*v,b=2*A,g=8,V=32,w=.2*y,k=8/180*v,M=2*y,P=M*M,I=.5*v,G=I*I,D=.2,F=.75,L=-1,R=2147483647,j=.75,T=1,O=.25,q=.5,z=2*y,E=z*z,N=256,J=2.5,X=.5,Z=.01*y,U=2/180*v,W=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(n.a)(this,t),this.major=0,this.minor=0,this.revision=0,this.major=e,this.minor=i,this.revision=s}return Object(r.a)(t,[{key:"toString",value:function(){return this.major+"."+this.minor+"."+this.revision}}]),t}(),Q=new W(2,4,1),Y="master",K="9ebbbcd960ad424e03e5de6e66a40764c16f51bc";function H(t){return parseInt(t,10)}function $(t){return Math.abs(parseInt(t,10))}function tt(t,e){for(var i=new Array(t),n=0;n<t;++n)i[n]=e(n);return i}function et(t){for(var e=new Array(t),i=0;i<t;++i)e[i]=null;return e}function it(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=new Array(t),n=0;n<t;++n)i[n]=e;return i}function nt(t){return null}function st(t){}function rt(t){}var ot=function(){function t(e){Object(n.a)(this,t),this.m_stack=[],this.m_count=0,this.m_stack=tt(e,(function(t){return null})),this.m_count=0}return Object(r.a)(t,[{key:"Reset",value:function(){return this.m_count=0,this}},{key:"Push",value:function(t){this.m_stack[this.m_count]=t,this.m_count++}},{key:"Pop",value:function(){this.m_count--;var t=this.m_stack[this.m_count];return this.m_stack[this.m_count]=null,t}},{key:"GetCount",value:function(){return this.m_count}}]),t}(),at=v/180,ut=180/v,lt=2*v,ht=Math.abs;function _t(t,e){return t<e?t:e}function mt(t,e){return t>e?t:e}function ct(t,e,i){return t<e?e:t>i?i:t}function ft(t,e){var i=t[0];t[0]=e[0],e[0]=i}var dt=isFinite;function vt(t){return t*t}function yt(t){return 1/Math.sqrt(t)}var pt=Math.sqrt,xt=Math.pow;function Bt(t){return t*at}function St(t){return t*ut}var At=Math.cos,Ct=Math.sin,bt=Math.acos,gt=Math.asin,Vt=Math.atan2;function wt(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,(t|=t>>16&65535)+1}function kt(t){return t>0&&0===(t&t-1)}function Mt(){return 2*Math.random()-1}function Pt(t,e){return(e-t)*Math.random()+t}var It=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(n.a)(this,t),this.x=e,this.y=i}return Object(r.a)(t,[{key:"Clone",value:function(){return new t(this.x,this.y)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this}},{key:"Set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"SelfAddXY",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"SelfSubXY",value:function(t,e){return this.x-=t,this.y-=e,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this}},{key:"SelfMulAdd",value:function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}},{key:"SelfMulSub",value:function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}},{key:"Dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"Cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"Length",value:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}},{key:"LengthSquared",value:function(){var t=this.x,e=this.y;return t*t+e*e}},{key:"Normalize",value:function(){var t=this.Length();if(t>=f){var e=1/t;this.x*=e,this.y*=e}return t}},{key:"SelfNormalize",value:function(){var t=this.Length();if(t>=f){var e=1/t;this.x*=e,this.y*=e}return this}},{key:"SelfRotate",value:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.x;return this.x=e*n-i*this.y,this.y=i*n+e*this.y,this}},{key:"SelfRotateCosSin",value:function(t,e){var i=this.x;return this.x=t*i-e*this.y,this.y=e*i+t*this.y,this}},{key:"IsValid",value:function(){return isFinite(this.x)&&isFinite(this.y)}},{key:"SelfCrossVS",value:function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this}},{key:"SelfCrossSV",value:function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this}},{key:"SelfMinV",value:function(t){return this.x=_t(this.x,t.x),this.y=_t(this.y,t.y),this}},{key:"SelfMaxV",value:function(t){return this.x=mt(this.x,t.x),this.y=mt(this.y,t.y),this}},{key:"SelfAbs",value:function(){return this.x=ht(this.x),this.y=ht(this.y),this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"SelfSkew",value:function(){var t=this.x;return this.x=-this.y,this.y=t,this}}],[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}},{key:"AbsV",value:function(t,e){return e.x=ht(t.x),e.y=ht(t.y),e}},{key:"MinV",value:function(t,e,i){return i.x=_t(t.x,e.x),i.y=_t(t.y,e.y),i}},{key:"MaxV",value:function(t,e,i){return i.x=mt(t.x,e.x),i.y=mt(t.y,e.y),i}},{key:"ClampV",value:function(t,e,i,n){return n.x=ct(t.x,e.x,i.x),n.y=ct(t.y,e.y,i.y),n}},{key:"RotateV",value:function(t,e,i){var n=t.x,s=t.y,r=Math.cos(e),o=Math.sin(e);return i.x=r*n-o*s,i.y=o*n+r*s,i}},{key:"DotVV",value:function(t,e){return t.x*e.x+t.y*e.y}},{key:"CrossVV",value:function(t,e){return t.x*e.y-t.y*e.x}},{key:"CrossVS",value:function(t,e,i){var n=t.x;return i.x=e*t.y,i.y=-e*n,i}},{key:"CrossVOne",value:function(t,e){var i=t.x;return e.x=t.y,e.y=-i,e}},{key:"CrossSV",value:function(t,e,i){var n=e.x;return i.x=-t*e.y,i.y=t*n,i}},{key:"CrossOneV",value:function(t,e){var i=t.x;return e.x=-t.y,e.y=i,e}},{key:"AddVV",value:function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i}},{key:"SubVV",value:function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i}},{key:"MulSV",value:function(t,e,i){return i.x=e.x*t,i.y=e.y*t,i}},{key:"MulVS",value:function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i}},{key:"AddVMulSV",value:function(t,e,i,n){return n.x=t.x+e*i.x,n.y=t.y+e*i.y,n}},{key:"SubVMulSV",value:function(t,e,i,n){return n.x=t.x-e*i.x,n.y=t.y-e*i.y,n}},{key:"AddVCrossSV",value:function(t,e,i,n){return n.x=t.x-e*i.y,n.y=t.y+e*i.x,n}},{key:"MidVV",value:function(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i}},{key:"ExtVV",value:function(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i}},{key:"IsEqualToV",value:function(t,e){return t.x===e.x&&t.y===e.y}},{key:"DistanceVV",value:function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}},{key:"DistanceSquaredVV",value:function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n}},{key:"NegV",value:function(t,e){return e.x=-t.x,e.y=-t.y,e}}]),t}();It.ZERO=new It(0,0),It.UNITX=new It(1,0),It.UNITY=new It(0,1),It.s_t0=new It,It.s_t1=new It,It.s_t2=new It,It.s_t3=new It;var Gt=new It(0,0),Dt=function(){function t(){Object(n.a)(this,t);for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];if(i[0]instanceof Float32Array){if(2!==i[0].length)throw new Error;this.data=i[0]}else{var r="number"===typeof i[0]?i[0]:0,o="number"===typeof i[1]?i[1]:0;this.data=new Float32Array([r,o])}}return Object(r.a)(t,[{key:"x",get:function(){return this.data[0]},set:function(t){this.data[0]=t}},{key:"y",get:function(){return this.data[1]},set:function(t){this.data[1]=t}},{key:"Clone",value:function(){return new t(new Float32Array(this.data))}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this}},{key:"Set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"Copy",value:function(e){return e instanceof t?this.data.set(e.data):(this.x=e.x,this.y=e.y),this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"SelfAddXY",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"SelfSubXY",value:function(t,e){return this.x-=t,this.y-=e,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this}},{key:"SelfMulAdd",value:function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}},{key:"SelfMulSub",value:function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}},{key:"Dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"Cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"Length",value:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}},{key:"LengthSquared",value:function(){var t=this.x,e=this.y;return t*t+e*e}},{key:"Normalize",value:function(){var t=this.Length();if(t>=f){var e=1/t;this.x*=e,this.y*=e}return t}},{key:"SelfNormalize",value:function(){var t=this.Length();if(t>=f){var e=1/t;this.x*=e,this.y*=e}return this}},{key:"SelfRotate",value:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.x;return this.x=e*n-i*this.y,this.y=i*n+e*this.y,this}},{key:"SelfRotateCosSin",value:function(t,e){var i=this.x;return this.x=t*i-e*this.y,this.y=e*i+t*this.y,this}},{key:"IsValid",value:function(){return isFinite(this.x)&&isFinite(this.y)}},{key:"SelfCrossVS",value:function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this}},{key:"SelfCrossSV",value:function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this}},{key:"SelfMinV",value:function(t){return this.x=_t(this.x,t.x),this.y=_t(this.y,t.y),this}},{key:"SelfMaxV",value:function(t){return this.x=mt(this.x,t.x),this.y=mt(this.y,t.y),this}},{key:"SelfAbs",value:function(){return this.x=ht(this.x),this.y=ht(this.y),this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"SelfSkew",value:function(){var t=this.x;return this.x=-this.y,this.y=t,this}}]),t}(),Ft=function(){function t(){Object(n.a)(this,t);for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];if(i[0]instanceof Float32Array){if(3!==i[0].length)throw new Error;this.data=i[0]}else{var r="number"===typeof i[0]?i[0]:0,o="number"===typeof i[1]?i[1]:0,a="number"===typeof i[2]?i[2]:0;this.data=new Float32Array([r,o,a])}}return Object(r.a)(t,[{key:"x",get:function(){return this.data[0]},set:function(t){this.data[0]=t}},{key:"y",get:function(){return this.data[1]},set:function(t){this.data[1]=t}},{key:"z",get:function(){return this.data[2]},set:function(t){this.data[2]=t}},{key:"Clone",value:function(){return new t(this.x,this.y,this.z)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this.z=0,this}},{key:"SetXYZ",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"SelfAddXYZ",value:function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"SelfSubXYZ",value:function(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}}],[{key:"DotV3V3",value:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}},{key:"CrossV3V3",value:function(t,e,i){var n=t.x,s=t.y,r=t.z,o=e.x,a=e.y,u=e.z;return i.x=s*u-r*a,i.y=r*o-n*u,i.z=n*a-s*o,i}}]),t}();Ft.ZERO=new Ft(0,0,0),Ft.s_t0=new Ft;var Lt=function(){function t(){Object(n.a)(this,t),this.ex=new It(1,0),this.ey=new It(0,1)}return Object(r.a)(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"SetSSSS",value:function(t,e,i,n){return this.ex.Set(t,i),this.ey.Set(e,n),this}},{key:"SetVV",value:function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this}},{key:"SetAngle",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.ex.Set(e,i),this.ey.Set(-i,e),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}},{key:"SetIdentity",value:function(){return this.ex.Set(1,0),this.ey.Set(0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this}},{key:"GetAngle",value:function(){return Math.atan2(this.ex.y,this.ex.x)}},{key:"GetInverse",value:function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,s=this.ey.y,r=e*s-i*n;return 0!==r&&(r=1/r),t.ex.x=r*s,t.ey.x=-r*i,t.ex.y=-r*n,t.ey.y=r*e,t}},{key:"Solve",value:function(t,e,i){var n=this.ex.x,s=this.ey.x,r=this.ex.y,o=this.ey.y,a=n*o-s*r;return 0!==a&&(a=1/a),i.x=a*(o*t-s*e),i.y=a*(n*e-r*t),i}},{key:"SelfAbs",value:function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this}},{key:"SelfInv",value:function(){return this.GetInverse(this),this}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this}},{key:"SelfSubM",value:function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this}}],[{key:"FromVV",value:function(e,i){return(new t).SetVV(e,i)}},{key:"FromSSSS",value:function(e,i,n,s){return(new t).SetSSSS(e,i,n,s)}},{key:"FromAngle",value:function(e){return(new t).SetAngle(e)}},{key:"AbsM",value:function(t,e){var i=t.ex,n=t.ey;return e.ex.x=ht(i.x),e.ex.y=ht(i.y),e.ey.x=ht(n.x),e.ey.y=ht(n.y),e}},{key:"MulMV",value:function(t,e,i){var n=t.ex,s=t.ey,r=e.x,o=e.y;return i.x=n.x*r+s.x*o,i.y=n.y*r+s.y*o,i}},{key:"MulTMV",value:function(t,e,i){var n=t.ex,s=t.ey,r=e.x,o=e.y;return i.x=n.x*r+n.y*o,i.y=s.x*r+s.y*o,i}},{key:"AddMM",value:function(t,e,i){var n=t.ex,s=t.ey,r=e.ex,o=e.ey;return i.ex.x=n.x+r.x,i.ex.y=n.y+r.y,i.ey.x=s.x+o.x,i.ey.y=s.y+o.y,i}},{key:"MulMM",value:function(t,e,i){var n=t.ex.x,s=t.ex.y,r=t.ey.x,o=t.ey.y,a=e.ex.x,u=e.ex.y,l=e.ey.x,h=e.ey.y;return i.ex.x=n*a+r*u,i.ex.y=s*a+o*u,i.ey.x=n*l+r*h,i.ey.y=s*l+o*h,i}},{key:"MulTMM",value:function(t,e,i){var n=t.ex.x,s=t.ex.y,r=t.ey.x,o=t.ey.y,a=e.ex.x,u=e.ex.y,l=e.ey.x,h=e.ey.y;return i.ex.x=n*a+s*u,i.ex.y=r*a+o*u,i.ey.x=n*l+s*h,i.ey.y=r*l+o*h,i}}]),t}();Lt.IDENTITY=new Lt;var Rt=function(){function t(){Object(n.a)(this,t),this.data=new Float32Array([1,0,0,0,1,0,0,0,1]),this.ex=new Ft(this.data.subarray(0,3)),this.ey=new Ft(this.data.subarray(3,6)),this.ez=new Ft(this.data.subarray(6,9))}return Object(r.a)(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"SetVVV",value:function(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}},{key:"SetIdentity",value:function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this}},{key:"Solve33",value:function(t,e,i,n){var s=this.ex.x,r=this.ex.y,o=this.ex.z,a=this.ey.x,u=this.ey.y,l=this.ey.z,h=this.ez.x,_=this.ez.y,m=this.ez.z,c=s*(u*m-l*_)+r*(l*h-a*m)+o*(a*_-u*h);return 0!==c&&(c=1/c),n.x=c*(t*(u*m-l*_)+e*(l*h-a*m)+i*(a*_-u*h)),n.y=c*(s*(e*m-i*_)+r*(i*h-t*m)+o*(t*_-e*h)),n.z=c*(s*(u*i-l*e)+r*(l*t-a*i)+o*(a*e-u*t)),n}},{key:"Solve22",value:function(t,e,i){var n=this.ex.x,s=this.ey.x,r=this.ex.y,o=this.ey.y,a=n*o-s*r;return 0!==a&&(a=1/a),i.x=a*(o*t-s*e),i.y=a*(n*e-r*t),i}},{key:"GetInverse22",value:function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,s=this.ey.y,r=e*s-i*n;0!==r&&(r=1/r),t.ex.x=r*s,t.ey.x=-r*i,t.ex.z=0,t.ex.y=-r*n,t.ey.y=r*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}},{key:"GetSymInverse33",value:function(t){var e=Ft.DotV3V3(this.ex,Ft.CrossV3V3(this.ey,this.ez,Ft.s_t0));0!==e&&(e=1/e);var i=this.ex.x,n=this.ey.x,s=this.ez.x,r=this.ey.y,o=this.ez.y,a=this.ez.z;t.ex.x=e*(r*a-o*o),t.ex.y=e*(s*o-n*a),t.ex.z=e*(n*o-s*r),t.ey.x=t.ex.y,t.ey.y=e*(i*a-s*s),t.ey.z=e*(s*n-i*o),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*r-n*n)}}],[{key:"MulM33V3",value:function(t,e,i){var n=e.x,s=e.y,r=e.z;return i.x=t.ex.x*n+t.ey.x*s+t.ez.x*r,i.y=t.ex.y*n+t.ey.y*s+t.ez.y*r,i.z=t.ex.z*n+t.ey.z*s+t.ez.z*r,i}},{key:"MulM33XYZ",value:function(t,e,i,n,s){return s.x=t.ex.x*e+t.ey.x*i+t.ez.x*n,s.y=t.ex.y*e+t.ey.y*i+t.ez.y*n,s.z=t.ex.z*e+t.ey.z*i+t.ez.z*n,s}},{key:"MulM33V2",value:function(t,e,i){var n=e.x,s=e.y;return i.x=t.ex.x*n+t.ey.x*s,i.y=t.ex.y*n+t.ey.y*s,i}},{key:"MulM33XY",value:function(t,e,i,n){return n.x=t.ex.x*e+t.ey.x*i,n.y=t.ex.y*e+t.ey.y*i,n}}]),t}();Rt.IDENTITY=new Rt;var jt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(n.a)(this,t),this.s=0,this.c=1,e&&(this.s=Math.sin(e),this.c=Math.cos(e))}return Object(r.a)(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.s=t.s,this.c=t.c,this}},{key:"SetAngle",value:function(t){return this.s=Math.sin(t),this.c=Math.cos(t),this}},{key:"SetIdentity",value:function(){return this.s=0,this.c=1,this}},{key:"GetAngle",value:function(){return Math.atan2(this.s,this.c)}},{key:"GetXAxis",value:function(t){return t.x=this.c,t.y=this.s,t}},{key:"GetYAxis",value:function(t){return t.x=-this.s,t.y=this.c,t}}],[{key:"MulRR",value:function(t,e,i){var n=t.c,s=t.s,r=e.c,o=e.s;return i.s=s*r+n*o,i.c=n*r-s*o,i}},{key:"MulTRR",value:function(t,e,i){var n=t.c,s=t.s,r=e.c,o=e.s;return i.s=n*o-s*r,i.c=n*r+s*o,i}},{key:"MulRV",value:function(t,e,i){var n=t.c,s=t.s,r=e.x,o=e.y;return i.x=n*r-s*o,i.y=s*r+n*o,i}},{key:"MulTRV",value:function(t,e,i){var n=t.c,s=t.s,r=e.x,o=e.y;return i.x=n*r+s*o,i.y=-s*r+n*o,i}}]),t}();jt.IDENTITY=new jt;var Tt=function(){function t(){Object(n.a)(this,t),this.p=new It,this.q=new jt}return Object(r.a)(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}},{key:"SetIdentity",value:function(){return this.p.SetZero(),this.q.SetIdentity(),this}},{key:"SetPositionRotation",value:function(t,e){return this.p.Copy(t),this.q.Copy(e),this}},{key:"SetPositionAngle",value:function(t,e){return this.p.Copy(t),this.q.SetAngle(e),this}},{key:"SetPosition",value:function(t){return this.p.Copy(t),this}},{key:"SetPositionXY",value:function(t,e){return this.p.Set(t,e),this}},{key:"SetRotation",value:function(t){return this.q.Copy(t),this}},{key:"SetRotationAngle",value:function(t){return this.q.SetAngle(t),this}},{key:"GetPosition",value:function(){return this.p}},{key:"GetRotation",value:function(){return this.q}},{key:"GetRotationAngle",value:function(){return this.q.GetAngle()}},{key:"GetAngle",value:function(){return this.q.GetAngle()}}],[{key:"MulXV",value:function(t,e,i){var n=t.q.c,s=t.q.s,r=e.x,o=e.y;return i.x=n*r-s*o+t.p.x,i.y=s*r+n*o+t.p.y,i}},{key:"MulTXV",value:function(t,e,i){var n=t.q.c,s=t.q.s,r=e.x-t.p.x,o=e.y-t.p.y;return i.x=n*r+s*o,i.y=-s*r+n*o,i}},{key:"MulXX",value:function(t,e,i){return jt.MulRR(t.q,e.q,i.q),It.AddVV(jt.MulRV(t.q,e.p,i.p),t.p,i.p),i}},{key:"MulTXX",value:function(t,e,i){return jt.MulTRR(t.q,e.q,i.q),jt.MulTRV(t.q,It.SubVV(e.p,t.p,i.p),i.p),i}}]),t}();Tt.IDENTITY=new Tt;var Ot=function(){function t(){Object(n.a)(this,t),this.localCenter=new It,this.c0=new It,this.c=new It,this.a0=0,this.a=0,this.alpha0=0}return Object(r.a)(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}},{key:"GetTransform",value:function(t,e){t.p.x=(1-e)*this.c0.x+e*this.c.x,t.p.y=(1-e)*this.c0.y+e*this.c.y;var i=(1-e)*this.a0+e*this.a;return t.q.SetAngle(i),t.p.SelfSub(jt.MulRV(t.q,this.localCenter,It.s_t0)),t}},{key:"Advance",value:function(t){var e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t}},{key:"Normalize",value:function(){var t=lt*Math.floor(this.a0/lt);this.a0-=t,this.a-=t}}]),t}(),qt=function t(){Object(n.a)(this,t)},zt=function(){function t(){Object(n.a)(this,t),this.m_start=Date.now()}return Object(r.a)(t,[{key:"Reset",value:function(){return this.m_start=Date.now(),this}},{key:"GetMilliseconds",value:function(){return Date.now()-this.m_start}}]),t}(),Et=function(){function t(){Object(n.a)(this,t),this.m_count=0,this.m_min_count=0,this.m_max_count=0}return Object(r.a)(t,[{key:"GetCount",value:function(){return this.m_count}},{key:"GetMinCount",value:function(){return this.m_min_count}},{key:"GetMaxCount",value:function(){return this.m_max_count}},{key:"ResetCount",value:function(){var t=this.m_count;return this.m_count=0,t}},{key:"ResetMinCount",value:function(){this.m_min_count=0}},{key:"ResetMaxCount",value:function(){this.m_max_count=0}},{key:"Increment",value:function(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)}},{key:"Decrement",value:function(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)}}]),t}(),Nt=function(){function t(){Object(n.a)(this,t),this.m_buffer=It.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}return Object(r.a)(t,[{key:"Copy",value:function(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this}},{key:"Reset",value:function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}},{key:"SetShape",value:function(t,e){t.SetupDistanceProxy(this,e)}},{key:"SetVerticesRadius",value:function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i}},{key:"GetSupport",value:function(t){for(var e=0,i=It.DotVV(this.m_vertices[0],t),n=1;n<this.m_count;++n){var s=It.DotVV(this.m_vertices[n],t);s>i&&(e=n,i=s)}return e}},{key:"GetSupportVertex",value:function(t){for(var e=0,i=It.DotVV(this.m_vertices[0],t),n=1;n<this.m_count;++n){var s=It.DotVV(this.m_vertices[n],t);s>i&&(e=n,i=s)}return this.m_vertices[e]}},{key:"GetVertexCount",value:function(){return this.m_count}},{key:"GetVertex",value:function(t){return this.m_vertices[t]}}]),t}(),Jt=function(){function t(){Object(n.a)(this,t),this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}return Object(r.a)(t,[{key:"Reset",value:function(){return this.metric=0,this.count=0,this}}]),t}(),Xt=function(){function t(){Object(n.a)(this,t),this.proxyA=new Nt,this.proxyB=new Nt,this.transformA=new Tt,this.transformB=new Tt,this.useRadii=!1}return Object(r.a)(t,[{key:"Reset",value:function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}}]),t}(),Zt=function(){function t(){Object(n.a)(this,t),this.pointA=new It,this.pointB=new It,this.distance=0,this.iterations=0}return Object(r.a)(t,[{key:"Reset",value:function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}}]),t}(),Ut=function t(){Object(n.a)(this,t),this.proxyA=new Nt,this.proxyB=new Nt,this.transformA=new Tt,this.transformB=new Tt,this.translationB=new It},Wt=function t(){Object(n.a)(this,t),this.point=new It,this.normal=new It,this.lambda=0,this.iterations=0},Qt=0,Yt=0,Kt=0;function Ht(){Qt=0,Yt=0,Kt=0}var $t=function(){function t(){Object(n.a)(this,t),this.wA=new It,this.wB=new It,this.w=new It,this.a=0,this.indexA=0,this.indexB=0}return Object(r.a)(t,[{key:"Copy",value:function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}}]),t}(),te=function(){function t(){Object(n.a)(this,t),this.m_v1=new $t,this.m_v2=new $t,this.m_v3=new $t,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}return Object(r.a)(t,[{key:"ReadCache",value:function(t,e,i,n,s){this.m_count=t.count;for(var r=this.m_vertices,o=0;o<this.m_count;++o){var a=r[o];a.indexA=t.indexA[o],a.indexB=t.indexB[o];var u=e.GetVertex(a.indexA),l=n.GetVertex(a.indexB);Tt.MulXV(i,u,a.wA),Tt.MulXV(s,l,a.wB),It.SubVV(a.wB,a.wA,a.w),a.a=0}if(this.m_count>1){var h=t.metric,_=this.GetMetric();(_<.5*h||2*h<_||_<f)&&(this.m_count=0)}if(0===this.m_count){var m=r[0];m.indexA=0,m.indexB=0;var c=e.GetVertex(0),d=n.GetVertex(0);Tt.MulXV(i,c,m.wA),Tt.MulXV(s,d,m.wB),It.SubVV(m.wB,m.wA,m.w),m.a=1,this.m_count=1}}},{key:"WriteCache",value:function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB}},{key:"GetSearchDirection",value:function(t){switch(this.m_count){case 1:return It.NegV(this.m_v1.w,t);case 2:var e=It.SubVV(this.m_v2.w,this.m_v1.w,t);return It.CrossVV(e,It.NegV(this.m_v1.w,It.s_t0))>0?It.CrossOneV(e,t):It.CrossVOne(e,t);default:return t.SetZero()}}},{key:"GetClosestPoint",value:function(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:default:return t.SetZero()}}},{key:"GetWitnessPoints",value:function(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}}},{key:"GetMetric",value:function(){switch(this.m_count){case 0:case 1:return 0;case 2:return It.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return It.CrossVV(It.SubVV(this.m_v2.w,this.m_v1.w,It.s_t0),It.SubVV(this.m_v3.w,this.m_v1.w,It.s_t1));default:return 0}}},{key:"Solve2",value:function(){var e=this.m_v1.w,i=this.m_v2.w,n=It.SubVV(i,e,t.s_e12),s=-It.DotVV(e,n);if(s<=0)return this.m_v1.a=1,void(this.m_count=1);var r=It.DotVV(i,n);if(r<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);var o=1/(r+s);this.m_v1.a=r*o,this.m_v2.a=s*o,this.m_count=2}},{key:"Solve3",value:function(){var e=this.m_v1.w,i=this.m_v2.w,n=this.m_v3.w,s=It.SubVV(i,e,t.s_e12),r=It.DotVV(e,s),o=It.DotVV(i,s),a=-r,u=It.SubVV(n,e,t.s_e13),l=It.DotVV(e,u),h=It.DotVV(n,u),_=-l,m=It.SubVV(n,i,t.s_e23),c=It.DotVV(i,m),f=It.DotVV(n,m),d=-c,v=It.CrossVV(s,u),y=v*It.CrossVV(i,n),p=v*It.CrossVV(n,e),x=v*It.CrossVV(e,i);if(a<=0&&_<=0)return this.m_v1.a=1,void(this.m_count=1);if(o>0&&a>0&&x<=0){var B=1/(o+a);return this.m_v1.a=o*B,this.m_v2.a=a*B,void(this.m_count=2)}if(h>0&&_>0&&p<=0){var S=1/(h+_);return this.m_v1.a=h*S,this.m_v3.a=_*S,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(o<=0&&d<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(h<=0&&f<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(f>0&&d>0&&y<=0){var A=1/(f+d);return this.m_v2.a=f*A,this.m_v3.a=d*A,this.m_count=2,void this.m_v1.Copy(this.m_v3)}var C=1/(y+p+x);this.m_v1.a=y*C,this.m_v2.a=p*C,this.m_v3.a=x*C,this.m_count=3}}]),t}();te.s_e12=new It,te.s_e13=new It,te.s_e23=new It;var ee=new te,ie=[0,0,0],ne=[0,0,0],se=new It,re=new It,oe=new It,ae=new It,ue=new It;function le(t,e,i){++Qt;var n=i.proxyA,s=i.proxyB,r=i.transformA,o=i.transformB,a=ee;a.ReadCache(e,n,r,s,o);for(var u=a.m_vertices,l=ie,h=ne,_=0,m=0;m<20;){_=a.m_count;for(var c=0;c<_;++c)l[c]=u[c].indexA,h[c]=u[c].indexB;switch(a.m_count){case 1:break;case 2:a.Solve2();break;case 3:a.Solve3()}if(3===a.m_count)break;var v=a.GetSearchDirection(re);if(v.LengthSquared()<d)break;var y=u[a.m_count];y.indexA=n.GetSupport(jt.MulTRV(r.q,It.NegV(v,It.s_t0),ae)),Tt.MulXV(r,n.GetVertex(y.indexA),y.wA),y.indexB=s.GetSupport(jt.MulTRV(o.q,v,ue)),Tt.MulXV(o,s.GetVertex(y.indexB),y.wB),It.SubVV(y.wB,y.wA,y.w),++m,++Yt;for(var p=!1,x=0;x<_;++x)if(y.indexA===l[x]&&y.indexB===h[x]){p=!0;break}if(p)break;++a.m_count}if(Kt=mt(Kt,m),a.GetWitnessPoints(t.pointA,t.pointB),t.distance=It.DistanceVV(t.pointA,t.pointB),t.iterations=m,a.WriteCache(e),i.useRadii){var B=n.m_radius,S=s.m_radius;if(t.distance>B+S&&t.distance>f){t.distance-=B+S;var A=It.SubVV(t.pointB,t.pointA,oe);A.Normalize(),t.pointA.SelfMulAdd(B,A),t.pointB.SelfMulSub(S,A)}else{var C=It.MidVV(t.pointA,t.pointB,se);t.pointA.Copy(C),t.pointB.Copy(C),t.distance=0}}}var he,_e=new It,me=new te,ce=new It,fe=new It,de=new It,ve=new It,ye=new It,pe=new It;function xe(t,e){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();var i=e.proxyA,n=e.proxyB,s=mt(i.m_radius,b)+mt(n.m_radius,b),r=e.transformA,o=e.transformB,a=e.translationB,u=_e.Set(0,0),l=0,h=me;h.m_count=0;for(var _=h.m_vertices,m=i.GetSupport(jt.MulTRV(r.q,It.NegV(a,It.s_t1),It.s_t0)),c=Tt.MulXV(r,i.GetVertex(m),ce),f=n.GetSupport(jt.MulTRV(o.q,a,It.s_t0)),d=Tt.MulXV(o,n.GetVertex(f),fe),v=It.SubVV(c,d,de),y=mt(b,s-b),p=.5*A,x=0;x<20&&v.Length()-y>p;){t.iterations+=1,m=i.GetSupport(jt.MulTRV(r.q,It.NegV(v,It.s_t1),It.s_t0)),c=Tt.MulXV(r,i.GetVertex(m),ce),f=n.GetSupport(jt.MulTRV(o.q,v,It.s_t0)),d=Tt.MulXV(o,n.GetVertex(f),fe);var B=It.SubVV(c,d,ve);v.Normalize();var S=It.DotVV(v,B),C=It.DotVV(v,a);if(S-y>l*C){if(C<=0)return!1;if((l=(S-y)/C)>1)return!1;u.Copy(v).SelfNeg(),h.m_count=0}var g=_[h.m_count];switch(g.indexA=f,g.wA.Copy(d).SelfMulAdd(l,a),g.indexB=m,g.wB.Copy(c),g.w.Copy(g.wB).SelfSub(g.wA),g.a=1,h.m_count+=1,h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3()}if(3===h.m_count)return!1;h.GetClosestPoint(v),++x}if(0===x)return!1;var V=ye,w=pe;return h.GetWitnessPoints(V,w),v.LengthSquared()>0&&(u.Copy(v).SelfNeg(),u.Normalize()),t.normal.Copy(u),t.lambda=l,t.iterations=x,!0}!function(t){t[t.e_vertex=0]="e_vertex",t[t.e_face=1]="e_face"}(he||(he={}));var Be,Se=function(){function t(){Object(n.a)(this,t),this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}return Object(r.a)(t,[{key:"key",get:function(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key},set:function(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255}},{key:"indexA",get:function(){return this._indexA},set:function(t){this._indexA=t,this._key_invalid=!0}},{key:"indexB",get:function(){return this._indexB},set:function(t){this._indexB=t,this._key_invalid=!0}},{key:"typeA",get:function(){return this._typeA},set:function(t){this._typeA=t,this._key_invalid=!0}},{key:"typeB",get:function(){return this._typeB},set:function(t){this._typeB=t,this._key_invalid=!0}}]),t}(),Ae=function(){function t(){Object(n.a)(this,t),this.cf=new Se}return Object(r.a)(t,[{key:"Copy",value:function(t){return this.key=t.key,this}},{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"key",get:function(){return this.cf.key},set:function(t){this.cf.key=t}}]),t}(),Ce=function(){function t(){Object(n.a)(this,t),this.localPoint=new It,this.normalImpulse=0,this.tangentImpulse=0,this.id=new Ae}return Object(r.a)(t,[{key:"Reset",value:function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}},{key:"Copy",value:function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}();!function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_circles=0]="e_circles",t[t.e_faceA=1]="e_faceA",t[t.e_faceB=2]="e_faceB"}(Be||(Be={}));var be,ge=function(){function t(){Object(n.a)(this,t),this.points=Ce.MakeArray(x),this.localNormal=new It,this.localPoint=new It,this.type=Be.e_unknown,this.pointCount=0}return Object(r.a)(t,[{key:"Reset",value:function(){for(var t=0;t<x;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=Be.e_unknown,this.pointCount=0}},{key:"Copy",value:function(t){this.pointCount=t.pointCount;for(var e=0;e<x;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}},{key:"Clone",value:function(){return(new t).Copy(this)}}]),t}(),Ve=function(){function t(){Object(n.a)(this,t),this.normal=new It,this.points=It.MakeArray(x),this.separations=it(x)}return Object(r.a)(t,[{key:"Initialize",value:function(e,i,n,s,r){if(0!==e.pointCount)switch(e.type){case Be.e_circles:this.normal.Set(1,0);var o=Tt.MulXV(i,e.localPoint,t.Initialize_s_pointA),a=Tt.MulXV(s,e.points[0].localPoint,t.Initialize_s_pointB);It.DistanceSquaredVV(o,a)>d&&It.SubVV(a,o,this.normal).SelfNormalize();var u=It.AddVMulSV(o,n,this.normal,t.Initialize_s_cA),l=It.SubVMulSV(a,r,this.normal,t.Initialize_s_cB);It.MidVV(u,l,this.points[0]),this.separations[0]=It.DotVV(It.SubVV(l,u,It.s_t0),this.normal);break;case Be.e_faceA:jt.MulRV(i.q,e.localNormal,this.normal);for(var h=Tt.MulXV(i,e.localPoint,t.Initialize_s_planePoint),_=0;_<e.pointCount;++_){var m=Tt.MulXV(s,e.points[_].localPoint,t.Initialize_s_clipPoint),c=n-It.DotVV(It.SubVV(m,h,It.s_t0),this.normal),f=It.AddVMulSV(m,c,this.normal,t.Initialize_s_cA),v=It.SubVMulSV(m,r,this.normal,t.Initialize_s_cB);It.MidVV(f,v,this.points[_]),this.separations[_]=It.DotVV(It.SubVV(v,f,It.s_t0),this.normal)}break;case Be.e_faceB:jt.MulRV(s.q,e.localNormal,this.normal);for(var y=Tt.MulXV(s,e.localPoint,t.Initialize_s_planePoint),p=0;p<e.pointCount;++p){var x=Tt.MulXV(i,e.points[p].localPoint,t.Initialize_s_clipPoint),B=r-It.DotVV(It.SubVV(x,y,It.s_t0),this.normal),S=It.AddVMulSV(x,B,this.normal,t.Initialize_s_cB),A=It.SubVMulSV(x,n,this.normal,t.Initialize_s_cA);It.MidVV(A,S,this.points[p]),this.separations[p]=It.DotVV(It.SubVV(A,S,It.s_t0),this.normal)}this.normal.SelfNeg()}}}]),t}();function we(t,e,i,n){var s;for(s=0;s<i.pointCount;++s){var r=i.points[s].id.key;t[s]=be.b2_removeState;for(var o=0,a=n.pointCount;o<a;++o)if(n.points[o].id.key===r){t[s]=be.b2_persistState;break}}for(;s<x;++s)t[s]=be.b2_nullState;for(s=0;s<n.pointCount;++s){var u=n.points[s].id.key;e[s]=be.b2_addState;for(var l=0,h=i.pointCount;l<h;++l)if(i.points[l].id.key===u){e[s]=be.b2_persistState;break}}for(;s<x;++s)e[s]=be.b2_nullState}Ve.Initialize_s_pointA=new It,Ve.Initialize_s_pointB=new It,Ve.Initialize_s_cA=new It,Ve.Initialize_s_cB=new It,Ve.Initialize_s_planePoint=new It,Ve.Initialize_s_clipPoint=new It,function(t){t[t.b2_nullState=0]="b2_nullState",t[t.b2_addState=1]="b2_addState",t[t.b2_persistState=2]="b2_persistState",t[t.b2_removeState=3]="b2_removeState"}(be||(be={}));var ke=function(){function t(){Object(n.a)(this,t),this.v=new It,this.id=new Ae}return Object(r.a)(t,[{key:"Copy",value:function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),Me=function(){function t(){Object(n.a)(this,t),this.p1=new It,this.p2=new It,this.maxFraction=1}return Object(r.a)(t,[{key:"Copy",value:function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}}]),t}(),Pe=function(){function t(){Object(n.a)(this,t),this.normal=new It,this.fraction=0}return Object(r.a)(t,[{key:"Copy",value:function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}}]),t}(),Ie=function(){function t(){Object(n.a)(this,t),this.lowerBound=new It,this.upperBound=new It,this.m_cache_center=new It,this.m_cache_extent=new It}return Object(r.a)(t,[{key:"Copy",value:function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}},{key:"IsValid",value:function(){return!!this.lowerBound.IsValid()&&(!!this.upperBound.IsValid()&&(!(this.upperBound.x<this.lowerBound.x)&&!(this.upperBound.y<this.lowerBound.y)))}},{key:"GetCenter",value:function(){return It.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)}},{key:"GetExtents",value:function(){return It.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)}},{key:"GetPerimeter",value:function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))}},{key:"Combine1",value:function(t){return this.lowerBound.x=_t(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=_t(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=mt(this.upperBound.x,t.upperBound.x),this.upperBound.y=mt(this.upperBound.y,t.upperBound.y),this}},{key:"Combine2",value:function(t,e){return this.lowerBound.x=_t(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=_t(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=mt(t.upperBound.x,e.upperBound.x),this.upperBound.y=mt(t.upperBound.y,e.upperBound.y),this}},{key:"Contains",value:function(t){var e=!0;return e=(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y}},{key:"RayCast",value:function(t,e){var i=-c,n=c,s=e.p1.x,r=e.p1.y,o=e.p2.x-e.p1.x,a=e.p2.y-e.p1.y,u=ht(o),l=ht(a),h=t.normal;if(u<f){if(s<this.lowerBound.x||this.upperBound.x<s)return!1}else{var _=1/o,m=(this.lowerBound.x-s)*_,d=(this.upperBound.x-s)*_,v=-1;if(m>d){var y=m;m=d,d=y,v=1}if(m>i&&(h.x=v,h.y=0,i=m),i>(n=_t(n,d)))return!1}if(l<f){if(r<this.lowerBound.y||this.upperBound.y<r)return!1}else{var p=1/a,x=(this.lowerBound.y-r)*p,B=(this.upperBound.y-r)*p,S=-1;if(x>B){var A=x;x=B,B=A,S=1}if(x>i&&(h.x=0,h.y=S,i=x),i>(n=_t(n,B)))return!1}return!(i<0||e.maxFraction<i)&&(t.fraction=i,!0)}},{key:"TestContain",value:function(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x)&&!(t.y<this.lowerBound.y||this.upperBound.y<t.y)}},{key:"TestOverlap",value:function(t){return!(this.upperBound.x<t.lowerBound.x)&&(!(this.upperBound.y<t.lowerBound.y)&&(!(t.upperBound.x<this.lowerBound.x)&&!(t.upperBound.y<this.lowerBound.y)))}}],[{key:"Combine",value:function(t,e,i){return i.Combine2(t,e),i}}]),t}();function Ge(t,e){return!(t.upperBound.x<e.lowerBound.x)&&(!(t.upperBound.y<e.lowerBound.y)&&(!(e.upperBound.x<t.lowerBound.x)&&!(e.upperBound.y<t.lowerBound.y)))}function De(t,e,i,n,s){var r=0,o=e[0],a=e[1],u=It.DotVV(i,o.v)-n,l=It.DotVV(i,a.v)-n;if(u<=0&&t[r++].Copy(o),l<=0&&t[r++].Copy(a),u*l<0){var h=u/(u-l),_=t[r].v;_.x=o.v.x+h*(a.v.x-o.v.x),_.y=o.v.y+h*(a.v.y-o.v.y);var m=t[r].id;m.cf.indexA=s,m.cf.indexB=o.id.cf.indexB,m.cf.typeA=he.e_vertex,m.cf.typeB=he.e_face,++r}return r}var Fe=new Xt,Le=new Jt,Re=new Zt;function je(t,e,i,n,s,r){var o=Fe.Reset();o.proxyA.SetShape(t,e),o.proxyB.SetShape(i,n),o.transformA.Copy(s),o.transformB.Copy(r),o.useRadii=!0;var a=Le.Reset();a.count=0;var u=Re.Reset();return le(u,a,o),u.distance<10*f}function Te(t){if(null===t)throw new Error;return t}var Oe=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(n.a)(this,t),this.m_id=0,this.aabb=new Ie,this._userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.moved=!1,this.m_id=e}return Object(r.a)(t,[{key:"userData",get:function(){if(null===this._userData)throw new Error;return this._userData},set:function(t){if(null!==this._userData)throw new Error;this._userData=t}},{key:"Reset",value:function(){this._userData=null}},{key:"IsLeaf",value:function(){return null===this.child1}}]),t}(),qe=function(){function t(){Object(n.a)(this,t),this.m_root=null,this.m_freeList=null,this.m_insertionCount=0,this.m_stack=new ot(256)}return Object(r.a)(t,[{key:"Query",value:function(t,e){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var n=i.Pop();if(null!==n)if(n.aabb.TestOverlap(t))if(n.IsLeaf()){if(!e(n))return}else i.Push(n.child1),i.Push(n.child2)}}},{key:"QueryPoint",value:function(t,e){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var n=i.Pop();if(null!==n)if(n.aabb.TestContain(t))if(n.IsLeaf()){if(!e(n))return}else i.Push(n.child1),i.Push(n.child2)}}},{key:"RayCast",value:function(e,i){var n=e.p1,s=e.p2,r=It.SubVV(s,n,t.s_r);r.Normalize();var o=It.CrossOneV(r,t.s_v),a=It.AbsV(o,t.s_abs_v),u=e.maxFraction,l=t.s_segmentAABB,h=n.x+u*(s.x-n.x),_=n.y+u*(s.y-n.y);l.lowerBound.x=_t(n.x,h),l.lowerBound.y=_t(n.y,_),l.upperBound.x=mt(n.x,h),l.upperBound.y=mt(n.y,_);var m=this.m_stack.Reset();for(m.Push(this.m_root);m.GetCount()>0;){var c=m.Pop();if(null!==c&&Ge(c.aabb,l)){var f=c.aabb.GetCenter(),d=c.aabb.GetExtents();if(!(ht(It.DotVV(o,It.SubVV(n,f,It.s_t0)))-It.DotVV(a,d)>0))if(c.IsLeaf()){var v=t.s_subInput;v.p1.Copy(e.p1),v.p2.Copy(e.p2),v.maxFraction=u;var y=i(v,c);if(0===y)return;y>0&&(u=y,h=n.x+u*(s.x-n.x),_=n.y+u*(s.y-n.y),l.lowerBound.x=_t(n.x,h),l.lowerBound.y=_t(n.y,_),l.upperBound.x=mt(n.x,h),l.upperBound.y=mt(n.y,_))}else m.Push(c.child1),m.Push(c.child2)}}}},{key:"AllocateNode",value:function(){if(null!==this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e.height=0,e.moved=!1,e}return new Oe(t.s_node_id++)}},{key:"FreeNode",value:function(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,t.Reset(),this.m_freeList=t}},{key:"CreateProxy",value:function(t,e){var i=this.AllocateNode(),n=B,s=B;return i.aabb.lowerBound.x=t.lowerBound.x-n,i.aabb.lowerBound.y=t.lowerBound.y-s,i.aabb.upperBound.x=t.upperBound.x+n,i.aabb.upperBound.y=t.upperBound.y+s,i.userData=e,i.height=0,i.moved=!0,this.InsertLeaf(i),i}},{key:"DestroyProxy",value:function(t){this.RemoveLeaf(t),this.FreeNode(t)}},{key:"MoveProxy",value:function(e,i,n){var s=t.MoveProxy_s_fatAABB,r=B,o=B;s.lowerBound.x=i.lowerBound.x-r,s.lowerBound.y=i.lowerBound.y-o,s.upperBound.x=i.upperBound.x+r,s.upperBound.y=i.upperBound.y+o;var a=S*n.x,u=S*n.y;a<0?s.lowerBound.x+=a:s.upperBound.x+=a,u<0?s.lowerBound.y+=u:s.upperBound.y+=u;var l=e.aabb;if(l.Contains(i)){var h=t.MoveProxy_s_hugeAABB;if(h.lowerBound.x=s.lowerBound.x-4*r,h.lowerBound.y=s.lowerBound.y-4*o,h.upperBound.x=s.upperBound.x+4*r,h.upperBound.y=s.upperBound.y+4*o,h.Contains(l))return!1}return this.RemoveLeaf(e),e.aabb.Copy(s),this.InsertLeaf(e),e.moved=!0,!0}},{key:"InsertLeaf",value:function(e){if(++this.m_insertionCount,null===this.m_root)return this.m_root=e,void(this.m_root.parent=null);for(var i=e.aabb,n=this.m_root;!n.IsLeaf();){var s=Te(n.child1),r=Te(n.child2),o=n.aabb.GetPerimeter(),a=t.s_combinedAABB;a.Combine2(n.aabb,i);var u=a.GetPerimeter(),l=2*u,h=2*(u-o),_=void 0,m=t.s_aabb,c=void 0;s.IsLeaf()?(m.Combine2(i,s.aabb),_=m.GetPerimeter()+h):(m.Combine2(i,s.aabb),c=s.aabb.GetPerimeter(),_=m.GetPerimeter()-c+h);var f=void 0;if(r.IsLeaf()?(m.Combine2(i,r.aabb),f=m.GetPerimeter()+h):(m.Combine2(i,r.aabb),c=r.aabb.GetPerimeter(),f=m.GetPerimeter()-c+h),l<_&&l<f)break;n=_<f?s:r}var d=n.parent,v=this.AllocateNode();v.parent=d,v.aabb.Combine2(i,n.aabb),v.height=n.height+1,null!==d?(d.child1===n?d.child1=v:d.child2=v,v.child1=n,v.child2=e,n.parent=v,e.parent=v):(v.child1=n,v.child2=e,n.parent=v,e.parent=v,this.m_root=v);for(var y=e.parent;null!==y;){var p=Te((y=this.Balance(y)).child1),x=Te(y.child2);y.height=1+mt(p.height,x.height),y.aabb.Combine2(p.aabb,x.aabb),y=y.parent}}},{key:"RemoveLeaf",value:function(t){if(t!==this.m_root){var e=Te(t.parent),i=e&&e.parent,n=Te(e.child1===t?e.child2:e.child1);if(null!==i){i.child1===e?i.child1=n:i.child2=n,n.parent=i,this.FreeNode(e);for(var s=i;null!==s;){var r=Te((s=this.Balance(s)).child1),o=Te(s.child2);s.aabb.Combine2(r.aabb,o.aabb),s.height=1+mt(r.height,o.height),s=s.parent}}else this.m_root=n,n.parent=null,this.FreeNode(e)}else this.m_root=null}},{key:"Balance",value:function(t){if(t.IsLeaf()||t.height<2)return t;var e=Te(t.child1),i=Te(t.child2),n=i.height-e.height;if(n>1){var s=Te(i.child1),r=Te(i.child2);return i.child1=t,i.parent=t.parent,t.parent=i,null!==i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,s.height>r.height?(i.child2=s,t.child2=r,r.parent=t,t.aabb.Combine2(e.aabb,r.aabb),i.aabb.Combine2(t.aabb,s.aabb),t.height=1+mt(e.height,r.height),i.height=1+mt(t.height,s.height)):(i.child2=r,t.child2=s,s.parent=t,t.aabb.Combine2(e.aabb,s.aabb),i.aabb.Combine2(t.aabb,r.aabb),t.height=1+mt(e.height,s.height),i.height=1+mt(t.height,r.height)),i}if(n<-1){var o=Te(e.child1),a=Te(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,o.height>a.height?(e.child2=o,t.child1=a,a.parent=t,t.aabb.Combine2(i.aabb,a.aabb),e.aabb.Combine2(t.aabb,o.aabb),t.height=1+mt(i.height,a.height),e.height=1+mt(t.height,o.height)):(e.child2=a,t.child1=o,o.parent=t,t.aabb.Combine2(i.aabb,o.aabb),e.aabb.Combine2(t.aabb,a.aabb),t.height=1+mt(i.height,o.height),e.height=1+mt(t.height,a.height)),e}return t}},{key:"GetHeight",value:function(){return null===this.m_root?0:this.m_root.height}},{key:"GetAreaRatio",value:function(){if(null===this.m_root)return 0;var e=this.m_root.aabb.GetPerimeter();return t.GetAreaNode(this.m_root)/e}},{key:"ComputeHeight",value:function(){return t.ComputeHeightNode(this.m_root)}},{key:"ValidateStructure",value:function(t){if(null!==t&&(this.m_root,!t.IsLeaf())){var e=Te(t.child1),i=Te(t.child2);this.ValidateStructure(e),this.ValidateStructure(i)}}},{key:"ValidateMetrics",value:function(e){if(null!==e&&!e.IsLeaf()){var i=Te(e.child1),n=Te(e.child2);t.s_aabb.Combine2(i.aabb,n.aabb),this.ValidateMetrics(i),this.ValidateMetrics(n)}}},{key:"Validate",value:function(){}},{key:"GetMaxBalance",value:function(){return t.GetMaxBalanceNode(this.m_root,0)}},{key:"RebuildBottomUp",value:function(){this.Validate()}},{key:"ShiftOrigin",value:function(e){t.ShiftOriginNode(this.m_root,e)}}],[{key:"GetAreaNode",value:function(e){if(null===e)return 0;if(e.IsLeaf())return 0;var i=e.aabb.GetPerimeter();return i+=t.GetAreaNode(e.child1),i+=t.GetAreaNode(e.child2)}},{key:"ComputeHeightNode",value:function(e){return null===e||e.IsLeaf()?0:1+mt(t.ComputeHeightNode(e.child1),t.ComputeHeightNode(e.child2))}},{key:"GetMaxBalanceNode",value:function(t,e){if(null===t)return e;if(t.height<=1)return e;var i=Te(t.child1),n=Te(t.child2);return mt(e,ht(n.height-i.height))}},{key:"ShiftOriginNode",value:function(e,i){if(null!==e&&!(e.height<=1)){var n=e.child1,s=e.child2;t.ShiftOriginNode(n,i),t.ShiftOriginNode(s,i),e.aabb.lowerBound.SelfSub(i),e.aabb.upperBound.SelfSub(i)}}}]),t}();qe.s_r=new It,qe.s_v=new It,qe.s_abs_v=new It,qe.s_segmentAABB=new Ie,qe.s_subInput=new Me,qe.s_combinedAABB=new Ie,qe.s_aabb=new Ie,qe.s_node_id=0,qe.MoveProxy_s_fatAABB=new Ie,qe.MoveProxy_s_hugeAABB=new Ie;var ze,Ee=function t(e,i){Object(n.a)(this,t),this.proxyA=e,this.proxyB=i},Ne=function(){function t(){Object(n.a)(this,t),this.m_tree=new qe,this.m_proxyCount=0,this.m_moveBuffer=new Set,this.m_pairCount=0,this.m_pairBuffer=[]}return Object(r.a)(t,[{key:"CreateProxy",value:function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i}},{key:"DestroyProxy",value:function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}},{key:"MoveProxy",value:function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)}},{key:"TouchProxy",value:function(t){this.BufferMove(t)}},{key:"GetProxyCount",value:function(){return this.m_proxyCount}},{key:"UpdatePairs",value:function(t){var e=this;this.m_pairCount=0,this.m_moveBuffer.forEach((function(t){var i=t.aabb;e.m_tree.Query(i,(function(i){if(i.m_id===t.m_id)return!0;var n,s;if(i.moved&&i.m_id>t.m_id)return!0;if(i.m_id<t.m_id?(n=i,s=t):(n=t,s=i),e.m_pairCount===e.m_pairBuffer.length)e.m_pairBuffer[e.m_pairCount]=new Ee(n,s);else{var r=e.m_pairBuffer[e.m_pairCount];r.proxyA=n,r.proxyB=s}return++e.m_pairCount,!0}))}));for(var i=0;i<this.m_pairCount;++i){var n=this.m_pairBuffer[i];t(n.proxyA.userData,n.proxyB.userData)}this.m_moveBuffer.forEach((function(t){return t.moved=!1})),this.m_moveBuffer.clear()}},{key:"Query",value:function(t,e){this.m_tree.Query(t,e)}},{key:"QueryPoint",value:function(t,e){this.m_tree.QueryPoint(t,e)}},{key:"RayCast",value:function(t,e){this.m_tree.RayCast(t,e)}},{key:"GetTreeHeight",value:function(){return this.m_tree.GetHeight()}},{key:"GetTreeBalance",value:function(){return this.m_tree.GetMaxBalance()}},{key:"GetTreeQuality",value:function(){return this.m_tree.GetAreaRatio()}},{key:"ShiftOrigin",value:function(t){this.m_tree.ShiftOrigin(t)}},{key:"BufferMove",value:function(t){this.m_moveBuffer.add(t)}},{key:"UnBufferMove",value:function(t){this.m_moveBuffer.delete(t)}}]),t}(),Je=i(215),Xe=i(177),Ze=i(70),Ue=i(71),We=function t(){Object(n.a)(this,t),this.mass=0,this.center=new It(0,0),this.I=0};!function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_circleShape=0]="e_circleShape",t[t.e_edgeShape=1]="e_edgeShape",t[t.e_polygonShape=2]="e_polygonShape",t[t.e_chainShape=3]="e_chainShape",t[t.e_shapeTypeCount=4]="e_shapeTypeCount"}(ze||(ze={}));var Qe=function(){function t(e,i){Object(n.a)(this,t),this.m_type=ze.e_unknown,this.m_radius=0,this.m_type=e,this.m_radius=i}return Object(r.a)(t,[{key:"Copy",value:function(t){return this.m_radius=t.m_radius,this}},{key:"GetType",value:function(){return this.m_type}}]),t}(),Ye=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.call(this,ze.e_edgeShape,b)).m_vertex1=new It,t.m_vertex2=new It,t.m_vertex0=new It,t.m_vertex3=new It,t.m_oneSided=!1,t}return Object(r.a)(i,[{key:"SetOneSided",value:function(t,e,i,n){return this.m_vertex0.Copy(t),this.m_vertex1.Copy(e),this.m_vertex2.Copy(i),this.m_vertex3.Copy(n),this.m_oneSided=!0,this}},{key:"SetTwoSided",value:function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_oneSided=!1,this}},{key:"Clone",value:function(){return(new i).Copy(this)}},{key:"Copy",value:function(t){return Object(Je.a)(Object(Xe.a)(i.prototype),"Copy",this).call(this,t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_oneSided=t.m_oneSided,this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){return!1}},{key:"ComputeDistance",value:function(t,e,n,s){var r=Tt.MulXV(t,this.m_vertex1,i.ComputeDistance_s_v1),o=Tt.MulXV(t,this.m_vertex2,i.ComputeDistance_s_v2),a=It.SubVV(e,r,i.ComputeDistance_s_d),u=It.SubVV(o,r,i.ComputeDistance_s_s),l=It.DotVV(a,u);if(l>0){var h=It.DotVV(u,u);l>h?It.SubVV(e,o,a):a.SelfMulSub(l/h,u)}return n.Copy(a),n.Normalize()}},{key:"RayCast",value:function(t,e,n,s){var r=Tt.MulTXV(n,e.p1,i.RayCast_s_p1),o=Tt.MulTXV(n,e.p2,i.RayCast_s_p2),a=It.SubVV(o,r,i.RayCast_s_d),u=this.m_vertex1,l=this.m_vertex2,h=It.SubVV(l,u,i.RayCast_s_e),_=t.normal.Set(h.y,-h.x).SelfNormalize(),m=It.DotVV(_,It.SubVV(u,r,It.s_t0));if(this.m_oneSided&&m>0)return!1;var c=It.DotVV(_,a);if(0===c)return!1;var f=m/c;if(f<0||e.maxFraction<f)return!1;var d=It.AddVMulSV(r,f,a,i.RayCast_s_q),v=It.SubVV(l,u,i.RayCast_s_r),y=It.DotVV(v,v);if(0===y)return!1;var p=It.DotVV(It.SubVV(d,u,It.s_t0),v)/y;return!(p<0||1<p)&&(t.fraction=f,jt.MulRV(n.q,t.normal,t.normal),m>0&&t.normal.SelfNeg(),!0)}},{key:"ComputeAABB",value:function(t,e,n){var s=Tt.MulXV(e,this.m_vertex1,i.ComputeAABB_s_v1),r=Tt.MulXV(e,this.m_vertex2,i.ComputeAABB_s_v2);It.MinV(s,r,t.lowerBound),It.MaxV(s,r,t.upperBound);var o=this.m_radius;t.lowerBound.SelfSubXY(o,o),t.upperBound.SelfAddXY(o,o)}},{key:"ComputeMass",value:function(t,e){t.mass=0,It.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,n){return n.SetZero(),0}},{key:"Dump",value:function(t){t("    const shape: b2EdgeShape = new b2EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_oneSided = %s;\n",this.m_oneSided)}}]),i}(Qe);Ye.ComputeDistance_s_v1=new It,Ye.ComputeDistance_s_v2=new It,Ye.ComputeDistance_s_d=new It,Ye.ComputeDistance_s_s=new It,Ye.RayCast_s_p1=new It,Ye.RayCast_s_p2=new It,Ye.RayCast_s_d=new It,Ye.RayCast_s_e=new It,Ye.RayCast_s_q=new It,Ye.RayCast_s_r=new It,Ye.ComputeAABB_s_v1=new It,Ye.ComputeAABB_s_v2=new It;var Ke=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.call(this,ze.e_chainShape,b)).m_vertices=[],t.m_count=0,t.m_prevVertex=new It,t.m_nextVertex=new It,t}return Object(r.a)(i,[{key:"CreateLoop",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if("number"===typeof e[0][0]){var n=e[0];if(n.length%2!==0)throw new Error;return this._CreateLoop((function(t){return{x:n[2*t],y:n[2*t+1]}}),n.length/2)}var s=e[0],r=e[1]||s.length;return this._CreateLoop((function(t){return s[t]}),r)}},{key:"_CreateLoop",value:function(t,e){if(e<3)return this;this.m_count=e+1,this.m_vertices=It.MakeArray(this.m_count);for(var i=0;i<e;++i)this.m_vertices[i].Copy(t(i));return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this}},{key:"CreateChain",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if("number"===typeof e[0][0]){var n=e[0],s=e[1],r=e[2];if(n.length%2!==0)throw new Error;return this._CreateChain((function(t){return{x:n[2*t],y:n[2*t+1]}}),n.length/2,s,r)}var o=e[0],a=e[1]||o.length,u=e[2],l=e[3];return this._CreateChain((function(t){return o[t]}),a,u,l)}},{key:"_CreateChain",value:function(t,e,i,n){this.m_count=e,this.m_vertices=It.MakeArray(e);for(var s=0;s<e;++s)this.m_vertices[s].Copy(t(s));return this.m_prevVertex.Copy(i),this.m_nextVertex.Copy(n),this}},{key:"Clone",value:function(){return(new i).Copy(this)}},{key:"Copy",value:function(t){return Object(Je.a)(Object(Xe.a)(i.prototype),"Copy",this).call(this,t),this._CreateChain((function(e){return t.m_vertices[e]}),t.m_count,t.m_prevVertex,t.m_nextVertex),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this}},{key:"GetChildCount",value:function(){return this.m_count-1}},{key:"GetChildEdge",value:function(t,e){t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),t.m_oneSided=!0,e>0?t.m_vertex0.Copy(this.m_vertices[e-1]):t.m_vertex0.Copy(this.m_prevVertex),e<this.m_count-2?t.m_vertex3.Copy(this.m_vertices[e+2]):t.m_vertex3.Copy(this.m_nextVertex)}},{key:"TestPoint",value:function(t,e){return!1}},{key:"ComputeDistance",value:function(t,e,n,s){var r=i.ComputeDistance_s_edgeShape;return this.GetChildEdge(r,s),r.ComputeDistance(t,e,n,0)}},{key:"RayCast",value:function(t,e,n,s){var r=i.RayCast_s_edgeShape;return r.m_vertex1.Copy(this.m_vertices[s]),r.m_vertex2.Copy(this.m_vertices[(s+1)%this.m_count]),r.RayCast(t,e,n,0)}},{key:"ComputeAABB",value:function(t,e,n){var s=this.m_vertices[n],r=this.m_vertices[(n+1)%this.m_count],o=Tt.MulXV(e,s,i.ComputeAABB_s_v1),a=Tt.MulXV(e,r,i.ComputeAABB_s_v2),u=It.MinV(o,a,i.ComputeAABB_s_lower),l=It.MaxV(o,a,i.ComputeAABB_s_upper);t.lowerBound.x=u.x-this.m_radius,t.lowerBound.y=u.y-this.m_radius,t.upperBound.x=l.x+this.m_radius,t.upperBound.y=l.y+this.m_radius}},{key:"ComputeMass",value:function(t,e){t.mass=0,t.center.SetZero(),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,n){return n.SetZero(),0}},{key:"Dump",value:function(t){t("    const shape: b2ChainShape = new b2ChainShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(var e=0;e<this.m_count;++e)t("    vs[%d] = new bVec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y)}}]),i}(Qe);Ke.ComputeDistance_s_edgeShape=new Ye,Ke.RayCast_s_edgeShape=new Ye,Ke.ComputeAABB_s_v1=new It,Ke.ComputeAABB_s_v2=new It,Ke.ComputeAABB_s_lower=new It,Ke.ComputeAABB_s_upper=new It;var He=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object(n.a)(this,i),(t=e.call(this,ze.e_circleShape,s)).m_p=new It,t}return Object(r.a)(i,[{key:"Set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.m_radius;return this.m_p.Copy(t),this.m_radius=e,this}},{key:"Clone",value:function(){return(new i).Copy(this)}},{key:"Copy",value:function(t){return Object(Je.a)(Object(Xe.a)(i.prototype),"Copy",this).call(this,t),this.m_p.Copy(t.m_p),this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){var n=Tt.MulXV(t,this.m_p,i.TestPoint_s_center),s=It.SubVV(e,n,i.TestPoint_s_d);return It.DotVV(s,s)<=vt(this.m_radius)}},{key:"ComputeDistance",value:function(t,e,n,s){var r=Tt.MulXV(t,this.m_p,i.ComputeDistance_s_center);return It.SubVV(e,r,n),n.Normalize()-this.m_radius}},{key:"RayCast",value:function(t,e,n,s){var r=Tt.MulXV(n,this.m_p,i.RayCast_s_position),o=It.SubVV(e.p1,r,i.RayCast_s_s),a=It.DotVV(o,o)-vt(this.m_radius),u=It.SubVV(e.p2,e.p1,i.RayCast_s_r),l=It.DotVV(o,u),h=It.DotVV(u,u),_=l*l-h*a;if(_<0||h<f)return!1;var m=-(l+pt(_));return 0<=m&&m<=e.maxFraction*h&&(m/=h,t.fraction=m,It.AddVMulSV(o,m,u,t.normal).SelfNormalize(),!0)}},{key:"ComputeAABB",value:function(t,e,n){var s=Tt.MulXV(e,this.m_p,i.ComputeAABB_s_p);t.lowerBound.Set(s.x-this.m_radius,s.y-this.m_radius),t.upperBound.Set(s.x+this.m_radius,s.y+this.m_radius)}},{key:"ComputeMass",value:function(t,e){var i=vt(this.m_radius);t.mass=e*v*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+It.DotVV(this.m_p,this.m_p))}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,n){var s=Tt.MulXV(i,this.m_p,new It),r=-(It.DotVV(t,s)-e);if(r<-this.m_radius+f)return 0;if(r>this.m_radius)return n.Copy(s),v*this.m_radius*this.m_radius;var o=this.m_radius*this.m_radius,a=r*r,u=o*(gt(r/this.m_radius)+v/2)+r*pt(o-a),l=-2/3*xt(o-a,1.5)/u;return n.x=s.x+t.x*l,n.y=s.y+t.y*l,u}},{key:"Dump",value:function(t){t("    const shape: b2CircleShape = new b2CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)}}]),i}(Qe);He.TestPoint_s_center=new It,He.TestPoint_s_d=new It,He.ComputeDistance_s_center=new It,He.RayCast_s_position=new It,He.RayCast_s_s=new It,He.RayCast_s_r=new It,He.ComputeAABB_s_p=new It;var $e=new It,ti=new It;function ei(t,e,i,n,s){t.pointCount=0;var r=Tt.MulXV(i,e.m_p,$e),o=Tt.MulXV(s,n.m_p,ti),a=It.DistanceSquaredVV(r,o),u=e.m_radius+n.m_radius;a>u*u||(t.type=Be.e_circles,t.localPoint.Copy(e.m_p),t.localNormal.SetZero(),t.pointCount=1,t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0)}var ii=new It,ni=new It,si=new It;function ri(t,e,i,n,s){t.pointCount=0;for(var r=Tt.MulXV(s,n.m_p,ii),o=Tt.MulTXV(i,r,ni),a=0,u=-c,l=e.m_radius+n.m_radius,h=e.m_count,_=e.m_vertices,m=e.m_normals,d=0;d<h;++d){var v=It.DotVV(m[d],It.SubVV(o,_[d],It.s_t0));if(v>l)return;v>u&&(u=v,a=d)}var y=a,p=(y+1)%h,x=_[y],B=_[p];if(u<f)return t.pointCount=1,t.type=Be.e_faceA,t.localNormal.Copy(m[a]),It.MidVV(x,B,t.localPoint),t.points[0].localPoint.Copy(n.m_p),void(t.points[0].id.key=0);var S=It.DotVV(It.SubVV(o,x,It.s_t0),It.SubVV(B,x,It.s_t1)),A=It.DotVV(It.SubVV(o,B,It.s_t0),It.SubVV(x,B,It.s_t1));if(S<=0){if(It.DistanceSquaredVV(o,x)>l*l)return;t.pointCount=1,t.type=Be.e_faceA,It.SubVV(o,x,t.localNormal).SelfNormalize(),t.localPoint.Copy(x),t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0}else if(A<=0){if(It.DistanceSquaredVV(o,B)>l*l)return;t.pointCount=1,t.type=Be.e_faceA,It.SubVV(o,B,t.localNormal).SelfNormalize(),t.localPoint.Copy(B),t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0}else{var C=It.MidVV(x,B,si);if(It.DotVV(It.SubVV(o,C,It.s_t1),m[y])>l)return;t.pointCount=1,t.type=Be.e_faceA,t.localNormal.Copy(m[y]).SelfNormalize(),t.localPoint.Copy(C),t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0}}var oi,ai=new It,ui=new It,li=new It,hi=new It,_i=new It,mi=new It,ci=new It,fi=new Ae;function di(t,e,i,n,s){t.pointCount=0;var r=Tt.MulTXV(i,Tt.MulXV(s,n.m_p,It.s_t0),ai),o=e.m_vertex1,a=e.m_vertex2,u=It.SubVV(a,o,ui),l=ci.Set(u.y,-u.x),h=It.DotVV(l,It.SubVV(r,o,It.s_t0));if(!(e.m_oneSided&&h<0)){var _=It.DotVV(u,It.SubVV(a,r,It.s_t0)),m=It.DotVV(u,It.SubVV(r,o,It.s_t0)),c=e.m_radius+n.m_radius,f=fi;if(f.cf.indexB=0,f.cf.typeB=he.e_vertex,m<=0){var d=o,v=It.SubVV(r,d,li);if(It.DotVV(v,v)>c*c)return;if(e.m_oneSided){var y=e.m_vertex0,p=o,x=It.SubVV(p,y,hi);if(It.DotVV(x,It.SubVV(p,r,It.s_t0))>0)return}return f.cf.indexA=0,f.cf.typeA=he.e_vertex,t.pointCount=1,t.type=Be.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(d),t.points[0].id.Copy(f),void t.points[0].localPoint.Copy(n.m_p)}if(_<=0){var B=a,S=It.SubVV(r,B,li);if(It.DotVV(S,S)>c*c)return;if(e.m_oneSided){var A=e.m_vertex3,C=a,b=It.SubVV(A,C,_i);if(It.DotVV(b,It.SubVV(r,C,It.s_t0))>0)return}return f.cf.indexA=1,f.cf.typeA=he.e_vertex,t.pointCount=1,t.type=Be.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(B),t.points[0].id.Copy(f),void t.points[0].localPoint.Copy(n.m_p)}var g=It.DotVV(u,u),V=mi;V.x=1/g*(_*o.x+m*a.x),V.y=1/g*(_*o.y+m*a.y);var w=It.SubVV(r,V,li);It.DotVV(w,w)>c*c||(h<0&&l.Set(-l.x,-l.y),l.Normalize(),f.cf.indexA=0,f.cf.typeA=he.e_face,t.pointCount=1,t.type=Be.e_faceA,t.localNormal.Copy(l),t.localPoint.Copy(o),t.points[0].id.Copy(f),t.points[0].localPoint.Copy(n.m_p))}}!function(t){t[t.e_unknown=0]="e_unknown",t[t.e_edgeA=1]="e_edgeA",t[t.e_edgeB=2]="e_edgeB"}(oi||(oi={}));var vi=function t(){Object(n.a)(this,t),this.normal=new It,this.type=oi.e_unknown,this.index=0,this.separation=0},yi=new vi,pi=[new It,new It];var xi=new vi,Bi=new It;var Si=new Tt,Ai=new It,Ci=new It,bi=new It,gi=new It,Vi=new It,wi=new It,ki=new It,Mi=new function t(){Object(n.a)(this,t),this.vertices=[],this.normals=[],this.count=0},Pi=new function t(){Object(n.a)(this,t),this.i1=0,this.i2=0,this.v1=new It,this.v2=new It,this.normal=new It,this.sideNormal1=new It,this.sideOffset1=0,this.sideNormal2=new It,this.sideOffset2=0},Ii=[new ke,new ke],Gi=[new ke,new ke],Di=[new ke,new ke];function Fi(t,e,i,n,s){t.pointCount=0;var r=Tt.MulTXX(i,s,Si),o=Tt.MulXV(r,n.m_centroid,Ai),a=e.m_vertex1,u=e.m_vertex2,l=It.SubVV(u,a,Ci);l.Normalize();var h=bi.Set(l.y,-l.x),_=It.DotVV(h,It.SubVV(o,a,It.s_t0)),m=e.m_oneSided;if(!(m&&_<0)){var c=Mi;c.count=n.m_count;for(var f=0;f<n.m_count;++f)c.vertices.length<=f&&c.vertices.push(new It),c.normals.length<=f&&c.normals.push(new It),Tt.MulXV(r,n.m_vertices[f],c.vertices[f]),jt.MulRV(r.q,n.m_normals[f],c.normals[f]);var d=n.m_radius+e.m_radius,v=function(t,e,i){var n=yi;n.type=oi.e_edgeA,n.index=-1,n.separation=-Number.MAX_VALUE,n.normal.SetZero();var s=pi;s[0].Copy(i),s[1].Copy(i).SelfNeg();for(var r=0;r<2;++r){for(var o=Number.MAX_VALUE,a=0;a<t.count;++a){var u=It.DotVV(s[r],It.SubVV(t.vertices[a],e,It.s_t0));u<o&&(o=u)}o>n.separation&&(n.index=r,n.separation=o,n.normal.Copy(s[r]))}return n}(c,a,h);if(!(v.separation>d)){var y=function(t,e,i){var n=xi;n.type=oi.e_unknown,n.index=-1,n.separation=-Number.MAX_VALUE,n.normal.SetZero();for(var s=0;s<t.count;++s){var r=It.NegV(t.normals[s],Bi),o=_t(It.DotVV(r,It.SubVV(t.vertices[s],e,It.s_t0)),It.DotVV(r,It.SubVV(t.vertices[s],i,It.s_t0)));o>n.separation&&(n.type=oi.e_edgeB,n.index=s,n.separation=o,n.normal.Copy(r))}return n}(c,a,u);if(!(y.separation>d)){var p;if(p=y.separation-d>.98*(v.separation-d)+.001?y:v,m){var B=It.SubVV(a,e.m_vertex0,gi);B.Normalize();var S=Vi.Set(B.y,-B.x),A=It.CrossVV(B,l)>=0,C=It.SubVV(e.m_vertex3,u,wi);C.Normalize();var b=ki.Set(C.y,-C.x),g=It.CrossVV(l,C)>=0;if(It.DotVV(p.normal,l)<=0)if(A){if(It.CrossVV(p.normal,S)>.1)return}else p=v;else if(g){if(It.CrossVV(b,p.normal)>.1)return}else p=v}var V=Ii,w=Pi;if(p.type===oi.e_edgeA){t.type=Be.e_faceA;for(var k=0,M=It.DotVV(p.normal,c.normals[0]),P=1;P<c.count;++P){var I=It.DotVV(p.normal,c.normals[P]);I<M&&(M=I,k=P)}var G=k,D=G+1<c.count?G+1:0;V[0].v.Copy(c.vertices[G]),V[0].id.cf.indexA=0,V[0].id.cf.indexB=G,V[0].id.cf.typeA=he.e_face,V[0].id.cf.typeB=he.e_vertex,V[1].v.Copy(c.vertices[D]),V[1].id.cf.indexA=0,V[1].id.cf.indexB=D,V[1].id.cf.typeA=he.e_face,V[1].id.cf.typeB=he.e_vertex,w.i1=0,w.i2=1,w.v1.Copy(a),w.v2.Copy(u),w.normal.Copy(p.normal),w.sideNormal1.Copy(l).SelfNeg(),w.sideNormal2.Copy(l)}else t.type=Be.e_faceB,V[0].v.Copy(u),V[0].id.cf.indexA=1,V[0].id.cf.indexB=p.index,V[0].id.cf.typeA=he.e_vertex,V[0].id.cf.typeB=he.e_face,V[1].v.Copy(a),V[1].id.cf.indexA=0,V[1].id.cf.indexB=p.index,V[1].id.cf.typeA=he.e_vertex,V[1].id.cf.typeB=he.e_face,w.i1=p.index,w.i2=w.i1+1<c.count?w.i1+1:0,w.v1.Copy(c.vertices[w.i1]),w.v2.Copy(c.vertices[w.i2]),w.normal.Copy(c.normals[w.i1]),w.sideNormal1.Set(w.normal.y,-w.normal.x),w.sideNormal2.Copy(w.sideNormal1).SelfNeg();w.sideOffset1=It.DotVV(w.sideNormal1,w.v1),w.sideOffset2=It.DotVV(w.sideNormal2,w.v2);var F=Gi,L=Di;if(!(De(F,V,w.sideNormal1,w.sideOffset1,w.i1)<x)&&!(De(L,F,w.sideNormal2,w.sideOffset2,w.i2)<x)){p.type===oi.e_edgeA?(t.localNormal.Copy(w.normal),t.localPoint.Copy(w.v1)):(t.localNormal.Copy(n.m_normals[w.i1]),t.localPoint.Copy(n.m_vertices[w.i1]));for(var R=0,j=0;j<x;++j){if(It.DotVV(w.normal,It.SubVV(L[j].v,w.v1,It.s_t0))<=d){var T=t.points[R];p.type===oi.e_edgeA?(Tt.MulTXV(r,L[j].v,T.localPoint),T.id.Copy(L[j].id)):(T.localPoint.Copy(L[j].v),T.id.cf.typeA=L[j].id.cf.typeB,T.id.cf.typeB=L[j].id.cf.typeA,T.id.cf.indexA=L[j].id.cf.indexB,T.id.cf.indexB=L[j].id.cf.indexA),++R}}t.pointCount=R}}}}}var Li=new Tt,Ri=new It,ji=new It;function Ti(t,e,i,n,s){for(var r=e.m_count,o=n.m_count,a=e.m_normals,u=e.m_vertices,l=n.m_vertices,h=Tt.MulTXX(s,i,Li),_=0,m=-c,f=0;f<r;++f){for(var d=jt.MulRV(h.q,a[f],Ri),v=Tt.MulXV(h,u[f],ji),y=c,p=0;p<o;++p){var x=It.DotVV(d,It.SubVV(l[p],v,It.s_t0));x<y&&(y=x)}y>m&&(m=y,_=f)}return t[0]=_,m}var Oi=new It;var qi=[new ke,new ke],zi=[new ke,new ke],Ei=[new ke,new ke],Ni=[0],Ji=[0],Xi=new It,Zi=new It,Ui=new It,Wi=new It,Qi=new It,Yi=new It,Ki=new It,Hi=new It;function $i(t,e,i,n,s){t.pointCount=0;var r=e.m_radius+n.m_radius,o=Ni;o[0]=0;var a=Ti(o,e,i,n,s);if(!(a>r)){var u=Ji;u[0]=0;var l=Ti(u,n,s,e,i);if(!(l>r)){var h,_,m,f,d=0,v=0;l>a+.1*A?(h=n,_=e,m=s,f=i,d=u[0],t.type=Be.e_faceB,v=1):(h=e,_=n,m=i,f=s,d=o[0],t.type=Be.e_faceA,v=0);var y=qi;!function(t,e,i,n,s,r){for(var o=e.m_normals,a=s.m_count,u=s.m_vertices,l=s.m_normals,h=jt.MulTRV(r.q,jt.MulRV(i.q,o[n],It.s_t0),Oi),_=0,m=c,f=0;f<a;++f){var d=It.DotVV(h,l[f]);d<m&&(m=d,_=f)}var v=_,y=v+1<a?v+1:0,p=t[0];Tt.MulXV(r,u[v],p.v);var x=p.id.cf;x.indexA=n,x.indexB=v,x.typeA=he.e_face,x.typeB=he.e_vertex;var B=t[1];Tt.MulXV(r,u[y],B.v);var S=B.id.cf;S.indexA=n,S.indexB=y,S.typeA=he.e_face,S.typeB=he.e_vertex}(y,h,m,d,_,f);var p=h.m_count,B=h.m_vertices,S=d,C=d+1<p?d+1:0,b=B[S],g=B[C],V=It.SubVV(g,b,Xi);V.Normalize();var w=It.CrossVOne(V,Zi),k=It.MidVV(b,g,Ui),M=jt.MulRV(m.q,V,Qi),P=It.CrossVOne(M,Wi),I=Tt.MulXV(m,b,Ki),G=Tt.MulXV(m,g,Hi),D=It.DotVV(P,I),F=-It.DotVV(M,I)+r,L=It.DotVV(M,G)+r,R=zi,j=Ei;if(!(De(R,y,It.NegV(M,Yi),F,S)<2)&&!(De(j,R,M,L,C)<2)){t.localNormal.Copy(w),t.localPoint.Copy(k);for(var T=0,O=0;O<x;++O){var q=j[O];if(It.DotVV(P,q.v)-D<=r){var z=t.points[T];if(Tt.MulTXV(f,q.v,z.localPoint),z.id.Copy(q.id),v){var E=z.id.cf;z.id.cf.indexA=E.indexB,z.id.cf.indexB=E.indexA,z.id.cf.typeA=E.typeB,z.id.cf.typeB=E.typeA}++T}}t.pointCount=T}}}}var tn=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.call(this,ze.e_polygonShape,b)).m_centroid=new It(0,0),t.m_vertices=[],t.m_normals=[],t.m_count=0,t}return Object(r.a)(i,[{key:"Clone",value:function(){return(new i).Copy(this)}},{key:"Copy",value:function(t){Object(Je.a)(Object(Xe.a)(i.prototype),"Copy",this).call(this,t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=It.MakeArray(this.m_count),this.m_normals=It.MakeArray(this.m_count);for(var e=0;e<this.m_count;++e)this.m_vertices[e].Copy(t.m_vertices[e]),this.m_normals[e].Copy(t.m_normals[e]);return this}},{key:"GetChildCount",value:function(){return 1}},{key:"Set",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if("number"===typeof e[0][0]){var n=e[0];if(n.length%2!==0)throw new Error;return this._Set((function(t){return{x:n[2*t],y:n[2*t+1]}}),n.length/2)}var s=e[0],r=e[1]||s.length;return this._Set((function(t){return s[t]}),r)}},{key:"_Set",value:function(t,e){if(e<3)return this.SetAsBox(1,1);for(var n=e,s=[],r=0;r<n;++r){for(var o=t(r),a=!0,u=0;u<s.length;++u)if(It.DistanceSquaredVV(o,s[u])<.5*A*(.5*A)){a=!1;break}a&&s.push(o)}if((n=s.length)<3)return this.SetAsBox(1,1);for(var l=0,h=s[0].x,_=1;_<n;++_){var m=s[_].x;(m>h||m===h&&s[_].y<s[l].y)&&(l=_,h=m)}for(var c=[],f=0,d=l;;){c[f]=d;for(var v=0,y=1;y<n;++y)if(v!==d){var p=It.SubVV(s[v],s[c[f]],i.Set_s_r),x=It.SubVV(s[y],s[c[f]],i.Set_s_v),B=It.CrossVV(p,x);B<0&&(v=y),0===B&&x.LengthSquared()>p.LengthSquared()&&(v=y)}else v=y;if(++f,d=v,v===l)break}this.m_count=f,this.m_vertices=It.MakeArray(this.m_count),this.m_normals=It.MakeArray(this.m_count);for(var S=0;S<f;++S)this.m_vertices[S].Copy(s[c[S]]);for(var C=0;C<f;++C){var b=this.m_vertices[C],g=this.m_vertices[(C+1)%f],V=It.SubVV(g,b,It.s_t0);It.CrossVOne(V,this.m_normals[C]).SelfNormalize()}return i.ComputeCentroid(this.m_vertices,f,this.m_centroid),this}},{key:"SetAsBox",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(this.m_count=4,this.m_vertices=It.MakeArray(this.m_count),this.m_normals=It.MakeArray(this.m_count),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i){this.m_centroid.Copy(i);var s=new Tt;s.SetPosition(i),s.SetRotationAngle(n);for(var r=0;r<this.m_count;++r)Tt.MulXV(s,this.m_vertices[r],this.m_vertices[r]),jt.MulRV(s.q,this.m_normals[r],this.m_normals[r])}return this}},{key:"TestPoint",value:function(t,e){for(var n=Tt.MulTXV(t,e,i.TestPoint_s_pLocal),s=0;s<this.m_count;++s){if(It.DotVV(this.m_normals[s],It.SubVV(n,this.m_vertices[s],It.s_t0))>0)return!1}return!0}},{key:"ComputeDistance",value:function(t,e,n,s){for(var r=Tt.MulTXV(t,e,i.ComputeDistance_s_pLocal),o=-c,a=i.ComputeDistance_s_normalForMaxDistance.Copy(r),u=0;u<this.m_count;++u){var l=It.DotVV(this.m_normals[u],It.SubVV(r,this.m_vertices[u],It.s_t0));l>o&&(o=l,a.Copy(this.m_normals[u]))}if(o>0){for(var h=i.ComputeDistance_s_minDistance.Copy(a),_=o*o,m=0;m<this.m_count;++m){var f=It.SubVV(r,this.m_vertices[m],i.ComputeDistance_s_distance),d=f.LengthSquared();_>d&&(h.Copy(f),_=d)}return jt.MulRV(t.q,h,n),n.Normalize(),Math.sqrt(_)}return jt.MulRV(t.q,a,n),o}},{key:"RayCast",value:function(t,e,n,s){for(var r=Tt.MulTXV(n,e.p1,i.RayCast_s_p1),o=Tt.MulTXV(n,e.p2,i.RayCast_s_p2),a=It.SubVV(o,r,i.RayCast_s_d),u=0,l=e.maxFraction,h=-1,_=0;_<this.m_count;++_){var m=It.DotVV(this.m_normals[_],It.SubVV(this.m_vertices[_],r,It.s_t0)),c=It.DotVV(this.m_normals[_],a);if(0===c){if(m<0)return!1}else c<0&&m<u*c?(u=m/c,h=_):c>0&&m<l*c&&(l=m/c);if(l<u)return!1}return h>=0&&(t.fraction=u,jt.MulRV(n.q,this.m_normals[h],t.normal),!0)}},{key:"ComputeAABB",value:function(t,e,n){for(var s=Tt.MulXV(e,this.m_vertices[0],t.lowerBound),r=t.upperBound.Copy(s),o=0;o<this.m_count;++o){var a=Tt.MulXV(e,this.m_vertices[o],i.ComputeAABB_s_v);It.MinV(a,s,s),It.MaxV(a,r,r)}var u=this.m_radius;s.SelfSubXY(u,u),r.SelfAddXY(u,u)}},{key:"ComputeMass",value:function(t,e){for(var n=i.ComputeMass_s_center.SetZero(),s=0,r=0,o=i.ComputeMass_s_s.Copy(this.m_vertices[0]),a=0;a<this.m_count;++a){var u=It.SubVV(this.m_vertices[a],o,i.ComputeMass_s_e1),l=It.SubVV(this.m_vertices[(a+1)%this.m_count],o,i.ComputeMass_s_e2),h=It.CrossVV(u,l),_=.5*h;s+=_,n.SelfAdd(It.MulSV(_*(1/3),It.AddVV(u,l,It.s_t0),It.s_t1));var m=u.x,c=u.y,f=l.x,d=l.y;r+=1/3*.25*h*(m*m+f*m+f*f+(c*c+d*c+d*d))}t.mass=e*s,n.SelfMul(1/s),It.AddVV(n,o,t.center),t.I=e*r,t.I+=t.mass*(It.DotVV(t.center,t.center)-It.DotVV(n,n))}},{key:"Validate",value:function(){for(var t=0;t<this.m_count;++t)for(var e=t,n=(t+1)%this.m_count,s=this.m_vertices[e],r=It.SubVV(this.m_vertices[n],s,i.Validate_s_e),o=0;o<this.m_count;++o)if(o!==e&&o!==n){var a=It.SubVV(this.m_vertices[o],s,i.Validate_s_v);if(It.CrossVV(r,a)<0)return!1}return!0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,n,s){for(var r=jt.MulTRV(n.q,t,i.ComputeSubmergedArea_s_normalL),o=e-It.DotVV(t,n.p),a=[],u=0,l=-1,h=-1,_=!1,m=0;m<this.m_count;++m){a[m]=It.DotVV(r,this.m_vertices[m])-o;var c=a[m]<-f;m>0&&(c?_||(l=m-1,u++):_&&(h=m-1,u++)),_=c}switch(u){case 0:if(_){var d=i.ComputeSubmergedArea_s_md;return this.ComputeMass(d,1),Tt.MulXV(n,d.center,s),d.mass}return 0;case 1:-1===l?l=this.m_count-1:h=this.m_count-1}for(var v,y=(l+1)%this.m_count,p=(h+1)%this.m_count,x=(0-a[l])/(a[y]-a[l]),B=(0-a[h])/(a[p]-a[h]),S=i.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[l].x*(1-x)+this.m_vertices[y].x*x,this.m_vertices[l].y*(1-x)+this.m_vertices[y].y*x),A=i.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[h].x*(1-B)+this.m_vertices[p].x*B,this.m_vertices[h].y*(1-B)+this.m_vertices[p].y*B),C=0,b=i.ComputeSubmergedArea_s_center.SetZero(),g=this.m_vertices[y],V=y;V!==p;){v=(V=(V+1)%this.m_count)===p?A:this.m_vertices[V];var w=.5*((g.x-S.x)*(v.y-S.y)-(g.y-S.y)*(v.x-S.x));C+=w,b.x+=w*(S.x+g.x+v.x)/3,b.y+=w*(S.y+g.y+v.y)/3,g=v}return b.SelfMul(1/C),Tt.MulXV(n,b,s),C}},{key:"Dump",value:function(t){t("    const shape: b2PolygonShape = new b2PolygonShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(var e=0;e<this.m_count;++e)t("    vs[%d] = new b2Vec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.Set(vs, %d);\n",this.m_count)}}],[{key:"ComputeCentroid",value:function(t,e,n){var s=n;s.SetZero();for(var r=0,o=i.ComputeCentroid_s_s.Copy(t[0]),a=0;a<e;++a){var u=It.SubVV(t[0],o,i.ComputeCentroid_s_p1),l=It.SubVV(t[a],o,i.ComputeCentroid_s_p2),h=It.SubVV(t[(a+1)%e],o,i.ComputeCentroid_s_p3),_=It.SubVV(l,u,i.ComputeCentroid_s_e1),m=It.SubVV(h,u,i.ComputeCentroid_s_e2),c=.5*It.CrossVV(_,m);r+=c,s.x+=c*(1/3)*(u.x+l.x+h.x),s.y+=c*(1/3)*(u.y+l.y+h.y)}return s.x=1/r*s.x+o.x,s.y=1/r*s.y+o.y,s}}]),i}(Qe);tn.Set_s_r=new It,tn.Set_s_v=new It,tn.TestPoint_s_pLocal=new It,tn.ComputeDistance_s_pLocal=new It,tn.ComputeDistance_s_normalForMaxDistance=new It,tn.ComputeDistance_s_minDistance=new It,tn.ComputeDistance_s_distance=new It,tn.RayCast_s_p1=new It,tn.RayCast_s_p2=new It,tn.RayCast_s_d=new It,tn.ComputeAABB_s_v=new It,tn.ComputeMass_s_center=new It,tn.ComputeMass_s_s=new It,tn.ComputeMass_s_e1=new It,tn.ComputeMass_s_e2=new It,tn.Validate_s_e=new It,tn.Validate_s_v=new It,tn.ComputeSubmergedArea_s_normalL=new It,tn.ComputeSubmergedArea_s_md=new We,tn.ComputeSubmergedArea_s_intoVec=new It,tn.ComputeSubmergedArea_s_outoVec=new It,tn.ComputeSubmergedArea_s_center=new It,tn.ComputeCentroid_s_s=new It,tn.ComputeCentroid_s_p1=new It,tn.ComputeCentroid_s_p2=new It,tn.ComputeCentroid_s_p3=new It,tn.ComputeCentroid_s_e1=new It,tn.ComputeCentroid_s_e2=new It;var en=0,nn=0,sn=0,rn=0,on=0,an=0,un=0;function ln(){en=0,nn=0,sn=0,rn=0,on=0,an=0,un=0}var hn,_n=new Tt,mn=new Tt,cn=new It,fn=new It,dn=new It,vn=new It,yn=new It,pn=function t(){Object(n.a)(this,t),this.proxyA=new Nt,this.proxyB=new Nt,this.sweepA=new Ot,this.sweepB=new Ot,this.tMax=0};!function(t){t[t.e_unknown=0]="e_unknown",t[t.e_failed=1]="e_failed",t[t.e_overlapped=2]="e_overlapped",t[t.e_touching=3]="e_touching",t[t.e_separated=4]="e_separated"}(hn||(hn={}));var xn,Bn=function t(){Object(n.a)(this,t),this.state=hn.e_unknown,this.t=0};!function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_points=0]="e_points",t[t.e_faceA=1]="e_faceA",t[t.e_faceB=2]="e_faceB"}(xn||(xn={}));var Sn,An=function(){function t(){Object(n.a)(this,t),this.m_sweepA=new Ot,this.m_sweepB=new Ot,this.m_type=xn.e_unknown,this.m_localPoint=new It,this.m_axis=new It}return Object(r.a)(t,[{key:"Initialize",value:function(t,e,i,n,s,r){this.m_proxyA=e,this.m_proxyB=n;var o=t.count;this.m_sweepA.Copy(i),this.m_sweepB.Copy(s);var a=_n,u=mn;if(this.m_sweepA.GetTransform(a,r),this.m_sweepB.GetTransform(u,r),1===o){this.m_type=xn.e_points;var l=this.m_proxyA.GetVertex(t.indexA[0]),h=this.m_proxyB.GetVertex(t.indexB[0]),_=Tt.MulXV(a,l,cn),m=Tt.MulXV(u,h,fn);It.SubVV(m,_,this.m_axis);var c=this.m_axis.Normalize();return this.m_localPoint.SetZero(),c}if(t.indexA[0]===t.indexA[1]){this.m_type=xn.e_faceB;var f=this.m_proxyB.GetVertex(t.indexB[0]),d=this.m_proxyB.GetVertex(t.indexB[1]);It.CrossVOne(It.SubVV(d,f,It.s_t0),this.m_axis).SelfNormalize();var v=jt.MulRV(u.q,this.m_axis,dn);It.MidVV(f,d,this.m_localPoint);var y=Tt.MulXV(u,this.m_localPoint,fn),p=this.m_proxyA.GetVertex(t.indexA[0]),x=Tt.MulXV(a,p,cn),B=It.DotVV(It.SubVV(x,y,It.s_t0),v);return B<0&&(this.m_axis.SelfNeg(),B=-B),B}this.m_type=xn.e_faceA;var S=this.m_proxyA.GetVertex(t.indexA[0]),A=this.m_proxyA.GetVertex(t.indexA[1]);It.CrossVOne(It.SubVV(A,S,It.s_t0),this.m_axis).SelfNormalize();var C=jt.MulRV(a.q,this.m_axis,dn);It.MidVV(S,A,this.m_localPoint);var b=Tt.MulXV(a,this.m_localPoint,cn),g=this.m_proxyB.GetVertex(t.indexB[0]),V=Tt.MulXV(u,g,fn),w=It.DotVV(It.SubVV(V,b,It.s_t0),C);return w<0&&(this.m_axis.SelfNeg(),w=-w),w}},{key:"FindMinSeparation",value:function(t,e,i){var n=_n,s=mn;switch(this.m_sweepA.GetTransform(n,i),this.m_sweepB.GetTransform(s,i),this.m_type){case xn.e_points:var r=jt.MulTRV(n.q,this.m_axis,vn),o=jt.MulTRV(s.q,It.NegV(this.m_axis,It.s_t0),yn);t[0]=this.m_proxyA.GetSupport(r),e[0]=this.m_proxyB.GetSupport(o);var a=this.m_proxyA.GetVertex(t[0]),u=this.m_proxyB.GetVertex(e[0]),l=Tt.MulXV(n,a,cn),h=Tt.MulXV(s,u,fn);return It.DotVV(It.SubVV(h,l,It.s_t0),this.m_axis);case xn.e_faceA:var _=jt.MulRV(n.q,this.m_axis,dn),m=Tt.MulXV(n,this.m_localPoint,cn),c=jt.MulTRV(s.q,It.NegV(_,It.s_t0),yn);t[0]=-1,e[0]=this.m_proxyB.GetSupport(c);var f=this.m_proxyB.GetVertex(e[0]),d=Tt.MulXV(s,f,fn);return It.DotVV(It.SubVV(d,m,It.s_t0),_);case xn.e_faceB:var v=jt.MulRV(s.q,this.m_axis,dn),y=Tt.MulXV(s,this.m_localPoint,fn),p=jt.MulTRV(n.q,It.NegV(v,It.s_t0),vn);e[0]=-1,t[0]=this.m_proxyA.GetSupport(p);var x=this.m_proxyA.GetVertex(t[0]),B=Tt.MulXV(n,x,cn);return It.DotVV(It.SubVV(B,y,It.s_t0),v);default:return t[0]=-1,e[0]=-1,0}}},{key:"Evaluate",value:function(t,e,i){var n=_n,s=mn;switch(this.m_sweepA.GetTransform(n,i),this.m_sweepB.GetTransform(s,i),this.m_type){case xn.e_points:var r=this.m_proxyA.GetVertex(t),o=this.m_proxyB.GetVertex(e),a=Tt.MulXV(n,r,cn),u=Tt.MulXV(s,o,fn);return It.DotVV(It.SubVV(u,a,It.s_t0),this.m_axis);case xn.e_faceA:var l=jt.MulRV(n.q,this.m_axis,dn),h=Tt.MulXV(n,this.m_localPoint,cn),_=this.m_proxyB.GetVertex(e),m=Tt.MulXV(s,_,fn);return It.DotVV(It.SubVV(m,h,It.s_t0),l);case xn.e_faceB:var c=jt.MulRV(s.q,this.m_axis,dn),f=Tt.MulXV(s,this.m_localPoint,fn),d=this.m_proxyA.GetVertex(t),v=Tt.MulXV(n,d,cn);return It.DotVV(It.SubVV(v,f,It.s_t0),c);default:return 0}}}]),t}(),Cn=new zt,bn=new Jt,gn=new Xt,Vn=new Zt,wn=new An,kn=[0],Mn=[0],Pn=new Ot,In=new Ot;function Gn(t,e){var i=Cn.Reset();++sn,t.state=hn.e_unknown,t.t=e.tMax;var n=e.proxyA,s=e.proxyB,r=mt(p,mt(n.m_count,s.m_count)),o=Pn.Copy(e.sweepA),a=In.Copy(e.sweepB);o.Normalize(),a.Normalize();var u=e.tMax,l=n.m_radius+s.m_radius,h=mt(A,l-3*A),_=.25*A,m=0,c=0,f=bn;f.count=0;var d=gn;for(d.proxyA.Copy(e.proxyA),d.proxyB.Copy(e.proxyB),d.useRadii=!1;;){var v=_n,y=mn;o.GetTransform(v,m),a.GetTransform(y,m),d.transformA.Copy(v),d.transformB.Copy(y);var x=Vn;if(le(x,f,d),x.distance<=0){t.state=hn.e_overlapped,t.t=0;break}if(x.distance<h+_){t.state=hn.e_touching,t.t=m;break}var B=wn;B.Initialize(f,n,o,s,a,m);for(var S=!1,C=u,b=0;;){var g=kn,V=Mn,w=B.FindMinSeparation(g,V,C);if(w>h+_){t.state=hn.e_separated,t.t=u,S=!0;break}if(w>h-_){m=C;break}var k=B.Evaluate(g[0],V[0],m);if(k<h-_){t.state=hn.e_failed,t.t=m,S=!0;break}if(k<=h+_){t.state=hn.e_touching,t.t=m,S=!0;break}for(var M=0,P=m,I=C;;){var G=0;G=1&M?P+(h-k)*(I-P)/(w-k):.5*(P+I),++M,++an;var D=B.Evaluate(g[0],V[0],G);if(ht(D-h)<_){C=G;break}if(D>h?(P=G,k=D):(I=G,w=D),50===M)break}if(un=mt(un,M),++b===r)break}if(++c,++rn,S)break;if(20===c){t.state=hn.e_failed,t.t=m;break}}on=mt(on,c);var F=i.GetMilliseconds();nn=mt(nn,F),en+=F}!function(t){t[t.e_unknownJoint=0]="e_unknownJoint",t[t.e_revoluteJoint=1]="e_revoluteJoint",t[t.e_prismaticJoint=2]="e_prismaticJoint",t[t.e_distanceJoint=3]="e_distanceJoint",t[t.e_pulleyJoint=4]="e_pulleyJoint",t[t.e_mouseJoint=5]="e_mouseJoint",t[t.e_gearJoint=6]="e_gearJoint",t[t.e_wheelJoint=7]="e_wheelJoint",t[t.e_weldJoint=8]="e_weldJoint",t[t.e_frictionJoint=9]="e_frictionJoint",t[t.e_ropeJoint=10]="e_ropeJoint",t[t.e_motorJoint=11]="e_motorJoint",t[t.e_areaJoint=12]="e_areaJoint"}(Sn||(Sn={}));var Dn=function(){function t(){Object(n.a)(this,t),this.linear=new It,this.angularA=0,this.angularB=0}return Object(r.a)(t,[{key:"SetZero",value:function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this}},{key:"Set",value:function(t,e,i){return this.linear.Copy(t),this.angularA=e,this.angularB=i,this}}]),t}(),Fn=function(){function t(e){Object(n.a)(this,t),this._other=null,this.prev=null,this.next=null,this.joint=e}return Object(r.a)(t,[{key:"other",get:function(){if(null===this._other)throw new Error;return this._other},set:function(t){if(null!==this._other)throw new Error;this._other=t}},{key:"Reset",value:function(){this._other=null,this.prev=null,this.next=null}}]),t}(),Ln=function t(e){Object(n.a)(this,t),this.type=Sn.e_unknownJoint,this.userData=null,this.collideConnected=!1,this.type=e};function Rn(t,e,i,n,s){var r,o=n.GetMass(),a=s.GetMass();r=o>0&&a>0?o*a/(o+a):o>0?o:a;var u=2*v*e;t.stiffness=r*u*u,t.damping=2*r*i*u}function jn(t,e,i,n,s){var r,o=n.GetInertia(),a=s.GetInertia();r=o>0&&a>0?o*a/(o+a):o>0?o:a;var u=2*v*e;t.stiffness=r*u*u,t.damping=2*r*i*u}var Tn=function(){function t(e){Object(n.a)(this,t),this.m_type=Sn.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_edgeA=new Fn(this),this.m_edgeB=new Fn(this),this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=e.type,this.m_edgeA.other=e.bodyB,this.m_edgeB.other=e.bodyA,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=m(e.collideConnected,!1),this.m_userData=m(e.userData,null)}return Object(r.a)(t,[{key:"GetType",value:function(){return this.m_type}},{key:"GetBodyA",value:function(){return this.m_bodyA}},{key:"GetBodyB",value:function(){return this.m_bodyB}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"IsEnabled",value:function(){return this.m_bodyA.IsEnabled()&&this.m_bodyB.IsEnabled()}},{key:"GetCollideConnected",value:function(){return this.m_collideConnected}},{key:"Dump",value:function(t){t("// Dump is not supported for this joint type.\n")}},{key:"ShiftOrigin",value:function(t){}},{key:"Draw",value:function(e){var i=this.m_bodyA.GetTransform(),n=this.m_bodyB.GetTransform(),s=i.p,r=n.p,o=this.GetAnchorA(t.Draw_s_p1),a=this.GetAnchorB(t.Draw_s_p2),u=t.Draw_s_color.SetRGB(.5,.8,.8);switch(this.m_type){case Sn.e_distanceJoint:e.DrawSegment(o,a,u);break;case Sn.e_pulleyJoint:var l=this.GetGroundAnchorA(),h=this.GetGroundAnchorB();e.DrawSegment(l,o,u),e.DrawSegment(h,a,u),e.DrawSegment(l,h,u);break;case Sn.e_mouseJoint:var _=t.Draw_s_c;_.Set(0,1,0),e.DrawPoint(o,4,_),e.DrawPoint(a,4,_),_.Set(.8,.8,.8),e.DrawSegment(o,a,_);break;default:e.DrawSegment(s,o,u),e.DrawSegment(o,a,u),e.DrawSegment(r,a,u)}}}]),t}();Tn.Draw_s_p1=new It,Tn.Draw_s_p2=new It,Tn.Draw_s_color=new o(.5,.8,.8),Tn.Draw_s_c=new o;var On=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.call(this,Sn.e_distanceJoint)).localAnchorA=new It,t.localAnchorB=new It,t.length=1,t.minLength=0,t.maxLength=c,t.stiffness=0,t.damping=0,t}return Object(r.a)(i,[{key:"Initialize",value:function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.length=mt(It.DistanceVV(i,n),A),this.minLength=this.length,this.maxLength=this.length}}]),i}(Ln),qn=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s;return Object(n.a)(this,i),(s=e.call(this,t)).m_stiffness=0,s.m_damping=0,s.m_bias=0,s.m_length=0,s.m_minLength=0,s.m_maxLength=0,s.m_localAnchorA=new It,s.m_localAnchorB=new It,s.m_gamma=0,s.m_impulse=0,s.m_lowerImpulse=0,s.m_upperImpulse=0,s.m_indexA=0,s.m_indexB=0,s.m_u=new It,s.m_rA=new It,s.m_rB=new It,s.m_localCenterA=new It,s.m_localCenterB=new It,s.m_currentLength=0,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_softMass=0,s.m_mass=0,s.m_qA=new jt,s.m_qB=new jt,s.m_lalcA=new It,s.m_lalcB=new It,s.m_localAnchorA.Copy(m(t.localAnchorA,It.ZERO)),s.m_localAnchorB.Copy(m(t.localAnchorB,It.ZERO)),s.m_length=mt(m(t.length,s.GetCurrentLength()),A),s.m_minLength=mt(m(t.minLength,s.m_length),A),s.m_maxLength=mt(m(t.maxLength,s.m_length),s.m_minLength),s.m_stiffness=m(t.stiffness,0),s.m_damping=m(t.damping,0),s}return Object(r.a)(i,[{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_u.x,e.y=t*(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_u.y,e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetLength",value:function(t){return this.m_impulse=0,this.m_length=mt(A,t),this.m_length}},{key:"GetLength",value:function(){return this.m_length}},{key:"SetMinLength",value:function(t){return this.m_lowerImpulse=0,this.m_minLength=ct(t,A,this.m_maxLength),this.m_minLength}},{key:"SetMaxLength",value:function(t){return this.m_upperImpulse=0,this.m_maxLength=mt(t,this.m_minLength),this.m_maxLength}},{key:"GetCurrentLength",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,new It),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,new It);return It.DistanceVV(t,e)}},{key:"SetStiffness",value:function(t){this.m_stiffness=t}},{key:"GetStiffness",value:function(){return this.m_stiffness}},{key:"SetDamping",value:function(t){this.m_damping=t}},{key:"GetDamping",value:function(){return this.m_damping}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.minLength = %.15f;\n",this.m_minLength),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  jd.stiffness = %.15f;\n",this.m_stiffness),t("  jd.damping = %.15f;\n",this.m_damping),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(n),_=this.m_qB.SetAngle(a);It.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),jt.MulRV(h,this.m_lalcA,this.m_rA),It.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),jt.MulRV(_,this.m_lalcB,this.m_rB),this.m_u.x=o.x+this.m_rB.x-e.x-this.m_rA.x,this.m_u.y=o.y+this.m_rB.y-e.y-this.m_rA.y,this.m_currentLength=this.m_u.Length(),this.m_currentLength>A?this.m_u.SelfMul(1/this.m_currentLength):(this.m_u.SetZero(),this.m_mass=0,this.m_impulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0);var m=It.CrossVV(this.m_rA,this.m_u),c=It.CrossVV(this.m_rB,this.m_u),f=this.m_invMassA+this.m_invIA*m*m+this.m_invMassB+this.m_invIB*c*c;if(this.m_mass=0!==f?1/f:0,this.m_stiffness>0&&this.m_minLength<this.m_maxLength){var d=this.m_currentLength-this.m_length,v=this.m_damping,y=this.m_stiffness,p=t.step.dt;this.m_gamma=p*(v+p*y),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=d*p*y*this.m_gamma,f+=this.m_gamma,this.m_softMass=0!==f?1/f:0}else this.m_gamma=0,this.m_bias=0,this.m_softMass=this.m_mass;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_lowerImpulse*=t.step.dtRatio,this.m_upperImpulse*=t.step.dtRatio;var x=It.MulSV(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse,this.m_u,i.InitVelocityConstraints_s_P);s.SelfMulSub(this.m_invMassA,x),r-=this.m_invIA*It.CrossVV(this.m_rA,x),u.SelfMulAdd(this.m_invMassB,x),l+=this.m_invIB*It.CrossVV(this.m_rB,x)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=l}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w;if(this.m_minLength<this.m_maxLength){if(this.m_stiffness>0){var o=It.AddVCrossSV(e,n,this.m_rA,i.SolveVelocityConstraints_s_vpA),a=It.AddVCrossSV(s,r,this.m_rB,i.SolveVelocityConstraints_s_vpB),u=It.DotVV(this.m_u,It.SubVV(a,o,It.s_t0)),l=-this.m_softMass*(u+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=l;var h=It.MulSV(l,this.m_u,i.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,h),n-=this.m_invIA*It.CrossVV(this.m_rA,h),s.SelfMulAdd(this.m_invMassB,h),r+=this.m_invIB*It.CrossVV(this.m_rB,h)}var _=mt(0,this.m_currentLength-this.m_minLength)*t.step.inv_dt,m=It.AddVCrossSV(e,n,this.m_rA,i.SolveVelocityConstraints_s_vpA),c=It.AddVCrossSV(s,r,this.m_rB,i.SolveVelocityConstraints_s_vpB),f=It.DotVV(this.m_u,It.SubVV(c,m,It.s_t0)),d=-this.m_mass*(f+_),v=this.m_lowerImpulse;this.m_lowerImpulse=mt(0,this.m_lowerImpulse+d),d=this.m_lowerImpulse-v;var y=It.MulSV(d,this.m_u,i.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,y),n-=this.m_invIA*It.CrossVV(this.m_rA,y),s.SelfMulAdd(this.m_invMassB,y),r+=this.m_invIB*It.CrossVV(this.m_rB,y);var p=mt(0,this.m_maxLength-this.m_currentLength)*t.step.inv_dt,x=It.AddVCrossSV(e,n,this.m_rA,i.SolveVelocityConstraints_s_vpA),B=It.AddVCrossSV(s,r,this.m_rB,i.SolveVelocityConstraints_s_vpB),S=It.DotVV(this.m_u,It.SubVV(x,B,It.s_t0)),A=-this.m_mass*(S+p),C=this.m_upperImpulse;this.m_upperImpulse=mt(0,this.m_upperImpulse+A),A=this.m_upperImpulse-C;var b=It.MulSV(-A,this.m_u,i.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,b),n-=this.m_invIA*It.CrossVV(this.m_rA,b),s.SelfMulAdd(this.m_invMassB,b),r+=this.m_invIB*It.CrossVV(this.m_rB,b)}else{var g=It.AddVCrossSV(e,n,this.m_rA,i.SolveVelocityConstraints_s_vpA),V=It.AddVCrossSV(s,r,this.m_rB,i.SolveVelocityConstraints_s_vpB),w=It.DotVV(this.m_u,It.SubVV(V,g,It.s_t0)),k=-this.m_mass*w;this.m_impulse+=k;var M=It.MulSV(k,this.m_u,i.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,M),n-=this.m_invIA*It.CrossVV(this.m_rA,M),s.SelfMulAdd(this.m_invMassB,M),r+=this.m_invIB*It.CrossVV(this.m_rB,M)}t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,s=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(n),a=this.m_qB.SetAngle(r),u=jt.MulRV(o,this.m_lalcA,this.m_rA),l=jt.MulRV(a,this.m_lalcB,this.m_rB),h=this.m_u;h.x=s.x+l.x-e.x-u.x,h.y=s.y+l.y-e.y-u.y;var _,m=this.m_u.Normalize();if(this.m_minLength===this.m_maxLength)_=m-this.m_minLength;else if(m<this.m_minLength)_=m-this.m_minLength;else{if(!(this.m_maxLength<m))return!0;_=m-this.m_maxLength}var c=-this.m_mass*_,f=It.MulSV(c,h,i.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,f),n-=this.m_invIA*It.CrossVV(u,f),s.SelfMulAdd(this.m_invMassB,f),r+=this.m_invIB*It.CrossVV(l,f),t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=r,ht(_)<A}},{key:"Draw",value:function(t){var e=this.m_bodyA.GetTransform(),n=this.m_bodyB.GetTransform(),s=Tt.MulXV(e,this.m_localAnchorA,i.Draw_s_pA),r=Tt.MulXV(n,this.m_localAnchorB,i.Draw_s_pB),o=It.SubVV(r,s,i.Draw_s_axis);o.Normalize();var a=i.Draw_s_c1,u=i.Draw_s_c2,l=i.Draw_s_c3,h=i.Draw_s_c4;t.DrawSegment(s,r,h);var _=It.AddVMulSV(s,this.m_length,o,i.Draw_s_pRest);if(t.DrawPoint(_,8,a),this.m_minLength!==this.m_maxLength){if(this.m_minLength>A){var m=It.AddVMulSV(s,this.m_minLength,o,i.Draw_s_pMin);t.DrawPoint(m,4,u)}if(this.m_maxLength<c){var f=It.AddVMulSV(s,this.m_maxLength,o,i.Draw_s_pMax);t.DrawPoint(f,4,l)}}}}]),i}(Tn);qn.InitVelocityConstraints_s_P=new It,qn.SolveVelocityConstraints_s_vpA=new It,qn.SolveVelocityConstraints_s_vpB=new It,qn.SolveVelocityConstraints_s_P=new It,qn.SolvePositionConstraints_s_P=new It,qn.Draw_s_pA=new It,qn.Draw_s_pB=new It,qn.Draw_s_axis=new It,qn.Draw_s_c1=new o(.7,.7,.7),qn.Draw_s_c2=new o(.3,.9,.3),qn.Draw_s_c3=new o(.9,.3,.3),qn.Draw_s_c4=new o(.4,.4,.4),qn.Draw_s_pRest=new It,qn.Draw_s_pMin=new It,qn.Draw_s_pMax=new It;var zn=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.call(this,Sn.e_areaJoint)).bodies=[],t.stiffness=0,t.damping=0,t}return Object(r.a)(i,[{key:"AddBody",value:function(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)}}]),i}(Ln),En=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s;Object(n.a)(this,i),(s=e.call(this,t)).m_stiffness=0,s.m_damping=0,s.m_impulse=0,s.m_targetArea=0,s.m_delta=new It,s.m_bodies=t.bodies,s.m_stiffness=m(t.stiffness,0),s.m_damping=m(t.damping,0),s.m_targetLengths=it(t.bodies.length),s.m_normals=It.MakeArray(t.bodies.length),s.m_joints=[],s.m_deltas=It.MakeArray(t.bodies.length);var r=new On;r.stiffness=s.m_stiffness,r.damping=s.m_damping,s.m_targetArea=0;for(var o=0;o<s.m_bodies.length;++o){var a=s.m_bodies[o],u=s.m_bodies[(o+1)%s.m_bodies.length],l=a.GetWorldCenter(),h=u.GetWorldCenter();s.m_targetLengths[o]=It.DistanceVV(l,h),s.m_targetArea+=It.CrossVV(l,h),r.Initialize(a,u,l,h),s.m_joints[o]=a.GetWorld().CreateJoint(r)}return s.m_targetArea*=.5,s}return Object(r.a)(i,[{key:"GetAnchorA",value:function(t){return t}},{key:"GetAnchorB",value:function(t){return t}},{key:"GetReactionForce",value:function(t,e){return e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"SetStiffness",value:function(t){this.m_stiffness=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetStiffness(t)}},{key:"GetStiffness",value:function(){return this.m_stiffness}},{key:"SetDamping",value:function(t){this.m_damping=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDamping(t)}},{key:"GetDamping",value:function(){return this.m_damping}},{key:"Dump",value:function(t){t("Area joint dumping is not supported.\n")}},{key:"InitVelocityConstraints",value:function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],n=this.m_bodies[(e+1)%this.m_bodies.length],s=t.positions[i.m_islandIndex].c,r=t.positions[n.m_islandIndex].c,o=this.m_deltas[e];It.SubVV(r,s,o)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(var a=0;a<this.m_bodies.length;++a){var u=this.m_bodies[a],l=t.velocities[u.m_islandIndex].v,h=this.m_deltas[a];l.x+=u.m_invMass*h.y*.5*this.m_impulse,l.y+=u.m_invMass*-h.x*.5*this.m_impulse}}else this.m_impulse=0}},{key:"SolveVelocityConstraints",value:function(t){for(var e=0,i=0,n=0;n<this.m_bodies.length;++n){var s=this.m_bodies[n],r=t.velocities[s.m_islandIndex].v,o=this.m_deltas[n];e+=o.LengthSquared()/s.GetMass(),i+=It.CrossVV(r,o)}var a=-2*i/e;this.m_impulse+=a;for(var u=0;u<this.m_bodies.length;++u){var l=this.m_bodies[u],h=t.velocities[l.m_islandIndex].v,_=this.m_deltas[u];h.x+=l.m_invMass*_.y*.5*a,h.y+=l.m_invMass*-_.x*.5*a}}},{key:"SolvePositionConstraints",value:function(t){for(var e=0,i=0,n=0;n<this.m_bodies.length;++n){var s=this.m_bodies[n],r=this.m_bodies[(n+1)%this.m_bodies.length],o=t.positions[s.m_islandIndex].c,a=t.positions[r.m_islandIndex].c,u=It.SubVV(a,o,this.m_delta),l=u.Length();l<f&&(l=1),this.m_normals[n].x=u.y/l,this.m_normals[n].y=-u.x/l,e+=l,i+=It.CrossVV(o,a)}i*=.5;for(var h=.5*(this.m_targetArea-i)/e,_=!0,m=0;m<this.m_bodies.length;++m){var c=this.m_bodies[m],d=t.positions[c.m_islandIndex].c,v=(m+1)%this.m_bodies.length,y=It.AddVV(this.m_normals[m],this.m_normals[v],this.m_delta);y.SelfMul(h);var p=y.LengthSquared();p>vt(w)&&y.SelfMul(w/pt(p)),p>vt(A)&&(_=!1),d.x+=y.x,d.y+=y.y}return _}}]),i}(Tn),Nn=i(49),Jn=function(){function t(){Object(n.a)(this,t),this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}return Object(r.a)(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex||0,this}}]),t}();Jn.DEFAULT=new Jn;var Xn=function t(){Object(n.a)(this,t),this.userData=null,this.friction=.2,this.restitution=0,this.restitutionThreshold=1*y,this.density=0,this.isSensor=!1,this.filter=new Jn},Zn=function(){function t(e,i){Object(n.a)(this,t),this.aabb=new Ie,this.childIndex=0,this.fixture=e,this.childIndex=i,this.fixture.m_shape.ComputeAABB(this.aabb,this.fixture.m_body.GetTransform(),i),this.treeNode=this.fixture.m_body.m_world.m_contactManager.m_broadPhase.CreateProxy(this.aabb,this)}return Object(r.a)(t,[{key:"Reset",value:function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.DestroyProxy(this.treeNode)}},{key:"Touch",value:function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.TouchProxy(this.treeNode)}},{key:"Synchronize",value:function(e,i){if(e===i)this.fixture.m_shape.ComputeAABB(this.aabb,e,this.childIndex),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,It.ZERO);else{var n=t.Synchronize_s_aabb1,s=t.Synchronize_s_aabb2;this.fixture.m_shape.ComputeAABB(n,e,this.childIndex),this.fixture.m_shape.ComputeAABB(s,i,this.childIndex),this.aabb.Combine2(n,s);var r=t.Synchronize_s_displacement;r.Copy(s.GetCenter()).SelfSub(n.GetCenter()),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,r)}}}]),t}();Zn.Synchronize_s_aabb1=new Ie,Zn.Synchronize_s_aabb2=new Ie,Zn.Synchronize_s_displacement=new It;var Un,Wn=function(){function t(e,i){Object(n.a)(this,t),this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_restitutionThreshold=1*y,this.m_proxies=[],this.m_filter=new Jn,this.m_isSensor=!1,this.m_userData=null,this.m_body=e,this.m_shape=i.shape.Clone(),this.m_userData=m(i.userData,null),this.m_friction=m(i.friction,.2),this.m_restitution=m(i.restitution,0),this.m_restitutionThreshold=m(i.restitutionThreshold,0),this.m_filter.Copy(m(i.filter,Jn.DEFAULT)),this.m_isSensor=m(i.isSensor,!1),this.m_density=m(i.density,0)}return Object(r.a)(t,[{key:"m_proxyCount",get:function(){return this.m_proxies.length}},{key:"Reset",value:function(){}},{key:"GetType",value:function(){return this.m_shape.GetType()}},{key:"GetShape",value:function(){return this.m_shape}},{key:"SetSensor",value:function(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}},{key:"IsSensor",value:function(){return this.m_isSensor}},{key:"SetFilterData",value:function(t){this.m_filter.Copy(t),this.Refilter()}},{key:"GetFilterData",value:function(){return this.m_filter}},{key:"Refilter",value:function(){for(var t=this.m_body.GetContactList();t;){var e=t.contact,i=e.GetFixtureA(),n=e.GetFixtureB();i!==this&&n!==this||e.FlagForFiltering(),t=t.next}this.TouchProxies()}},{key:"GetBody",value:function(){return this.m_body}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"TestPoint",value:function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}},{key:"ComputeDistance",value:function(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i)}},{key:"RayCast",value:function(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)}},{key:"GetMassData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new We;return this.m_shape.ComputeMass(t,this.m_density),t}},{key:"SetDensity",value:function(t){this.m_density=t}},{key:"GetDensity",value:function(){return this.m_density}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetRestitutionThreshold",value:function(){return this.m_restitutionThreshold}},{key:"SetRestitutionThreshold",value:function(t){this.m_restitutionThreshold=t}},{key:"GetAABB",value:function(t){return this.m_proxies[t].aabb}},{key:"Dump",value:function(t,e){t("    const fd: b2FixtureDef = new b2FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.restitutionThreshold = %.15f;\n",this.m_restitutionThreshold),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",e)}},{key:"CreateProxies",value:function(){if(0!==this.m_proxies.length)throw new Error;for(var t=0;t<this.m_shape.GetChildCount();++t)this.m_proxies[t]=new Zn(this,t)}},{key:"DestroyProxies",value:function(){var t,e=Object(Nn.a)(this.m_proxies);try{for(e.s();!(t=e.n()).done;){t.value.Reset()}}catch(i){e.e(i)}finally{e.f()}this.m_proxies.length=0}},{key:"TouchProxies",value:function(){var t,e=Object(Nn.a)(this.m_proxies);try{for(e.s();!(t=e.n()).done;){t.value.Touch()}}catch(i){e.e(i)}finally{e.f()}}},{key:"SynchronizeProxies",value:function(t,e){var i,n=Object(Nn.a)(this.m_proxies);try{for(n.s();!(i=n.n()).done;){i.value.Synchronize(t,e)}}catch(s){n.e(s)}finally{n.f()}}}]),t}();!function(t){t[t.b2_unknown=-1]="b2_unknown",t[t.b2_staticBody=0]="b2_staticBody",t[t.b2_kinematicBody=1]="b2_kinematicBody",t[t.b2_dynamicBody=2]="b2_dynamicBody"}(Un||(Un={}));var Qn=function t(){Object(n.a)(this,t),this.id="",this.type=Un.b2_staticBody,this.position=new It(0,0),this.angle=0,this.linearVelocity=new It(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.enabled=!0,this.userData=null,this.gravityScale=1},Yn=function(){function t(e,i){Object(n.a)(this,t),this.m_type=Un.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_enabledFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new Tt,this.m_xf0=new Tt,this.m_sweep=new Ot,this.m_linearVelocity=new It,this.m_angularVelocity=0,this.m_force=new It,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_id=e.id,this.m_bulletFlag=m(e.bullet,!1),this.m_fixedRotationFlag=m(e.fixedRotation,!1),this.m_autoSleepFlag=m(e.allowSleep,!0),m(e.awake,!1)&&m(e.type,Un.b2_staticBody)!==Un.b2_staticBody&&(this.m_awakeFlag=!0),this.m_enabledFlag=m(e.enabled,!0),this.m_world=i,this.m_xf.p.Copy(m(e.position,It.ZERO)),this.m_xf.q.SetAngle(m(e.angle,0)),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(m(e.linearVelocity,It.ZERO)),this.m_angularVelocity=m(e.angularVelocity,0),this.m_linearDamping=m(e.linearDamping,0),this.m_angularDamping=m(e.angularDamping,0),this.m_gravityScale=m(e.gravityScale,1),this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=m(e.type,Un.b2_staticBody),this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0}return Object(r.a)(t,[{key:"GetId",value:function(){return this.m_id}},{key:"CreateFixture",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t instanceof Qe?this.CreateFixtureShapeDensity(t,e):this.CreateFixtureDef(t)}},{key:"CreateFixtureDef",value:function(t){if(this.m_world.IsLocked())throw new Error;var e=new Wn(this,t);return this.m_enabledFlag&&e.CreateProxies(),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newContacts=!0,e}},{key:"CreateFixtureShapeDensity",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t.CreateFixtureShapeDensity_s_def;return n.shape=e,n.density=i,this.CreateFixtureDef(n)}},{key:"DestroyFixture",value:function(t){if(this.m_world.IsLocked())throw new Error;for(var e=this.m_fixtureList,i=null;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=e,e=e.m_next}for(var n=this.m_contactList;n;){var s=n.contact;n=n.next;var r=s.GetFixtureA(),o=s.GetFixtureB();t!==r&&t!==o||this.m_world.m_contactManager.Destroy(s)}this.m_enabledFlag&&t.DestroyProxies(),t.m_next=null,t.Reset(),--this.m_fixtureCount,this.ResetMassData()}},{key:"SetTransformVec",value:function(t,e){this.SetTransformXY(t.x,t.y,e)}},{key:"SetTransformXY",value:function(t,e,i){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),Tt.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var n=this.m_fixtureList;n;n=n.m_next)n.SynchronizeProxies(this.m_xf,this.m_xf);this.m_world.m_newContacts=!0}},{key:"SetTransform",value:function(t){this.SetTransformVec(t.p,t.GetAngle())}},{key:"GetTransform",value:function(){return this.m_xf}},{key:"GetPosition",value:function(){return this.m_xf.p}},{key:"SetPosition",value:function(t){this.SetTransformVec(t,this.GetAngle())}},{key:"SetPositionXY",value:function(t,e){this.SetTransformXY(t,e,this.GetAngle())}},{key:"GetAngle",value:function(){return this.m_sweep.a}},{key:"SetAngle",value:function(t){this.SetTransformVec(this.GetPosition(),t)}},{key:"GetWorldCenter",value:function(){return this.m_sweep.c}},{key:"GetLocalCenter",value:function(){return this.m_sweep.localCenter}},{key:"SetLinearVelocity",value:function(t){this.m_type!==Un.b2_staticBody&&(It.DotVV(t,t)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(t))}},{key:"GetLinearVelocity",value:function(){return this.m_linearVelocity}},{key:"SetAngularVelocity",value:function(t){this.m_type!==Un.b2_staticBody&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)}},{key:"GetAngularVelocity",value:function(){return this.m_angularVelocity}},{key:"GetDefinition",value:function(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t}},{key:"ApplyForce",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.m_type===Un.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))}},{key:"ApplyForceToCenter",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===Un.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))}},{key:"ApplyTorque",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===Un.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))}},{key:"ApplyLinearImpulse",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.m_type===Un.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))}},{key:"ApplyLinearImpulseToCenter",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===Un.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))}},{key:"ApplyAngularImpulse",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===Un.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))}},{key:"GetMass",value:function(){return this.m_mass}},{key:"GetInertia",value:function(){return this.m_I+this.m_mass*It.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)}},{key:"GetMassData",value:function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*It.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}},{key:"SetMassData",value:function(e){if(this.m_world.IsLocked())throw new Error;if(this.m_type===Un.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&!this.m_fixedRotationFlag&&(this.m_I=e.I-this.m_mass*It.DotVV(e.center,e.center),this.m_invI=1/this.m_I);var i=t.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e.center),Tt.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),It.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,It.SubVV(this.m_sweep.c,i,It.s_t0),this.m_linearVelocity)}}},{key:"ResetMassData",value:function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===Un.b2_staticBody||this.m_type===Un.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var e=t.ResetMassData_s_localCenter.SetZero(),i=this.m_fixtureList;i;i=i.m_next)if(0!==i.m_density){var n=i.GetMassData(t.ResetMassData_s_massData);this.m_mass+=n.mass,e.x+=n.center.x*n.mass,e.y+=n.center.y*n.mass,this.m_I+=n.I}this.m_mass>0&&(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*It.DotVV(e,e),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var s=t.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e),Tt.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),It.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,It.SubVV(this.m_sweep.c,s,It.s_t0),this.m_linearVelocity)}},{key:"GetWorldPoint",value:function(t,e){return Tt.MulXV(this.m_xf,t,e)}},{key:"GetWorldVector",value:function(t,e){return jt.MulRV(this.m_xf.q,t,e)}},{key:"GetLocalPoint",value:function(t,e){return Tt.MulTXV(this.m_xf,t,e)}},{key:"GetLocalVector",value:function(t,e){return jt.MulTRV(this.m_xf.q,t,e)}},{key:"GetLinearVelocityFromWorldPoint",value:function(t,e){return It.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,It.SubVV(t,this.m_sweep.c,It.s_t0),e)}},{key:"GetLinearVelocityFromLocalPoint",value:function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}},{key:"GetLinearDamping",value:function(){return this.m_linearDamping}},{key:"SetLinearDamping",value:function(t){this.m_linearDamping=t}},{key:"GetAngularDamping",value:function(){return this.m_angularDamping}},{key:"SetAngularDamping",value:function(t){this.m_angularDamping=t}},{key:"GetGravityScale",value:function(){return this.m_gravityScale}},{key:"SetGravityScale",value:function(t){this.m_gravityScale=t}},{key:"SetType",value:function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==t){this.m_type=t,this.ResetMassData(),this.m_type===Un.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_awakeFlag=!1,this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e;e=e.next,this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null;for(var n=this.m_fixtureList;n;n=n.m_next)n.TouchProxies()}}},{key:"GetType",value:function(){return this.m_type}},{key:"SetBullet",value:function(t){this.m_bulletFlag=t}},{key:"IsBullet",value:function(){return this.m_bulletFlag}},{key:"SetSleepingAllowed",value:function(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}},{key:"IsSleepingAllowed",value:function(){return this.m_autoSleepFlag}},{key:"SetAwake",value:function(t){this.m_type!==Un.b2_staticBody&&(t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0))}},{key:"IsAwake",value:function(){return this.m_awakeFlag}},{key:"SetEnabled",value:function(t){if(this.m_world.IsLocked())throw new Error;if(t!==this.IsEnabled())if(this.m_enabledFlag=t,t){for(var e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies();this.m_world.m_newContacts=!0}else{for(var i=this.m_fixtureList;i;i=i.m_next)i.DestroyProxies();for(var n=this.m_contactList;n;){var s=n;n=n.next,this.m_world.m_contactManager.Destroy(s.contact)}this.m_contactList=null}}},{key:"IsEnabled",value:function(){return this.m_enabledFlag}},{key:"SetFixedRotation",value:function(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}},{key:"IsFixedRotation",value:function(){return this.m_fixedRotationFlag}},{key:"GetFixtureList",value:function(){return this.m_fixtureList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetContactList",value:function(){return this.m_contactList}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"GetWorld",value:function(){return this.m_world}},{key:"Dump",value:function(t){var e=this.m_islandIndex;t("{\n"),t("  const bd: b2BodyDef = new b2BodyDef();\n");var i="";switch(this.m_type){case Un.b2_staticBody:i="b2BodyType.b2_staticBody";break;case Un.b2_kinematicBody:i="b2BodyType.b2_kinematicBody";break;case Un.b2_dynamicBody:i="b2BodyType.b2_dynamicBody"}t("  bd.type = %s;\n",i),t("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),t("  bd.angle = %.15f;\n",this.m_sweep.a),t("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),t("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),t("  bd.linearDamping = %.15f;\n",this.m_linearDamping),t("  bd.angularDamping = %.15f;\n",this.m_angularDamping),t("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),t("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),t("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),t("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),t("  bd.active = %s;\n",this.m_enabledFlag?"true":"false"),t("  bd.gravityScale = %.15f;\n",this.m_gravityScale),t("\n"),t("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),t("\n");for(var n=this.m_fixtureList;n;n=n.m_next)t("  {\n"),n.Dump(t,e),t("  }\n");t("}\n")}},{key:"SynchronizeFixtures",value:function(){if(this.m_awakeFlag){var e=t.SynchronizeFixtures_s_xf1;e.q.SetAngle(this.m_sweep.a0),jt.MulRV(e.q,this.m_sweep.localCenter,e.p),It.SubVV(this.m_sweep.c0,e.p,e.p);for(var i=this.m_fixtureList;i;i=i.m_next)i.SynchronizeProxies(e,this.m_xf)}else for(var n=this.m_fixtureList;n;n=n.m_next)n.SynchronizeProxies(this.m_xf,this.m_xf)}},{key:"SynchronizeTransform",value:function(){this.m_xf.q.SetAngle(this.m_sweep.a),jt.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),It.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}},{key:"ShouldCollide",value:function(t){return(this.m_type!==Un.b2_staticBody||t.m_type!==Un.b2_staticBody)&&this.ShouldCollideConnected(t)}},{key:"ShouldCollideConnected",value:function(t){for(var e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}},{key:"Advance",value:function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),jt.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),It.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}},{key:"GetControllerList",value:function(){return this.m_controllerList}},{key:"GetControllerCount",value:function(){return this.m_controllerCount}}]),t}();function Kn(t,e){return pt(t*e)}function Hn(t,e){return t>e?t:e}function $n(t,e){return t<e?t:e}Yn.CreateFixtureShapeDensity_s_def=new Xn,Yn.SetMassData_s_oldCenter=new It,Yn.ResetMassData_s_localCenter=new It,Yn.ResetMassData_s_oldCenter=new It,Yn.ResetMassData_s_massData=new We,Yn.SynchronizeFixtures_s_xf1=new Tt;var ts=function(){function t(e){Object(n.a)(this,t),this._other=null,this.prev=null,this.next=null,this.contact=e}return Object(r.a)(t,[{key:"other",get:function(){if(null===this._other)throw new Error;return this._other},set:function(t){if(null!==this._other)throw new Error;this._other=t}},{key:"Reset",value:function(){this._other=null,this.prev=null,this.next=null}}]),t}(),es=function(){function t(){Object(n.a)(this,t),this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_nodeA=new ts(this),this.m_nodeB=new ts(this),this.m_indexA=0,this.m_indexB=0,this.m_manifold=new ge,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_restitutionThreshold=0,this.m_tangentSpeed=0,this.m_oldManifold=new ge}return Object(r.a)(t,[{key:"GetManifold",value:function(){return this.m_manifold}},{key:"GetWorldManifold",value:function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),n=this.GetShapeA(),s=this.GetShapeB();t.Initialize(this.m_manifold,e.GetTransform(),n.m_radius,i.GetTransform(),s.m_radius)}},{key:"IsTouching",value:function(){return this.m_touchingFlag}},{key:"SetEnabled",value:function(t){this.m_enabledFlag=t}},{key:"IsEnabled",value:function(){return this.m_enabledFlag}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetFixtureA",value:function(){return this.m_fixtureA}},{key:"GetChildIndexA",value:function(){return this.m_indexA}},{key:"GetShapeA",value:function(){return this.m_fixtureA.GetShape()}},{key:"GetFixtureB",value:function(){return this.m_fixtureB}},{key:"GetChildIndexB",value:function(){return this.m_indexB}},{key:"GetShapeB",value:function(){return this.m_fixtureB.GetShape()}},{key:"FlagForFiltering",value:function(){this.m_filterFlag=!0}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"ResetFriction",value:function(){this.m_friction=Kn(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"ResetRestitution",value:function(){this.m_restitution=Hn(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}},{key:"SetRestitutionThreshold",value:function(t){this.m_restitutionThreshold=t}},{key:"GetRestitutionThreshold",value:function(){return this.m_restitutionThreshold}},{key:"ResetRestitutionThreshold",value:function(){this.m_restitutionThreshold=$n(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}},{key:"SetTangentSpeed",value:function(t){this.m_tangentSpeed=t}},{key:"GetTangentSpeed",value:function(){return this.m_tangentSpeed}},{key:"Reset",value:function(t,e,i,n){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=n,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.Reset(),this.m_nodeB.Reset(),this.m_toiCount=0,this.m_friction=Kn(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Hn(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution),this.m_restitutionThreshold=$n(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}},{key:"Update",value:function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;var i=!1,n=this.m_touchingFlag,s=this.m_fixtureA.IsSensor(),r=this.m_fixtureB.IsSensor(),o=s||r,a=this.m_fixtureA.GetBody(),u=this.m_fixtureB.GetBody(),l=a.GetTransform(),h=u.GetTransform();if(o){var _=this.GetShapeA(),m=this.GetShapeB();i=je(_,this.m_indexA,m,this.m_indexB,l,h),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,l,h),i=this.m_manifold.pointCount>0;for(var c=0;c<this.m_manifold.pointCount;++c){var f=this.m_manifold.points[c];f.normalImpulse=0,f.tangentImpulse=0;for(var d=f.id,v=0;v<this.m_oldManifold.pointCount;++v){var y=this.m_oldManifold.points[v];if(y.id.key===d.key){f.normalImpulse=y.normalImpulse,f.tangentImpulse=y.tangentImpulse;break}}}i!==n&&(a.SetAwake(!0),u.SetAwake(!0))}this.m_touchingFlag=i,!n&&i&&t&&t.BeginContact(this),n&&!i&&t&&t.EndContact(this),!o&&i&&t&&t.PreSolve(this,this.m_oldManifold)}},{key:"ComputeTOI",value:function(e,i){var n=t.ComputeTOI_s_input;n.proxyA.SetShape(this.GetShapeA(),this.m_indexA),n.proxyB.SetShape(this.GetShapeB(),this.m_indexB),n.sweepA.Copy(e),n.sweepB.Copy(i),n.tMax=A;var s=t.ComputeTOI_s_output;return Gn(s,n),s.t}}]),t}();es.ComputeTOI_s_input=new pn,es.ComputeTOI_s_output=new Bn;var is=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){return Object(n.a)(this,i),e.apply(this,arguments)}return Object(r.a)(i,[{key:"Evaluate",value:function(t,e,n){var s=i.Evaluate_s_edge;this.GetShapeA().GetChildEdge(s,this.m_indexA),di(t,s,e,this.GetShapeB(),n)}}],[{key:"Create",value:function(){return new i}},{key:"Destroy",value:function(t){}}]),i}(es);is.Evaluate_s_edge=new Ye;var ns=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){return Object(n.a)(this,i),e.apply(this,arguments)}return Object(r.a)(i,[{key:"Evaluate",value:function(t,e,n){var s=i.Evaluate_s_edge;this.GetShapeA().GetChildEdge(s,this.m_indexA),Fi(t,s,e,this.GetShapeB(),n)}}],[{key:"Create",value:function(){return new i}},{key:"Destroy",value:function(t){}}]),i}(es);ns.Evaluate_s_edge=new Ye;var ss=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){return Object(n.a)(this,i),e.apply(this,arguments)}return Object(r.a)(i,[{key:"Evaluate",value:function(t,e,i){ei(t,this.GetShapeA(),e,this.GetShapeB(),i)}}],[{key:"Create",value:function(){return new i}},{key:"Destroy",value:function(t){}}]),i}(es),rs=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){return Object(n.a)(this,i),e.apply(this,arguments)}return Object(r.a)(i,[{key:"Evaluate",value:function(t,e,i){$i(t,this.GetShapeA(),e,this.GetShapeB(),i)}}],[{key:"Create",value:function(){return new i}},{key:"Destroy",value:function(t){}}]),i}(es),os=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){return Object(n.a)(this,i),e.apply(this,arguments)}return Object(r.a)(i,[{key:"Evaluate",value:function(t,e,i){ri(t,this.GetShapeA(),e,this.GetShapeB(),i)}}],[{key:"Create",value:function(){return new i}},{key:"Destroy",value:function(t){}}]),i}(es),as=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){return Object(n.a)(this,i),e.apply(this,arguments)}return Object(r.a)(i,[{key:"Evaluate",value:function(t,e,i){di(t,this.GetShapeA(),e,this.GetShapeB(),i)}}],[{key:"Create",value:function(){return new i}},{key:"Destroy",value:function(t){}}]),i}(es),us=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){return Object(n.a)(this,i),e.apply(this,arguments)}return Object(r.a)(i,[{key:"Evaluate",value:function(t,e,i){Fi(t,this.GetShapeA(),e,this.GetShapeB(),i)}}],[{key:"Create",value:function(){return new i}},{key:"Destroy",value:function(t){}}]),i}(es),ls=function t(){Object(n.a)(this,t),this.pool=[],this.createFcn=null,this.destroyFcn=null,this.primary=!1},hs=function(){function t(){Object(n.a)(this,t),this.m_registers=[],this.InitializeRegisters()}return Object(r.a)(t,[{key:"AddType",value:function(t,e,i,n){var s=[];function r(){return s.pop()||t()}function o(t){s.push(t)}this.m_registers[i][n].pool=s,this.m_registers[i][n].createFcn=r,this.m_registers[i][n].destroyFcn=o,this.m_registers[i][n].primary=!0,i!==n&&(this.m_registers[n][i].pool=s,this.m_registers[n][i].createFcn=r,this.m_registers[n][i].destroyFcn=o,this.m_registers[n][i].primary=!1)}},{key:"InitializeRegisters",value:function(){for(var t=0;t<ze.e_shapeTypeCount;t++){this.m_registers[t]=[];for(var e=0;e<ze.e_shapeTypeCount;e++)this.m_registers[t][e]=new ls}this.AddType(ss.Create,ss.Destroy,ze.e_circleShape,ze.e_circleShape),this.AddType(os.Create,os.Destroy,ze.e_polygonShape,ze.e_circleShape),this.AddType(rs.Create,rs.Destroy,ze.e_polygonShape,ze.e_polygonShape),this.AddType(as.Create,as.Destroy,ze.e_edgeShape,ze.e_circleShape),this.AddType(us.Create,us.Destroy,ze.e_edgeShape,ze.e_polygonShape),this.AddType(is.Create,is.Destroy,ze.e_chainShape,ze.e_circleShape),this.AddType(ns.Create,ns.Destroy,ze.e_chainShape,ze.e_polygonShape)}},{key:"Create",value:function(t,e,i,n){var s=t.GetType(),r=i.GetType(),o=this.m_registers[s][r];if(o.createFcn){var a=o.createFcn();return o.primary?a.Reset(t,e,i,n):a.Reset(i,n,t,e),a}return null}},{key:"Destroy",value:function(t){var e=t.m_fixtureA.GetType(),i=t.m_fixtureB.GetType(),n=this.m_registers[e][i];n.destroyFcn&&n.destroyFcn(t)}}]),t}(),_s=function(){function t(){Object(n.a)(this,t)}return Object(r.a)(t,[{key:"SayGoodbyeJoint",value:function(t){}},{key:"SayGoodbyeFixture",value:function(t){}},{key:"SayGoodbyeParticleGroup",value:function(t){}},{key:"SayGoodbyeParticle",value:function(t,e){}}]),t}(),ms=function(){function t(){Object(n.a)(this,t)}return Object(r.a)(t,[{key:"ShouldCollide",value:function(t,e){var i=t.GetBody(),n=e.GetBody();if(n.GetType()===Un.b2_staticBody&&i.GetType()===Un.b2_staticBody)return!1;if(!n.ShouldCollideConnected(i))return!1;var s=t.GetFilterData(),r=e.GetFilterData();return s.groupIndex===r.groupIndex&&0!==s.groupIndex?s.groupIndex>0:0!==(s.maskBits&r.categoryBits)&&0!==(s.categoryBits&r.maskBits)}},{key:"ShouldCollideFixtureParticle",value:function(t,e,i){return!0}},{key:"ShouldCollideParticleParticle",value:function(t,e,i){return!0}}]),t}();ms.b2_defaultFilter=new ms;var cs=function t(){Object(n.a)(this,t),this.normalImpulses=it(x),this.tangentImpulses=it(x),this.count=0},fs=function(){function t(){Object(n.a)(this,t)}return Object(r.a)(t,[{key:"BeginContact",value:function(t){}},{key:"EndContact",value:function(t){}},{key:"BeginContactFixtureParticle",value:function(t,e){}},{key:"EndContactFixtureParticle",value:function(t,e){}},{key:"BeginContactBodyParticleGroup",value:function(t,e){}},{key:"EndContactBodyParticleGroup",value:function(t,e){}},{key:"BeginContactParticleParticle",value:function(t,e){}},{key:"EndContactParticleParticle",value:function(t,e){}},{key:"BeginContactParticleGroupParticleGroup",value:function(t,e){}},{key:"EndContactParticleGroupParticleGroup",value:function(t,e){}},{key:"PreSolve",value:function(t,e){}},{key:"PostSolve",value:function(t,e){}}]),t}();fs.b2_defaultListener=new fs;var ds=function(){function t(){Object(n.a)(this,t)}return Object(r.a)(t,[{key:"ReportFixture",value:function(t){return!0}},{key:"ReportParticle",value:function(t,e){return!1}},{key:"ShouldQueryParticleSystem",value:function(t){return!0}}]),t}(),vs=function(){function t(){Object(n.a)(this,t)}return Object(r.a)(t,[{key:"ReportFixture",value:function(t,e,i,n){return n}},{key:"ReportParticle",value:function(t,e,i,n,s){return 0}},{key:"ShouldQueryParticleSystem",value:function(t){return!0}}]),t}(),ys=function(){function t(){Object(n.a)(this,t),this.m_broadPhase=new Ne,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=ms.b2_defaultFilter,this.m_contactListener=fs.b2_defaultListener,this.m_contactFactory=new hs}return Object(r.a)(t,[{key:"AddPair",value:function(t,e){var i=t.fixture,n=e.fixture,s=t.childIndex,r=e.childIndex,o=i.GetBody(),a=n.GetBody();if(o!==a){for(var u=a.GetContactList();u;){if(u.other===o){var l=u.contact.GetFixtureA(),h=u.contact.GetFixtureB(),_=u.contact.GetChildIndexA(),m=u.contact.GetChildIndexB();if(l===i&&h===n&&_===s&&m===r)return;if(l===n&&h===i&&_===r&&m===s)return}u=u.next}if(!this.m_contactFilter||this.m_contactFilter.ShouldCollide(i,n)){var c=this.m_contactFactory.Create(i,s,n,r);null!==c&&(i=c.GetFixtureA(),n=c.GetFixtureB(),s=c.GetChildIndexA(),r=c.GetChildIndexB(),o=i.m_body,a=n.m_body,c.m_prev=null,c.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=c),this.m_contactList=c,c.m_nodeA.other=a,c.m_nodeA.prev=null,c.m_nodeA.next=o.m_contactList,null!==o.m_contactList&&(o.m_contactList.prev=c.m_nodeA),o.m_contactList=c.m_nodeA,c.m_nodeB.other=o,c.m_nodeB.prev=null,c.m_nodeB.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=c.m_nodeB),a.m_contactList=c.m_nodeB,++this.m_contactCount)}}}},{key:"FindNewContacts",value:function(){var t=this;this.m_broadPhase.UpdatePairs((function(e,i){t.AddPair(e,i)}))}},{key:"Destroy",value:function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),n=e.GetBody(),s=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===n.m_contactList&&(n.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===s.m_contactList&&(s.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0)),this.m_contactFactory.Destroy(t),--this.m_contactCount}},{key:"Collide",value:function(){for(var t=this.m_contactList;t;){var e=t.GetFixtureA(),i=t.GetFixtureB(),n=t.GetChildIndexA(),s=t.GetChildIndexB(),r=e.GetBody(),o=i.GetBody();if(t.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,i)){var a=t;t=a.m_next,this.Destroy(a);continue}t.m_filterFlag=!1}var u=r.IsAwake()&&r.m_type!==Un.b2_staticBody,l=o.IsAwake()&&o.m_type!==Un.b2_staticBody;if(u||l){var h=e.m_proxies[n].treeNode,_=i.m_proxies[s].treeNode;if(Ge(h.aabb,_.aabb))t.Update(this.m_contactListener),t=t.m_next;else{var m=t;t=m.m_next,this.Destroy(m)}}else t=t.m_next}}}]),t}(),ps=function(){function t(){Object(n.a)(this,t),this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}return Object(r.a)(t,[{key:"Reset",value:function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}}]),t}(),xs=function(){function t(){Object(n.a)(this,t),this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1}return Object(r.a)(t,[{key:"Copy",value:function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this}}]),t}(),Bs=function(){function t(){Object(n.a)(this,t),this.c=new It,this.a=0}return Object(r.a)(t,null,[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),Ss=function(){function t(){Object(n.a)(this,t),this.v=new It,this.w=0}return Object(r.a)(t,null,[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),As=function t(){Object(n.a)(this,t),this.step=new xs},Cs=!1;function bs(){return Cs}function gs(t){Cs=t}var Vs=function(){function t(){Object(n.a)(this,t),this.rA=new It,this.rB=new It,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return Object(r.a)(t,null,[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),ws=function(){function t(){Object(n.a)(this,t),this.points=Vs.MakeArray(x),this.normal=new It,this.tangent=new It,this.normalMass=new Lt,this.K=new Lt,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.threshold=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}return Object(r.a)(t,null,[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),ks=function(){function t(){Object(n.a)(this,t),this.localPoints=It.MakeArray(x),this.localNormal=new It,this.localPoint=new It,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new It,this.localCenterB=new It,this.invIA=0,this.invIB=0,this.type=Be.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}return Object(r.a)(t,null,[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),Ms=function t(){Object(n.a)(this,t),this.step=new xs,this.count=0},Ps=function(){function t(){Object(n.a)(this,t),this.normal=new It,this.point=new It,this.separation=0}return Object(r.a)(t,[{key:"Initialize",value:function(e,i,n,s){var r=t.Initialize_s_pointA,o=t.Initialize_s_pointB,a=t.Initialize_s_planePoint,u=t.Initialize_s_clipPoint;switch(e.type){case Be.e_circles:Tt.MulXV(i,e.localPoint,r),Tt.MulXV(n,e.localPoints[0],o),It.SubVV(o,r,this.normal).SelfNormalize(),It.MidVV(r,o,this.point),this.separation=It.DotVV(It.SubVV(o,r,It.s_t0),this.normal)-e.radiusA-e.radiusB;break;case Be.e_faceA:jt.MulRV(i.q,e.localNormal,this.normal),Tt.MulXV(i,e.localPoint,a),Tt.MulXV(n,e.localPoints[s],u),this.separation=It.DotVV(It.SubVV(u,a,It.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(u);break;case Be.e_faceB:jt.MulRV(n.q,e.localNormal,this.normal),Tt.MulXV(n,e.localPoint,a),Tt.MulXV(i,e.localPoints[s],u),this.separation=It.DotVV(It.SubVV(u,a,It.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(u),this.normal.SelfNeg()}}}]),t}();Ps.Initialize_s_pointA=new It,Ps.Initialize_s_pointB=new It,Ps.Initialize_s_planePoint=new It,Ps.Initialize_s_clipPoint=new It;var Is=function(){function t(){Object(n.a)(this,t),this.m_step=new xs,this.m_positionConstraints=ks.MakeArray(1024),this.m_velocityConstraints=ws.MakeArray(1024),this.m_count=0}return Object(r.a)(t,[{key:"Initialize",value:function(t){if(this.m_step.Copy(t.step),this.m_count=t.count,this.m_positionConstraints.length<this.m_count)for(var e=mt(2*this.m_positionConstraints.length,this.m_count);this.m_positionConstraints.length<e;)this.m_positionConstraints[this.m_positionConstraints.length]=new ks;if(this.m_velocityConstraints.length<this.m_count)for(var i=mt(2*this.m_velocityConstraints.length,this.m_count);this.m_velocityConstraints.length<i;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new ws;this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(var n=0;n<this.m_count;++n){var s=this.m_contacts[n],r=s.m_fixtureA,o=s.m_fixtureB,a=r.GetShape(),u=o.GetShape(),l=a.m_radius,h=u.m_radius,_=r.GetBody(),m=o.GetBody(),c=s.GetManifold(),f=c.pointCount,d=this.m_velocityConstraints[n];d.friction=s.m_friction,d.restitution=s.m_restitution,d.threshold=s.m_restitutionThreshold,d.tangentSpeed=s.m_tangentSpeed,d.indexA=_.m_islandIndex,d.indexB=m.m_islandIndex,d.invMassA=_.m_invMass,d.invMassB=m.m_invMass,d.invIA=_.m_invI,d.invIB=m.m_invI,d.contactIndex=n,d.pointCount=f,d.K.SetZero(),d.normalMass.SetZero();var v=this.m_positionConstraints[n];v.indexA=_.m_islandIndex,v.indexB=m.m_islandIndex,v.invMassA=_.m_invMass,v.invMassB=m.m_invMass,v.localCenterA.Copy(_.m_sweep.localCenter),v.localCenterB.Copy(m.m_sweep.localCenter),v.invIA=_.m_invI,v.invIB=m.m_invI,v.localNormal.Copy(c.localNormal),v.localPoint.Copy(c.localPoint),v.pointCount=f,v.radiusA=l,v.radiusB=h,v.type=c.type;for(var y=0;y<f;++y){var p=c.points[y],x=d.points[y];this.m_step.warmStarting?(x.normalImpulse=this.m_step.dtRatio*p.normalImpulse,x.tangentImpulse=this.m_step.dtRatio*p.tangentImpulse):(x.normalImpulse=0,x.tangentImpulse=0),x.rA.SetZero(),x.rB.SetZero(),x.normalMass=0,x.tangentMass=0,x.velocityBias=0,v.localPoints[y].Copy(p.localPoint)}}return this}},{key:"InitializeVelocityConstraints",value:function(){for(var e=t.InitializeVelocityConstraints_s_xfA,i=t.InitializeVelocityConstraints_s_xfB,n=t.InitializeVelocityConstraints_s_worldManifold,s=0;s<this.m_count;++s){var r=this.m_velocityConstraints[s],o=this.m_positionConstraints[s],a=o.radiusA,u=o.radiusB,l=this.m_contacts[r.contactIndex].GetManifold(),h=r.indexA,_=r.indexB,m=r.invMassA,c=r.invMassB,f=r.invIA,d=r.invIB,v=o.localCenterA,y=o.localCenterB,p=this.m_positions[h].c,x=this.m_positions[h].a,B=this.m_velocities[h].v,S=this.m_velocities[h].w,A=this.m_positions[_].c,C=this.m_positions[_].a,b=this.m_velocities[_].v,g=this.m_velocities[_].w;e.q.SetAngle(x),i.q.SetAngle(C),It.SubVV(p,jt.MulRV(e.q,v,It.s_t0),e.p),It.SubVV(A,jt.MulRV(i.q,y,It.s_t0),i.p),n.Initialize(l,e,a,i,u),r.normal.Copy(n.normal),It.CrossVOne(r.normal,r.tangent);for(var V=r.pointCount,w=0;w<V;++w){var k=r.points[w];It.SubVV(n.points[w],p,k.rA),It.SubVV(n.points[w],A,k.rB);var M=It.CrossVV(k.rA,r.normal),P=It.CrossVV(k.rB,r.normal),I=m+c+f*M*M+d*P*P;k.normalMass=I>0?1/I:0;var G=r.tangent,D=It.CrossVV(k.rA,G),F=It.CrossVV(k.rB,G),L=m+c+f*D*D+d*F*F;k.tangentMass=L>0?1/L:0,k.velocityBias=0;var R=It.DotVV(r.normal,It.SubVV(It.AddVCrossSV(b,g,k.rB,It.s_t0),It.AddVCrossSV(B,S,k.rA,It.s_t1),It.s_t0));R<-r.threshold&&(k.velocityBias+=-r.restitution*R)}if(2===r.pointCount&&Cs){var j=r.points[0],T=r.points[1],O=It.CrossVV(j.rA,r.normal),q=It.CrossVV(j.rB,r.normal),z=It.CrossVV(T.rA,r.normal),E=It.CrossVV(T.rB,r.normal),N=m+c+f*O*O+d*q*q,J=m+c+f*z*z+d*E*E,X=m+c+f*O*z+d*q*E;N*N<1e3*(N*J-X*X)?(r.K.ex.Set(N,X),r.K.ey.Set(X,J),r.K.GetInverse(r.normalMass)):r.pointCount=1}}}},{key:"WarmStart",value:function(){for(var e=t.WarmStart_s_P,i=0;i<this.m_count;++i){for(var n=this.m_velocityConstraints[i],s=n.indexA,r=n.indexB,o=n.invMassA,a=n.invIA,u=n.invMassB,l=n.invIB,h=n.pointCount,_=this.m_velocities[s].v,m=this.m_velocities[s].w,c=this.m_velocities[r].v,f=this.m_velocities[r].w,d=n.normal,v=n.tangent,y=0;y<h;++y){var p=n.points[y];It.AddVV(It.MulSV(p.normalImpulse,d,It.s_t0),It.MulSV(p.tangentImpulse,v,It.s_t1),e),m-=a*It.CrossVV(p.rA,e),_.SelfMulSub(o,e),f+=l*It.CrossVV(p.rB,e),c.SelfMulAdd(u,e)}this.m_velocities[s].w=m,this.m_velocities[r].w=f}}},{key:"SolveVelocityConstraints",value:function(){for(var e=t.SolveVelocityConstraints_s_dv,i=t.SolveVelocityConstraints_s_dv1,n=t.SolveVelocityConstraints_s_dv2,s=t.SolveVelocityConstraints_s_P,r=t.SolveVelocityConstraints_s_a,o=t.SolveVelocityConstraints_s_b,a=t.SolveVelocityConstraints_s_x,u=t.SolveVelocityConstraints_s_d,l=t.SolveVelocityConstraints_s_P1,h=t.SolveVelocityConstraints_s_P2,_=t.SolveVelocityConstraints_s_P1P2,m=0;m<this.m_count;++m){for(var c=this.m_velocityConstraints[m],f=c.indexA,d=c.indexB,v=c.invMassA,y=c.invIA,p=c.invMassB,x=c.invIB,B=c.pointCount,S=this.m_velocities[f].v,A=this.m_velocities[f].w,C=this.m_velocities[d].v,b=this.m_velocities[d].w,g=c.normal,V=c.tangent,w=c.friction,k=0;k<B;++k){var M=c.points[k];It.SubVV(It.AddVCrossSV(C,b,M.rB,It.s_t0),It.AddVCrossSV(S,A,M.rA,It.s_t1),e);var P=It.DotVV(e,V)-c.tangentSpeed,I=M.tangentMass*-P,G=w*M.normalImpulse,D=ct(M.tangentImpulse+I,-G,G);I=D-M.tangentImpulse,M.tangentImpulse=D,It.MulSV(I,V,s),S.SelfMulSub(v,s),A-=y*It.CrossVV(M.rA,s),C.SelfMulAdd(p,s),b+=x*It.CrossVV(M.rB,s)}if(1===c.pointCount||!1===Cs)for(var F=0;F<B;++F){var L=c.points[F];It.SubVV(It.AddVCrossSV(C,b,L.rB,It.s_t0),It.AddVCrossSV(S,A,L.rA,It.s_t1),e);var R=It.DotVV(e,g),j=-L.normalMass*(R-L.velocityBias),T=mt(L.normalImpulse+j,0);j=T-L.normalImpulse,L.normalImpulse=T,It.MulSV(j,g,s),S.SelfMulSub(v,s),A-=y*It.CrossVV(L.rA,s),C.SelfMulAdd(p,s),b+=x*It.CrossVV(L.rB,s)}else{var O=c.points[0],q=c.points[1];r.Set(O.normalImpulse,q.normalImpulse),It.SubVV(It.AddVCrossSV(C,b,O.rB,It.s_t0),It.AddVCrossSV(S,A,O.rA,It.s_t1),i),It.SubVV(It.AddVCrossSV(C,b,q.rB,It.s_t0),It.AddVCrossSV(S,A,q.rA,It.s_t1),n);var z=It.DotVV(i,g),E=It.DotVV(n,g);for(o.x=z-O.velocityBias,o.y=E-q.velocityBias,o.SelfSub(Lt.MulMV(c.K,r,It.s_t0));;){if(Lt.MulMV(c.normalMass,o,a).SelfNeg(),a.x>=0&&a.y>=0){It.SubVV(a,r,u),It.MulSV(u.x,g,l),It.MulSV(u.y,g,h),It.AddVV(l,h,_),S.SelfMulSub(v,_),A-=y*(It.CrossVV(O.rA,l)+It.CrossVV(q.rA,h)),C.SelfMulAdd(p,_),b+=x*(It.CrossVV(O.rB,l)+It.CrossVV(q.rB,h)),O.normalImpulse=a.x,q.normalImpulse=a.y;break}if(a.x=-O.normalMass*o.x,a.y=0,z=0,E=c.K.ex.y*a.x+o.y,a.x>=0&&E>=0){It.SubVV(a,r,u),It.MulSV(u.x,g,l),It.MulSV(u.y,g,h),It.AddVV(l,h,_),S.SelfMulSub(v,_),A-=y*(It.CrossVV(O.rA,l)+It.CrossVV(q.rA,h)),C.SelfMulAdd(p,_),b+=x*(It.CrossVV(O.rB,l)+It.CrossVV(q.rB,h)),O.normalImpulse=a.x,q.normalImpulse=a.y;break}if(a.x=0,a.y=-q.normalMass*o.y,z=c.K.ey.x*a.y+o.x,E=0,a.y>=0&&z>=0){It.SubVV(a,r,u),It.MulSV(u.x,g,l),It.MulSV(u.y,g,h),It.AddVV(l,h,_),S.SelfMulSub(v,_),A-=y*(It.CrossVV(O.rA,l)+It.CrossVV(q.rA,h)),C.SelfMulAdd(p,_),b+=x*(It.CrossVV(O.rB,l)+It.CrossVV(q.rB,h)),O.normalImpulse=a.x,q.normalImpulse=a.y;break}if(a.x=0,a.y=0,z=o.x,E=o.y,z>=0&&E>=0){It.SubVV(a,r,u),It.MulSV(u.x,g,l),It.MulSV(u.y,g,h),It.AddVV(l,h,_),S.SelfMulSub(v,_),A-=y*(It.CrossVV(O.rA,l)+It.CrossVV(q.rA,h)),C.SelfMulAdd(p,_),b+=x*(It.CrossVV(O.rB,l)+It.CrossVV(q.rB,h)),O.normalImpulse=a.x,q.normalImpulse=a.y;break}break}}this.m_velocities[f].w=A,this.m_velocities[d].w=b}}},{key:"StoreImpulses",value:function(){for(var t=0;t<this.m_count;++t)for(var e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold(),n=0;n<e.pointCount;++n)i.points[n].normalImpulse=e.points[n].normalImpulse,i.points[n].tangentImpulse=e.points[n].tangentImpulse}},{key:"SolvePositionConstraints",value:function(){for(var e=t.SolvePositionConstraints_s_xfA,i=t.SolvePositionConstraints_s_xfB,n=t.SolvePositionConstraints_s_psm,s=t.SolvePositionConstraints_s_rA,r=t.SolvePositionConstraints_s_rB,o=t.SolvePositionConstraints_s_P,a=0,u=0;u<this.m_count;++u){for(var l=this.m_positionConstraints[u],h=l.indexA,_=l.indexB,m=l.localCenterA,c=l.invMassA,f=l.invIA,d=l.localCenterB,v=l.invMassB,y=l.invIB,p=l.pointCount,x=this.m_positions[h].c,B=this.m_positions[h].a,S=this.m_positions[_].c,C=this.m_positions[_].a,b=0;b<p;++b){e.q.SetAngle(B),i.q.SetAngle(C),It.SubVV(x,jt.MulRV(e.q,m,It.s_t0),e.p),It.SubVV(S,jt.MulRV(i.q,d,It.s_t0),i.p),n.Initialize(l,e,i,b);var g=n.normal,V=n.point,k=n.separation;It.SubVV(V,x,s),It.SubVV(V,S,r),a=_t(a,k);var M=ct(D*(k+A),-w,0),P=It.CrossVV(s,g),I=It.CrossVV(r,g),G=c+v+f*P*P+y*I*I,F=G>0?-M/G:0;It.MulSV(F,g,o),x.SelfMulSub(c,o),B-=f*It.CrossVV(s,o),S.SelfMulAdd(v,o),C+=y*It.CrossVV(r,o)}this.m_positions[h].a=B,this.m_positions[_].a=C}return a>-3*A}},{key:"SolveTOIPositionConstraints",value:function(e,i){for(var n=t.SolveTOIPositionConstraints_s_xfA,s=t.SolveTOIPositionConstraints_s_xfB,r=t.SolveTOIPositionConstraints_s_psm,o=t.SolveTOIPositionConstraints_s_rA,a=t.SolveTOIPositionConstraints_s_rB,u=t.SolveTOIPositionConstraints_s_P,l=0,h=0;h<this.m_count;++h){var _=this.m_positionConstraints[h],m=_.indexA,c=_.indexB,f=_.localCenterA,d=_.localCenterB,v=_.pointCount,y=0,p=0;m!==e&&m!==i||(y=_.invMassA,p=_.invIA);var x=0,B=0;c!==e&&c!==i||(x=_.invMassB,B=_.invIB);for(var S=this.m_positions[m].c,C=this.m_positions[m].a,b=this.m_positions[c].c,g=this.m_positions[c].a,V=0;V<v;++V){n.q.SetAngle(C),s.q.SetAngle(g),It.SubVV(S,jt.MulRV(n.q,f,It.s_t0),n.p),It.SubVV(b,jt.MulRV(s.q,d,It.s_t0),s.p),r.Initialize(_,n,s,V);var k=r.normal,M=r.point,P=r.separation;It.SubVV(M,S,o),It.SubVV(M,b,a),l=_t(l,P);var I=ct(F*(P+A),-w,0),G=It.CrossVV(o,k),D=It.CrossVV(a,k),L=y+x+p*G*G+B*D*D,R=L>0?-I/L:0;It.MulSV(R,k,u),S.SelfMulSub(y,u),C-=p*It.CrossVV(o,u),b.SelfMulAdd(x,u),g+=B*It.CrossVV(a,u)}this.m_positions[m].a=C,this.m_positions[c].a=g}return l>=-1.5*A}}]),t}();Is.InitializeVelocityConstraints_s_xfA=new Tt,Is.InitializeVelocityConstraints_s_xfB=new Tt,Is.InitializeVelocityConstraints_s_worldManifold=new Ve,Is.WarmStart_s_P=new It,Is.SolveVelocityConstraints_s_dv=new It,Is.SolveVelocityConstraints_s_dv1=new It,Is.SolveVelocityConstraints_s_dv2=new It,Is.SolveVelocityConstraints_s_P=new It,Is.SolveVelocityConstraints_s_a=new It,Is.SolveVelocityConstraints_s_b=new It,Is.SolveVelocityConstraints_s_x=new It,Is.SolveVelocityConstraints_s_d=new It,Is.SolveVelocityConstraints_s_P1=new It,Is.SolveVelocityConstraints_s_P2=new It,Is.SolveVelocityConstraints_s_P1P2=new It,Is.SolvePositionConstraints_s_xfA=new Tt,Is.SolvePositionConstraints_s_xfB=new Tt,Is.SolvePositionConstraints_s_psm=new Ps,Is.SolvePositionConstraints_s_rA=new It,Is.SolvePositionConstraints_s_rB=new It,Is.SolvePositionConstraints_s_P=new It,Is.SolveTOIPositionConstraints_s_xfA=new Tt,Is.SolveTOIPositionConstraints_s_xfB=new Tt,Is.SolveTOIPositionConstraints_s_psm=new Ps,Is.SolveTOIPositionConstraints_s_rA=new It,Is.SolveTOIPositionConstraints_s_rB=new It,Is.SolveTOIPositionConstraints_s_P=new It;var Gs=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.call(this,Sn.e_frictionJoint)).localAnchorA=new It,t.localAnchorB=new It,t.maxForce=0,t.maxTorque=0,t}return Object(r.a)(i,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)}}]),i}(Ln),Ds=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s;return Object(n.a)(this,i),(s=e.call(this,t)).m_localAnchorA=new It,s.m_localAnchorB=new It,s.m_linearImpulse=new It,s.m_angularImpulse=0,s.m_maxForce=0,s.m_maxTorque=0,s.m_indexA=0,s.m_indexB=0,s.m_rA=new It,s.m_rB=new It,s.m_localCenterA=new It,s.m_localCenterB=new It,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_linearMass=new Lt,s.m_angularMass=0,s.m_qA=new jt,s.m_qB=new jt,s.m_lalcA=new It,s.m_lalcB=new It,s.m_K=new Lt,s.m_localAnchorA.Copy(m(t.localAnchorA,It.ZERO)),s.m_localAnchorB.Copy(m(t.localAnchorB,It.ZERO)),s.m_linearImpulse.SetZero(),s.m_maxForce=m(t.maxForce,0),s.m_maxTorque=m(t.maxTorque,0),s.m_linearMass.SetZero(),s}return Object(r.a)(i,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,a=this.m_qA.SetAngle(e),u=this.m_qB.SetAngle(s);It.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=jt.MulRV(a,this.m_lalcA,this.m_rA);It.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var h=jt.MulRV(u,this.m_lalcB,this.m_rB),_=this.m_invMassA,m=this.m_invMassB,c=this.m_invIA,f=this.m_invIB,d=this.m_K;if(d.ex.x=_+m+c*l.y*l.y+f*h.y*h.y,d.ex.y=-c*l.x*l.y-f*h.x*h.y,d.ey.x=d.ex.y,d.ey.y=_+m+c*l.x*l.x+f*h.x*h.x,d.GetInverse(this.m_linearMass),this.m_angularMass=c+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var v=this.m_linearImpulse;i.SelfMulSub(_,v),n-=c*(It.CrossVV(this.m_rA,v)+this.m_angularImpulse),r.SelfMulAdd(m,v),o+=f*(It.CrossVV(this.m_rB,v)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=o}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,u=this.m_invIA,l=this.m_invIB,h=t.step.dt,_=r-n,m=-this.m_angularMass*_,c=this.m_angularImpulse,f=h*this.m_maxTorque;this.m_angularImpulse=ct(this.m_angularImpulse+m,-f,f),n-=u*(m=this.m_angularImpulse-c),r+=l*m;var d=It.SubVV(It.AddVCrossSV(s,r,this.m_rB,It.s_t0),It.AddVCrossSV(e,n,this.m_rA,It.s_t1),i.SolveVelocityConstraints_s_Cdot_v2),v=Lt.MulMV(this.m_linearMass,d,i.SolveVelocityConstraints_s_impulseV).SelfNeg(),y=i.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(v);var p=h*this.m_maxForce;this.m_linearImpulse.LengthSquared()>p*p&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(p)),It.SubVV(this.m_linearImpulse,y,v),e.SelfMulSub(o,v),n-=u*It.CrossVV(this.m_rA,v),s.SelfMulAdd(a,v),r+=l*It.CrossVV(this.m_rB,v),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),i}(Tn);Ds.SolveVelocityConstraints_s_Cdot_v2=new It,Ds.SolveVelocityConstraints_s_impulseV=new It,Ds.SolveVelocityConstraints_s_oldImpulseV=new It;var Fs=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.call(this,Sn.e_gearJoint)).ratio=1,t}return i}(Ln),Ls=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s,r,o;Object(n.a)(this,i),(s=e.call(this,t)).m_typeA=Sn.e_unknownJoint,s.m_typeB=Sn.e_unknownJoint,s.m_localAnchorA=new It,s.m_localAnchorB=new It,s.m_localAnchorC=new It,s.m_localAnchorD=new It,s.m_localAxisC=new It,s.m_localAxisD=new It,s.m_referenceAngleA=0,s.m_referenceAngleB=0,s.m_constant=0,s.m_ratio=0,s.m_impulse=0,s.m_indexA=0,s.m_indexB=0,s.m_indexC=0,s.m_indexD=0,s.m_lcA=new It,s.m_lcB=new It,s.m_lcC=new It,s.m_lcD=new It,s.m_mA=0,s.m_mB=0,s.m_mC=0,s.m_mD=0,s.m_iA=0,s.m_iB=0,s.m_iC=0,s.m_iD=0,s.m_JvAC=new It,s.m_JvBD=new It,s.m_JwA=0,s.m_JwB=0,s.m_JwC=0,s.m_JwD=0,s.m_mass=0,s.m_qA=new jt,s.m_qB=new jt,s.m_qC=new jt,s.m_qD=new jt,s.m_lalcA=new It,s.m_lalcB=new It,s.m_lalcC=new It,s.m_lalcD=new It,s.m_joint1=t.joint1,s.m_joint2=t.joint2,s.m_typeA=s.m_joint1.GetType(),s.m_typeB=s.m_joint2.GetType(),s.m_bodyC=s.m_joint1.GetBodyA(),s.m_bodyA=s.m_joint1.GetBodyB();var a=s.m_bodyA.m_xf,u=s.m_bodyA.m_sweep.a,l=s.m_bodyC.m_xf,h=s.m_bodyC.m_sweep.a;if(s.m_typeA===Sn.e_revoluteJoint){var _=t.joint1;s.m_localAnchorC.Copy(_.m_localAnchorA),s.m_localAnchorA.Copy(_.m_localAnchorB),s.m_referenceAngleA=_.m_referenceAngle,s.m_localAxisC.SetZero(),r=u-h-s.m_referenceAngleA}else{var c=t.joint1;s.m_localAnchorC.Copy(c.m_localAnchorA),s.m_localAnchorA.Copy(c.m_localAnchorB),s.m_referenceAngleA=c.m_referenceAngle,s.m_localAxisC.Copy(c.m_localXAxisA);var f=s.m_localAnchorC,d=jt.MulTRV(l.q,It.AddVV(jt.MulRV(a.q,s.m_localAnchorA,It.s_t0),It.SubVV(a.p,l.p,It.s_t1),It.s_t0),It.s_t0);r=It.DotVV(It.SubVV(d,f,It.s_t0),s.m_localAxisC)}s.m_bodyD=s.m_joint2.GetBodyA(),s.m_bodyB=s.m_joint2.GetBodyB();var v=s.m_bodyB.m_xf,y=s.m_bodyB.m_sweep.a,p=s.m_bodyD.m_xf,x=s.m_bodyD.m_sweep.a;if(s.m_typeB===Sn.e_revoluteJoint){var B=t.joint2;s.m_localAnchorD.Copy(B.m_localAnchorA),s.m_localAnchorB.Copy(B.m_localAnchorB),s.m_referenceAngleB=B.m_referenceAngle,s.m_localAxisD.SetZero(),o=y-x-s.m_referenceAngleB}else{var S=t.joint2;s.m_localAnchorD.Copy(S.m_localAnchorA),s.m_localAnchorB.Copy(S.m_localAnchorB),s.m_referenceAngleB=S.m_referenceAngle,s.m_localAxisD.Copy(S.m_localXAxisA);var A=s.m_localAnchorD,C=jt.MulTRV(p.q,It.AddVV(jt.MulRV(v.q,s.m_localAnchorB,It.s_t0),It.SubVV(v.p,p.p,It.s_t1),It.s_t0),It.s_t0);o=It.DotVV(It.SubVV(C,A,It.s_t0),s.m_localAxisD)}return s.m_ratio=m(t.ratio,1),s.m_constant=r+s.m_ratio*o,s.m_impulse=0,s}return Object(r.a)(i,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,u=t.positions[this.m_indexC].a,l=t.velocities[this.m_indexC].v,h=t.velocities[this.m_indexC].w,_=t.positions[this.m_indexD].a,m=t.velocities[this.m_indexD].v,c=t.velocities[this.m_indexD].w,f=this.m_qA.SetAngle(e),d=this.m_qB.SetAngle(r),v=this.m_qC.SetAngle(u),y=this.m_qD.SetAngle(_);if(this.m_mass=0,this.m_typeA===Sn.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var p=jt.MulRV(v,this.m_localAxisC,i.InitVelocityConstraints_s_u);It.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var x=jt.MulRV(v,this.m_lalcC,i.InitVelocityConstraints_s_rC);It.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var B=jt.MulRV(f,this.m_lalcA,i.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(p),this.m_JwC=It.CrossVV(x,p),this.m_JwA=It.CrossVV(B,p),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===Sn.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var S=jt.MulRV(y,this.m_localAxisD,i.InitVelocityConstraints_s_u);It.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var A=jt.MulRV(y,this.m_lalcD,i.InitVelocityConstraints_s_rD);It.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var C=jt.MulRV(d,this.m_lalcB,i.InitVelocityConstraints_s_rB);It.MulSV(this.m_ratio,S,this.m_JvBD),this.m_JwD=this.m_ratio*It.CrossVV(A,S),this.m_JwB=this.m_ratio*It.CrossVV(C,S),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.step.warmStarting?(n.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),s+=this.m_iA*this.m_impulse*this.m_JwA,o.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),a+=this.m_iB*this.m_impulse*this.m_JwB,l.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),h-=this.m_iC*this.m_impulse*this.m_JwC,m.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),c-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a,t.velocities[this.m_indexC].w=h,t.velocities[this.m_indexD].w=c}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,r=t.velocities[this.m_indexC].v,o=t.velocities[this.m_indexC].w,a=t.velocities[this.m_indexD].v,u=t.velocities[this.m_indexD].w,l=It.DotVV(this.m_JvAC,It.SubVV(e,r,It.s_t0))+It.DotVV(this.m_JvBD,It.SubVV(n,a,It.s_t0));l+=this.m_JwA*i-this.m_JwC*o+(this.m_JwB*s-this.m_JwD*u);var h=-this.m_mass*l;this.m_impulse+=h,e.SelfMulAdd(this.m_mA*h,this.m_JvAC),i+=this.m_iA*h*this.m_JwA,n.SelfMulAdd(this.m_mB*h,this.m_JvBD),s+=this.m_iB*h*this.m_JwB,r.SelfMulSub(this.m_mC*h,this.m_JvAC),o-=this.m_iC*h*this.m_JwC,a.SelfMulSub(this.m_mD*h,this.m_JvBD),u-=this.m_iD*h*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s,t.velocities[this.m_indexC].w=o,t.velocities[this.m_indexD].w=u}},{key:"SolvePositionConstraints",value:function(t){var e,n,s,r,o,a,u=t.positions[this.m_indexA].c,l=t.positions[this.m_indexA].a,h=t.positions[this.m_indexB].c,_=t.positions[this.m_indexB].a,m=t.positions[this.m_indexC].c,c=t.positions[this.m_indexC].a,f=t.positions[this.m_indexD].c,d=t.positions[this.m_indexD].a,v=this.m_qA.SetAngle(l),y=this.m_qB.SetAngle(_),p=this.m_qC.SetAngle(c),x=this.m_qD.SetAngle(d),B=this.m_JvAC,S=this.m_JvBD,C=0;if(this.m_typeA===Sn.e_revoluteJoint)B.SetZero(),s=1,o=1,C+=this.m_iA+this.m_iC,e=l-c-this.m_referenceAngleA;else{var b=jt.MulRV(p,this.m_localAxisC,i.SolvePositionConstraints_s_u),g=jt.MulRV(p,this.m_lalcC,i.SolvePositionConstraints_s_rC),V=jt.MulRV(v,this.m_lalcA,i.SolvePositionConstraints_s_rA);B.Copy(b),o=It.CrossVV(g,b),s=It.CrossVV(V,b),C+=this.m_mC+this.m_mA+this.m_iC*o*o+this.m_iA*s*s;var w=this.m_lalcC,k=jt.MulTRV(p,It.AddVV(V,It.SubVV(u,m,It.s_t0),It.s_t0),It.s_t0);e=It.DotVV(It.SubVV(k,w,It.s_t0),this.m_localAxisC)}if(this.m_typeB===Sn.e_revoluteJoint)S.SetZero(),r=this.m_ratio,a=this.m_ratio,C+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),n=_-d-this.m_referenceAngleB;else{var M=jt.MulRV(x,this.m_localAxisD,i.SolvePositionConstraints_s_u),P=jt.MulRV(x,this.m_lalcD,i.SolvePositionConstraints_s_rD),I=jt.MulRV(y,this.m_lalcB,i.SolvePositionConstraints_s_rB);It.MulSV(this.m_ratio,M,S),a=this.m_ratio*It.CrossVV(P,M),r=this.m_ratio*It.CrossVV(I,M),C+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*a*a+this.m_iB*r*r;var G=this.m_lalcD,D=jt.MulTRV(x,It.AddVV(I,It.SubVV(h,f,It.s_t0),It.s_t0),It.s_t0);n=It.DotVV(It.SubVV(D,G,It.s_t0),this.m_localAxisD)}var F=e+this.m_ratio*n-this.m_constant,L=0;return C>0&&(L=-F/C),u.SelfMulAdd(this.m_mA*L,B),l+=this.m_iA*L*s,h.SelfMulAdd(this.m_mB*L,S),_+=this.m_iB*L*r,m.SelfMulSub(this.m_mC*L,B),c-=this.m_iC*L*o,f.SelfMulSub(this.m_mD*L,S),d-=this.m_iD*L*a,t.positions[this.m_indexA].a=l,t.positions[this.m_indexB].a=_,t.positions[this.m_indexC].a=c,t.positions[this.m_indexD].a=d,0<A}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return It.MulSV(t*this.m_impulse,this.m_JvAC,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse*this.m_JwA}},{key:"GetJoint1",value:function(){return this.m_joint1}},{key:"GetJoint2",value:function(){return this.m_joint2}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"SetRatio",value:function(t){this.m_ratio=t}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex,n=this.m_joint1.m_index,s=this.m_joint2.m_index;t("  const jd: b2GearJointDef = new b2GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",n),t("  jd.joint2 = joints[%d];\n",s),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),i}(Tn);Ls.InitVelocityConstraints_s_u=new It,Ls.InitVelocityConstraints_s_rA=new It,Ls.InitVelocityConstraints_s_rB=new It,Ls.InitVelocityConstraints_s_rC=new It,Ls.InitVelocityConstraints_s_rD=new It,Ls.SolvePositionConstraints_s_u=new It,Ls.SolvePositionConstraints_s_rA=new It,Ls.SolvePositionConstraints_s_rB=new It,Ls.SolvePositionConstraints_s_rC=new It,Ls.SolvePositionConstraints_s_rD=new It;var Rs=function(){function t(){Object(n.a)(this,t),this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=Bs.MakeArray(1024),this.m_velocities=Ss.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}return Object(r.a)(t,[{key:"Initialize",value:function(t,e,i,n){if(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_listener=n,this.m_positions.length<t)for(var s=mt(2*this.m_positions.length,t);this.m_positions.length<s;)this.m_positions[this.m_positions.length]=new Bs;if(this.m_velocities.length<t)for(var r=mt(2*this.m_velocities.length,t);this.m_velocities.length<r;)this.m_velocities[this.m_velocities.length]=new Ss}},{key:"Clear",value:function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}},{key:"AddBody",value:function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t}},{key:"AddContact",value:function(t){this.m_contacts[this.m_contactCount++]=t}},{key:"AddJoint",value:function(t){this.m_joints[this.m_jointCount++]=t}},{key:"Solve",value:function(e,i,n,s){for(var r=t.s_timer.Reset(),o=i.dt,a=0;a<this.m_bodyCount;++a){var u=this.m_bodies[a];this.m_positions[a].c.Copy(u.m_sweep.c);var l=u.m_sweep.a,h=this.m_velocities[a].v.Copy(u.m_linearVelocity),_=u.m_angularVelocity;u.m_sweep.c0.Copy(u.m_sweep.c),u.m_sweep.a0=u.m_sweep.a,u.m_type===Un.b2_dynamicBody&&(h.x+=o*u.m_invMass*(u.m_gravityScale*u.m_mass*n.x+u.m_force.x),h.y+=o*u.m_invMass*(u.m_gravityScale*u.m_mass*n.y+u.m_force.y),_+=o*u.m_invI*u.m_torque,h.SelfMul(1/(1+o*u.m_linearDamping)),_*=1/(1+o*u.m_angularDamping)),this.m_positions[a].a=l,this.m_velocities[a].w=_}r.Reset();var m=t.s_solverData;m.step.Copy(i),m.positions=this.m_positions,m.velocities=this.m_velocities;var f=t.s_contactSolverDef;f.step.Copy(i),f.contacts=this.m_contacts,f.count=this.m_contactCount,f.positions=this.m_positions,f.velocities=this.m_velocities;var d=t.s_contactSolver.Initialize(f);d.InitializeVelocityConstraints(),i.warmStarting&&d.WarmStart();for(var v=0;v<this.m_jointCount;++v)this.m_joints[v].InitVelocityConstraints(m);e.solveInit=r.GetMilliseconds(),r.Reset();for(var y=0;y<i.velocityIterations;++y){for(var p=0;p<this.m_jointCount;++p)this.m_joints[p].SolveVelocityConstraints(m);d.SolveVelocityConstraints()}d.StoreImpulses(),e.solveVelocity=r.GetMilliseconds();for(var x=0;x<this.m_bodyCount;++x){var B=this.m_positions[x].c,S=this.m_positions[x].a,A=this.m_velocities[x].v,C=this.m_velocities[x].w,b=It.MulSV(o,A,t.s_translation);if(It.DotVV(b,b)>P){var g=M/b.Length();A.SelfMul(g)}var V=o*C;if(V*V>G)C*=I/ht(V);B.x+=o*A.x,B.y+=o*A.y,S+=o*C,this.m_positions[x].a=S,this.m_velocities[x].w=C}r.Reset();for(var w=!1,k=0;k<i.positionIterations;++k){for(var D=d.SolvePositionConstraints(),F=!0,L=0;L<this.m_jointCount;++L){var R=this.m_joints[L].SolvePositionConstraints(m);F=F&&R}if(D&&F){w=!0;break}}for(var j=0;j<this.m_bodyCount;++j){var T=this.m_bodies[j];T.m_sweep.c.Copy(this.m_positions[j].c),T.m_sweep.a=this.m_positions[j].a,T.m_linearVelocity.Copy(this.m_velocities[j].v),T.m_angularVelocity=this.m_velocities[j].w,T.SynchronizeTransform()}if(e.solvePosition=r.GetMilliseconds(),this.Report(d.m_velocityConstraints),s){for(var O=c,q=Z*Z,z=U*U,E=0;E<this.m_bodyCount;++E){var N=this.m_bodies[E];N.GetType()!==Un.b2_staticBody&&(!N.m_autoSleepFlag||N.m_angularVelocity*N.m_angularVelocity>z||It.DotVV(N.m_linearVelocity,N.m_linearVelocity)>q?(N.m_sleepTime=0,O=0):(N.m_sleepTime+=o,O=_t(O,N.m_sleepTime)))}if(O>=X&&w)for(var J=0;J<this.m_bodyCount;++J){this.m_bodies[J].SetAwake(!1)}}}},{key:"SolveTOI",value:function(e,i,n){for(var s=0;s<this.m_bodyCount;++s){var r=this.m_bodies[s];this.m_positions[s].c.Copy(r.m_sweep.c),this.m_positions[s].a=r.m_sweep.a,this.m_velocities[s].v.Copy(r.m_linearVelocity),this.m_velocities[s].w=r.m_angularVelocity}var o=t.s_contactSolverDef;o.contacts=this.m_contacts,o.count=this.m_contactCount,o.step.Copy(e),o.positions=this.m_positions,o.velocities=this.m_velocities;for(var a=t.s_contactSolver.Initialize(o),u=0;u<e.positionIterations;++u){if(a.SolveTOIPositionConstraints(i,n))break}this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,this.m_bodies[n].m_sweep.c0.Copy(this.m_positions[n].c),this.m_bodies[n].m_sweep.a0=this.m_positions[n].a,a.InitializeVelocityConstraints();for(var l=0;l<e.velocityIterations;++l)a.SolveVelocityConstraints();for(var h=e.dt,_=0;_<this.m_bodyCount;++_){var m=this.m_positions[_].c,c=this.m_positions[_].a,f=this.m_velocities[_].v,d=this.m_velocities[_].w,v=It.MulSV(h,f,t.s_translation);if(It.DotVV(v,v)>P){var y=M/v.Length();f.SelfMul(y)}var p=h*d;if(p*p>G)d*=I/ht(p);m.SelfMulAdd(h,f),c+=h*d,this.m_positions[_].a=c,this.m_velocities[_].w=d;var x=this.m_bodies[_];x.m_sweep.c.Copy(m),x.m_sweep.a=c,x.m_linearVelocity.Copy(f),x.m_angularVelocity=d,x.SynchronizeTransform()}this.Report(a.m_velocityConstraints)}},{key:"Report",value:function(e){if(null!==this.m_listener)for(var i=0;i<this.m_contactCount;++i){var n=this.m_contacts[i];if(n){var s=e[i],r=t.s_impulse;r.count=s.pointCount;for(var o=0;o<s.pointCount;++o)r.normalImpulses[o]=s.points[o].normalImpulse,r.tangentImpulses[o]=s.points[o].tangentImpulse;this.m_listener.PostSolve(n,r)}}}}]),t}();Rs.s_timer=new zt,Rs.s_solverData=new As,Rs.s_contactSolverDef=new Ms,Rs.s_contactSolver=new Is,Rs.s_translation=new It,Rs.s_impulse=new cs;var js=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.call(this,Sn.e_motorJoint)).linearOffset=new It(0,0),t.angularOffset=0,t.maxForce=1,t.maxTorque=1,t.correctionFactor=.3,t}return Object(r.a)(i,[{key:"Initialize",value:function(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var i=this.bodyA.GetAngle(),n=this.bodyB.GetAngle();this.angularOffset=n-i}}]),i}(Ln),Ts=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s;return Object(n.a)(this,i),(s=e.call(this,t)).m_linearOffset=new It,s.m_angularOffset=0,s.m_linearImpulse=new It,s.m_angularImpulse=0,s.m_maxForce=0,s.m_maxTorque=0,s.m_correctionFactor=.3,s.m_indexA=0,s.m_indexB=0,s.m_rA=new It,s.m_rB=new It,s.m_localCenterA=new It,s.m_localCenterB=new It,s.m_linearError=new It,s.m_angularError=0,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_linearMass=new Lt,s.m_angularMass=0,s.m_qA=new jt,s.m_qB=new jt,s.m_K=new Lt,s.m_linearOffset.Copy(m(t.linearOffset,It.ZERO)),s.m_linearImpulse.SetZero(),s.m_maxForce=m(t.maxForce,0),s.m_maxTorque=m(t.maxTorque,0),s.m_correctionFactor=m(t.correctionFactor,.3),s}return Object(r.a)(i,[{key:"GetAnchorA",value:function(t){var e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t}},{key:"GetAnchorB",value:function(t){var e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t}},{key:"GetReactionForce",value:function(t,e){return It.MulSV(t,this.m_linearImpulse,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"SetLinearOffset",value:function(t){It.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))}},{key:"GetLinearOffset",value:function(){return this.m_linearOffset}},{key:"SetAngularOffset",value:function(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)}},{key:"GetAngularOffset",value:function(){return this.m_angularOffset}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(o),_=jt.MulRV(l,It.SubVV(this.m_linearOffset,this.m_localCenterA,It.s_t0),this.m_rA),m=jt.MulRV(h,It.NegV(this.m_localCenterB,It.s_t0),this.m_rB),c=this.m_invMassA,f=this.m_invMassB,d=this.m_invIA,v=this.m_invIB,y=this.m_K;if(y.ex.x=c+f+d*_.y*_.y+v*m.y*m.y,y.ex.y=-d*_.x*_.y-v*m.x*m.y,y.ey.x=y.ex.y,y.ey.y=c+f+d*_.x*_.x+v*m.x*m.x,y.GetInverse(this.m_linearMass),this.m_angularMass=d+v,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),It.SubVV(It.AddVV(r,m,It.s_t0),It.AddVV(e,_,It.s_t1),this.m_linearError),this.m_angularError=o-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var p=this.m_linearImpulse;n.SelfMulSub(c,p),s-=d*(It.CrossVV(_,p)+this.m_angularImpulse),a.SelfMulAdd(f,p),u+=v*(It.CrossVV(m,p)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,u=this.m_invIA,l=this.m_invIB,h=t.step.dt,_=t.step.inv_dt,m=r-n+_*this.m_correctionFactor*this.m_angularError,c=-this.m_angularMass*m,f=this.m_angularImpulse,d=h*this.m_maxTorque;this.m_angularImpulse=ct(this.m_angularImpulse+c,-d,d),n-=u*(c=this.m_angularImpulse-f),r+=l*c;var v=this.m_rA,y=this.m_rB,p=It.AddVV(It.SubVV(It.AddVV(s,It.CrossSV(r,y,It.s_t0),It.s_t0),It.AddVV(e,It.CrossSV(n,v,It.s_t1),It.s_t1),It.s_t2),It.MulSV(_*this.m_correctionFactor,this.m_linearError,It.s_t3),i.SolveVelocityConstraints_s_Cdot_v2),x=Lt.MulMV(this.m_linearMass,p,i.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),B=i.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(x);var S=h*this.m_maxForce;this.m_linearImpulse.LengthSquared()>S*S&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(S)),It.SubVV(this.m_linearImpulse,B,x),e.SelfMulSub(o,x),n-=u*It.CrossVV(v,x),s.SelfMulAdd(a,x),r+=l*It.CrossVV(y,x),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),i}(Tn);Ts.SolveVelocityConstraints_s_Cdot_v2=new It,Ts.SolveVelocityConstraints_s_impulse_v2=new It,Ts.SolveVelocityConstraints_s_oldImpulse_v2=new It;var Os=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.call(this,Sn.e_mouseJoint)).target=new It,t.maxForce=0,t.stiffness=5,t.damping=.7,t}return i}(Ln),qs=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s;return Object(n.a)(this,i),(s=e.call(this,t)).m_localAnchorB=new It,s.m_targetA=new It,s.m_stiffness=0,s.m_damping=0,s.m_beta=0,s.m_impulse=new It,s.m_maxForce=0,s.m_gamma=0,s.m_indexA=0,s.m_indexB=0,s.m_rB=new It,s.m_localCenterB=new It,s.m_invMassB=0,s.m_invIB=0,s.m_mass=new Lt,s.m_C=new It,s.m_qB=new jt,s.m_lalcB=new It,s.m_K=new Lt,s.m_targetA.Copy(m(t.target,It.ZERO)),Tt.MulTXV(s.m_bodyB.GetTransform(),s.m_targetA,s.m_localAnchorB),s.m_maxForce=m(t.maxForce,0),s.m_impulse.SetZero(),s.m_stiffness=m(t.stiffness,0),s.m_damping=m(t.damping,0),s.m_beta=0,s.m_gamma=0,s}return Object(r.a)(i,[{key:"SetTarget",value:function(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)}},{key:"GetTarget",value:function(){return this.m_targetA}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetStiffness",value:function(t){this.m_stiffness=t}},{key:"GetStiffness",value:function(){return this.m_stiffness}},{key:"SetDamping",value:function(t){this.m_damping=t}},{key:"GetDamping",value:function(){return this.m_damping}},{key:"InitVelocityConstraints",value:function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,r=this.m_qB.SetAngle(i),o=this.m_bodyB.GetMass(),a=2*v*this.m_stiffness,u=2*o*this.m_damping*a,l=o*(a*a),h=t.step.dt;this.m_gamma=h*(u+h*l),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=h*l*this.m_gamma,It.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),jt.MulRV(r,this.m_lalcB,this.m_rB);var _=this.m_K;_.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,_.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,_.ey.x=_.ex.y,_.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,_.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),s*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),n.x+=this.m_invMassB*this.m_impulse.x,n.y+=this.m_invMassB*this.m_impulse.y,s+=this.m_invIB*It.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=s}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,s=It.AddVCrossSV(e,n,this.m_rB,i.SolveVelocityConstraints_s_Cdot),r=Lt.MulMV(this.m_mass,It.AddVV(s,It.AddVV(this.m_C,It.MulSV(this.m_gamma,this.m_impulse,It.s_t0),It.s_t0),It.s_t0).SelfNeg(),i.SolveVelocityConstraints_s_impulse),o=i.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(r);var a=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.SelfMul(a/this.m_impulse.Length()),It.SubVV(this.m_impulse,o,r),e.SelfMulAdd(this.m_invMassB,r),n+=this.m_invIB*It.CrossVV(this.m_rB,r),t.velocities[this.m_indexB].w=n}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return It.MulSV(t,this.m_impulse,e)}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"Dump",value:function(t){t("Mouse joint dumping is not supported.\n")}},{key:"ShiftOrigin",value:function(t){this.m_targetA.SelfSub(t)}}]),i}(Tn);qs.SolveVelocityConstraints_s_Cdot=new It,qs.SolveVelocityConstraints_s_impulse=new It,qs.SolveVelocityConstraints_s_oldImpulse=new It;var zs=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.call(this,Sn.e_prismaticJoint)).localAnchorA=new It,t.localAnchorB=new It,t.localAxisA=new It(1,0),t.referenceAngle=0,t.enableLimit=!1,t.lowerTranslation=0,t.upperTranslation=0,t.enableMotor=!1,t.maxMotorForce=0,t.motorSpeed=0,t}return Object(r.a)(i,[{key:"Initialize",value:function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(n,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),i}(Ln),Es=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s;return Object(n.a)(this,i),(s=e.call(this,t)).m_localAnchorA=new It,s.m_localAnchorB=new It,s.m_localXAxisA=new It,s.m_localYAxisA=new It,s.m_referenceAngle=0,s.m_impulse=new It(0,0),s.m_motorImpulse=0,s.m_lowerImpulse=0,s.m_upperImpulse=0,s.m_lowerTranslation=0,s.m_upperTranslation=0,s.m_maxMotorForce=0,s.m_motorSpeed=0,s.m_enableLimit=!1,s.m_enableMotor=!1,s.m_indexA=0,s.m_indexB=0,s.m_localCenterA=new It,s.m_localCenterB=new It,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_axis=new It(0,0),s.m_perp=new It(0,0),s.m_s1=0,s.m_s2=0,s.m_a1=0,s.m_a2=0,s.m_K=new Lt,s.m_K3=new Rt,s.m_K2=new Lt,s.m_translation=0,s.m_axialMass=0,s.m_qA=new jt,s.m_qB=new jt,s.m_lalcA=new It,s.m_lalcB=new It,s.m_rA=new It,s.m_rB=new It,s.m_localAnchorA.Copy(m(t.localAnchorA,It.ZERO)),s.m_localAnchorB.Copy(m(t.localAnchorB,It.ZERO)),s.m_localXAxisA.Copy(m(t.localAxisA,new It(1,0))).SelfNormalize(),It.CrossOneV(s.m_localXAxisA,s.m_localYAxisA),s.m_referenceAngle=m(t.referenceAngle,0),s.m_lowerTranslation=m(t.lowerTranslation,0),s.m_upperTranslation=m(t.upperTranslation,0),s.m_maxMotorForce=m(t.maxMotorForce,0),s.m_motorSpeed=m(t.motorSpeed,0),s.m_enableLimit=m(t.enableLimit,!1),s.m_enableMotor=m(t.enableMotor,!1),s}return Object(r.a)(i,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(n),_=this.m_qB.SetAngle(a);It.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var m=jt.MulRV(h,this.m_lalcA,this.m_rA);It.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var c=jt.MulRV(_,this.m_lalcB,this.m_rB),f=It.AddVV(It.SubVV(o,e,It.s_t0),It.SubVV(c,m,It.s_t1),i.InitVelocityConstraints_s_d),d=this.m_invMassA,v=this.m_invMassB,y=this.m_invIA,p=this.m_invIB;if(jt.MulRV(h,this.m_localXAxisA,this.m_axis),this.m_a1=It.CrossVV(It.AddVV(f,m,It.s_t0),this.m_axis),this.m_a2=It.CrossVV(c,this.m_axis),this.m_axialMass=d+v+y*this.m_a1*this.m_a1+p*this.m_a2*this.m_a2,this.m_axialMass>0&&(this.m_axialMass=1/this.m_axialMass),jt.MulRV(h,this.m_localYAxisA,this.m_perp),this.m_s1=It.CrossVV(It.AddVV(f,m,It.s_t0),this.m_perp),this.m_s2=It.CrossVV(c,this.m_perp),this.m_K.ex.x=d+v+y*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2,this.m_K.ex.y=y*this.m_s1+p*this.m_s2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=y+p,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_enableLimit?this.m_translation=It.DotVV(this.m_axis,f):(this.m_lowerImpulse=0,this.m_upperImpulse=0),this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,this.m_lowerImpulse*=t.step.dtRatio,this.m_upperImpulse*=t.step.dtRatio;var x=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,B=It.AddVV(It.MulSV(this.m_impulse.x,this.m_perp,It.s_t0),It.MulSV(x,this.m_axis,It.s_t1),i.InitVelocityConstraints_s_P),S=this.m_impulse.x*this.m_s1+this.m_impulse.y+x*this.m_a1,A=this.m_impulse.x*this.m_s2+this.m_impulse.y+x*this.m_a2;s.SelfMulSub(d,B),r-=y*S,u.SelfMulAdd(v,B),l+=p*A}else this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=l}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,u=this.m_invIA,l=this.m_invIB;if(this.m_enableMotor){var h=It.DotVV(this.m_axis,It.SubVV(s,e,It.s_t0))+this.m_a2*r-this.m_a1*n,_=this.m_axialMass*(this.m_motorSpeed-h),m=this.m_motorImpulse,c=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=ct(this.m_motorImpulse+_,-c,c),_=this.m_motorImpulse-m;var f=It.MulSV(_,this.m_axis,i.SolveVelocityConstraints_s_P),d=_*this.m_a1,v=_*this.m_a2;e.SelfMulSub(o,f),n-=u*d,s.SelfMulAdd(a,f),r+=l*v}if(this.m_enableLimit){var y=this.m_translation-this.m_lowerTranslation,p=It.DotVV(this.m_axis,It.SubVV(s,e,It.s_t0))+this.m_a2*r-this.m_a1*n,x=-this.m_axialMass*(p+mt(y,0)*t.step.inv_dt),B=this.m_lowerImpulse;this.m_lowerImpulse=mt(this.m_lowerImpulse+x,0),x=this.m_lowerImpulse-B;var S=It.MulSV(x,this.m_axis,i.SolveVelocityConstraints_s_P),A=x*this.m_a1,C=x*this.m_a2;e.SelfMulSub(o,S),n-=u*A,s.SelfMulAdd(a,S),r+=l*C;var b=this.m_upperTranslation-this.m_translation,g=It.DotVV(this.m_axis,It.SubVV(e,s,It.s_t0))+this.m_a1*n-this.m_a2*r,V=-this.m_axialMass*(g+mt(b,0)*t.step.inv_dt),w=this.m_upperImpulse;this.m_upperImpulse=mt(this.m_upperImpulse+V,0),V=this.m_upperImpulse-w;var k=It.MulSV(V,this.m_axis,i.SolveVelocityConstraints_s_P),M=V*this.m_a1,P=V*this.m_a2;e.SelfMulAdd(o,k),n+=u*M,s.SelfMulSub(a,k),r-=l*P}var I=It.DotVV(this.m_perp,It.SubVV(s,e,It.s_t0))+this.m_s2*r-this.m_s1*n,G=r-n,D=this.m_K.Solve(-I,-G,i.SolveVelocityConstraints_s_df);this.m_impulse.SelfAdd(D);var F=It.MulSV(D.x,this.m_perp,i.SolveVelocityConstraints_s_P),L=D.x*this.m_s1+D.y,R=D.x*this.m_s2+D.y;e.SelfMulSub(o,F),n-=u*L,s.SelfMulAdd(a,F),r+=l*R,t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,s=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(n),a=this.m_qB.SetAngle(r),u=this.m_invMassA,l=this.m_invMassB,h=this.m_invIA,_=this.m_invIB,m=jt.MulRV(o,this.m_lalcA,this.m_rA),c=jt.MulRV(a,this.m_lalcB,this.m_rB),f=It.SubVV(It.AddVV(s,c,It.s_t0),It.AddVV(e,m,It.s_t1),i.SolvePositionConstraints_s_d),d=jt.MulRV(o,this.m_localXAxisA,this.m_axis),v=It.CrossVV(It.AddVV(f,m,It.s_t0),d),y=It.CrossVV(c,d),p=jt.MulRV(o,this.m_localYAxisA,this.m_perp),x=It.CrossVV(It.AddVV(f,m,It.s_t0),p),B=It.CrossVV(c,p),S=i.SolvePositionConstraints_s_impulse,b=It.DotVV(p,f),g=r-n-this.m_referenceAngle,V=ht(b),w=ht(g),k=!1,M=0;if(this.m_enableLimit){var P=It.DotVV(d,f);ht(this.m_upperTranslation-this.m_lowerTranslation)<2*A?(M=P,V=mt(V,ht(P)),k=!0):P<=this.m_lowerTranslation?(M=_t(P-this.m_lowerTranslation,0),V=mt(V,this.m_lowerTranslation-P),k=!0):P>=this.m_upperTranslation&&(M=mt(P-this.m_upperTranslation,0),V=mt(V,P-this.m_upperTranslation),k=!0)}if(k){var I=u+l+h*x*x+_*B*B,G=h*x+_*B,D=h*x*v+_*B*y,F=h+_;0===F&&(F=1);var L=h*v+_*y,R=u+l+h*v*v+_*y*y,j=this.m_K3;j.ex.SetXYZ(I,G,D),j.ey.SetXYZ(G,F,L),j.ez.SetXYZ(D,L,R),S=j.Solve33(-b,-g,-M,S)}else{var T=u+l+h*x*x+_*B*B,O=h*x+_*B,q=h+_;0===q&&(q=1);var z=this.m_K2;z.ex.Set(T,O),z.ey.Set(O,q);var E=z.Solve(-b,-g,i.SolvePositionConstraints_s_impulse1);S.x=E.x,S.y=E.y,S.z=0}var N=It.AddVV(It.MulSV(S.x,p,It.s_t0),It.MulSV(S.z,d,It.s_t1),i.SolvePositionConstraints_s_P),J=S.x*x+S.y+S.z*v,X=S.x*B+S.y+S.z*y;return e.SelfMulSub(u,N),n-=h*J,s.SelfMulAdd(l,N),r+=_*X,t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=r,V<=A&&w<=C}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_axis.x),e.y=t*(this.m_impulse.y*this.m_perp.y+(this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_axis.y),e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.y}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointTranslation",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,i.GetJointTranslation_s_pA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,i.GetJointTranslation_s_pB),n=It.SubVV(e,t,i.GetJointTranslation_s_d),s=this.m_bodyA.GetWorldVector(this.m_localXAxisA,i.GetJointTranslation_s_axis);return It.DotVV(n,s)}},{key:"GetJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;It.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=jt.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);It.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var n=jt.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),s=It.AddVV(t.m_sweep.c,i,It.s_t0),r=It.AddVV(e.m_sweep.c,n,It.s_t1),o=It.SubVV(r,s,It.s_t2),a=t.GetWorldVector(this.m_localXAxisA,this.m_axis),u=t.m_linearVelocity,l=e.m_linearVelocity,h=t.m_angularVelocity,_=e.m_angularVelocity;return It.DotVV(o,It.CrossSV(h,a,It.s_t0))+It.DotVV(a,It.SubVV(It.AddVCrossSV(l,_,n,It.s_t0),It.AddVCrossSV(u,h,i,It.s_t1),It.s_t0))}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_lowerImpulse=0,this.m_upperImpulse=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerTranslation}},{key:"GetUpperLimit",value:function(){return this.m_upperTranslation}},{key:"SetLimits",value:function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_lowerImpulse=0,this.m_upperImpulse=0)}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorForce",value:function(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)}},{key:"GetMaxMotorForce",value:function(){return this.m_maxMotorForce}},{key:"GetMotorForce",value:function(t){return t*this.m_motorImpulse}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"Draw",value:function(t){var e=this.m_bodyA.GetTransform(),n=this.m_bodyB.GetTransform(),s=Tt.MulXV(e,this.m_localAnchorA,i.Draw_s_pA),r=Tt.MulXV(n,this.m_localAnchorB,i.Draw_s_pB),o=jt.MulRV(e.q,this.m_localXAxisA,i.Draw_s_axis),a=i.Draw_s_c1,u=i.Draw_s_c2,l=i.Draw_s_c3,h=i.Draw_s_c4,_=i.Draw_s_c5;if(t.DrawSegment(s,r,_),this.m_enableLimit){var m=It.AddVMulSV(s,this.m_lowerTranslation,o,i.Draw_s_lower),c=It.AddVMulSV(s,this.m_upperTranslation,o,i.Draw_s_upper),f=jt.MulRV(e.q,this.m_localYAxisA,i.Draw_s_perp);t.DrawSegment(m,c,a),t.DrawSegment(It.AddVMulSV(m,-.5,f,It.s_t0),It.AddVMulSV(m,.5,f,It.s_t1),u),t.DrawSegment(It.AddVMulSV(c,-.5,f,It.s_t0),It.AddVMulSV(c,.5,f,It.s_t1),l)}else t.DrawSegment(It.AddVMulSV(s,-1,o,It.s_t0),It.AddVMulSV(s,1,o,It.s_t1),a);t.DrawPoint(s,5,a),t.DrawPoint(r,5,h)}}]),i}(Tn);Es.InitVelocityConstraints_s_d=new It,Es.InitVelocityConstraints_s_P=new It,Es.SolveVelocityConstraints_s_P=new It,Es.SolveVelocityConstraints_s_df=new It,Es.SolvePositionConstraints_s_d=new It,Es.SolvePositionConstraints_s_impulse=new Ft,Es.SolvePositionConstraints_s_impulse1=new It,Es.SolvePositionConstraints_s_P=new It,Es.GetJointTranslation_s_pA=new It,Es.GetJointTranslation_s_pB=new It,Es.GetJointTranslation_s_d=new It,Es.GetJointTranslation_s_axis=new It,Es.Draw_s_pA=new It,Es.Draw_s_pB=new It,Es.Draw_s_axis=new It,Es.Draw_s_c1=new o(.7,.7,.7),Es.Draw_s_c2=new o(.3,.9,.3),Es.Draw_s_c3=new o(.9,.3,.3),Es.Draw_s_c4=new o(.3,.3,.9),Es.Draw_s_c5=new o(.4,.4,.4),Es.Draw_s_lower=new It,Es.Draw_s_upper=new It,Es.Draw_s_perp=new It;var Ns=2,Js=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.call(this,Sn.e_pulleyJoint)).groundAnchorA=new It(-1,1),t.groundAnchorB=new It(1,1),t.localAnchorA=new It(-1,0),t.localAnchorB=new It(1,0),t.lengthA=0,t.lengthB=0,t.ratio=1,t.collideConnected=!0,t}return Object(r.a)(i,[{key:"Initialize",value:function(t,e,i,n,s,r,o){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(n),this.bodyA.GetLocalPoint(s,this.localAnchorA),this.bodyB.GetLocalPoint(r,this.localAnchorB),this.lengthA=It.DistanceVV(s,i),this.lengthB=It.DistanceVV(r,n),this.ratio=o}}]),i}(Ln),Xs=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s;return Object(n.a)(this,i),(s=e.call(this,t)).m_groundAnchorA=new It,s.m_groundAnchorB=new It,s.m_lengthA=0,s.m_lengthB=0,s.m_localAnchorA=new It,s.m_localAnchorB=new It,s.m_constant=0,s.m_ratio=0,s.m_impulse=0,s.m_indexA=0,s.m_indexB=0,s.m_uA=new It,s.m_uB=new It,s.m_rA=new It,s.m_rB=new It,s.m_localCenterA=new It,s.m_localCenterB=new It,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_mass=0,s.m_qA=new jt,s.m_qB=new jt,s.m_lalcA=new It,s.m_lalcB=new It,s.m_groundAnchorA.Copy(m(t.groundAnchorA,new It(-1,1))),s.m_groundAnchorB.Copy(m(t.groundAnchorB,new It(1,0))),s.m_localAnchorA.Copy(m(t.localAnchorA,new It(-1,0))),s.m_localAnchorB.Copy(m(t.localAnchorB,new It(1,0))),s.m_lengthA=m(t.lengthA,0),s.m_lengthB=m(t.lengthB,0),s.m_ratio=m(t.ratio,1),s.m_constant=m(t.lengthA,0)+s.m_ratio*m(t.lengthB,0),s.m_impulse=0,s}return Object(r.a)(i,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(n),_=this.m_qB.SetAngle(a);It.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),jt.MulRV(h,this.m_lalcA,this.m_rA),It.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),jt.MulRV(_,this.m_lalcB,this.m_rB),this.m_uA.Copy(e).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(o).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var m=this.m_uA.Length(),c=this.m_uB.Length();m>10*A?this.m_uA.SelfMul(1/m):this.m_uA.SetZero(),c>10*A?this.m_uB.SelfMul(1/c):this.m_uB.SetZero();var f=It.CrossVV(this.m_rA,this.m_uA),d=It.CrossVV(this.m_rB,this.m_uB),v=this.m_invMassA+this.m_invIA*f*f,y=this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=v+this.m_ratio*this.m_ratio*y,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var p=It.MulSV(-this.m_impulse,this.m_uA,i.InitVelocityConstraints_s_PA),x=It.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,i.InitVelocityConstraints_s_PB);s.SelfMulAdd(this.m_invMassA,p),r+=this.m_invIA*It.CrossVV(this.m_rA,p),u.SelfMulAdd(this.m_invMassB,x),l+=this.m_invIB*It.CrossVV(this.m_rB,x)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=l}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,o=It.AddVCrossSV(e,n,this.m_rA,i.SolveVelocityConstraints_s_vpA),a=It.AddVCrossSV(s,r,this.m_rB,i.SolveVelocityConstraints_s_vpB),u=-It.DotVV(this.m_uA,o)-this.m_ratio*It.DotVV(this.m_uB,a),l=-this.m_mass*u;this.m_impulse+=l;var h=It.MulSV(-l,this.m_uA,i.SolveVelocityConstraints_s_PA),_=It.MulSV(-this.m_ratio*l,this.m_uB,i.SolveVelocityConstraints_s_PB);e.SelfMulAdd(this.m_invMassA,h),n+=this.m_invIA*It.CrossVV(this.m_rA,h),s.SelfMulAdd(this.m_invMassB,_),r+=this.m_invIB*It.CrossVV(this.m_rB,_),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,s=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(n),a=this.m_qB.SetAngle(r);It.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var u=jt.MulRV(o,this.m_lalcA,this.m_rA);It.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var l=jt.MulRV(a,this.m_lalcB,this.m_rB),h=this.m_uA.Copy(e).SelfAdd(u).SelfSub(this.m_groundAnchorA),_=this.m_uB.Copy(s).SelfAdd(l).SelfSub(this.m_groundAnchorB),m=h.Length(),c=_.Length();m>10*A?h.SelfMul(1/m):h.SetZero(),c>10*A?_.SelfMul(1/c):_.SetZero();var f=It.CrossVV(u,h),d=It.CrossVV(l,_),v=this.m_invMassA+this.m_invIA*f*f,y=this.m_invMassB+this.m_invIB*d*d,p=v+this.m_ratio*this.m_ratio*y;p>0&&(p=1/p);var x=this.m_constant-m-this.m_ratio*c,B=ht(x),S=-p*x,C=It.MulSV(-S,h,i.SolvePositionConstraints_s_PA),b=It.MulSV(-this.m_ratio*S,_,i.SolvePositionConstraints_s_PB);return e.SelfMulAdd(this.m_invMassA,C),n+=this.m_invIA*It.CrossVV(u,C),s.SelfMulAdd(this.m_invMassB,b),r+=this.m_invIB*It.CrossVV(l,b),t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=r,B<A}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetGroundAnchorA",value:function(){return this.m_groundAnchorA}},{key:"GetGroundAnchorB",value:function(){return this.m_groundAnchorB}},{key:"GetLengthA",value:function(){return this.m_lengthA}},{key:"GetLengthB",value:function(){return this.m_lengthB}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"GetCurrentLengthA",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,i.GetCurrentLengthA_s_p),e=this.m_groundAnchorA;return It.DistanceVV(t,e)}},{key:"GetCurrentLengthB",value:function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,i.GetCurrentLengthB_s_p),e=this.m_groundAnchorB;return It.DistanceVV(t,e)}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"ShiftOrigin",value:function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)}}]),i}(Tn);Xs.InitVelocityConstraints_s_PA=new It,Xs.InitVelocityConstraints_s_PB=new It,Xs.SolveVelocityConstraints_s_vpA=new It,Xs.SolveVelocityConstraints_s_vpB=new It,Xs.SolveVelocityConstraints_s_PA=new It,Xs.SolveVelocityConstraints_s_PB=new It,Xs.SolvePositionConstraints_s_PA=new It,Xs.SolvePositionConstraints_s_PB=new It,Xs.GetCurrentLengthA_s_p=new It,Xs.GetCurrentLengthB_s_p=new It;var Zs=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.call(this,Sn.e_revoluteJoint)).localAnchorA=new It(0,0),t.localAnchorB=new It(0,0),t.referenceAngle=0,t.enableLimit=!1,t.lowerAngle=0,t.upperAngle=0,t.enableMotor=!1,t.motorSpeed=0,t.maxMotorTorque=0,t}return Object(r.a)(i,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),i}(Ln),Us=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s;return Object(n.a)(this,i),(s=e.call(this,t)).m_localAnchorA=new It,s.m_localAnchorB=new It,s.m_impulse=new It,s.m_motorImpulse=0,s.m_lowerImpulse=0,s.m_upperImpulse=0,s.m_enableMotor=!1,s.m_maxMotorTorque=0,s.m_motorSpeed=0,s.m_enableLimit=!1,s.m_referenceAngle=0,s.m_lowerAngle=0,s.m_upperAngle=0,s.m_indexA=0,s.m_indexB=0,s.m_rA=new It,s.m_rB=new It,s.m_localCenterA=new It,s.m_localCenterB=new It,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_K=new Lt,s.m_angle=0,s.m_axialMass=0,s.m_qA=new jt,s.m_qB=new jt,s.m_lalcA=new It,s.m_lalcB=new It,s.m_localAnchorA.Copy(m(t.localAnchorA,It.ZERO)),s.m_localAnchorB.Copy(m(t.localAnchorB,It.ZERO)),s.m_referenceAngle=m(t.referenceAngle,0),s.m_impulse.SetZero(),s.m_motorImpulse=0,s.m_lowerAngle=m(t.lowerAngle,0),s.m_upperAngle=m(t.upperAngle,0),s.m_maxMotorTorque=m(t.maxMotorTorque,0),s.m_motorSpeed=m(t.motorSpeed,0),s.m_enableLimit=m(t.enableLimit,!1),s.m_enableMotor=m(t.enableMotor,!1),s}return Object(r.a)(i,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(r);It.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),jt.MulRV(u,this.m_lalcA,this.m_rA),It.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),jt.MulRV(l,this.m_lalcB,this.m_rB);var h,_=this.m_invMassA,m=this.m_invMassB,c=this.m_invIA,f=this.m_invIB;if(this.m_K.ex.x=_+m+this.m_rA.y*this.m_rA.y*c+this.m_rB.y*this.m_rB.y*f,this.m_K.ey.x=-this.m_rA.y*this.m_rA.x*c-this.m_rB.y*this.m_rB.x*f,this.m_K.ex.y=this.m_K.ey.x,this.m_K.ey.y=_+m+this.m_rA.x*this.m_rA.x*c+this.m_rB.x*this.m_rB.x*f,this.m_axialMass=c+f,this.m_axialMass>0?(this.m_axialMass=1/this.m_axialMass,h=!1):h=!0,this.m_angle=r-e-this.m_referenceAngle,(!1===this.m_enableLimit||h)&&(this.m_lowerImpulse=0,this.m_upperImpulse=0),(!1===this.m_enableMotor||h)&&(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,this.m_lowerImpulse*=t.step.dtRatio,this.m_upperImpulse*=t.step.dtRatio;var d=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,v=i.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);n.SelfMulSub(_,v),s-=c*(It.CrossVV(this.m_rA,v)+d),o.SelfMulAdd(m,v),a+=f*(It.CrossVV(this.m_rB,v)+d)}else this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,u=this.m_invIA,l=this.m_invIB,h=u+l===0;if(this.m_enableMotor&&!h){var _=r-n-this.m_motorSpeed,m=-this.m_axialMass*_,c=this.m_motorImpulse,f=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=ct(this.m_motorImpulse+m,-f,f),n-=u*(m=this.m_motorImpulse-c),r+=l*m}if(this.m_enableLimit&&!h){var d=this.m_angle-this.m_lowerAngle,v=r-n,y=-this.m_axialMass*(v+mt(d,0)*t.step.inv_dt),p=this.m_lowerImpulse;this.m_lowerImpulse=mt(this.m_lowerImpulse+y,0),n-=u*(y=this.m_lowerImpulse-p),r+=l*y;var x=this.m_upperAngle-this.m_angle,B=n-r,S=-this.m_axialMass*(B+mt(x,0)*t.step.inv_dt),A=this.m_upperImpulse;this.m_upperImpulse=mt(this.m_upperImpulse+S,0),n+=u*(S=this.m_upperImpulse-A),r-=l*S}var C=It.SubVV(It.AddVCrossSV(s,r,this.m_rB,It.s_t0),It.AddVCrossSV(e,n,this.m_rA,It.s_t1),i.SolveVelocityConstraints_s_Cdot_v2),b=this.m_K.Solve(-C.x,-C.y,i.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=b.x,this.m_impulse.y+=b.y,e.SelfMulSub(o,b),n-=u*It.CrossVV(this.m_rA,b),s.SelfMulAdd(a,b),r+=l*It.CrossVV(this.m_rB,b),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r}},{key:"SolvePositionConstraints",value:function(t){var e,n=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,a=this.m_qA.SetAngle(s),u=this.m_qB.SetAngle(o),l=0,h=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&!h){var _=o-s-this.m_referenceAngle,m=0;ht(this.m_upperAngle-this.m_lowerAngle)<2*C?m=ct(_-this.m_lowerAngle,-k,k):_<=this.m_lowerAngle?m=ct(_-this.m_lowerAngle+C,-k,0):_>=this.m_upperAngle&&(m=ct(_-this.m_upperAngle-C,0,k));var c=-this.m_axialMass*m;s-=this.m_invIA*c,o+=this.m_invIB*c,l=ht(m)}a.SetAngle(s),u.SetAngle(o),It.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var f=jt.MulRV(a,this.m_lalcA,this.m_rA);It.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var d=jt.MulRV(u,this.m_lalcB,this.m_rB),v=It.SubVV(It.AddVV(r,d,It.s_t0),It.AddVV(n,f,It.s_t1),i.SolvePositionConstraints_s_C_v2);e=v.Length();var y=this.m_invMassA,p=this.m_invMassB,x=this.m_invIA,B=this.m_invIB,S=this.m_K;S.ex.x=y+p+x*f.y*f.y+B*d.y*d.y,S.ex.y=-x*f.x*f.y-B*d.x*d.y,S.ey.x=S.ex.y,S.ey.y=y+p+x*f.x*f.x+B*d.x*d.x;var b=S.Solve(v.x,v.y,i.SolvePositionConstraints_s_impulse).SelfNeg();return n.SelfMulSub(y,b),s-=x*It.CrossVV(f,b),r.SelfMulAdd(p,b),o+=B*It.CrossVV(d,b),t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=o,e<=A&&l<=C}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*(this.m_lowerImpulse-this.m_upperImpulse)}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}},{key:"GetJointSpeed",value:function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorTorque",value:function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_lowerImpulse=0,this.m_upperImpulse=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerAngle}},{key:"GetUpperLimit",value:function(){return this.m_upperAngle}},{key:"SetLimits",value:function(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_lowerAngle=t,this.m_upperAngle=e)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"Draw",value:function(t){var e=this.m_bodyA.GetTransform(),n=this.m_bodyB.GetTransform(),s=Tt.MulXV(e,this.m_localAnchorA,i.Draw_s_pA),r=Tt.MulXV(n,this.m_localAnchorB,i.Draw_s_pB),o=i.Draw_s_c1,a=i.Draw_s_c2,u=i.Draw_s_c3,l=i.Draw_s_c4,h=i.Draw_s_c5;t.DrawPoint(s,5,l),t.DrawPoint(r,5,h);var _=this.m_bodyA.GetAngle(),m=this.m_bodyB.GetAngle()-_-this.m_referenceAngle,c=.5,f=i.Draw_s_r.Set(c*Math.cos(m),c*Math.sin(m));if(t.DrawSegment(r,It.AddVV(r,f,It.s_t0),o),t.DrawCircle(r,c,o),this.m_enableLimit){var d=i.Draw_s_rlo.Set(c*Math.cos(this.m_lowerAngle),c*Math.sin(this.m_lowerAngle)),v=i.Draw_s_rhi.Set(c*Math.cos(this.m_upperAngle),c*Math.sin(this.m_upperAngle));t.DrawSegment(r,It.AddVV(r,d,It.s_t0),a),t.DrawSegment(r,It.AddVV(r,v,It.s_t0),u)}var y=i.Draw_s_color_;t.DrawSegment(e.p,s,y),t.DrawSegment(s,r,y),t.DrawSegment(n.p,r,y)}}]),i}(Tn);Us.InitVelocityConstraints_s_P=new It,Us.SolveVelocityConstraints_s_Cdot_v2=new It,Us.SolveVelocityConstraints_s_impulse_v2=new It,Us.SolvePositionConstraints_s_C_v2=new It,Us.SolvePositionConstraints_s_impulse=new It,Us.Draw_s_pA=new It,Us.Draw_s_pB=new It,Us.Draw_s_c1=new o(.7,.7,.7),Us.Draw_s_c2=new o(.3,.9,.3),Us.Draw_s_c3=new o(.9,.3,.3),Us.Draw_s_c4=new o(.3,.3,.9),Us.Draw_s_c5=new o(.4,.4,.4),Us.Draw_s_color_=new o(.5,.8,.8),Us.Draw_s_r=new It,Us.Draw_s_rlo=new It,Us.Draw_s_rhi=new It;var Ws=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.call(this,Sn.e_weldJoint)).localAnchorA=new It,t.localAnchorB=new It,t.referenceAngle=0,t.stiffness=0,t.damping=0,t}return Object(r.a)(i,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),i}(Ln),Qs=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s;return Object(n.a)(this,i),(s=e.call(this,t)).m_stiffness=0,s.m_damping=0,s.m_bias=0,s.m_localAnchorA=new It,s.m_localAnchorB=new It,s.m_referenceAngle=0,s.m_gamma=0,s.m_impulse=new Ft(0,0,0),s.m_indexA=0,s.m_indexB=0,s.m_rA=new It,s.m_rB=new It,s.m_localCenterA=new It,s.m_localCenterB=new It,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_mass=new Rt,s.m_qA=new jt,s.m_qB=new jt,s.m_lalcA=new It,s.m_lalcB=new It,s.m_K=new Rt,s.m_stiffness=m(t.stiffness,0),s.m_damping=m(t.damping,0),s.m_localAnchorA.Copy(m(t.localAnchorA,It.ZERO)),s.m_localAnchorB.Copy(m(t.localAnchorB,It.ZERO)),s.m_referenceAngle=m(t.referenceAngle,0),s.m_impulse.SetZero(),s}return Object(r.a)(i,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(r);It.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),jt.MulRV(u,this.m_lalcA,this.m_rA),It.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),jt.MulRV(l,this.m_lalcB,this.m_rB);var h=this.m_invMassA,_=this.m_invMassB,m=this.m_invIA,c=this.m_invIB,f=this.m_K;if(f.ex.x=h+_+this.m_rA.y*this.m_rA.y*m+this.m_rB.y*this.m_rB.y*c,f.ey.x=-this.m_rA.y*this.m_rA.x*m-this.m_rB.y*this.m_rB.x*c,f.ez.x=-this.m_rA.y*m-this.m_rB.y*c,f.ex.y=f.ey.x,f.ey.y=h+_+this.m_rA.x*this.m_rA.x*m+this.m_rB.x*this.m_rB.x*c,f.ez.y=this.m_rA.x*m+this.m_rB.x*c,f.ex.z=f.ez.x,f.ey.z=f.ez.y,f.ez.z=m+c,this.m_stiffness>0){f.GetInverse22(this.m_mass);var d=m+c,v=r-e-this.m_referenceAngle,y=this.m_damping,p=this.m_stiffness,x=t.step.dt;this.m_gamma=x*(y+x*p),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=v*x*p*this.m_gamma,d+=this.m_gamma,this.m_mass.ez.z=0!==d?1/d:0}else f.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);var B=i.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);n.SelfMulSub(h,B),s-=m*(It.CrossVV(this.m_rA,B)+this.m_impulse.z),o.SelfMulAdd(_,B),a+=c*(It.CrossVV(this.m_rB,B)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,u=this.m_invIA,l=this.m_invIB;if(this.m_stiffness>0){var h=r-n,_=-this.m_mass.ez.z*(h+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=_,n-=u*_,r+=l*_;var m=It.SubVV(It.AddVCrossSV(s,r,this.m_rB,It.s_t0),It.AddVCrossSV(e,n,this.m_rA,It.s_t1),i.SolveVelocityConstraints_s_Cdot1),c=Rt.MulM33XY(this.m_mass,m.x,m.y,i.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=c.x,this.m_impulse.y+=c.y;var f=c;e.SelfMulSub(o,f),n-=u*It.CrossVV(this.m_rA,f),s.SelfMulAdd(a,f),r+=l*It.CrossVV(this.m_rB,f)}else{var d=It.SubVV(It.AddVCrossSV(s,r,this.m_rB,It.s_t0),It.AddVCrossSV(e,n,this.m_rA,It.s_t1),i.SolveVelocityConstraints_s_Cdot1),v=r-n,y=Rt.MulM33XYZ(this.m_mass,d.x,d.y,v,i.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(y);var p=i.SolveVelocityConstraints_s_P.Set(y.x,y.y);e.SelfMulSub(o,p),n-=u*(It.CrossVV(this.m_rA,p)+y.z),s.SelfMulAdd(a,p),r+=l*(It.CrossVV(this.m_rB,p)+y.z)}t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,s=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(n),a=this.m_qB.SetAngle(r),u=this.m_invMassA,l=this.m_invMassB,h=this.m_invIA,_=this.m_invIB;It.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var m=jt.MulRV(o,this.m_lalcA,this.m_rA);It.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var c,f,d=jt.MulRV(a,this.m_lalcB,this.m_rB),v=this.m_K;if(v.ex.x=u+l+m.y*m.y*h+d.y*d.y*_,v.ey.x=-m.y*m.x*h-d.y*d.x*_,v.ez.x=-m.y*h-d.y*_,v.ex.y=v.ey.x,v.ey.y=u+l+m.x*m.x*h+d.x*d.x*_,v.ez.y=m.x*h+d.x*_,v.ex.z=v.ez.x,v.ey.z=v.ez.y,v.ez.z=h+_,this.m_stiffness>0){var y=It.SubVV(It.AddVV(s,d,It.s_t0),It.AddVV(e,m,It.s_t1),i.SolvePositionConstraints_s_C1);c=y.Length(),f=0;var p=v.Solve22(y.x,y.y,i.SolvePositionConstraints_s_P).SelfNeg();e.SelfMulSub(u,p),n-=h*It.CrossVV(m,p),s.SelfMulAdd(l,p),r+=_*It.CrossVV(d,p)}else{var x=It.SubVV(It.AddVV(s,d,It.s_t0),It.AddVV(e,m,It.s_t1),i.SolvePositionConstraints_s_C1),B=r-n-this.m_referenceAngle;c=x.Length(),f=ht(B);var S=v.Solve33(x.x,x.y,B,i.SolvePositionConstraints_s_impulse).SelfNeg(),b=i.SolvePositionConstraints_s_P.Set(S.x,S.y);e.SelfMulSub(u,b),n-=h*(It.CrossVV(this.m_rA,b)+S.z),s.SelfMulAdd(l,b),r+=_*(It.CrossVV(this.m_rB,b)+S.z)}return t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=r,c<=A&&f<=C}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.z}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"SetStiffness",value:function(t){this.m_stiffness=t}},{key:"GetStiffness",value:function(){return this.m_stiffness}},{key:"SetDamping",value:function(t){this.m_damping=t}},{key:"GetDamping",value:function(){return this.m_damping}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.stiffness = %.15f;\n",this.m_stiffness),t("  jd.damping = %.15f;\n",this.m_damping),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),i}(Tn);Qs.InitVelocityConstraints_s_P=new It,Qs.SolveVelocityConstraints_s_Cdot1=new It,Qs.SolveVelocityConstraints_s_impulse1=new It,Qs.SolveVelocityConstraints_s_impulse=new Ft,Qs.SolveVelocityConstraints_s_P=new It,Qs.SolvePositionConstraints_s_C1=new It,Qs.SolvePositionConstraints_s_P=new It,Qs.SolvePositionConstraints_s_impulse=new Ft;var Ys,Ks=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.call(this,Sn.e_wheelJoint)).localAnchorA=new It(0,0),t.localAnchorB=new It(0,0),t.localAxisA=new It(1,0),t.enableLimit=!1,t.lowerTranslation=0,t.upperTranslation=0,t.enableMotor=!1,t.maxMotorTorque=0,t.motorSpeed=0,t.stiffness=0,t.damping=0,t}return Object(r.a)(i,[{key:"Initialize",value:function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(n,this.localAxisA)}}]),i}(Ln),Hs=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s;return Object(n.a)(this,i),(s=e.call(this,t)).m_localAnchorA=new It,s.m_localAnchorB=new It,s.m_localXAxisA=new It,s.m_localYAxisA=new It,s.m_impulse=0,s.m_motorImpulse=0,s.m_springImpulse=0,s.m_lowerImpulse=0,s.m_upperImpulse=0,s.m_translation=0,s.m_lowerTranslation=0,s.m_upperTranslation=0,s.m_maxMotorTorque=0,s.m_motorSpeed=0,s.m_enableLimit=!1,s.m_enableMotor=!1,s.m_stiffness=0,s.m_damping=0,s.m_indexA=0,s.m_indexB=0,s.m_localCenterA=new It,s.m_localCenterB=new It,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_ax=new It,s.m_ay=new It,s.m_sAx=0,s.m_sBx=0,s.m_sAy=0,s.m_sBy=0,s.m_mass=0,s.m_motorMass=0,s.m_axialMass=0,s.m_springMass=0,s.m_bias=0,s.m_gamma=0,s.m_qA=new jt,s.m_qB=new jt,s.m_lalcA=new It,s.m_lalcB=new It,s.m_rA=new It,s.m_rB=new It,s.m_localAnchorA.Copy(m(t.localAnchorA,It.ZERO)),s.m_localAnchorB.Copy(m(t.localAnchorB,It.ZERO)),s.m_localXAxisA.Copy(m(t.localAxisA,It.UNITX)),It.CrossOneV(s.m_localXAxisA,s.m_localYAxisA),s.m_lowerTranslation=m(t.lowerTranslation,0),s.m_upperTranslation=m(t.upperTranslation,0),s.m_enableLimit=m(t.enableLimit,!1),s.m_maxMotorTorque=m(t.maxMotorTorque,0),s.m_motorSpeed=m(t.motorSpeed,0),s.m_enableMotor=m(t.enableMotor,!1),s.m_ax.SetZero(),s.m_ay.SetZero(),s.m_stiffness=m(t.stiffness,0),s.m_damping=m(t.damping,0),s}return Object(r.a)(i,[{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"SetSpringFrequencyHz",value:function(t){this.m_stiffness=t}},{key:"GetSpringFrequencyHz",value:function(){return this.m_stiffness}},{key:"SetSpringDampingRatio",value:function(t){this.m_damping=t}},{key:"GetSpringDampingRatio",value:function(){return this.m_damping}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,n=this.m_invMassB,s=this.m_invIA,r=this.m_invIB,o=t.positions[this.m_indexA].c,a=t.positions[this.m_indexA].a,u=t.velocities[this.m_indexA].v,l=t.velocities[this.m_indexA].w,h=t.positions[this.m_indexB].c,_=t.positions[this.m_indexB].a,m=t.velocities[this.m_indexB].v,c=t.velocities[this.m_indexB].w,f=this.m_qA.SetAngle(a),d=this.m_qB.SetAngle(_);It.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var v=jt.MulRV(f,this.m_lalcA,this.m_rA);It.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var y=jt.MulRV(d,this.m_lalcB,this.m_rB),p=It.SubVV(It.AddVV(h,y,It.s_t0),It.AddVV(o,v,It.s_t1),i.InitVelocityConstraints_s_d);jt.MulRV(f,this.m_localYAxisA,this.m_ay),this.m_sAy=It.CrossVV(It.AddVV(p,v,It.s_t0),this.m_ay),this.m_sBy=It.CrossVV(y,this.m_ay),this.m_mass=e+n+s*this.m_sAy*this.m_sAy+r*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),jt.MulRV(f,this.m_localXAxisA,this.m_ax),this.m_sAx=It.CrossVV(It.AddVV(p,v,It.s_t0),this.m_ax),this.m_sBx=It.CrossVV(y,this.m_ax);var x=e+n+s*this.m_sAx*this.m_sAx+r*this.m_sBx*this.m_sBx;if(this.m_axialMass=x>0?1/x:0,this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_stiffness>0&&x>0){this.m_springMass=1/x;var B=It.DotVV(p,this.m_ax),S=t.step.dt;this.m_gamma=S*(this.m_damping+S*this.m_stiffness),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=B*S*this.m_stiffness*this.m_gamma,this.m_springMass=x+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}else this.m_springImpulse=0;if(this.m_enableLimit?this.m_translation=It.DotVV(this.m_ax,p):(this.m_lowerImpulse=0,this.m_upperImpulse=0),this.m_enableMotor?(this.m_motorMass=s+r,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;var A=this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse,C=It.AddVV(It.MulSV(this.m_impulse,this.m_ay,It.s_t0),It.MulSV(A,this.m_ax,It.s_t1),i.InitVelocityConstraints_s_P),b=this.m_impulse*this.m_sAy+A*this.m_sAx+this.m_motorImpulse,g=this.m_impulse*this.m_sBy+A*this.m_sBx+this.m_motorImpulse;u.SelfMulSub(this.m_invMassA,C),l-=this.m_invIA*b,m.SelfMulAdd(this.m_invMassB,C),c+=this.m_invIB*g}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;t.velocities[this.m_indexA].w=l,t.velocities[this.m_indexB].w=c}},{key:"SolveVelocityConstraints",value:function(t){var e=this.m_invMassA,n=this.m_invMassB,s=this.m_invIA,r=this.m_invIB,o=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,u=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=It.DotVV(this.m_ax,It.SubVV(u,o,It.s_t0))+this.m_sBx*l-this.m_sAx*a,_=-this.m_springMass*(h+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=_;var m=It.MulSV(_,this.m_ax,i.SolveVelocityConstraints_s_P),c=_*this.m_sAx,f=_*this.m_sBx;o.SelfMulSub(e,m),a-=s*c,u.SelfMulAdd(n,m);var d=(l+=r*f)-a-this.m_motorSpeed,v=-this.m_motorMass*d,y=this.m_motorImpulse,p=t.step.dt*this.m_maxMotorTorque;if(this.m_motorImpulse=ct(this.m_motorImpulse+v,-p,p),a-=s*(v=this.m_motorImpulse-y),l+=r*v,this.m_enableLimit){var x=this.m_translation-this.m_lowerTranslation,B=It.DotVV(this.m_ax,It.SubVV(u,o,It.s_t0))+this.m_sBx*l-this.m_sAx*a,S=-this.m_axialMass*(B+mt(x,0)*t.step.inv_dt),A=this.m_lowerImpulse;this.m_lowerImpulse=mt(this.m_lowerImpulse+S,0),S=this.m_lowerImpulse-A;var C=It.MulSV(S,this.m_ax,i.SolveVelocityConstraints_s_P),b=S*this.m_sAx,g=S*this.m_sBx;o.SelfMulSub(e,C),a-=s*b,u.SelfMulAdd(n,C),l+=r*g;var V=this.m_upperTranslation-this.m_translation,w=It.DotVV(this.m_ax,It.SubVV(o,u,It.s_t0))+this.m_sAx*a-this.m_sBx*l,k=-this.m_axialMass*(w+mt(V,0)*t.step.inv_dt),M=this.m_upperImpulse;this.m_upperImpulse=mt(this.m_upperImpulse+k,0),k=this.m_upperImpulse-M;var P=It.MulSV(k,this.m_ax,i.SolveVelocityConstraints_s_P),I=k*this.m_sAx,G=k*this.m_sBx;o.SelfMulAdd(e,P),a+=s*I,u.SelfMulSub(n,P),l-=r*G}var D=It.DotVV(this.m_ay,It.SubVV(u,o,It.s_t0))+this.m_sBy*l-this.m_sAy*a,F=-this.m_mass*D;this.m_impulse+=F;var L=It.MulSV(F,this.m_ay,i.SolveVelocityConstraints_s_P),R=F*this.m_sAy,j=F*this.m_sBy;o.SelfMulSub(e,L),a-=s*R,u.SelfMulAdd(n,L),l+=r*j,t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=l}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,s=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,o=0;if(this.m_enableLimit){var a=this.m_qA.SetAngle(n),u=this.m_qB.SetAngle(r);It.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=jt.MulRV(a,this.m_lalcA,this.m_rA);It.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var h=jt.MulRV(u,this.m_lalcB,this.m_rB),_=It.AddVV(It.SubVV(s,e,It.s_t0),It.SubVV(h,l,It.s_t1),i.SolvePositionConstraints_s_d),m=jt.MulRV(a,this.m_localXAxisA,this.m_ax),c=It.CrossVV(It.AddVV(_,l,It.s_t0),this.m_ax),f=It.CrossVV(h,this.m_ax),d=0,v=It.DotVV(m,_);if(ht(this.m_upperTranslation-this.m_lowerTranslation)<2*A?d=v:v<=this.m_lowerTranslation?d=_t(v-this.m_lowerTranslation,0):v>=this.m_upperTranslation&&(d=mt(v-this.m_upperTranslation,0)),0!==d){var y=this.m_invMassA+this.m_invMassB+this.m_invIA*c*c+this.m_invIB*f*f,p=0;0!==y&&(p=-d/y);var x=It.MulSV(p,m,i.SolvePositionConstraints_s_P),B=p*c,S=p*f;e.SelfMulSub(this.m_invMassA,x),n-=this.m_invIA*B,s.SelfMulAdd(this.m_invMassB,x),r+=this.m_invIB*S,o=ht(d)}}var C=this.m_qA.SetAngle(n),b=this.m_qB.SetAngle(r);It.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var g=jt.MulRV(C,this.m_lalcA,this.m_rA);It.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var V=jt.MulRV(b,this.m_lalcB,this.m_rB),w=It.AddVV(It.SubVV(s,e,It.s_t0),It.SubVV(V,g,It.s_t1),i.SolvePositionConstraints_s_d),k=jt.MulRV(C,this.m_localYAxisA,this.m_ay),M=It.CrossVV(It.AddVV(w,g,It.s_t0),k),P=It.CrossVV(V,k),I=It.DotVV(w,k),G=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,D=0;0!==G&&(D=-I/G);var F=It.MulSV(D,k,i.SolvePositionConstraints_s_P),L=D*M,R=D*P;return e.SelfMulSub(this.m_invMassA,F),n-=this.m_invIA*L,s.SelfMulAdd(this.m_invMassB,F),r+=this.m_invIB*R,o=mt(o,ht(I)),t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=r,o<=A}},{key:"GetDefinition",value:function(t){return t}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+(this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+(this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_ax.y),e}},{key:"GetReactionTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetJointTranslation",value:function(){return this.GetPrismaticJointTranslation()}},{key:"GetJointLinearSpeed",value:function(){return this.GetPrismaticJointSpeed()}},{key:"GetJointAngle",value:function(){return this.GetRevoluteJointAngle()}},{key:"GetJointAngularSpeed",value:function(){return this.GetRevoluteJointSpeed()}},{key:"GetPrismaticJointTranslation",value:function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new It),n=e.GetWorldPoint(this.m_localAnchorB,new It),s=It.SubVV(n,i,new It),r=t.GetWorldVector(this.m_localXAxisA,new It);return It.DotVV(s,r)}},{key:"GetPrismaticJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;It.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=jt.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);It.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var n=jt.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),s=It.AddVV(t.m_sweep.c,i,It.s_t0),r=It.AddVV(e.m_sweep.c,n,It.s_t1),o=It.SubVV(r,s,It.s_t2),a=t.GetWorldVector(this.m_localXAxisA,new It),u=t.m_linearVelocity,l=e.m_linearVelocity,h=t.m_angularVelocity,_=e.m_angularVelocity;return It.DotVV(o,It.CrossSV(h,a,It.s_t0))+It.DotVV(a,It.SubVV(It.AddVCrossSV(l,_,n,It.s_t0),It.AddVCrossSV(u,h,i,It.s_t1),It.s_t0))}},{key:"GetRevoluteJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}},{key:"GetRevoluteJointSpeed",value:function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"SetMaxMotorTorque",value:function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_lowerImpulse=0,this.m_upperImpulse=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerTranslation}},{key:"GetUpperLimit",value:function(){return this.m_upperTranslation}},{key:"SetLimits",value:function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_lowerImpulse=0,this.m_upperImpulse=0)}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.stiffness = %.15f;\n",this.m_stiffness),t("  jd.damping = %.15f;\n",this.m_damping),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"Draw",value:function(t){var e=this.m_bodyA.GetTransform(),n=this.m_bodyB.GetTransform(),s=Tt.MulXV(e,this.m_localAnchorA,i.Draw_s_pA),r=Tt.MulXV(n,this.m_localAnchorB,i.Draw_s_pB),o=jt.MulRV(e.q,this.m_localXAxisA,i.Draw_s_axis),a=i.Draw_s_c1,u=i.Draw_s_c2,l=i.Draw_s_c3,h=i.Draw_s_c4,_=i.Draw_s_c5;if(t.DrawSegment(s,r,_),this.m_enableLimit){var m=It.AddVMulSV(s,this.m_lowerTranslation,o,i.Draw_s_lower),c=It.AddVMulSV(s,this.m_upperTranslation,o,i.Draw_s_upper),f=jt.MulRV(e.q,this.m_localYAxisA,i.Draw_s_perp);t.DrawSegment(m,c,a),t.DrawSegment(It.AddVMulSV(m,-.5,f,It.s_t0),It.AddVMulSV(m,.5,f,It.s_t1),u),t.DrawSegment(It.AddVMulSV(c,-.5,f,It.s_t0),It.AddVMulSV(c,.5,f,It.s_t1),l)}else t.DrawSegment(It.AddVMulSV(s,-1,o,It.s_t0),It.AddVMulSV(s,1,o,It.s_t1),a);t.DrawPoint(s,5,a),t.DrawPoint(r,5,h)}}]),i}(Tn);Hs.InitVelocityConstraints_s_d=new It,Hs.InitVelocityConstraints_s_P=new It,Hs.SolveVelocityConstraints_s_P=new It,Hs.SolvePositionConstraints_s_d=new It,Hs.SolvePositionConstraints_s_P=new It,Hs.Draw_s_pA=new It,Hs.Draw_s_pB=new It,Hs.Draw_s_axis=new It,Hs.Draw_s_c1=new o(.7,.7,.7),Hs.Draw_s_c2=new o(.3,.9,.3),Hs.Draw_s_c3=new o(.9,.3,.3),Hs.Draw_s_c4=new o(.3,.3,.9),Hs.Draw_s_c5=new o(.4,.4,.4),Hs.Draw_s_lower=new It,Hs.Draw_s_upper=new It,Hs.Draw_s_perp=new It,function(t){t[t.b2_waterParticle=0]="b2_waterParticle",t[t.b2_zombieParticle=2]="b2_zombieParticle",t[t.b2_wallParticle=4]="b2_wallParticle",t[t.b2_springParticle=8]="b2_springParticle",t[t.b2_elasticParticle=16]="b2_elasticParticle",t[t.b2_viscousParticle=32]="b2_viscousParticle",t[t.b2_powderParticle=64]="b2_powderParticle",t[t.b2_tensileParticle=128]="b2_tensileParticle",t[t.b2_colorMixingParticle=256]="b2_colorMixingParticle",t[t.b2_destructionListenerParticle=512]="b2_destructionListenerParticle",t[t.b2_barrierParticle=1024]="b2_barrierParticle",t[t.b2_staticPressureParticle=2048]="b2_staticPressureParticle",t[t.b2_reactiveParticle=4096]="b2_reactiveParticle",t[t.b2_repulsiveParticle=8192]="b2_repulsiveParticle",t[t.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle",t[t.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle",t[t.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle",t[t.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle"}(Ys||(Ys={}));var $s=function t(){Object(n.a)(this,t),this.flags=0,this.position=new It,this.velocity=new It,this.color=new o(0,0,0,0),this.lifetime=0,this.userData=null,this.group=null};function tr(t,e,i){return ct(Math.ceil(Math.sqrt(t/(.01*e))*i),1,8)}var er,ir=function(){function t(){Object(n.a)(this,t),this.m_index=L}return Object(r.a)(t,[{key:"GetIndex",value:function(){return this.m_index}},{key:"SetIndex",value:function(t){this.m_index=t}}]),t}();!function(t){t[t.b2_solidParticleGroup=1]="b2_solidParticleGroup",t[t.b2_rigidParticleGroup=2]="b2_rigidParticleGroup",t[t.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty",t[t.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed",t[t.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth",t[t.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask"}(er||(er={}));var nr=function t(){Object(n.a)(this,t),this.id="",this.flags=0,this.groupFlags=0,this.position=new It,this.angle=0,this.linearVelocity=new It,this.angularVelocity=0,this.color=new o,this.strength=1,this.userData=null,this.group=null},sr=function(){function t(e,i){Object(n.a)(this,t),this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new It,this.m_linearVelocity=new It,this.m_angularVelocity=0,this.m_transform=new Tt,this.m_userData=null,this.anchorOffset=0,this.relativePositions=[],this.m_system=e,this.id=i}return Object(r.a)(t,[{key:"anchorIndex",get:function(){return this.m_firstIndex+this.anchorOffset}},{key:"UpdateAnchor",value:function(){this.anchorOffset=Math.floor((this.m_lastIndex-this.m_firstIndex)/2);var t=this.m_system.m_positionBuffer.data[this.anchorIndex];this.relativePositions.length=0;for(var e=this.m_firstIndex;e<this.m_lastIndex;e++){var i=this.m_system.m_positionBuffer.data[e],n=new It;It.SubVV(i,t,n),this.relativePositions.push(n)}}},{key:"GetAnchorPosition",value:function(){return this.anchorIndex?this.m_system.m_positionBuffer.data[this.anchorIndex]:It.ZERO}},{key:"GetOffsets",value:function(){if(!this.anchorIndex)return[];for(var t=this.m_system.m_positionBuffer.data[this.anchorIndex],e=[],i=this.m_firstIndex;i<this.m_lastIndex;i++){var n=this.m_system.m_positionBuffer.data[i],s=new It;It.SubVV(n,t,s),s.SelfSub(this.relativePositions[i-this.m_firstIndex]),e.push(s)}return e}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetParticleSystem",value:function(){return this.m_system}},{key:"GetParticleCount",value:function(){return this.m_lastIndex-this.m_firstIndex}},{key:"GetBufferIndex",value:function(){return this.m_firstIndex}},{key:"ContainsParticle",value:function(t){return this.m_firstIndex<=t&&t<this.m_lastIndex}},{key:"GetAllParticleFlags",value:function(){if(!this.m_system.m_flagsBuffer.data)throw new Error;for(var t=0,e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t}},{key:"GetGroupFlags",value:function(){return this.m_groupFlags}},{key:"SetGroupFlags",value:function(t){t|=this.m_groupFlags&er.b2_particleGroupInternalMask,this.m_system.SetGroupFlags(this,t)}},{key:"GetMass",value:function(){return this.UpdateStatistics(),this.m_mass}},{key:"GetInertia",value:function(){return this.UpdateStatistics(),this.m_inertia}},{key:"GetCenter",value:function(){return this.UpdateStatistics(),this.m_center}},{key:"GetLinearVelocity",value:function(){return this.UpdateStatistics(),this.m_linearVelocity}},{key:"GetAngularVelocity",value:function(){return this.UpdateStatistics(),this.m_angularVelocity}},{key:"GetTransform",value:function(){return this.m_transform}},{key:"GetPosition",value:function(){return this.m_transform.p}},{key:"GetAngle",value:function(){return this.m_transform.q.GetAngle()}},{key:"GetLinearVelocityFromWorldPoint",value:function(e,i){var n=t.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),It.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,It.SubVV(e,this.m_center,n),i)}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"ApplyForce",value:function(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)}},{key:"ApplyLinearImpulse",value:function(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)}},{key:"DestroyParticles",value:function(t){if(this.m_system.m_world.IsLocked())throw new Error;for(var e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)}},{key:"UpdateStatistics",value:function(){if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;if(this.m_timestamp!==this.m_system.m_timestamp){var t=this.m_system.GetParticleMass();this.m_mass=t*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(var e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_center.SelfMulAdd(t,this.m_system.m_positionBuffer.data[e]),this.m_linearVelocity.SelfMulAdd(t,this.m_system.m_velocityBuffer.data[e]);if(this.m_mass>0){var i=1/this.m_mass;this.m_center.SelfMul(i),this.m_linearVelocity.SelfMul(i)}this.m_inertia=0,this.m_angularVelocity=0;for(var n=new It,s=new It,r=this.m_firstIndex;r<this.m_lastIndex;r++)It.SubVV(this.m_system.m_positionBuffer.data[r],this.m_center,n),It.SubVV(this.m_system.m_velocityBuffer.data[r],this.m_linearVelocity,s),this.m_inertia+=t*It.DotVV(n,n),this.m_angularVelocity+=t*It.CrossVV(n,s);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}}}]),t}();sr.GetLinearVelocityFromWorldPoint_s_t0=new It;var rr=function(){function t(e){Object(n.a)(this,t),this.m_buffer=[],this.m_front=0,this.m_back=0,this.m_buffer.fill(null,0,e)}return Object(r.a)(t,[{key:"m_capacity",get:function(){return this.m_buffer.length}},{key:"Push",value:function(t){if(this.m_back>=this.m_capacity){for(var e=this.m_front;e<this.m_back;e++)this.m_buffer[e-this.m_front]=this.m_buffer[e];this.m_back-=this.m_front,this.m_front=0}this.m_buffer[this.m_back]=t,this.m_back++}},{key:"Pop",value:function(){this.m_buffer[this.m_front]=null,this.m_front++}},{key:"Empty",value:function(){return this.m_front===this.m_back}},{key:"Front",value:function(){var t=this.m_buffer[this.m_front];if(!t)throw new Error;return t}}]),t}(),or=function(){function t(e){Object(n.a)(this,t),this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=tt(e,(function(){return new ar})),this.m_generatorCapacity=e}return Object(r.a)(t,[{key:"AddGenerator",value:function(t,e,i){var n=this.m_generatorBuffer[this.m_generatorCount++];n.center.Copy(t),n.tag=e,n.necessary=i}},{key:"Generate",value:function(t,e){for(var i=1/t,n=new It(+c,+c),s=new It(-c,-c),r=0,o=0;o<this.m_generatorCount;o++){var a=this.m_generatorBuffer[o];a.necessary&&(It.MinV(n,a.center,n),It.MaxV(s,a.center,s),++r)}if(0===r)return this.m_countX=0,void(this.m_countY=0);n.x-=e,n.y-=e,s.x+=e,s.y+=e,this.m_countX=1+Math.floor(i*(s.x-n.x)),this.m_countY=1+Math.floor(i*(s.y-n.y)),this.m_diagram=[];for(var u=new rr(4*this.m_countX*this.m_countY),l=0;l<this.m_generatorCount;l++){var h=this.m_generatorBuffer[l];h.center.SelfSub(n).SelfMul(i);var _=Math.floor(h.center.x),m=Math.floor(h.center.y);_>=0&&m>=0&&_<this.m_countX&&m<this.m_countY&&u.Push(new ur(_,m,_+m*this.m_countX,h))}for(;!u.Empty();){var f=u.Front(),d=f.m_x,v=f.m_y,y=f.m_i,p=f.m_generator;u.Pop(),this.m_diagram[y]||(this.m_diagram[y]=p,d>0&&u.Push(new ur(d-1,v,y-1,p)),v>0&&u.Push(new ur(d,v-1,y-this.m_countX,p)),d<this.m_countX-1&&u.Push(new ur(d+1,v,y+1,p)),v<this.m_countY-1&&u.Push(new ur(d,v+1,y+this.m_countX,p)))}for(var x=0;x<this.m_countY;x++)for(var B=0;B<this.m_countX-1;B++){var S=B+x*this.m_countX,A=this.m_diagram[S],C=this.m_diagram[S+1];A!==C&&(u.Push(new ur(B,x,S,C)),u.Push(new ur(B+1,x,S+1,A)))}for(var b=0;b<this.m_countY-1;b++)for(var g=0;g<this.m_countX;g++){var V=g+b*this.m_countX,w=this.m_diagram[V],k=this.m_diagram[V+this.m_countX];w!==k&&(u.Push(new ur(g,b,V,k)),u.Push(new ur(g,b+1,V+this.m_countX,w)))}for(;!u.Empty();){var M=u.Front(),P=M.m_x,I=M.m_y,G=M.m_i,D=M.m_generator;u.Pop();var F=this.m_diagram[G],L=D;if(F!==L){var R=F.center.x-P,j=F.center.y-I,T=L.center.x-P,O=L.center.y-I;R*R+j*j>T*T+O*O&&(this.m_diagram[G]=L,P>0&&u.Push(new ur(P-1,I,G-1,L)),I>0&&u.Push(new ur(P,I-1,G-this.m_countX,L)),P<this.m_countX-1&&u.Push(new ur(P+1,I,G+1,L)),I<this.m_countY-1&&u.Push(new ur(P,I+1,G+this.m_countX,L)))}}}},{key:"GetNodes",value:function(t){for(var e=0;e<this.m_countY-1;e++)for(var i=0;i<this.m_countX-1;i++){var n=i+e*this.m_countX,s=this.m_diagram[n],r=this.m_diagram[n+1],o=this.m_diagram[n+this.m_countX],a=this.m_diagram[n+1+this.m_countX];r!==o&&(s!==r&&s!==o&&(s.necessary||r.necessary||o.necessary)&&t(s.tag,r.tag,o.tag),a!==r&&a!==o&&(s.necessary||r.necessary||o.necessary)&&t(r.tag,a.tag,o.tag))}}}]),t}(),ar=function t(){Object(n.a)(this,t),this.center=new It,this.tag=0,this.necessary=!1},ur=function t(e,i,s,r){Object(n.a)(this,t),this.m_x=e,this.m_y=i,this.m_i=s,this.m_generator=r};function lr(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function hr(t,e){return t<e}function _r(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:hr,s=e,r=[],o=0;;){for(;s+1<i;i++){var a=t[s+Math.floor(Math.random()*(i-s))];r[o++]=i;for(var u=s-1;;){for(;n(t[++u],a););for(;n(a,t[--i]););if(u>=i)break;lr(t,u,i)}}if(0===o)break;s=i,i=r[--o]}return t}function mr(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:hr;return _r(t,e,i,n)}function cr(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length,n=0,s=0;s<i;++s)e(t[s])||(s!==n?lr(t,n++,s):++n);return n}function fr(t,e,i,n,s){for(var r=i-e;r>0;){var o=Math.floor(r/2),a=e+o;s(t[a],n)?(e=++a,r-=o+1):r=o}return e}function dr(t,e,i,n,s){for(var r=i-e;r>0;){var o=Math.floor(r/2),a=e+o;s(n,t[a])?r=o:(e=++a,r-=o+1)}return e}function vr(t,e,i,n){for(var s=i;e!==s;)lr(t,e++,s++),s===n?s=i:e===i&&(i=s)}var yr=function(){function t(e){Object(n.a)(this,t),this.data=[],this.count=0,this.capacity=0,this.allocator=e}return Object(r.a)(t,[{key:"Append",value:function(){return this.count>=this.capacity&&this.Grow(),this.count++}},{key:"Reserve",value:function(t){if(!(this.capacity>=t)){for(var e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}}},{key:"Grow",value:function(){var t=this.capacity?2*this.capacity:N;this.Reserve(t)}},{key:"Free",value:function(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)}},{key:"Shorten",value:function(t){}},{key:"Data",value:function(){return this.data}},{key:"GetCount",value:function(){return this.count}},{key:"SetCount",value:function(t){this.count=t}},{key:"GetCapacity",value:function(){return this.capacity}},{key:"RemoveIf",value:function(t){this.count=cr(this.data,t,this.count)}},{key:"Unique",value:function(t){this.count=function(t,e,i,n){if(e===i)return i;for(var s=e;++e!==i;)n(t[s],t[e])||lr(t,++s,e);return++s}(this.data,0,this.count,t)}}]),t}(),pr=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s;return Object(n.a)(this,i),(s=e.call(this)).m_system=t,s}return Object(r.a)(i,[{key:"ShouldQueryParticleSystem",value:function(t){return!1}},{key:"ReportFixture",value:function(t){if(t.IsSensor())return!0;for(var e=t.GetShape().GetChildCount(),i=0;i<e;i++)for(var n=t.GetAABB(i),s=this.m_system.GetInsideBoundsEnumerator(n),r=void 0;(r=s.GetNext())>=0;)this.ReportFixtureAndParticle(t,i,r);return!0}},{key:"ReportParticle",value:function(t,e){return!1}},{key:"ShouldCollideFixtureParticle",value:function(t,e){var i=this.m_system.GetFixtureContactFilter();if(i&&this.m_system.GetFlagsBuffer()[e]&Ys.b2_fixtureContactFilterParticle)return i.ShouldCollideFixtureParticle(t,this.m_system,e);return!0}}]),i}(ds),xr=function(){function t(){Object(n.a)(this,t),this.indexA=0,this.indexB=0,this.weight=0,this.normal=new It,this.flags=0}return Object(r.a)(t,[{key:"Clone",value:function(){var e=new t;return e.indexA=this.indexA,e.indexB=this.indexB,e.weight=this.weight,e.normal=this.normal,e.flags=this.flags,e}},{key:"SetIndices",value:function(t,e){this.indexA=t,this.indexB=e}},{key:"SetWeight",value:function(t){this.weight=t}},{key:"SetNormal",value:function(t){this.normal.Copy(t)}},{key:"SetFlags",value:function(t){this.flags=t}},{key:"GetIndexA",value:function(){return this.indexA}},{key:"GetIndexB",value:function(){return this.indexB}},{key:"GetWeight",value:function(){return this.weight}},{key:"GetNormal",value:function(){return this.normal}},{key:"GetFlags",value:function(){return this.flags}},{key:"IsEqual",value:function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y}},{key:"IsNotEqual",value:function(t){return!this.IsEqual(t)}},{key:"ApproximatelyEqual",value:function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&ht(this.weight-t.weight)<.01&&It.DistanceSquaredVV(this.normal,t.normal)<1e-4}}]),t}(),Br=function(){function t(){Object(n.a)(this,t),this.index=0,this.weight=0,this.normal=new It,this.mass=0}return Object(r.a)(t,[{key:"Clone",value:function(){var e=new t;return e.index=this.index,e.body=this.body,e.fixture=this.fixture,e.weight=this.weight,e.normal=this.normal,e.mass=this.mass,e}}]),t}(),Sr=function t(){Object(n.a)(this,t),this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0},Ar=function t(){Object(n.a)(this,t),this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new It(0,0),this.pb=new It(0,0),this.pc=new It(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0},Cr=function(){function t(){Object(n.a)(this,t),this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60}return Object(r.a)(t,[{key:"Copy",value:function(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this}},{key:"Clone",value:function(){return(new t).Copy(this)}}]),t}(),br=function(){function t(e,i){Object(n.a)(this,t),this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new gr,this.m_flagsBuffer=new gr,this.m_positionBuffer=new gr,this.m_velocityBuffer=new gr,this.m_positionConstraintBuffer=[],this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new gr,this.m_groupBuffer=[],this.m_userDataBuffer=new gr,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new gr,this.m_bodyContactCountBuffer=new gr,this.m_consecutiveContactStepsBuffer=new gr,this.m_stuckParticleBuffer=new yr((function(){return 0})),this.m_proxyBuffer=new yr((function(){return new Vr})),this.m_contactBuffer=new yr((function(){return new xr})),this.m_bodyContactBuffer=new yr((function(){return new Br})),this.m_pairBuffer=new yr((function(){return new Sr})),this.m_triadBuffer=new yr((function(){return new Ar})),this.m_expirationTimeBuffer=new gr,this.m_indexByExpirationTimeBuffer=new gr,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new Cr,this.m_prev=null,this.m_next=null,this.UpdateBodyContacts_callback=null,this.SolveCollision_callback=null,this.SetStrictContactCheck(e.strictContactCheck),this.SetDensity(e.density),this.SetGravityScale(e.gravityScale),this.SetRadius(e.radius),this.SetMaxParticleCount(e.maxCount),this.m_def=e.Clone(),this.m_world=i,this.SetDestructionByAge(this.m_def.destroyByAge)}return Object(r.a)(t,[{key:"Drop",value:function(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)}},{key:"CreateParticle",value:function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity){var e=this.m_count?2*this.m_count:N;this.ReallocateInternalAllocatedBuffers(e)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return L;this.DestroyOldestParticle(0,!1),this.SolveZombie()}var i=this.m_count++;this.m_flagsBuffer.data[i]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[i]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[i]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[i]=0),this.m_positionBuffer.data[i]=(this.m_positionBuffer.data[i]||new It).Copy(m(t.position,It.ZERO)),this.m_velocityBuffer.data[i]=(this.m_velocityBuffer.data[i]||new It).Copy(m(t.velocity,It.ZERO)),this.m_weightBuffer[i]=0,this.m_forceBuffer[i]=(this.m_forceBuffer[i]||new It).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[i]=0),this.m_depthBuffer&&(this.m_depthBuffer[i]=0);var n=(new o).Copy(m(t.color,o.ZERO));!this.m_colorBuffer.data&&n.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[i]=(this.m_colorBuffer.data[i]||new o).Copy(n)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[i]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[i]=null);var s=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],r=m(t.lifetime,0),a=r>0;(this.m_expirationTimeBuffer.data||a)&&(this.SetParticleLifetime(i,a?r:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),this.m_indexByExpirationTimeBuffer.data[i]=i),s.index=i;var u=m(t.group,null);return this.m_groupBuffer[i]=u,u&&(u.m_firstIndex<u.m_lastIndex?(this.RotateBuffer(u.m_firstIndex,u.m_lastIndex,i),u.m_lastIndex=i+1):(u.m_firstIndex=i,u.m_lastIndex=i+1),u.UpdateAnchor()),this.SetParticleFlags(i,m(t.flags,0)),i}},{key:"GetParticleHandleFromIndex",value:function(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);var e=this.m_handleIndexBuffer.data[t];return e||((e=new ir).SetIndex(t),this.m_handleIndexBuffer.data[t]=e,e)}},{key:"DestroyParticle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=Ys.b2_zombieParticle;e&&(i|=Ys.b2_destructionListenerParticle),this.SetParticleFlags(t,this.m_flagsBuffer.data[t]|i)}},{key:"DestroyOldestParticle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.GetParticleCount(),n=this.m_indexByExpirationTimeBuffer.data[i-(t+1)],s=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[n]>0?n:s,e)}},{key:"DestroyParticlesInShape",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=t.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error;var r=new Lr(this,e,i,n),o=s;return e.ComputeAABB(o,i,0),this.m_world.QueryAABB(r,o),r.Destroyed()}},{key:"CreateParticleGroup",value:function(e){if(this.m_world.IsLocked())throw new Error;var i=t.CreateParticleGroup_s_transform;i.SetPositionAngle(m(e.position,It.ZERO),m(e.angle,0));var n=this.m_count;if(e.shape&&this.CreateParticlesWithShapeForGroup(e.shape,e,i),e.shapes&&this.CreateParticlesWithShapesForGroup(e.shapes,m(e.shapeCount,e.shapes.length),e,i),e.positionData)for(var s=m(e.particleCount,e.positionData.length),r=0;r<s;r++){var o=e.positionData[r];this.CreateParticleForGroup(e,i,o)}var a=this.m_count,u=new sr(this,e.id);u.m_firstIndex=n,u.m_lastIndex=a,u.m_strength=m(e.strength,1),u.m_userData=e.userData,u.m_transform.Copy(i),u.m_prev=null,u.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=u),this.m_groupList=u,++this.m_groupCount;for(var l=n;l<a;l++)this.m_groupBuffer[l]=u;this.SetGroupFlags(u,m(e.groupFlags,0));var h=new Fr;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(n,a,h),e.group&&(this.JoinParticleGroups(e.group,u),u=e.group),u.UpdateAnchor(),u}},{key:"JoinParticleGroups",value:function(t,e){if(this.m_world.IsLocked())throw new Error;this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex);var i=new Rr(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,i);for(var n=e.m_firstIndex;n<e.m_lastIndex;n++)this.m_groupBuffer[n]=t;var s=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,s),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e)}},{key:"SplitParticleGroup",value:function(e){this.UpdateContacts(!0);var i=tt(e.GetParticleCount(),(function(t){return new kr}));t.InitializeParticleLists(e,i),this.MergeParticleListsInContact(e,i);var n=t.FindLongestParticleList(e,i);this.MergeZombieParticleListNodes(e,i,n),this.CreateParticleGroupsFromParticleList(e,i,n),this.UpdatePairsAndTriadsWithParticleList(e,i)}},{key:"GetParticleGroupList",value:function(){return this.m_groupList}},{key:"GetParticleGroupCount",value:function(){return this.m_groupCount}},{key:"GetParticleCount",value:function(){return this.m_count}},{key:"GetMaxParticleCount",value:function(){return this.m_def.maxCount}},{key:"SetMaxParticleCount",value:function(t){this.m_def.maxCount=t}},{key:"GetAllParticleFlags",value:function(){return this.m_allParticleFlags}},{key:"GetAllGroupFlags",value:function(){return this.m_allGroupFlags}},{key:"SetPaused",value:function(t){this.m_paused=t}},{key:"GetPaused",value:function(){return this.m_paused}},{key:"SetDensity",value:function(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density}},{key:"GetDensity",value:function(){return this.m_def.density}},{key:"SetGravityScale",value:function(t){this.m_def.gravityScale=t}},{key:"GetGravityScale",value:function(){return this.m_def.gravityScale}},{key:"SetDamping",value:function(t){this.m_def.dampingStrength=t}},{key:"GetDamping",value:function(){return this.m_def.dampingStrength}},{key:"SetStaticPressureIterations",value:function(t){this.m_def.staticPressureIterations=t}},{key:"GetStaticPressureIterations",value:function(){return this.m_def.staticPressureIterations}},{key:"SetRadius",value:function(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter}},{key:"GetRadius",value:function(){return this.m_particleDiameter/2}},{key:"GetPositionBuffer",value:function(){return this.m_positionBuffer.data}},{key:"GetVelocityBuffer",value:function(){return this.m_velocityBuffer.data}},{key:"GetColorBuffer",value:function(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data}},{key:"GetGroupBuffer",value:function(){return this.m_groupBuffer}},{key:"GetWeightBuffer",value:function(){return this.m_weightBuffer}},{key:"GetUserDataBuffer",value:function(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data}},{key:"GetFlagsBuffer",value:function(){return this.m_flagsBuffer.data}},{key:"SetParticleFlags",value:function(t,e){this.m_flagsBuffer.data[t]&~e&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&e&&(e&Ys.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),e&Ys.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=e),this.m_flagsBuffer.data[t]=e}},{key:"GetParticleFlags",value:function(t){return this.m_flagsBuffer.data[t]}},{key:"SetFlagsBuffer",value:function(t){this.SetUserOverridableBuffer(this.m_flagsBuffer,t)}},{key:"SetPositionBuffer",value:function(t){if(t instanceof Float32Array){if(t.length%2!==0)throw new Error;for(var e=t.length/2,i=new Array(e),n=0;n<e;++n)i[n]=new Dt(t.subarray(2*n,2*n+2));t=i}this.SetUserOverridableBuffer(this.m_positionBuffer,t)}},{key:"SetVelocityBuffer",value:function(t){if(t instanceof Float32Array){if(t.length%2!==0)throw new Error;for(var e=t.length/2,i=new Array(e),n=0;n<e;++n)i[n]=new Dt(t.subarray(2*n,2*n+2));t=i}this.SetUserOverridableBuffer(this.m_velocityBuffer,t)}},{key:"SetColorBuffer",value:function(t){if(t instanceof Float32Array){if(t.length%4!==0)throw new Error;for(var e=t.length/4,i=new Array(e),n=0;n<e;++n)i[n]=new u(t.subarray(4*n,4*n+4));t=i}this.SetUserOverridableBuffer(this.m_colorBuffer,t)}},{key:"SetUserDataBuffer",value:function(t){this.SetUserOverridableBuffer(this.m_userDataBuffer,t)}},{key:"GetContacts",value:function(){return this.m_contactBuffer.data}},{key:"GetContactCount",value:function(){return this.m_contactBuffer.count}},{key:"GetBodyContacts",value:function(){return this.m_bodyContactBuffer.data}},{key:"GetBodyContactCount",value:function(){return this.m_bodyContactBuffer.count}},{key:"GetPairs",value:function(){return this.m_pairBuffer.data}},{key:"GetPairCount",value:function(){return this.m_pairBuffer.count}},{key:"GetTriads",value:function(){return this.m_triadBuffer.data}},{key:"GetTriadCount",value:function(){return this.m_triadBuffer.count}},{key:"SetStuckThreshold",value:function(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))}},{key:"GetStuckCandidates",value:function(){return this.m_stuckParticleBuffer.Data()}},{key:"GetStuckCandidateCount",value:function(){return this.m_stuckParticleBuffer.GetCount()}},{key:"ComputeCollisionEnergy",value:function(){for(var e=t.ComputeCollisionEnergy_s_v,i=this.m_velocityBuffer.data,n=0,s=0;s<this.m_contactBuffer.count;s++){var r=this.m_contactBuffer.data[s],o=r.indexA,a=r.indexB,u=r.normal,l=It.SubVV(i[a],i[o],e),h=It.DotVV(l,u);h<0&&(n+=h*h)}return.5*this.GetParticleMass()*n}},{key:"SetStrictContactCheck",value:function(t){this.m_def.strictContactCheck=t}},{key:"GetStrictContactCheck",value:function(){return this.m_def.strictContactCheck}},{key:"SetParticleLifetime",value:function(t,e){var i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i)for(var n=this.GetParticleCount(),s=0;s<n;++s)this.m_indexByExpirationTimeBuffer.data[s]=s;var r=e/this.m_def.lifetimeGranularity,o=r>0?this.GetQuantizedTimeElapsed()+r:r;o!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=o,this.m_expirationTimeBufferRequiresSorting=!0)}},{key:"GetParticleLifetime",value:function(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])}},{key:"SetDestructionByAge",value:function(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t}},{key:"GetDestructionByAge",value:function(){return this.m_def.destroyByAge}},{key:"GetExpirationTimeBuffer",value:function(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data}},{key:"ExpirationTimeToLifetime",value:function(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity}},{key:"GetIndexByExpirationTimeBuffer",value:function(){return this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data}},{key:"ParticleApplyLinearImpulse",value:function(t,e){this.ApplyLinearImpulse(t,t+1,e)}},{key:"ApplyLinearImpulse",value:function(t,e,i){for(var n=this.m_velocityBuffer.data,s=(e-t)*this.GetParticleMass(),r=(new It).Copy(i).SelfMul(1/s),o=t;o<e;o++)n[o].SelfAdd(r)}},{key:"ParticleApplyForce",value:function(e,i){t.IsSignificantForce(i)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[e])&&(this.PrepareForceBuffer(),this.m_forceBuffer[e].SelfAdd(i))}},{key:"ApplyForce",value:function(e,i,n){var s=(new It).Copy(n).SelfMul(1/(i-e));if(t.IsSignificantForce(s)){this.PrepareForceBuffer();for(var r=e;r<i;r++)this.m_forceBuffer[r].SelfAdd(s)}}},{key:"GetNext",value:function(){return this.m_next}},{key:"QueryAABB",value:function(e,i){if(0!==this.m_proxyBuffer.count)for(var n=this.m_proxyBuffer.count,s=fr(this.m_proxyBuffer.data,0,n,t.computeTag(this.m_inverseDiameter*i.lowerBound.x,this.m_inverseDiameter*i.lowerBound.y),Vr.CompareProxyTag),r=dr(this.m_proxyBuffer.data,s,n,t.computeTag(this.m_inverseDiameter*i.upperBound.x,this.m_inverseDiameter*i.upperBound.y),Vr.CompareTagProxy),o=this.m_positionBuffer.data,a=s;a<r;++a){var u=this.m_proxyBuffer.data[a].index,l=o[u];if(i.lowerBound.x<l.x&&l.x<i.upperBound.x&&i.lowerBound.y<l.y&&l.y<i.upperBound.y&&!e.ReportParticle(this,u))break}}},{key:"QueryShapeAABB",value:function(e,i,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.QueryShapeAABB_s_aabb,o=r;i.ComputeAABB(o,n,s),this.QueryAABB(e,o)}},{key:"QueryPointAABB",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A,s=t.QueryPointAABB_s_aabb,r=s;r.lowerBound.Set(i.x-n,i.y-n),r.upperBound.Set(i.x+n,i.y+n),this.QueryAABB(e,r)}},{key:"RayCast",value:function(e,i,n){var s=t.RayCast_s_aabb,r=t.RayCast_s_p,o=t.RayCast_s_v,a=t.RayCast_s_n,u=t.RayCast_s_point;if(0!==this.m_proxyBuffer.count){var l=this.m_positionBuffer.data,h=s;It.MinV(i,n,h.lowerBound),It.MaxV(i,n,h.upperBound);for(var _,m=1,c=It.SubVV(n,i,o),f=It.DotVV(c,c),d=this.GetInsideBoundsEnumerator(h);(_=d.GetNext())>=0;){var v=It.SubVV(i,l[_],r),y=It.DotVV(v,c),p=y*y-f*(It.DotVV(v,v)-this.m_squaredDiameter);if(p>=0){var x=pt(p),B=(-y-x)/f;if(B>m)continue;if(B<0&&((B=(-y+x)/f)<0||B>m))continue;var S=It.AddVMulSV(v,B,c,a);if(S.Normalize(),(m=_t(m,e.ReportParticle(this,_,It.AddVMulSV(i,B,c,u),S,B)))<=0)break}}}}},{key:"ComputeAABB",value:function(t){var e=this.GetParticleCount();t.lowerBound.x=+c,t.lowerBound.y=+c,t.upperBound.x=-c,t.upperBound.y=-c;for(var i=this.m_positionBuffer.data,n=0;n<e;n++){var s=i[n];It.MinV(t.lowerBound,s,t.lowerBound),It.MaxV(t.upperBound,s,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter}},{key:"FreeBuffer",value:function(t,e){null!==t&&(t.length=0)}},{key:"FreeUserOverridableBuffer",value:function(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)}},{key:"ReallocateBuffer3",value:function(t,e,i){if(i<=e)throw new Error;var n=t?t.slice():[];return n.length=i,n}},{key:"ReallocateBuffer5",value:function(t,e,i,n,s){if(n<=i)throw new Error;if(e&&!(n<=e))throw new Error;return s&&!t||e||(t=this.ReallocateBuffer3(t,i,n)),t}},{key:"ReallocateBuffer4",value:function(t,e,i,n){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,n)}},{key:"RequestBuffer",value:function(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(N),(t=[]).length=this.m_internalAllocatedCapacity),t}},{key:"ReallocateHandleBuffers",value:function(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)}},{key:"ReallocateInternalAllocatedBuffers",value:function(t){function e(t,e){return e&&t>e?e:t}if(t=e(t,this.m_def.maxCount),t=e(t,this.m_flagsBuffer.userSuppliedCapacity),t=e(t,this.m_positionBuffer.userSuppliedCapacity),t=e(t,this.m_velocityBuffer.userSuppliedCapacity),t=e(t,this.m_colorBuffer.userSuppliedCapacity),t=e(t,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);var i=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,i),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,i),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,i),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}}},{key:"CreateParticleForGroup",value:function(t,e,i){var n=new $s;n.flags=m(t.flags,0),Tt.MulXV(e,i,n.position),It.AddVV(m(t.linearVelocity,It.ZERO),It.CrossSV(m(t.angularVelocity,0),It.SubVV(n.position,m(t.position,It.ZERO),It.s_t0),It.s_t0),n.velocity),n.color.Copy(m(t.color,o.ZERO)),n.lifetime=m(t.lifetime,0),n.userData=t.userData,this.CreateParticle(n)}},{key:"CreateParticlesStrokeShapeForGroup",value:function(e,i,n){var s=t.CreateParticlesStrokeShapeForGroup_s_edge,r=t.CreateParticlesStrokeShapeForGroup_s_d,o=t.CreateParticlesStrokeShapeForGroup_s_p,a=m(i.stride,0);0===a&&(a=this.GetParticleStride());for(var u=0,l=e.GetChildCount(),h=0;h<l;h++){var _=null;e.GetType()===ze.e_edgeShape?_=e:(_=s,e.GetChildEdge(_,h));for(var c=It.SubVV(_.m_vertex2,_.m_vertex1,r),f=c.Length();u<f;){var d=It.AddVMulSV(_.m_vertex1,u/f,c,o);this.CreateParticleForGroup(i,n,d),u+=a}u-=f}}},{key:"CreateParticlesFillShapeForGroup",value:function(e,i,n){var s=t.CreateParticlesFillShapeForGroup_s_aabb,r=t.CreateParticlesFillShapeForGroup_s_p,o=m(i.stride,0);0===o&&(o=this.GetParticleStride());var a=Tt.IDENTITY,u=s;e.ComputeAABB(u,a,0);for(var l=Math.floor(u.lowerBound.y/o)*o;l<u.upperBound.y;l+=o)for(var h=Math.floor(u.lowerBound.x/o)*o;h<u.upperBound.x;h+=o){var _=r.Set(h,l);e.TestPoint(a,_)&&this.CreateParticleForGroup(i,n,_)}}},{key:"CreateParticlesWithShapeForGroup",value:function(t,e,i){switch(t.GetType()){case ze.e_edgeShape:case ze.e_chainShape:this.CreateParticlesStrokeShapeForGroup(t,e,i);break;case ze.e_polygonShape:case ze.e_circleShape:this.CreateParticlesFillShapeForGroup(t,e,i)}}},{key:"CreateParticlesWithShapesForGroup",value:function(t,e,i,n){var s=new jr(t,e);this.CreateParticlesFillShapeForGroup(s,i,n)}},{key:"CloneParticle",value:function(t,e){var i=new $s;i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;var n=this.CreateParticle(i);if(this.m_handleIndexBuffer.data){var s=this.m_handleIndexBuffer.data[t];s&&s.SetIndex(n),this.m_handleIndexBuffer.data[n]=s,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[n]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[n]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[n]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[n].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[n]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[n]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[n]=this.m_expirationTimeBuffer.data[t]),n}},{key:"DestroyParticlesInGroup",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e)}},{key:"DestroyParticleGroup",value:function(t){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(var e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount}},{key:"UpdatePairsAndTriads",value:function(e,i,n){for(var s=t.UpdatePairsAndTriads_s_dab,r=t.UpdatePairsAndTriads_s_dbc,o=t.UpdatePairsAndTriads_s_dca,a=this.m_positionBuffer.data,u=0,l=e;l<i;l++)u|=this.m_flagsBuffer.data[l];if(u&t.k_pairFlags)for(var h=0;h<this.m_contactBuffer.count;h++){var _=this.m_contactBuffer.data[h],m=_.indexA,c=_.indexB,f=this.m_flagsBuffer.data[m],d=this.m_flagsBuffer.data[c],v=this.m_groupBuffer[m],y=this.m_groupBuffer[c];if(m>=e&&m<i&&c>=e&&c<i&&!((f|d)&Ys.b2_zombieParticle)&&(f|d)&t.k_pairFlags&&(n.IsNecessary(m)||n.IsNecessary(c))&&t.ParticleCanBeConnected(f,v)&&t.ParticleCanBeConnected(d,y)&&n.ShouldCreatePair(m,c)){var p=this.m_pairBuffer.data[this.m_pairBuffer.Append()];p.indexA=m,p.indexB=c,p.flags=_.flags,p.strength=_t(v?v.m_strength:1,y?y.m_strength:1),p.distance=It.DistanceVV(a[m],a[c])}mr(this.m_pairBuffer.data,0,this.m_pairBuffer.count,t.ComparePairIndices),this.m_pairBuffer.Unique(t.MatchPairIndices)}if(u&t.k_triadFlags){for(var x=new or(i-e),B=e;B<i;B++){var S=this.m_flagsBuffer.data[B],A=this.m_groupBuffer[B];S&Ys.b2_zombieParticle||!t.ParticleCanBeConnected(S,A)||x.AddGenerator(a[B],B,n.IsNecessary(B))}var C=this.GetParticleStride();x.Generate(C/2,2*C);var b=this;x.GetNodes((function(e,i,u){var l=b.m_flagsBuffer.data[e],h=b.m_flagsBuffer.data[i],_=b.m_flagsBuffer.data[u];if((l|h|_)&t.k_triadFlags&&n.ShouldCreateTriad(e,i,u)){var m=a[e],c=a[i],f=a[u],d=It.SubVV(m,c,s),v=It.SubVV(c,f,r),y=It.SubVV(f,m,o),p=E*b.m_squaredDiameter;if(It.DotVV(d,d)>p||It.DotVV(v,v)>p||It.DotVV(y,y)>p)return;var x=b.m_groupBuffer[e],B=b.m_groupBuffer[i],S=b.m_groupBuffer[u],A=b.m_triadBuffer.data[b.m_triadBuffer.Append()];A.indexA=e,A.indexB=i,A.indexC=u,A.flags=l|h|_,A.strength=function(){return _t(_t(x?x.m_strength:1,B?B.m_strength:1),S?S.m_strength:1)};var C=(m.x+c.x+f.x)/3,g=(m.y+c.y+f.y)/3;A.pa.x=m.x-C,A.pa.y=m.y-g,A.pb.x=c.x-C,A.pb.y=c.y-g,A.pc.x=f.x-C,A.pc.y=f.y-g,A.ka=-It.DotVV(y,d),A.kb=-It.DotVV(d,v),A.kc=-It.DotVV(v,y),A.s=It.CrossVV(m,c)+It.CrossVV(c,f)+It.CrossVV(f,m)}})),mr(this.m_triadBuffer.data,0,this.m_triadBuffer.count,t.CompareTriadIndices),this.m_triadBuffer.Unique(t.MatchTriadIndices)}}},{key:"UpdatePairsAndTriadsWithReactiveParticles",value:function(){var t=new Tr(this.m_flagsBuffer);this.UpdatePairsAndTriads(0,this.m_count,t);for(var e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&=~Ys.b2_reactiveParticle;this.m_allParticleFlags&=~Ys.b2_reactiveParticle}},{key:"MergeParticleListsInContact",value:function(e,i){for(var n=e.GetBufferIndex(),s=0;s<this.m_contactBuffer.count;s++){var r=this.m_contactBuffer.data[s],o=r.indexA,a=r.indexB;if(e.ContainsParticle(o)&&e.ContainsParticle(a)){var u=i[o-n].list,l=i[a-n].list;if(u!==l){if(u.count<l.count){var h=u;u=l,l=h}t.MergeParticleLists(u,l)}}}}},{key:"MergeZombieParticleListNodes",value:function(e,i,n){for(var s=e.GetParticleCount(),r=0;r<s;r++){var o=i[r];o!==n&&this.m_flagsBuffer.data[o.index]&Ys.b2_zombieParticle&&t.MergeParticleListAndNode(n,o)}}},{key:"CreateParticleGroupsFromParticleList",value:function(t,e,i){var n=t.GetParticleCount(),s=new nr;s.groupFlags=t.GetGroupFlags(),s.userData=t.GetUserData();for(var r=0;r<n;r++){var o=e[r];if(o.count&&o!==i)for(var a=this.CreateParticleGroup(s),u=o;u;u=u.next){var l=u.index,h=this.CloneParticle(l,a);this.m_flagsBuffer.data[l]|=Ys.b2_zombieParticle,u.index=h}}}},{key:"UpdatePairsAndTriadsWithParticleList",value:function(t,e){for(var i=t.GetBufferIndex(),n=0;n<this.m_pairBuffer.count;n++){var s=this.m_pairBuffer.data[n],r=s.indexA,o=s.indexB;t.ContainsParticle(r)&&(s.indexA=e[r-i].index),t.ContainsParticle(o)&&(s.indexB=e[o-i].index)}for(var a=0;a<this.m_triadBuffer.count;a++){var u=this.m_triadBuffer.data[a],l=u.indexA,h=u.indexB,_=u.indexC;t.ContainsParticle(l)&&(u.indexA=e[l-i].index),t.ContainsParticle(h)&&(u.indexB=e[h-i].index),t.ContainsParticle(_)&&(u.indexC=e[_-i].index)}}},{key:"ComputeDepth",value:function(){for(var t=[],e=0,i=0;i<this.m_contactBuffer.count;i++){var n=this.m_contactBuffer.data[i],s=n.indexA,r=n.indexB,o=this.m_groupBuffer[s],a=this.m_groupBuffer[r];o&&o===a&&o.m_groupFlags&er.b2_particleGroupNeedsUpdateDepth&&(t[e++]=n)}for(var u=[],l=0,h=this.m_groupList;h;h=h.GetNext())if(h.m_groupFlags&er.b2_particleGroupNeedsUpdateDepth){u[l++]=h,this.SetGroupFlags(h,h.m_groupFlags&~er.b2_particleGroupNeedsUpdateDepth);for(var _=h.m_firstIndex;_<h.m_lastIndex;_++)this.m_accumulationBuffer[_]=0}for(var m=0;m<e;m++){var f=t[m],d=f.indexA,v=f.indexB,y=f.weight;this.m_accumulationBuffer[d]+=y,this.m_accumulationBuffer[v]+=y}for(var p=0;p<l;p++)for(var x=u[p],B=x.m_firstIndex;B<x.m_lastIndex;B++){var S=this.m_accumulationBuffer[B];this.m_depthBuffer[B]=S<.8?0:c}for(var A=pt(this.m_count)>>0,C=0;C<A;C++){for(var b=!1,g=0;g<e;g++){var V=t[g],w=V.indexA,k=V.indexB,M=1-V.weight,P=this.m_depthBuffer[w],I=this.m_depthBuffer[k],G=I+M,D=P+M;P>G&&(this.m_depthBuffer[w]=G,b=!0),I>D&&(this.m_depthBuffer[k]=D,b=!0)}if(!b)break}for(var F=0;F<l;F++)for(var L=u[F],R=L.m_firstIndex;R<L.m_lastIndex;R++)this.m_depthBuffer[R]<c?this.m_depthBuffer[R]*=this.m_particleDiameter:this.m_depthBuffer[R]=0}},{key:"GetInsideBoundsEnumerator",value:function(e){var i=t.computeTag(this.m_inverseDiameter*e.lowerBound.x-1,this.m_inverseDiameter*e.lowerBound.y-1),n=t.computeTag(this.m_inverseDiameter*e.upperBound.x+1,this.m_inverseDiameter*e.upperBound.y+1),s=this.m_proxyBuffer.count,r=fr(this.m_proxyBuffer.data,0,s,i,Vr.CompareProxyTag),o=dr(this.m_proxyBuffer.data,0,s,n,Vr.CompareTagProxy);return new wr(this,i,n,r,o)}},{key:"UpdateAllParticleFlags",value:function(){this.m_allParticleFlags=0;for(var t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1}},{key:"UpdateAllGroupFlags",value:function(){this.m_allGroupFlags=0;for(var t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1}},{key:"AddContact",value:function(e,i,n){var s=this.m_flagsBuffer.data,r=this.m_positionBuffer.data,o=It.SubVV(r[i],r[e],t.AddContact_s_d),a=It.DotVV(o,o);if(0<a&&a<this.m_squaredDiameter){var u=yt(a),l=this.m_contactBuffer.data[this.m_contactBuffer.Append()];l.indexA=e,l.indexB=i,l.flags=s[e]|s[i],l.weight=1-a*u*this.m_inverseDiameter,l.normal.x=u*o.x,l.normal.y=u*o.y}}},{key:"FindContacts",value:function(){var e=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(var i=0,n=0;i<e;i++){for(var s=t.computeRelativeTag(this.m_proxyBuffer.data[i].tag,1,0),r=i+1;r<e&&!(s<this.m_proxyBuffer.data[r].tag);r++)this.AddContact(this.m_proxyBuffer.data[i].index,this.m_proxyBuffer.data[r].index,this.m_contactBuffer);for(var o=t.computeRelativeTag(this.m_proxyBuffer.data[i].tag,-1,1);n<e&&!(o<=this.m_proxyBuffer.data[n].tag);n++);for(var a=t.computeRelativeTag(this.m_proxyBuffer.data[i].tag,1,1),u=n;u<e&&!(a<this.m_proxyBuffer.data[u].tag);u++)this.AddContact(this.m_proxyBuffer.data[i].index,this.m_proxyBuffer.data[u].index,this.m_contactBuffer)}}},{key:"UpdateProxies",value:function(){for(var e=this.m_positionBuffer.data,i=this.m_inverseDiameter,n=0;n<this.m_proxyBuffer.count;++n){var s=this.m_proxyBuffer.data[n],r=e[s.index];s.tag=t.computeTag(i*r.x,i*r.y)}}},{key:"SortProxies",value:function(){_r(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,Vr.CompareProxyProxy)}},{key:"FilterContacts",value:function(){var t=this.GetParticleContactFilter();if(null!==t){var e=this;this.m_contactBuffer.RemoveIf((function(i){return 0!==(i.flags&Ys.b2_particleContactFilterParticle)&&!t.ShouldCollideParticleParticle(e,i.indexA,i.indexB)}))}}},{key:"NotifyContactListenerPreContact",value:function(t,e){null!==this.GetParticleContactListener()&&(t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),e.Initialize(this.m_contactBuffer,this.m_flagsBuffer))}},{key:"NotifyContactListenerPostContact",value:function(t,e){var i=this.GetParticleContactListener();if(null!==i){for(var n=0;n<this.m_contactBuffer.count;++n){var s=this.m_contactBuffer.data[n],r=t.Find(s);r>=0?t.Invalidate(r):i.BeginContactParticleParticle(this,s)}for(var o=0;o<t.GetCount();o++)t.GetValidBuffer()[o]&&i.EndContactParticleParticle(this,t.GetBuffer()[o]);var a=new Dr(this);a.Initialize(this.m_contactBuffer,this.m_flagsBuffer);for(var u=0;u<a.GetCount();u++){var l=a.GetBuffer()[u],h=e.Find(l);h>=0?e.Invalidate(h):i.BeginContactParticleGroupParticleGroup(this,l)}for(var _=0;_<e.GetCount();_++)e.GetValidBuffer()[_]&&i.EndContactParticleGroupParticleGroup(this,e.GetBuffer()[_])}}},{key:"UpdateContacts",value:function(e){this.UpdateProxies(),this.SortProxies();var i=new Gr,n=new Dr(this);this.NotifyContactListenerPreContact(i,n),this.FindContacts(),this.FilterContacts(),this.NotifyContactListenerPostContact(i,n),e&&this.m_contactBuffer.RemoveIf(t.b2ParticleContactIsZombie)}},{key:"NotifyBodyContactListenerPreContact",value:function(t,e){null!==this.GetFixtureContactListener()&&(t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),e.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer))}},{key:"NotifyBodyContactListenerPostContact",value:function(t,e){var i=this.GetFixtureContactListener();if(null!==i){for(var n=0;n<this.m_bodyContactBuffer.count;n++){var s=this.m_bodyContactBuffer.data[n],r=t.Find(s);r>=0?t.Invalidate(r):i.BeginContactFixtureParticle(this,s)}for(var o=0;o<t.GetCount();o++)t.GetValidBuffer()[o]&&i.EndContactFixtureParticle(this,t.GetBuffer()[o]);var a=new Ir(this);a.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer);for(var u=0;u<a.GetCount();u++){var l=a.GetBuffer()[u],h=e.Find(l);h>=0?e.Invalidate(h):i.BeginContactBodyParticleGroup(this,l)}for(var _=0;_<e.GetCount();_++)e.GetValidBuffer()[_]&&i.EndContactBodyParticleGroup(this,e.GetBuffer()[_])}}},{key:"UpdateBodyContacts",value:function(){var e=new Pr,i=new Ir(this);if(this.NotifyBodyContactListenerPreContact(e,i),this.m_stuckThreshold>0)for(var n=this.GetParticleCount(),s=0;s<n;s++)this.m_bodyContactCountBuffer.data[s]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[s]+1&&(this.m_consecutiveContactStepsBuffer.data[s]=0);this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);var r=t.UpdateBodyContacts_s_aabb;this.ComputeAABB(r),null===this.UpdateBodyContacts_callback&&(this.UpdateBodyContacts_callback=new Or(this));var o=this.UpdateBodyContacts_callback;this.m_world.QueryAABB(o,r),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(e,i)}},{key:"Solve",value:function(e){if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(e),this.m_allParticleFlags&Ys.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<e.particleIterations;this.m_iterationIndex++){++this.m_timestamp;var i=t.Solve_s_subStep.Copy(e);i.dt/=e.particleIterations,i.inv_dt*=e.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&er.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&Ys.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(i),this.m_allParticleFlags&Ys.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&Ys.b2_repulsiveParticle&&this.SolveRepulsive(i),this.m_allParticleFlags&Ys.b2_powderParticle&&this.SolvePowder(i),this.m_allParticleFlags&Ys.b2_tensileParticle&&this.SolveTensile(i),this.m_allGroupFlags&er.b2_solidParticleGroup&&this.SolveSolid(i),this.m_allParticleFlags&Ys.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(i),this.m_allParticleFlags&Ys.b2_staticPressureParticle&&this.SolveStaticPressure(i),this.SolvePressure(i),this.SolveDamping(i),this.m_allParticleFlags&t.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&Ys.b2_elasticParticle&&this.SolveElastic(i),this.m_allParticleFlags&Ys.b2_springParticle&&this.SolveSpring(i),this.LimitVelocity(i),this.m_allGroupFlags&er.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&Ys.b2_barrierParticle&&this.SolveBarrier(i),this.SolveCollision(i),this.m_allGroupFlags&er.b2_rigidParticleGroup&&this.SolveRigid(i),this.m_allParticleFlags&Ys.b2_wallParticle&&this.SolveWall();for(var n=0;n<this.m_count;n++){var s=this.m_positionBuffer.data[n];s.SelfMulAdd(i.dt,this.m_velocityBuffer.data[n]);var r=this.m_positionConstraintBuffer[n];r&&It.ClampV(s,r[0],r[1],s)}this.m_positionConstraintBuffer.length=0}}},{key:"SolveCollision",value:function(e){var i=t.SolveCollision_s_aabb,n=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,r=i;r.lowerBound.x=+c,r.lowerBound.y=+c,r.upperBound.x=-c,r.upperBound.y=-c;for(var o=0;o<this.m_count;o++){var a=s[o],u=n[o],l=u.x+e.dt*a.x,h=u.y+e.dt*a.y;r.lowerBound.x=_t(r.lowerBound.x,_t(u.x,l)),r.lowerBound.y=_t(r.lowerBound.y,_t(u.y,h)),r.upperBound.x=mt(r.upperBound.x,mt(u.x,l)),r.upperBound.y=mt(r.upperBound.y,mt(u.y,h))}null===this.SolveCollision_callback&&(this.SolveCollision_callback=new qr(this,e));var _=this.SolveCollision_callback;_.m_step=e,this.m_world.QueryAABB(_,r)}},{key:"LimitVelocity",value:function(t){for(var e=this.m_velocityBuffer.data,i=this.GetCriticalVelocitySquared(t),n=0;n<this.m_count;n++){var s=e[n],r=It.DotVV(s,s);r>i&&s.SelfMul(pt(i/r))}}},{key:"SolveGravity",value:function(e){for(var i=t.SolveGravity_s_gravity,n=this.m_velocityBuffer.data,s=It.MulSV(e.dt*this.m_def.gravityScale,this.m_world.GetGravity(),i),r=0;r<this.m_count;r++)n[r].SelfAdd(s)}},{key:"SolveBarrier",value:function(e){for(var i=t.SolveBarrier_s_aabb,n=t.SolveBarrier_s_va,s=t.SolveBarrier_s_vb,r=t.SolveBarrier_s_pba,o=t.SolveBarrier_s_vba,a=t.SolveBarrier_s_vc,u=t.SolveBarrier_s_pca,l=t.SolveBarrier_s_vca,h=t.SolveBarrier_s_qba,_=t.SolveBarrier_s_qca,m=t.SolveBarrier_s_dv,c=t.SolveBarrier_s_f,f=this.m_positionBuffer.data,d=this.m_velocityBuffer.data,v=0;v<this.m_count;v++){0!==(this.m_flagsBuffer.data[v]&t.k_barrierWallFlags)&&d[v].SetZero()}for(var y=J*e.dt,p=this.GetParticleMass(),x=0;x<this.m_pairBuffer.count;x++){var B=this.m_pairBuffer.data[x];if(B.flags&Ys.b2_barrierParticle){var S=B.indexA,A=B.indexB,C=f[S],b=f[A],g=i;It.MinV(C,b,g.lowerBound),It.MaxV(C,b,g.upperBound);for(var V=this.m_groupBuffer[S],w=this.m_groupBuffer[A],k=this.GetLinearVelocity(V,S,C,n),M=this.GetLinearVelocity(w,A,b,s),P=It.SubVV(b,C,r),I=It.SubVV(M,k,o),G=this.GetInsideBoundsEnumerator(g),D=void 0;(D=G.GetNext())>=0;){var F=f[D],L=this.m_groupBuffer[D];if(V!==L&&w!==L){var R=this.GetLinearVelocity(L,D,F,a),j=It.SubVV(F,C,u),T=It.SubVV(R,k,l),O=It.CrossVV(I,T),q=It.CrossVV(P,T)-It.CrossVV(j,I),z=It.CrossVV(P,j),E=void 0,N=void 0,X=h,Z=_;if(0===O){if(0===q)continue;if(!((N=-z/q)>=0&&N<y))continue;if(It.AddVMulSV(P,N,I,X),It.AddVMulSV(j,N,T,Z),!((E=It.DotVV(X,Z)/It.DotVV(X,X))>=0&&E<=1))continue}else{var U=q*q-4*z*O;if(U<0)continue;var W=pt(U),Q=(-q-W)/(2*O),Y=(-q+W)/(2*O);if(Q>Y){var K=Q;Q=Y,Y=K}if(N=Q,It.AddVMulSV(P,N,I,X),It.AddVMulSV(j,N,T,Z),E=It.DotVV(X,Z)/It.DotVV(X,X),!(N>=0&&N<y&&E>=0&&E<=1)){if(!((N=Y)>=0&&N<y))continue;if(It.AddVMulSV(P,N,I,X),It.AddVMulSV(j,N,T,Z),!((E=It.DotVV(X,Z)/It.DotVV(X,X))>=0&&E<=1))continue}}var H=m;H.x=k.x+E*I.x-R.x,H.y=k.y+E*I.y-R.y;var $=It.MulSV(p,H,c);if(L&&this.IsRigidGroup(L)){var tt=L.GetMass(),et=L.GetInertia();tt>0&&L.m_linearVelocity.SelfMulAdd(1/tt,$),et>0&&(L.m_angularVelocity+=It.CrossVV(It.SubVV(F,L.GetCenter(),It.s_t0),$)/et)}else d[D].SelfAdd(H);this.ParticleApplyForce(D,$.SelfMul(-e.inv_dt))}}}}}},{key:"SolveStaticPressure",value:function(t){this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);for(var e=this.GetCriticalPressure(t),i=this.m_def.staticPressureStrength*e,n=O*e,s=this.m_def.staticPressureRelaxation,r=0;r<this.m_def.staticPressureIterations;r++){for(var o=0;o<this.m_count;o++)this.m_accumulationBuffer[o]=0;for(var a=0;a<this.m_contactBuffer.count;a++){var u=this.m_contactBuffer.data[a];if(u.flags&Ys.b2_staticPressureParticle){var l=u.indexA,h=u.indexB,_=u.weight;this.m_accumulationBuffer[l]+=_*this.m_staticPressureBuffer[h],this.m_accumulationBuffer[h]+=_*this.m_staticPressureBuffer[l]}}for(var m=0;m<this.m_count;m++){var c=this.m_weightBuffer[m];if(this.m_flagsBuffer.data[m]&Ys.b2_staticPressureParticle){var f=(this.m_accumulationBuffer[m]+i*(c-T))/(c+s);this.m_staticPressureBuffer[m]=ct(f,0,n)}else this.m_staticPressureBuffer[m]=0}}}},{key:"ComputeWeight",value:function(){for(var t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(var e=0;e<this.m_bodyContactBuffer.count;e++){var i=this.m_bodyContactBuffer.data[e],n=i.index,s=i.weight;this.m_weightBuffer[n]+=s}for(var r=0;r<this.m_contactBuffer.count;r++){var o=this.m_contactBuffer.data[r],a=o.indexA,u=o.indexB,l=o.weight;this.m_weightBuffer[a]+=l,this.m_weightBuffer[u]+=l}}},{key:"SolvePressure",value:function(e){for(var i=t.SolvePressure_s_f,n=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,r=this.GetCriticalPressure(e),o=this.m_def.pressureStrength*r,a=O*r,u=0;u<this.m_count;u++){var l=o*mt(0,this.m_weightBuffer[u]-T);this.m_accumulationBuffer[u]=_t(l,a)}if(this.m_allParticleFlags&t.k_noPressureFlags)for(var h=0;h<this.m_count;h++)this.m_flagsBuffer.data[h]&t.k_noPressureFlags&&(this.m_accumulationBuffer[h]=0);if(this.m_allParticleFlags&Ys.b2_staticPressureParticle)for(var _=0;_<this.m_count;_++)this.m_flagsBuffer.data[_]&Ys.b2_staticPressureParticle&&(this.m_accumulationBuffer[_]+=this.m_staticPressureBuffer[_]);for(var m=e.dt/(this.m_def.density*this.m_particleDiameter),c=this.GetParticleInvMass(),f=0;f<this.m_bodyContactBuffer.count;f++){var d=this.m_bodyContactBuffer.data[f],v=d.index,y=d.body,p=d.weight,x=d.mass,B=d.normal,S=n[v],A=this.m_accumulationBuffer[v]+o*p,C=It.MulSV(m*p*x*A,B,i);s[v].SelfMulSub(c,C),y.ApplyLinearImpulse(C,S,!0)}for(var b=0;b<this.m_contactBuffer.count;b++){var g=this.m_contactBuffer.data[b],V=g.indexA,w=g.indexB,k=g.weight,M=g.normal,P=this.m_accumulationBuffer[V]+this.m_accumulationBuffer[w],I=It.MulSV(m*k*P,M,i);s[V].SelfSub(I),s[w].SelfAdd(I)}}},{key:"SolveDamping",value:function(e){for(var i=t.SolveDamping_s_v,n=t.SolveDamping_s_f,s=this.m_positionBuffer.data,r=this.m_velocityBuffer.data,o=this.m_def.dampingStrength,a=1/this.GetCriticalVelocity(e),u=this.GetParticleInvMass(),l=0;l<this.m_bodyContactBuffer.count;l++){var h=this.m_bodyContactBuffer.data[l],_=h.index,m=h.body,c=h.weight,f=h.mass,d=h.normal,v=s[_],y=It.SubVV(m.GetLinearVelocityFromWorldPoint(v,It.s_t0),r[_],i),p=It.DotVV(y,d);if(p<0){var x=mt(o*c,_t(-a*p,.5)),B=It.MulSV(x*f*p,d,n);r[_].SelfMulAdd(u,B),m.ApplyForce(B.SelfNeg(),v,!0)}}for(var S=0;S<this.m_contactBuffer.count;S++){var A=this.m_contactBuffer.data[S],C=A.indexA,b=A.indexB,g=A.weight,V=A.normal,w=It.SubVV(r[b],r[C],i),k=It.DotVV(w,V);if(k<0){var M=mt(o*g,_t(-a*k,.5)),P=It.MulSV(M*k,V,n);r[C].SelfAdd(P),r[b].SelfSub(P)}}}},{key:"SolveRigidDamping",value:function(){for(var e=t.SolveRigidDamping_s_t0,i=t.SolveRigidDamping_s_t1,n=t.SolveRigidDamping_s_p,s=t.SolveRigidDamping_s_v,r=[0],o=[0],a=[0],u=[0],l=[0],h=[0],_=this.m_positionBuffer.data,m=this.m_def.dampingStrength,c=0;c<this.m_bodyContactBuffer.count;c++){var f=this.m_bodyContactBuffer.data[c],d=f.index,v=this.m_groupBuffer[d];if(v&&this.IsRigidGroup(v)){var y=f.body,p=f.normal,x=f.weight,B=_[d],S=It.SubVV(y.GetLinearVelocityFromWorldPoint(B,e),v.GetLinearVelocityFromWorldPoint(B,i),s),A=It.DotVV(S,p);if(A<0){this.InitDampingParameterWithRigidGroupOrParticle(r,o,a,!0,v,d,B,p),this.InitDampingParameter(u,l,h,y.GetMass(),y.GetInertia()-y.GetMass()*y.GetLocalCenter().LengthSquared(),y.GetWorldCenter(),B,p);var C=m*_t(x,1)*this.ComputeDampingImpulse(r[0],o[0],a[0],u[0],l[0],h[0],A);this.ApplyDamping(r[0],o[0],a[0],!0,v,d,C,p),y.ApplyLinearImpulse(It.MulSV(-C,p,It.s_t0),B,!0)}}}for(var b=0;b<this.m_contactBuffer.count;b++){var g=this.m_contactBuffer.data[b],V=g.indexA,w=g.indexB,k=g.normal,M=g.weight,P=this.m_groupBuffer[V],I=this.m_groupBuffer[w],G=this.IsRigidGroup(P),D=this.IsRigidGroup(I);if(P!==I&&(G||D)){var F=It.MidVV(_[V],_[w],n),L=It.SubVV(this.GetLinearVelocity(I,w,F,e),this.GetLinearVelocity(P,V,F,i),s),R=It.DotVV(L,k);if(R<0){this.InitDampingParameterWithRigidGroupOrParticle(r,o,a,G,P,V,F,k),this.InitDampingParameterWithRigidGroupOrParticle(u,l,h,D,I,w,F,k);var j=m*M*this.ComputeDampingImpulse(r[0],o[0],a[0],u[0],l[0],h[0],R);this.ApplyDamping(r[0],o[0],a[0],G,P,V,j,k),this.ApplyDamping(u[0],l[0],h[0],D,I,w,-j,k)}}}}},{key:"SolveExtraDamping",value:function(){for(var e=t.SolveExtraDamping_s_v,i=t.SolveExtraDamping_s_f,n=this.m_velocityBuffer.data,s=this.m_positionBuffer.data,r=this.GetParticleInvMass(),o=0;o<this.m_bodyContactBuffer.count;o++){var a=this.m_bodyContactBuffer.data[o],u=a.index;if(this.m_flagsBuffer.data[u]&t.k_extraDampingFlags){var l=a.body,h=a.mass,_=a.normal,m=s[u],c=It.SubVV(l.GetLinearVelocityFromWorldPoint(m,It.s_t0),n[u],e),f=It.DotVV(c,_);if(f<0){var d=It.MulSV(.5*h*f,_,i);n[u].SelfMulAdd(r,d),l.ApplyLinearImpulse(d.SelfNeg(),m,!0)}}}}},{key:"SolveWall",value:function(){for(var t=this.m_velocityBuffer.data,e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&Ys.b2_wallParticle&&t[e].SetZero()}},{key:"SolveRigid",value:function(e){for(var i=t.SolveRigid_s_position,n=t.SolveRigid_s_rotation,s=t.SolveRigid_s_transform,r=t.SolveRigid_s_velocityTransform,o=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,u=this.m_groupList;u;u=u.GetNext())if(u.m_groupFlags&er.b2_rigidParticleGroup){u.UpdateStatistics();var l=n;l.SetAngle(e.dt*u.m_angularVelocity);var h=It.AddVV(u.m_center,It.SubVV(It.MulSV(e.dt,u.m_linearVelocity,It.s_t0),jt.MulRV(l,u.m_center,It.s_t1),It.s_t0),i),_=s;_.SetPositionRotation(h,l),Tt.MulXX(_,u.m_transform,u.m_transform);var m=r;m.p.x=e.inv_dt*_.p.x,m.p.y=e.inv_dt*_.p.y,m.q.s=e.inv_dt*_.q.s,m.q.c=e.inv_dt*(_.q.c-1);for(var c=u.m_firstIndex;c<u.m_lastIndex;c++)Tt.MulXV(m,o[c],a[c])}}},{key:"SolveElastic",value:function(e){for(var i=t.SolveElastic_s_pa,n=t.SolveElastic_s_pb,s=t.SolveElastic_s_pc,r=t.SolveElastic_s_r,o=t.SolveElastic_s_t0,a=this.m_positionBuffer.data,u=this.m_velocityBuffer.data,l=e.inv_dt*this.m_def.elasticStrength,h=0;h<this.m_triadBuffer.count;h++){var _=this.m_triadBuffer.data[h];if(_.flags&Ys.b2_elasticParticle){var m=_.indexA,c=_.indexB,f=_.indexC,d=i.Copy(a[m]),v=n.Copy(a[c]),y=s.Copy(a[f]),p=u[m],x=u[c],B=u[f];d.SelfMulAdd(e.dt,p),v.SelfMulAdd(e.dt,x),y.SelfMulAdd(e.dt,B);var S=(d.x+v.x+y.x)/3,A=(d.y+v.y+y.y)/3;d.x-=S,d.y-=A,v.x-=S,v.y-=A,y.x-=S,y.y-=A;var C=_.pa,b=_.pb,g=_.pc,V=r;V.s=It.CrossVV(C,d)+It.CrossVV(b,v)+It.CrossVV(g,y),V.c=It.DotVV(C,d)+It.DotVV(b,v)+It.DotVV(g,y);var w=yt(V.s*V.s+V.c*V.c);isFinite(w)||(w=198177537e11),V.s*=w,V.c*=w;var k=l*("number"===typeof _.strength?_.strength:_.strength());jt.MulRV(V,C,o),It.SubVV(o,d,o),It.MulSV(k,o,o),p.SelfAdd(o),jt.MulRV(V,b,o),It.SubVV(o,v,o),It.MulSV(k,o,o),x.SelfAdd(o),jt.MulRV(V,g,o),It.SubVV(o,y,o),It.MulSV(k,o,o),B.SelfAdd(o)}}}},{key:"SolveSpring",value:function(e){for(var i=t.SolveSpring_s_pa,n=t.SolveSpring_s_pb,s=t.SolveSpring_s_d,r=t.SolveSpring_s_f,o=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,u=e.inv_dt*this.m_def.springStrength,l=0;l<this.m_pairBuffer.count;l++){var h=this.m_pairBuffer.data[l];if(h.flags&Ys.b2_springParticle){var _=h.indexA,m=h.indexB,c=i.Copy(o[_]),f=n.Copy(o[m]),d=a[_],v=a[m];c.SelfMulAdd(e.dt,d),f.SelfMulAdd(e.dt,v);var y=It.SubVV(f,c,s),p=h.distance,x=y.Length(),B=u*h.strength,S=It.MulSV(B*(p-x)/x,y,r);d.SelfSub(S),v.SelfAdd(S)}}}},{key:"SolveTensile",value:function(e){for(var i=t.SolveTensile_s_weightedNormal,n=t.SolveTensile_s_s,s=t.SolveTensile_s_f,r=this.m_velocityBuffer.data,o=0;o<this.m_count;o++)this.m_accumulation2Buffer[o]=new It,this.m_accumulation2Buffer[o].SetZero();for(var a=0;a<this.m_contactBuffer.count;a++){var u=this.m_contactBuffer.data[a];if(u.flags&Ys.b2_tensileParticle){var l=u.indexA,h=u.indexB,_=u.weight,m=u.normal,c=It.MulSV((1-_)*_,m,i);this.m_accumulation2Buffer[l].SelfSub(c),this.m_accumulation2Buffer[h].SelfAdd(c)}}for(var f=this.GetCriticalVelocity(e),d=this.m_def.surfaceTensionPressureStrength*f,v=this.m_def.surfaceTensionNormalStrength*f,y=q*f,p=0;p<this.m_contactBuffer.count;p++){var x=this.m_contactBuffer.data[p];if(x.flags&Ys.b2_tensileParticle){var B=x.indexA,S=x.indexB,A=x.weight,C=x.normal,b=this.m_weightBuffer[B]+this.m_weightBuffer[S],g=It.SubVV(this.m_accumulation2Buffer[S],this.m_accumulation2Buffer[B],n),V=_t(d*(b-2)+v*It.DotVV(g,C),y)*A,w=It.MulSV(V,C,s);r[B].SelfSub(w),r[S].SelfAdd(w)}}}},{key:"SolveViscous",value:function(){for(var e=t.SolveViscous_s_v,i=t.SolveViscous_s_f,n=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,r=this.m_def.viscousStrength,o=this.GetParticleInvMass(),a=0;a<this.m_bodyContactBuffer.count;a++){var u=this.m_bodyContactBuffer.data[a],l=u.index;if(this.m_flagsBuffer.data[l]&Ys.b2_viscousParticle){var h=u.body,_=u.weight,m=u.mass,c=n[l],f=It.SubVV(h.GetLinearVelocityFromWorldPoint(c,It.s_t0),s[l],e),d=It.MulSV(r*m*_,f,i);s[l].SelfMulAdd(o,d),h.ApplyLinearImpulse(d.SelfNeg(),c,!0)}}for(var v=0;v<this.m_contactBuffer.count;v++){var y=this.m_contactBuffer.data[v];if(y.flags&Ys.b2_viscousParticle){var p=y.indexA,x=y.indexB,B=y.weight,S=It.SubVV(s[x],s[p],e),A=It.MulSV(r*B,S,i);s[p].SelfAdd(A),s[x].SelfSub(A)}}}},{key:"SolveRepulsive",value:function(e){for(var i=t.SolveRepulsive_s_f,n=this.m_velocityBuffer.data,s=this.m_def.repulsiveStrength*this.GetCriticalVelocity(e),r=0;r<this.m_contactBuffer.count;r++){var o=this.m_contactBuffer.data[r];if(o.flags&Ys.b2_repulsiveParticle){var a=o.indexA,u=o.indexB;if(this.m_groupBuffer[a]!==this.m_groupBuffer[u]){var l=o.weight,h=o.normal,_=It.MulSV(s*l,h,i);n[a].SelfSub(_),n[u].SelfAdd(_)}}}}},{key:"SolvePowder",value:function(e){for(var i=t.SolvePowder_s_f,n=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,r=this.m_def.powderStrength*this.GetCriticalVelocity(e),o=1-j,a=this.GetParticleInvMass(),u=0;u<this.m_bodyContactBuffer.count;u++){var l=this.m_bodyContactBuffer.data[u],h=l.index;if(this.m_flagsBuffer.data[h]&Ys.b2_powderParticle){var _=l.weight;if(_>o){var m=l.body,c=l.mass,f=n[h],d=l.normal,v=It.MulSV(r*c*(_-o),d,i);s[h].SelfMulSub(a,v),m.ApplyLinearImpulse(v,f,!0)}}}for(var y=0;y<this.m_contactBuffer.count;y++){var p=this.m_contactBuffer.data[y];if(p.flags&Ys.b2_powderParticle){var x=p.weight;if(x>o){var B=p.indexA,S=p.indexB,A=p.normal,C=It.MulSV(r*(x-o),A,i);s[B].SelfSub(C),s[S].SelfAdd(C)}}}}},{key:"SolveSolid",value:function(e){var i=t.SolveSolid_s_f,n=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);for(var s=e.inv_dt*this.m_def.ejectionStrength,r=0;r<this.m_contactBuffer.count;r++){var o=this.m_contactBuffer.data[r],a=o.indexA,u=o.indexB;if(this.m_groupBuffer[a]!==this.m_groupBuffer[u]){var l=o.weight,h=o.normal,_=this.m_depthBuffer[a]+this.m_depthBuffer[u],m=It.MulSV(s*_*l,h,i);n[a].SelfSub(m),n[u].SelfAdd(m)}}}},{key:"SolveForce",value:function(t){for(var e=this.m_velocityBuffer.data,i=t.dt*this.GetParticleInvMass(),n=0;n<this.m_count;n++)e[n].SelfMulAdd(i,this.m_forceBuffer[n]);this.m_hasForce=!1}},{key:"SolveColorMixing",value:function(){var t=.5*this.m_def.colorMixingStrength;if(t)for(var e=0;e<this.m_contactBuffer.count;e++){var i=this.m_contactBuffer.data[e],n=i.indexA,s=i.indexB;if(this.m_flagsBuffer.data[n]&this.m_flagsBuffer.data[s]&Ys.b2_colorMixingParticle){var r=this.m_colorBuffer.data[n],a=this.m_colorBuffer.data[s];o.MixColors(r,a,t)}}}},{key:"SolveZombie",value:function(){for(var t=0,e=[],i=0;i<this.m_count;i++)e[i]=L;for(var n=0,s=0;s<this.m_count;s++){var r=this.m_flagsBuffer.data[s];if(r&Ys.b2_zombieParticle){var o=this.m_world.m_destructionListener;if(r&Ys.b2_destructionListenerParticle&&o&&o.SayGoodbyeParticle(this,s),this.m_handleIndexBuffer.data){var a=this.m_handleIndexBuffer.data[s];a&&(a.SetIndex(L),this.m_handleIndexBuffer.data[s]=null)}e[s]=L}else{if(e[s]=t,s!==t){if(this.m_handleIndexBuffer.data){var u=this.m_handleIndexBuffer.data[s];u&&u.SetIndex(t),this.m_handleIndexBuffer.data[t]=u}this.m_flagsBuffer.data[t]=this.m_flagsBuffer.data[s],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[t]=this.m_lastBodyContactStepBuffer.data[s]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[t]=this.m_bodyContactCountBuffer.data[s]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[t]=this.m_consecutiveContactStepsBuffer.data[s]),this.m_positionBuffer.data[t].Copy(this.m_positionBuffer.data[s]),this.m_velocityBuffer.data[t].Copy(this.m_velocityBuffer.data[s]),this.m_groupBuffer[t]=this.m_groupBuffer[s],this.m_hasForce&&this.m_forceBuffer[t].Copy(this.m_forceBuffer[s]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[t]=this.m_staticPressureBuffer[s]),this.m_depthBuffer&&(this.m_depthBuffer[t]=this.m_depthBuffer[s]),this.m_colorBuffer.data&&this.m_colorBuffer.data[t].Copy(this.m_colorBuffer.data[s]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[t]=this.m_userDataBuffer.data[s]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[t]=this.m_expirationTimeBuffer.data[s])}t++,n|=r}}for(var l=function(t){return t.index<0},h=function(t){return t.indexA<0||t.indexB<0},_=function(t){return t.index<0},m=function(t){return t.indexA<0||t.indexB<0},c=function(t){return t.indexA<0||t.indexB<0||t.indexC<0},f=0;f<this.m_proxyBuffer.count;f++){var d=this.m_proxyBuffer.data[f];d.index=e[d.index]}this.m_proxyBuffer.RemoveIf(l);for(var v=0;v<this.m_contactBuffer.count;v++){var y=this.m_contactBuffer.data[v];y.indexA=e[y.indexA],y.indexB=e[y.indexB]}this.m_contactBuffer.RemoveIf(h);for(var p=0;p<this.m_bodyContactBuffer.count;p++){var x=this.m_bodyContactBuffer.data[p];x.index=e[x.index]}this.m_bodyContactBuffer.RemoveIf(_);for(var B=0;B<this.m_pairBuffer.count;B++){var S=this.m_pairBuffer.data[B];S.indexA=e[S.indexA],S.indexB=e[S.indexB]}this.m_pairBuffer.RemoveIf(m);for(var A=0;A<this.m_triadBuffer.count;A++){var C=this.m_triadBuffer.data[A];C.indexA=e[C.indexA],C.indexB=e[C.indexB],C.indexC=e[C.indexC]}if(this.m_triadBuffer.RemoveIf(c),this.m_indexByExpirationTimeBuffer.data)for(var b=0,g=0;g<this.m_count;g++){var V=e[this.m_indexByExpirationTimeBuffer.data[g]];V!==L&&(this.m_indexByExpirationTimeBuffer.data[b++]=V)}for(var w=this.m_groupList;w;w=w.GetNext()){for(var k=t,M=0,P=!1,I=w.m_firstIndex;I<w.m_lastIndex;I++){var G=e[I];G>=0?(k=_t(k,G),M=mt(M,G+1)):P=!0}k<M?(w.m_firstIndex=k,w.m_lastIndex=M,P&&w.m_groupFlags&er.b2_solidParticleGroup&&this.SetGroupFlags(w,w.m_groupFlags|er.b2_particleGroupNeedsUpdateDepth)):(w.m_firstIndex=0,w.m_lastIndex=0,w.m_groupFlags&er.b2_particleGroupCanBeEmpty||this.SetGroupFlags(w,w.m_groupFlags|er.b2_particleGroupWillBeDestroyed))}this.m_count=t,this.m_allParticleFlags=n,this.m_needsUpdateAllParticleFlags=!1;for(var D=this.m_groupList;D;){var F=D.GetNext();D.m_groupFlags&er.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(D),D=F}}},{key:"SolveLifetimes",value:function(t){this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);var e=this.GetQuantizedTimeElapsed(),i=this.m_expirationTimeBuffer.data,n=this.m_indexByExpirationTimeBuffer.data,s=this.GetParticleCount();if(this.m_expirationTimeBufferRequiresSorting){_r(n,0,s,(function(t,e){var n=i[t],s=i[e],r=n<=0;return r===s<=0?n>s:r})),this.m_expirationTimeBufferRequiresSorting=!1}for(var r=s-1;r>=0;--r){var o=n[r],a=i[o];if(e<a||a<=0)break;this.DestroyParticle(o)}}},{key:"RotateBuffer",value:function(t,e,i){if(t!==e&&e!==i){if(vr(this.m_flagsBuffer.data,t,e,i),this.m_lastBodyContactStepBuffer.data&&vr(this.m_lastBodyContactStepBuffer.data,t,e,i),this.m_bodyContactCountBuffer.data&&vr(this.m_bodyContactCountBuffer.data,t,e,i),this.m_consecutiveContactStepsBuffer.data&&vr(this.m_consecutiveContactStepsBuffer.data,t,e,i),vr(this.m_positionBuffer.data,t,e,i),vr(this.m_velocityBuffer.data,t,e,i),vr(this.m_groupBuffer,t,e,i),this.m_hasForce&&vr(this.m_forceBuffer,t,e,i),this.m_staticPressureBuffer&&vr(this.m_staticPressureBuffer,t,e,i),this.m_depthBuffer&&vr(this.m_depthBuffer,t,e,i),this.m_colorBuffer.data&&vr(this.m_colorBuffer.data,t,e,i),this.m_userDataBuffer.data&&vr(this.m_userDataBuffer.data,t,e,i),this.m_handleIndexBuffer.data){vr(this.m_handleIndexBuffer.data,t,e,i);for(var n=t;n<i;++n){var s=this.m_handleIndexBuffer.data[n];s&&s.SetIndex(x(s.GetIndex()))}}if(this.m_expirationTimeBuffer.data){vr(this.m_expirationTimeBuffer.data,t,e,i);for(var r=this.GetParticleCount(),o=this.m_indexByExpirationTimeBuffer.data,a=0;a<r;++a)o[a]=x(o[a])}for(var u=0;u<this.m_proxyBuffer.count;u++){var l=this.m_proxyBuffer.data[u];l.index=x(l.index)}for(var h=0;h<this.m_contactBuffer.count;h++){var _=this.m_contactBuffer.data[h];_.indexA=x(_.indexA),_.indexB=x(_.indexB)}for(var m=0;m<this.m_bodyContactBuffer.count;m++){var c=this.m_bodyContactBuffer.data[m];c.index=x(c.index)}for(var f=0;f<this.m_pairBuffer.count;f++){var d=this.m_pairBuffer.data[f];d.indexA=x(d.indexA),d.indexB=x(d.indexB)}for(var v=0;v<this.m_triadBuffer.count;v++){var y=this.m_triadBuffer.data[v];y.indexA=x(y.indexA),y.indexB=x(y.indexB),y.indexC=x(y.indexC)}for(var p=this.m_groupList;p;p=p.GetNext())p.m_firstIndex=x(p.m_firstIndex),p.m_lastIndex=x(p.m_lastIndex-1)+1}function x(n){return n<t?n:n<e?n+i-e:n<i?n+t-e:n}}},{key:"GetCriticalVelocity",value:function(t){return this.m_particleDiameter*t.inv_dt}},{key:"GetCriticalVelocitySquared",value:function(t){var e=this.GetCriticalVelocity(t);return e*e}},{key:"GetCriticalPressure",value:function(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)}},{key:"GetParticleStride",value:function(){return j*this.m_particleDiameter}},{key:"GetParticleMass",value:function(){var t=this.GetParticleStride();return this.m_def.density*t*t}},{key:"GetParticleInvMass",value:function(){var t=this.m_inverseDiameter*(1/j);return this.m_inverseDensity*t*t}},{key:"GetFixtureContactFilter",value:function(){return this.m_allParticleFlags&Ys.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}},{key:"GetParticleContactFilter",value:function(){return this.m_allParticleFlags&Ys.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}},{key:"GetFixtureContactListener",value:function(){return this.m_allParticleFlags&Ys.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}},{key:"GetParticleContactListener",value:function(){return this.m_allParticleFlags&Ys.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}},{key:"SetUserOverridableBuffer",value:function(t,e){t.data=e,t.userSuppliedCapacity=e.length}},{key:"SetGroupFlags",value:function(t,e){var i=t.m_groupFlags;(i^e)&er.b2_solidParticleGroup&&(e|=er.b2_particleGroupNeedsUpdateDepth),i&~e&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&e&&(e&er.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=e),t.m_groupFlags=e}},{key:"RemoveSpuriousBodyContacts",value:function(){_r(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,t.BodyContactCompare);var e=t.RemoveSpuriousBodyContacts_s_n,i=t.RemoveSpuriousBodyContacts_s_pos,n=t.RemoveSpuriousBodyContacts_s_normal,s=this,r=-1,o=0;this.m_bodyContactBuffer.count=cr(this.m_bodyContactBuffer.data,(function(t){if(t.index!==r&&(o=0,r=t.index),o++>3)return!0;var a=e.Copy(t.normal);a.SelfMul(s.m_particleDiameter*(1-t.weight));var u=It.AddVV(s.m_positionBuffer.data[t.index],a,i);if(!t.fixture.TestPoint(u)){for(var l=t.fixture.GetShape().GetChildCount(),h=0;h<l;h++){var _=n;if(t.fixture.ComputeDistance(u,_,h)<A)return!1}return!0}return!1}),this.m_bodyContactBuffer.count)}},{key:"DetectStuckParticle",value:function(t){this.m_stuckThreshold<=0||(++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp)}},{key:"ValidateParticleIndex",value:function(t){return t>=0&&t<this.GetParticleCount()&&t!==L}},{key:"GetQuantizedTimeElapsed",value:function(){return Math.floor(this.m_timeElapsed/4294967296)}},{key:"LifetimeToExpirationTime",value:function(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)}},{key:"ForceCanBeApplied",value:function(t){return!(t&Ys.b2_wallParticle)}},{key:"PrepareForceBuffer",value:function(){if(!this.m_hasForce){for(var t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}}},{key:"IsRigidGroup",value:function(t){return null!==t&&0!==(t.m_groupFlags&er.b2_rigidParticleGroup)}},{key:"GetLinearVelocity",value:function(t,e,i,n){return t&&this.IsRigidGroup(t)?t.GetLinearVelocityFromWorldPoint(i,n):n.Copy(this.m_velocityBuffer.data[e])}},{key:"InitDampingParameter",value:function(t,e,i,n,s,r,o,a){t[0]=n>0?1/n:0,e[0]=s>0?1/s:0,i[0]=It.CrossVV(It.SubVV(o,r,It.s_t0),a)}},{key:"InitDampingParameterWithRigidGroupOrParticle",value:function(t,e,i,n,s,r,o,a){if(s&&n)this.InitDampingParameter(t,e,i,s.GetMass(),s.GetInertia(),s.GetCenter(),o,a);else{var u=this.m_flagsBuffer.data[r];this.InitDampingParameter(t,e,i,u&Ys.b2_wallParticle?0:this.GetParticleMass(),0,o,o,a)}}},{key:"ComputeDampingImpulse",value:function(t,e,i,n,s,r,o){var a=t+e*i*i+n+s*r*r;return a>0?o/a:0}},{key:"ApplyDamping",value:function(t,e,i,n,s,r,o,a){s&&n?(s.m_linearVelocity.SelfMulAdd(o*t,a),s.m_angularVelocity+=o*i*e):this.m_velocityBuffer.data[r].SelfMulAdd(o*t,a)}}],[{key:"computeTag",value:function(e,i){return(i+t.yOffset>>>0<<t.yShift)+(t.xScale*e+t.xOffset>>>0)>>>0}},{key:"computeRelativeTag",value:function(e,i,n){return e+(n<<t.yShift)+(i<<t.xShift)>>>0}},{key:"IsSignificantForce",value:function(t){return 0!==t.x||0!==t.y}},{key:"ParticleCanBeConnected",value:function(t,e){return 0!==(t&(Ys.b2_wallParticle|Ys.b2_springParticle|Ys.b2_elasticParticle))||null!==e&&0!==(e.GetGroupFlags()&er.b2_rigidParticleGroup)}},{key:"ComparePairIndices",value:function(t,e){var i=t.indexA-e.indexA;return 0!==i?i<0:t.indexB<e.indexB}},{key:"MatchPairIndices",value:function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB}},{key:"CompareTriadIndices",value:function(t,e){var i=t.indexA-e.indexA;if(0!==i)return i<0;var n=t.indexB-e.indexB;return 0!==n?n<0:t.indexC<e.indexC}},{key:"MatchTriadIndices",value:function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC}},{key:"InitializeParticleLists",value:function(t,e){for(var i=t.GetBufferIndex(),n=t.GetParticleCount(),s=0;s<n;s++){var r=e[s];r.list=r,r.next=null,r.count=1,r.index=s+i}}},{key:"MergeParticleLists",value:function(t,e){for(var i=e;;){i.list=t;var n=i.next;if(!n){i.next=t.next;break}i=n}t.next=e,t.count+=e.count,e.count=0}},{key:"FindLongestParticleList",value:function(t,e){for(var i=t.GetParticleCount(),n=e[0],s=0;s<i;s++){var r=e[s];n.count<r.count&&(n=r)}return n}},{key:"MergeParticleListAndNode",value:function(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0}},{key:"b2ParticleContactIsZombie",value:function(t){return(t.flags&Ys.b2_zombieParticle)===Ys.b2_zombieParticle}},{key:"BodyContactCompare",value:function(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index}}]),t}();br.xTruncBits=12,br.yTruncBits=12,br.tagBits=32,br.yOffset=1<<br.yTruncBits-1,br.yShift=br.tagBits-br.yTruncBits,br.xShift=br.tagBits-br.yTruncBits-br.xTruncBits,br.xScale=1<<br.xShift,br.xOffset=br.xScale*(1<<br.xTruncBits-1),br.yMask=(1<<br.yTruncBits)-1<<br.yShift,br.xMask=~br.yMask,br.DestroyParticlesInShape_s_aabb=new Ie,br.CreateParticleGroup_s_transform=new Tt,br.ComputeCollisionEnergy_s_v=new It,br.QueryShapeAABB_s_aabb=new Ie,br.QueryPointAABB_s_aabb=new Ie,br.RayCast_s_aabb=new Ie,br.RayCast_s_p=new It,br.RayCast_s_v=new It,br.RayCast_s_n=new It,br.RayCast_s_point=new It,br.k_pairFlags=Ys.b2_springParticle,br.k_triadFlags=Ys.b2_elasticParticle,br.k_noPressureFlags=Ys.b2_powderParticle|Ys.b2_tensileParticle,br.k_extraDampingFlags=Ys.b2_staticPressureParticle,br.k_barrierWallFlags=Ys.b2_barrierParticle|Ys.b2_wallParticle,br.CreateParticlesStrokeShapeForGroup_s_edge=new Ye,br.CreateParticlesStrokeShapeForGroup_s_d=new It,br.CreateParticlesStrokeShapeForGroup_s_p=new It,br.CreateParticlesFillShapeForGroup_s_aabb=new Ie,br.CreateParticlesFillShapeForGroup_s_p=new It,br.UpdatePairsAndTriads_s_dab=new It,br.UpdatePairsAndTriads_s_dbc=new It,br.UpdatePairsAndTriads_s_dca=new It,br.AddContact_s_d=new It,br.UpdateBodyContacts_s_aabb=new Ie,br.Solve_s_subStep=new xs,br.SolveCollision_s_aabb=new Ie,br.SolveGravity_s_gravity=new It,br.SolveBarrier_s_aabb=new Ie,br.SolveBarrier_s_va=new It,br.SolveBarrier_s_vb=new It,br.SolveBarrier_s_pba=new It,br.SolveBarrier_s_vba=new It,br.SolveBarrier_s_vc=new It,br.SolveBarrier_s_pca=new It,br.SolveBarrier_s_vca=new It,br.SolveBarrier_s_qba=new It,br.SolveBarrier_s_qca=new It,br.SolveBarrier_s_dv=new It,br.SolveBarrier_s_f=new It,br.SolvePressure_s_f=new It,br.SolveDamping_s_v=new It,br.SolveDamping_s_f=new It,br.SolveRigidDamping_s_t0=new It,br.SolveRigidDamping_s_t1=new It,br.SolveRigidDamping_s_p=new It,br.SolveRigidDamping_s_v=new It,br.SolveExtraDamping_s_v=new It,br.SolveExtraDamping_s_f=new It,br.SolveRigid_s_position=new It,br.SolveRigid_s_rotation=new jt,br.SolveRigid_s_transform=new Tt,br.SolveRigid_s_velocityTransform=new Tt,br.SolveElastic_s_pa=new It,br.SolveElastic_s_pb=new It,br.SolveElastic_s_pc=new It,br.SolveElastic_s_r=new jt,br.SolveElastic_s_t0=new It,br.SolveSpring_s_pa=new It,br.SolveSpring_s_pb=new It,br.SolveSpring_s_d=new It,br.SolveSpring_s_f=new It,br.SolveTensile_s_weightedNormal=new It,br.SolveTensile_s_s=new It,br.SolveTensile_s_f=new It,br.SolveViscous_s_v=new It,br.SolveViscous_s_f=new It,br.SolveRepulsive_s_f=new It,br.SolvePowder_s_f=new It,br.SolveSolid_s_f=new It,br.RemoveSpuriousBodyContacts_s_n=new It,br.RemoveSpuriousBodyContacts_s_pos=new It,br.RemoveSpuriousBodyContacts_s_normal=new It;var gr=function(){function t(){Object(n.a)(this,t),this._data=null,this.userSuppliedCapacity=0}return Object(r.a)(t,[{key:"data",get:function(){return this._data},set:function(t){this._data=t}}]),t}(),Vr=function(){function t(){Object(n.a)(this,t),this.index=L,this.tag=0}return Object(r.a)(t,null,[{key:"CompareProxyProxy",value:function(t,e){return t.tag<e.tag}},{key:"CompareTagProxy",value:function(t,e){return t<e.tag}},{key:"CompareProxyTag",value:function(t,e){return t.tag<e}}]),t}(),wr=function(){function t(e,i,s,r,o){Object(n.a)(this,t),this.m_system=e,this.m_xLower=(i&br.xMask)>>>0,this.m_xUpper=(s&br.xMask)>>>0,this.m_yLower=(i&br.yMask)>>>0,this.m_yUpper=(s&br.yMask)>>>0,this.m_first=r,this.m_last=o}return Object(r.a)(t,[{key:"GetNext",value:function(){for(;this.m_first<this.m_last;){var t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&br.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return L}}]),t}(),kr=function t(){Object(n.a)(this,t),this.next=null,this.count=0,this.index=0},Mr=function(){function t(){Object(n.a)(this,t),this.data=[],this.valid=[],this.count=0}return Object(r.a)(t,[{key:"Clear",value:function(){this.data.length=0,this.valid.length=0,this.count=0}},{key:"GetCount",value:function(){return this.count}},{key:"Invalidate",value:function(t){this.valid[t]=!1}},{key:"GetValidBuffer",value:function(){return this.valid}},{key:"GetBuffer",value:function(){return this.data}},{key:"SetCount",value:function(t){this.count=t}},{key:"Append",value:function(t){this.data[this.count]=t,this.valid[this.count]=!0,this.count++}}]),t}(),Pr=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){return Object(n.a)(this,i),e.apply(this,arguments)}return Object(r.a)(i,[{key:"Initialize",value:function(t,e){this.Clear();for(var i=0;i<t.count;i++){var n=t.data[i];e.data[n.index]&Ys.b2_fixtureContactListenerParticle&&this.Append(n.Clone())}}},{key:"Find",value:function(t){for(var e=0;e<this.GetCount();e++)if(this.data[e].fixture===t.fixture&&this.data[e].index===t.index)return e;return L}}]),i}(Mr),Ir=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s;return Object(n.a)(this,i),(s=e.call(this)).particleSystem=t,s}return Object(r.a)(i,[{key:"Initialize",value:function(t,e){this.Clear();for(var i=0;i<t.count;i++){var n=t.data[i];if(e.data[n.index]&Ys.b2_fixtureContactListenerParticle)this.particleSystem.m_groupBuffer[n.index]&&this.Find(n)===L&&this.Append(n.Clone())}}},{key:"Find",value:function(t){if(!this.data.length)return L;for(var e=this.particleSystem.m_groupBuffer[t.index],i=0;i<this.data.length;i++){var n=this.particleSystem.m_groupBuffer[this.data[i].index];if(this.data[i].body.m_id===t.body.m_id&&(null===e||void 0===e?void 0:e.id)===(null===n||void 0===n?void 0:n.id))return i}return L}}]),i}(Mr),Gr=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){return Object(n.a)(this,i),e.apply(this,arguments)}return Object(r.a)(i,[{key:"Initialize",value:function(t,e){this.Clear();for(var i=0;i<t.count;i++){var n=t.data[i];(e.data[n.indexA]&Ys.b2_particleContactListenerParticle||e.data[n.indexB]&Ys.b2_particleContactListenerParticle)&&(this.Find(n)||this.Append(n.Clone()))}}},{key:"Find",value:function(t){for(var e=0;e<this.GetCount();e++)if(this.data[e].indexA===t.indexA&&this.data[e].indexB===t.indexB)return e;return L}}]),i}(Mr),Dr=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s;return Object(n.a)(this,i),(s=e.call(this)).particleSystem=t,s}return Object(r.a)(i,[{key:"Initialize",value:function(t,e){this.Clear();for(var i=0;i<t.count;i++){var n=t.data[i];if(e.data[n.indexA]&Ys.b2_particleContactListenerParticle||e.data[n.indexB]&Ys.b2_particleContactListenerParticle){var s=this.particleSystem.m_groupBuffer[n.indexA],r=this.particleSystem.m_groupBuffer[n.indexB];s&&r&&s!==r&&this.Find(n)===L&&this.Append(n.Clone())}}}},{key:"Find",value:function(t){for(var e=this.particleSystem.m_groupBuffer[t.indexA],i=this.particleSystem.m_groupBuffer[t.indexB],n=0;n<this.data.length;n++){var s=this.particleSystem.m_groupBuffer[this.data[n].indexA],r=this.particleSystem.m_groupBuffer[this.data[n].indexB];if(e===s&&i===r||e===r&&i===s)return n}return L}}]),i}(Mr),Fr=function(){function t(){Object(n.a)(this,t)}return Object(r.a)(t,[{key:"IsNecessary",value:function(t){return!0}},{key:"ShouldCreatePair",value:function(t,e){return!0}},{key:"ShouldCreateTriad",value:function(t,e,i){return!0}}]),t}(),Lr=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t,s,r,o){var a;return Object(n.a)(this,i),(a=e.call(this)).m_callDestructionListener=!1,a.m_destroyed=0,a.m_system=t,a.m_shape=s,a.m_xf=r,a.m_callDestructionListener=o,a.m_destroyed=0,a}return Object(r.a)(i,[{key:"ReportFixture",value:function(t){return!1}},{key:"ReportParticle",value:function(t,e){return t===this.m_system&&(this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0)}},{key:"Destroyed",value:function(){return this.m_destroyed}}]),i}(ds),Rr=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s;return Object(n.a)(this,i),(s=e.call(this)).m_threshold=0,s.m_threshold=t,s}return Object(r.a)(i,[{key:"ShouldCreatePair",value:function(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t}},{key:"ShouldCreateTriad",value:function(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i)}}]),i}(Fr),jr=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length;return Object(n.a)(this,i),(s=e.call(this,ze.e_unknown,0)).m_shapeCount=0,s.m_shapes=t,s.m_shapeCount=r,s}return Object(r.a)(i,[{key:"Clone",value:function(){throw new Error}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){for(var i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1}},{key:"ComputeDistance",value:function(t,e,i,n){return 0}},{key:"RayCast",value:function(t,e,i,n){return!1}},{key:"ComputeAABB",value:function(t,e,i){var n=new Ie;t.lowerBound.x=+c,t.lowerBound.y=+c,t.upperBound.x=-c,t.upperBound.y=-c;for(var s=0;s<this.m_shapeCount;s++)for(var r=this.m_shapes[s].GetChildCount(),o=0;o<r;o++){var a=n;this.m_shapes[s].ComputeAABB(a,e,o),t.Combine1(a)}}},{key:"ComputeMass",value:function(t,e){}},{key:"SetupDistanceProxy",value:function(t,e){}},{key:"ComputeSubmergedArea",value:function(t,e,i,n){return 0}},{key:"Dump",value:function(t){}}]),i}(Qe),Tr=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){var s;return Object(n.a)(this,i),(s=e.call(this)).m_flagsBuffer=t,s}return Object(r.a)(i,[{key:"IsNecessary",value:function(t){return 0!==(this.m_flagsBuffer.data[t]&Ys.b2_reactiveParticle)}}]),i}(Fr),Or=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t){return Object(n.a)(this,i),e.call(this,t)}return Object(r.a)(i,[{key:"ReportFixtureAndParticle",value:function(t,e,n){var s=i.ReportFixtureAndParticle_s_n,r=i.ReportFixtureAndParticle_s_rp,o=this.m_system.m_positionBuffer.data[n],a=s,u=t.ComputeDistance(o,a,e);if(u<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(t,n)){var l=t.GetBody(),h=l.GetWorldCenter(),_=l.GetMass(),m=l.GetInertia()-_*l.GetLocalCenter().LengthSquared(),c=_>0?1/_:0,f=m>0?1/m:0,d=this.m_system.m_flagsBuffer.data[n]&Ys.b2_wallParticle?0:this.m_system.GetParticleInvMass(),v=It.SubVV(o,h,r),y=It.CrossVV(v,a),p=d+c+f*y*y,x=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];x.index=n,x.body=l,x.fixture=t,x.weight=1-u*this.m_system.m_inverseDiameter,x.normal.Copy(a.SelfNeg()),x.mass=p>0?1/p:0,this.m_system.DetectStuckParticle(n)}}}]),i}(pr);Or.ReportFixtureAndParticle_s_n=new It,Or.ReportFixtureAndParticle_s_rp=new It;var qr=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(t,s){var r;return Object(n.a)(this,i),(r=e.call(this,t)).m_step=s,r}return Object(r.a)(i,[{key:"ReportFixtureAndParticle",value:function(t,e,n){var s=i.ReportFixtureAndParticle_s_p1,r=i.ReportFixtureAndParticle_s_output,o=i.ReportFixtureAndParticle_s_input,a=i.ReportFixtureAndParticle_s_p,u=i.ReportFixtureAndParticle_s_v,l=i.ReportFixtureAndParticle_s_f,h=t.GetBody(),_=this.m_system.m_positionBuffer.data[n],m=this.m_system.m_velocityBuffer.data[n],c=r,f=o;if(0===this.m_system.m_iterationIndex){var d=Tt.MulTXV(h.m_xf0,_,s);t.GetShape().GetType()===ze.e_circleShape&&(d.SelfSub(h.GetLocalCenter()),jt.MulRV(h.m_xf0.q,d,d),jt.MulTRV(h.m_xf.q,d,d),d.SelfAdd(h.GetLocalCenter())),Tt.MulXV(h.m_xf,d,f.p1)}else f.p1.Copy(_);if(It.AddVMulSV(_,this.m_step.dt,m,f.p2),f.maxFraction=1,this.ShouldCollideFixtureParticle(t,e)&&t.RayCast(c,f,e)){var v=c.normal,y=a;y.x=(1-c.fraction)*f.p1.x+c.fraction*f.p2.x+A*v.x,y.y=(1-c.fraction)*f.p1.y+c.fraction*f.p2.y+A*v.y;var p=u;p.x=this.m_step.inv_dt*(y.x-_.x),p.y=this.m_step.inv_dt*(y.y-_.y),this.m_system.m_velocityBuffer.data[n].Copy(p);var x=l;x.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(m.x-p.x),x.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(m.y-p.y),this.m_system.ParticleApplyForce(n,x)}}},{key:"ReportParticle",value:function(t,e){return!1}}]),i}(pr);qr.ReportFixtureAndParticle_s_p1=new It,qr.ReportFixtureAndParticle_s_output=new Pe,qr.ReportFixtureAndParticle_s_input=new Me,qr.ReportFixtureAndParticle_s_p=new It,qr.ReportFixtureAndParticle_s_v=new It,qr.ReportFixtureAndParticle_s_f=new It;var zr,Er,Nr=function(){function t(e){Object(n.a)(this,t),this.m_contactManager=new ys,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new It,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_newContacts=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new ps,this.m_island=new Rs,this.s_stack=[],this.m_controllerList=null,this.m_controllerCount=0,this.m_gravity.Copy(e)}return Object(r.a)(t,[{key:"SetDestructionListener",value:function(t){this.m_destructionListener=t}},{key:"SetContactFilter",value:function(t){this.m_contactManager.m_contactFilter=t}},{key:"SetContactListener",value:function(t){this.m_contactManager.m_contactListener=t}},{key:"SetDebugDraw",value:function(t){this.m_debugDraw=t}},{key:"CreateBody",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qn;if(this.IsLocked())throw new Error;var e=new Yn(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}},{key:"DestroyBody",value:function(t){if(this.IsLocked())throw new Error;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var n=t.m_controllerList;n;){var s=n;n=n.nextController,s.controller.RemoveBody(t)}for(var r=t.m_contactList;r;){var o=r;r=r.next,this.m_contactManager.Destroy(o.contact)}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var u=a;a=a.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(u),u.DestroyProxies(),u.Reset(),t.m_fixtureList=a,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},{key:"CreateJoint",value:function(e){if(this.IsLocked())throw new Error;var i=t._Joint_Create(e);i.m_prev=null,i.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=i),this.m_jointList=i,++this.m_jointCount,i.m_edgeA.prev=null,i.m_edgeA.next=i.m_bodyA.m_jointList,i.m_bodyA.m_jointList&&(i.m_bodyA.m_jointList.prev=i.m_edgeA),i.m_bodyA.m_jointList=i.m_edgeA,i.m_edgeB.prev=null,i.m_edgeB.next=i.m_bodyB.m_jointList,i.m_bodyB.m_jointList&&(i.m_bodyB.m_jointList.prev=i.m_edgeB),i.m_bodyB.m_jointList=i.m_edgeB;var n=i.m_bodyA,s=i.m_bodyB;if(!i.m_collideConnected)for(var r=s.GetContactList();r;)r.other===n&&r.contact.FlagForFiltering(),r=r.next;return i}},{key:"DestroyJoint",value:function(e){if(this.IsLocked())throw new Error;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e===this.m_jointList&&(this.m_jointList=e.m_next);var i=e.m_bodyA,n=e.m_bodyB,s=e.m_collideConnected;if(i.SetAwake(!0),n.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA===i.m_jointList&&(i.m_jointList=e.m_edgeA.next),e.m_edgeA.Reset(),e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB===n.m_jointList&&(n.m_jointList=e.m_edgeB.next),e.m_edgeB.Reset(),t._Joint_Destroy(e),--this.m_jointCount,!s)for(var r=n.GetContactList();r;)r.other===i&&r.contact.FlagForFiltering(),r=r.next}},{key:"CreateParticleSystem",value:function(t){if(this.IsLocked())throw new Error;var e=new br(t,this);return e.m_prev=null,e.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=e),this.m_particleSystemList=e,e}},{key:"DestroyParticleSystem",value:function(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next)}},{key:"CalculateReasonableParticleIterations",value:function(t){if(null===this.m_particleSystemList)return 1;return tr(this.m_gravity.Length(),function(t){for(var e=c,i=t.GetParticleSystemList();null!==i;i=i.m_next)e=_t(e,i.GetRadius());return e}(this),t)}},{key:"Step",value:function(e,i,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.CalculateReasonableParticleIterations(e),r=t.Step_s_stepTimer.Reset();this.m_newContacts&&(this.m_contactManager.FindNewContacts(),this.m_newContacts=!1),this.m_locked=!0;var o=t.Step_s_step;o.dt=e,o.velocityIterations=i,o.positionIterations=n,o.particleIterations=s,o.inv_dt=e>0?1/e:0,o.dtRatio=this.m_inv_dt0*e,o.warmStarting=this.m_warmStarting;var a=t.Step_s_timer.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=a.GetMilliseconds(),this.m_stepComplete&&o.dt>0){for(var u=t.Step_s_timer.Reset(),l=this.m_particleSystemList;l;l=l.m_next)l.Solve(o);this.Solve(o),this.m_profile.solve=u.GetMilliseconds()}if(this.m_continuousPhysics&&o.dt>0){var h=t.Step_s_timer.Reset();this.SolveTOI(o),this.m_profile.solveTOI=h.GetMilliseconds()}o.dt>0&&(this.m_inv_dt0=o.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=r.GetMilliseconds()}},{key:"ClearForces",value:function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0}},{key:"DrawParticleSystem",value:function(t){if(null!==this.m_debugDraw){var e=t.GetParticleCount();if(e){var i=t.GetRadius(),n=t.GetPositionBuffer(),s=null;t.m_colorBuffer.data&&(s=t.GetColorBuffer());var r=t.GetTriads().map((function(t){return[t.indexA,t.indexB,t.indexC]})),o=this.m_debugDraw.GetFlags();o&a.e_particleBit&&this.m_debugDraw.DrawParticles(n,i,s,e),o&a.e_particleTriadBit&&this.m_debugDraw.DrawParticleTriads(n,r,null)}}}},{key:"DebugDraw",value:function(){if(null!==this.m_debugDraw){var e=this.m_debugDraw.GetFlags(),i=t.DebugDraw_s_color.SetRGB(0,0,0);if(e&a.e_shapeBit)for(var n=this.m_bodyList;n;n=n.m_next){var s=n.m_xf;this.m_debugDraw.PushTransform(s);for(var r=n.GetFixtureList();r;r=r.m_next)n.GetType()===Un.b2_dynamicBody&&0===n.m_mass?this.DrawShape(r,new o(1,0,0)):n.IsEnabled()?n.GetType()===Un.b2_staticBody?(i.SetRGB(.5,.9,.5),this.DrawShape(r,i)):n.GetType()===Un.b2_kinematicBody?(i.SetRGB(.5,.5,.9),this.DrawShape(r,i)):n.IsAwake()?(i.SetRGB(.9,.7,.7),this.DrawShape(r,i)):(i.SetRGB(.6,.6,.6),this.DrawShape(r,i)):(i.SetRGB(.5,.5,.3),this.DrawShape(r,i));this.m_debugDraw.PopTransform(s)}if(e&a.e_particleBit||e&a.e_particleTriadBit){this.m_debugDraw.PushTransform(Tt.IDENTITY);for(var u=this.m_particleSystemList;u;u=u.m_next)this.DrawParticleSystem(u);this.m_debugDraw.PopTransform(Tt.IDENTITY)}if(e&a.e_jointBit)for(var l=this.m_jointList;l;l=l.m_next)l.Draw(this.m_debugDraw);if(e&a.e_pairBit){i.SetRGB(.3,.9,.9);for(var h=this.m_contactManager.m_contactList;h;h=h.m_next){var _=h.GetFixtureA(),m=h.GetFixtureB(),c=h.GetChildIndexA(),f=h.GetChildIndexB(),d=_.GetAABB(c).GetCenter(),v=m.GetAABB(f).GetCenter();this.m_debugDraw.DrawSegment(d,v,i)}}if(e&a.e_aabbBit){i.SetRGB(.9,.3,.9);for(var y=t.DebugDraw_s_vs,p=this.m_bodyList;p;p=p.m_next)if(p.IsEnabled())for(var x=p.GetFixtureList();x;x=x.m_next)for(var B=0;B<x.m_proxyCount;++B){var S=x.m_proxies[B].treeNode.aabb;y[0].Set(S.lowerBound.x,S.lowerBound.y),y[1].Set(S.upperBound.x,S.lowerBound.y),y[2].Set(S.upperBound.x,S.upperBound.y),y[3].Set(S.lowerBound.x,S.upperBound.y),this.m_debugDraw.DrawPolygon(y,4,i)}}if(e&a.e_centerOfMassBit)for(var A=this.m_bodyList;A;A=A.m_next){var C=t.DebugDraw_s_xf;C.q.Copy(A.m_xf.q),C.p.Copy(A.GetWorldCenter()),this.m_debugDraw.DrawTransform(C)}if(e&a.e_controllerBit)for(var b=this.m_controllerList;b;b=b.m_next)b.Draw(this.m_debugDraw)}}},{key:"QueryAABB",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof ds?this._QueryAABB(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryAABB(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"_QueryAABB",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.Query(e,(function(e){var n=e.userData.fixture;return t?t.ReportFixture(n):!i||i(n)})),t instanceof ds)for(var n=this.m_particleSystemList;n;n=n.m_next)t.ShouldQueryParticleSystem(n)&&n.QueryAABB(t,e)}},{key:"QueryAllAABB",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryAABB(t,(function(t){return e.push(t),!0})),e}},{key:"QueryPointAABB",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof ds?this._QueryPointAABB(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryPointAABB(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"_QueryPointAABB",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(e){var n=e.userData.fixture;return t?t.ReportFixture(n):!i||i(n)})),t instanceof ds)for(var n=this.m_particleSystemList;n;n=n.m_next)t.ShouldQueryParticleSystem(n)&&n.QueryPointAABB(t,e)}},{key:"QueryAllPointAABB",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryPointAABB(t,(function(t){return e.push(t),!0})),e}},{key:"QueryFixtureShape",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof ds?this._QueryFixtureShape(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3]):this._QueryFixtureShape(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3])}},{key:"_QueryFixtureShape",value:function(e,i,n,s,r){var o=t.QueryFixtureShape_s_aabb;if(i.ComputeAABB(o,s,n),this.m_contactManager.m_broadPhase.Query(o,(function(t){var o=t.userData,a=o.fixture;if(je(i,n,a.GetShape(),o.childIndex,s,a.GetBody().GetTransform())){if(e)return e.ReportFixture(a);if(r)return r(a)}return!0})),e instanceof ds)for(var a=this.m_particleSystemList;a;a=a.m_next)e.ShouldQueryParticleSystem(a)&&a.QueryAABB(e,o)}},{key:"QueryAllFixtureShape",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return this.QueryFixtureShape(t,e,i,(function(t){return n.push(t),!0})),n}},{key:"QueryFixturePoint",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof ds?this._QueryFixturePoint(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryFixturePoint(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"_QueryFixturePoint",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(n){var s=n.userData.fixture;if(s.TestPoint(e)){if(t)return t.ReportFixture(s);if(i)return i(s)}return!0})),t)for(var n=this.m_particleSystemList;n;n=n.m_next)t.ShouldQueryParticleSystem(n)&&n.QueryPointAABB(t,e)}},{key:"QueryAllFixturePoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryFixturePoint(t,(function(t){return e.push(t),!0})),e}},{key:"RayCast",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof vs?this._RayCast(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]):this._RayCast(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}},{key:"_RayCast",value:function(e,i,n,s){var r=t.RayCast_s_input;if(r.maxFraction=1,r.p1.Copy(i),r.p2.Copy(n),this.m_contactManager.m_broadPhase.RayCast(r,(function(r,o){var a=o.userData,u=a.fixture,l=a.childIndex,h=t.RayCast_s_output;if(u.RayCast(h,r,l)){var _=h.fraction,m=t.RayCast_s_point;if(m.Set((1-_)*i.x+_*n.x,(1-_)*i.y+_*n.y),e)return e.ReportFixture(u,m,h.normal,_);if(s)return s(u,m,h.normal,_)}return r.maxFraction})),e)for(var o=this.m_particleSystemList;o;o=o.m_next)e.ShouldQueryParticleSystem(o)&&o.RayCast(e,i,n)}},{key:"RayCastOne",value:function(t,e){var i=null,n=1;return this.RayCast(t,e,(function(t,e,s,r){return r<n&&(n=r,i=t),n})),i}},{key:"RayCastAll",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.RayCast(t,e,(function(t,e,n,s){return i.push(t),1})),i}},{key:"GetBodyList",value:function(){return this.m_bodyList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetParticleSystemList",value:function(){return this.m_particleSystemList}},{key:"GetContactList",value:function(){return this.m_contactManager.m_contactList}},{key:"SetAllowSleeping",value:function(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)}},{key:"GetAllowSleeping",value:function(){return this.m_allowSleep}},{key:"SetWarmStarting",value:function(t){this.m_warmStarting=t}},{key:"GetWarmStarting",value:function(){return this.m_warmStarting}},{key:"SetContinuousPhysics",value:function(t){this.m_continuousPhysics=t}},{key:"GetContinuousPhysics",value:function(){return this.m_continuousPhysics}},{key:"SetSubStepping",value:function(t){this.m_subStepping=t}},{key:"GetSubStepping",value:function(){return this.m_subStepping}},{key:"GetProxyCount",value:function(){return this.m_contactManager.m_broadPhase.GetProxyCount()}},{key:"GetBodyCount",value:function(){return this.m_bodyCount}},{key:"GetJointCount",value:function(){return this.m_jointCount}},{key:"GetContactCount",value:function(){return this.m_contactManager.m_contactCount}},{key:"GetTreeHeight",value:function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}},{key:"GetTreeBalance",value:function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}},{key:"GetTreeQuality",value:function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}},{key:"SetGravity",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!It.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(var i=this.m_bodyList;i;i=i.m_next)i.SetAwake(!0)}},{key:"GetGravity",value:function(){return this.m_gravity}},{key:"IsLocked",value:function(){return this.m_locked}},{key:"SetAutoClearForces",value:function(t){this.m_clearForces=t}},{key:"GetAutoClearForces",value:function(){return this.m_clearForces}},{key:"ShiftOrigin",value:function(t){if(this.IsLocked())throw new Error;for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}},{key:"GetContactManager",value:function(){return this.m_contactManager}},{key:"GetProfile",value:function(){return this.m_profile}},{key:"Dump",value:function(t){if(!this.m_locked){t("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),t("this.m_world.SetGravity(g);\n"),t("const bodies: b2Body[] = [];\n"),t("const joints: b2Joint[] = [];\n");for(var e=0,i=this.m_bodyList;i;i=i.m_next)i.m_islandIndex=e,i.Dump(t),++e;e=0;for(var n=this.m_jointList;n;n=n.m_next)n.m_index=e,++e;for(var s=this.m_jointList;s;s=s.m_next)s.m_type!==Sn.e_gearJoint&&(t("{\n"),s.Dump(t),t("}\n"));for(var r=this.m_jointList;r;r=r.m_next)r.m_type===Sn.e_gearJoint&&(t("{\n"),r.Dump(t),t("}\n"))}}},{key:"DrawShape",value:function(t,e){if(null!==this.m_debugDraw){var i=t.GetShape();switch(i.m_type){case ze.e_circleShape:var n=i,s=n.m_p,r=n.m_radius,o=It.UNITX;this.m_debugDraw.DrawSolidCircle(s,r,o,e);break;case ze.e_edgeShape:var a=i,u=a.m_vertex1,l=a.m_vertex2;this.m_debugDraw.DrawSegment(u,l,e),!1===a.m_oneSided&&(this.m_debugDraw.DrawPoint(u,4,e),this.m_debugDraw.DrawPoint(l,4,e));break;case ze.e_chainShape:for(var h=i,_=h.m_count,m=h.m_vertices,c=m[0],f=1;f<_;++f){var d=m[f];this.m_debugDraw.DrawSegment(c,d,e),c=d}break;case ze.e_polygonShape:var v=i,y=v.m_count,p=v.m_vertices;this.m_debugDraw.DrawSolidPolygon(p,y,e)}}}},{key:"Solve",value:function(t){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf0.Copy(e.m_xf);for(var i=this.m_controllerList;i;i=i.m_next)i.Step(t);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var n=this.m_island;n.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,this.m_contactManager.m_contactListener);for(var s=this.m_bodyList;s;s=s.m_next)s.m_islandFlag=!1;for(var r=this.m_contactManager.m_contactList;r;r=r.m_next)r.m_islandFlag=!1;for(var o=this.m_jointList;o;o=o.m_next)o.m_islandFlag=!1;for(var a=this.s_stack,u=this.m_bodyList;u;u=u.m_next)if(!u.m_islandFlag&&u.IsAwake()&&u.IsEnabled()&&u.GetType()!==Un.b2_staticBody){n.Clear();var l=0;for(a[l++]=u,u.m_islandFlag=!0;l>0;){var h=a[--l];if(!h)throw new Error;if(n.AddBody(h),h.GetType()!==Un.b2_staticBody){h.m_awakeFlag=!0;for(var _=h.m_contactList;_;_=_.next){var m=_.contact;if(!m.m_islandFlag&&(m.IsEnabled()&&m.IsTouching())){var c=m.m_fixtureA.m_isSensor,f=m.m_fixtureB.m_isSensor;if(!c&&!f){n.AddContact(m),m.m_islandFlag=!0;var d=_.other;d.m_islandFlag||(a[l++]=d,d.m_islandFlag=!0)}}}for(var v=h.m_jointList;v;v=v.next)if(!v.joint.m_islandFlag){var y=v.other;y.IsEnabled()&&(n.AddJoint(v.joint),v.joint.m_islandFlag=!0,y.m_islandFlag||(a[l++]=y,y.m_islandFlag=!0))}}}var p=new ps;n.Solve(p,t,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=p.solveInit,this.m_profile.solveVelocity+=p.solveVelocity,this.m_profile.solvePosition+=p.solvePosition;for(var x=0;x<n.m_bodyCount;++x){var B=n.m_bodies[x];B.GetType()===Un.b2_staticBody&&(B.m_islandFlag=!1)}}for(var S=0;S<a.length&&a[S];++S)a[S]=null;for(var A=new zt,C=this.m_bodyList;C;C=C.m_next)C.m_islandFlag&&C.GetType()!==Un.b2_staticBody&&C.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=A.GetMilliseconds()}},{key:"SolveTOI",value:function(e){var i=this.m_island;if(i.Initialize(2*V,V,0,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var n=this.m_bodyList;n;n=n.m_next)n.m_islandFlag=!1,n.m_sweep.alpha0=0;for(var s=this.m_contactManager.m_contactList;s;s=s.m_next)s.m_toiFlag=!1,s.m_islandFlag=!1,s.m_toiCount=0,s.m_toi=1}for(;;){for(var r=null,o=1,a=this.m_contactManager.m_contactList;a;a=a.m_next)if(a.IsEnabled()&&!(a.m_toiCount>g)){var u=1;if(a.m_toiFlag)u=a.m_toi;else{var l=a.GetFixtureA(),h=a.GetFixtureB();if(l.IsSensor()||h.IsSensor())continue;var _=l.GetBody(),m=h.GetBody(),c=_.m_type,d=m.m_type,v=_.IsAwake()&&c!==Un.b2_staticBody,y=m.IsAwake()&&d!==Un.b2_staticBody;if(!v&&!y)continue;var p=_.IsBullet()||c!==Un.b2_dynamicBody,x=m.IsBullet()||d!==Un.b2_dynamicBody;if(!p&&!x)continue;var B=_.m_sweep.alpha0;_.m_sweep.alpha0<m.m_sweep.alpha0?(B=m.m_sweep.alpha0,_.m_sweep.Advance(B)):m.m_sweep.alpha0<_.m_sweep.alpha0&&(B=_.m_sweep.alpha0,m.m_sweep.Advance(B));var S=a.GetChildIndexA(),A=a.GetChildIndexB(),C=t.SolveTOI_s_toi_input;C.proxyA.SetShape(l.GetShape(),S),C.proxyB.SetShape(h.GetShape(),A),C.sweepA.Copy(_.m_sweep),C.sweepB.Copy(m.m_sweep),C.tMax=1;var b=t.SolveTOI_s_toi_output;Gn(b,C);var w=b.t;u=b.state===hn.e_touching?_t(B+(1-B)*w,1):1,a.m_toi=u,a.m_toiFlag=!0}u<o&&(r=a,o=u)}if(null===r||1-10*f<o){this.m_stepComplete=!0;break}var k=r.GetFixtureA(),M=r.GetFixtureB(),P=k.GetBody(),I=M.GetBody(),G=t.SolveTOI_s_backup1.Copy(P.m_sweep),D=t.SolveTOI_s_backup2.Copy(I.m_sweep);if(P.Advance(o),I.Advance(o),r.Update(this.m_contactManager.m_contactListener),r.m_toiFlag=!1,++r.m_toiCount,r.IsEnabled()&&r.IsTouching()){P.SetAwake(!0),I.SetAwake(!0),i.Clear(),i.AddBody(P),i.AddBody(I),i.AddContact(r),P.m_islandFlag=!0,I.m_islandFlag=!0,r.m_islandFlag=!0;for(var F=0;F<2;++F){var L=0===F?P:I;if(L.m_type===Un.b2_dynamicBody)for(var R=L.m_contactList;R&&i.m_bodyCount!==i.m_bodyCapacity&&i.m_contactCount!==i.m_contactCapacity;R=R.next){var j=R.contact;if(!j.m_islandFlag){var T=R.other;if(T.m_type!==Un.b2_dynamicBody||L.IsBullet()||T.IsBullet()){var O=j.m_fixtureA.m_isSensor,q=j.m_fixtureB.m_isSensor;if(!O&&!q){var z=t.SolveTOI_s_backup.Copy(T.m_sweep);T.m_islandFlag||T.Advance(o),j.Update(this.m_contactManager.m_contactListener),j.IsEnabled()&&j.IsTouching()?(j.m_islandFlag=!0,i.AddContact(j),T.m_islandFlag||(T.m_islandFlag=!0,T.m_type!==Un.b2_staticBody&&T.SetAwake(!0),i.AddBody(T))):(T.m_sweep.Copy(z),T.SynchronizeTransform())}}}}}var E=t.SolveTOI_s_subStep;E.dt=(1-o)*e.dt,E.inv_dt=1/E.dt,E.dtRatio=1,E.positionIterations=20,E.velocityIterations=e.velocityIterations,E.particleIterations=e.particleIterations,E.warmStarting=!1,i.SolveTOI(E,P.m_islandIndex,I.m_islandIndex);for(var N=0;N<i.m_bodyCount;++N){var J=i.m_bodies[N];if(J.m_islandFlag=!1,J.m_type===Un.b2_dynamicBody){J.SynchronizeFixtures();for(var X=J.m_contactList;X;X=X.next)X.contact.m_toiFlag=!1,X.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else r.SetEnabled(!1),P.m_sweep.Copy(G),I.m_sweep.Copy(D),P.SynchronizeTransform(),I.SynchronizeTransform()}}},{key:"AddController",value:function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t}},{key:"RemoveController",value:function(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t}}],[{key:"_Joint_Create",value:function(t){switch(t.type){case Sn.e_distanceJoint:return new qn(t);case Sn.e_mouseJoint:return new qs(t);case Sn.e_prismaticJoint:return new Es(t);case Sn.e_revoluteJoint:return new Us(t);case Sn.e_pulleyJoint:return new Xs(t);case Sn.e_gearJoint:return new Ls(t);case Sn.e_wheelJoint:return new Hs(t);case Sn.e_weldJoint:return new Qs(t);case Sn.e_frictionJoint:return new Ds(t);case Sn.e_motorJoint:return new Ts(t);case Sn.e_areaJoint:return new En(t)}throw new Error}},{key:"_Joint_Destroy",value:function(t){}}]),t}();Nr.Step_s_step=new xs,Nr.Step_s_stepTimer=new zt,Nr.Step_s_timer=new zt,Nr.DebugDraw_s_color=new o(0,0,0),Nr.DebugDraw_s_vs=It.MakeArray(4),Nr.DebugDraw_s_xf=new Tt,Nr.QueryFixtureShape_s_aabb=new Ie,Nr.RayCast_s_input=new Me,Nr.RayCast_s_output=new Pe,Nr.RayCast_s_point=new It,Nr.SolveTOI_s_subStep=new xs,Nr.SolveTOI_s_backup=new Ot,Nr.SolveTOI_s_backup1=new Ot,Nr.SolveTOI_s_backup2=new Ot,Nr.SolveTOI_s_toi_input=new pn,Nr.SolveTOI_s_toi_output=new Bn,function(t){t[t.b2_pbdStretchingModel=0]="b2_pbdStretchingModel",t[t.b2_xpbdStretchingModel=1]="b2_xpbdStretchingModel"}(zr||(zr={})),function(t){t[t.b2_springAngleBendingModel=0]="b2_springAngleBendingModel",t[t.b2_pbdAngleBendingModel=1]="b2_pbdAngleBendingModel",t[t.b2_xpbdAngleBendingModel=2]="b2_xpbdAngleBendingModel",t[t.b2_pbdDistanceBendingModel=3]="b2_pbdDistanceBendingModel",t[t.b2_pbdHeightBendingModel=4]="b2_pbdHeightBendingModel",t[t.b2_pbdTriangleBendingModel=5]="b2_pbdTriangleBendingModel"}(Er||(Er={}));var Jr=function(){function t(){Object(n.a)(this,t),this.stretchingModel=zr.b2_pbdStretchingModel,this.bendingModel=Er.b2_pbdAngleBendingModel,this.damping=0,this.stretchStiffness=1,this.stretchHertz=0,this.stretchDamping=0,this.bendStiffness=.5,this.bendHertz=1,this.bendDamping=0,this.isometric=!1,this.fixedEffectiveMass=!1,this.warmStart=!1}return Object(r.a)(t,[{key:"Copy",value:function(t){return this.stretchingModel=t.stretchingModel,this.bendingModel=t.bendingModel,this.damping=t.damping,this.stretchStiffness=t.stretchStiffness,this.stretchHertz=t.stretchHertz,this.stretchDamping=t.stretchDamping,this.bendStiffness=t.bendStiffness,this.bendHertz=t.bendHertz,this.bendDamping=t.bendDamping,this.isometric=t.isometric,this.fixedEffectiveMass=t.fixedEffectiveMass,this.warmStart=t.warmStart,this}}]),t}(),Xr=function t(){Object(n.a)(this,t),this.position=new It,this.vertices=[],this.count=0,this.masses=[],this.gravity=new It,this.tuning=new Jr},Zr=function t(){Object(n.a)(this,t),this.i1=0,this.i2=0,this.invMass1=0,this.invMass2=0,this.L=0,this.lambda=0,this.spring=0,this.damper=0},Ur=function t(){Object(n.a)(this,t),this.i1=0,this.i2=0,this.i3=0,this.invMass1=0,this.invMass2=0,this.invMass3=0,this.invEffectiveMass=0,this.lambda=0,this.L1=0,this.L2=0,this.alpha1=0,this.alpha2=0,this.spring=0,this.damper=0},Wr=function(){function t(){Object(n.a)(this,t),this.m_position=new It,this.m_count=0,this.m_stretchCount=0,this.m_bendCount=0,this.m_stretchConstraints=[],this.m_bendConstraints=[],this.m_bindPositions=[],this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_invMasses=[],this.m_gravity=new It,this.m_tuning=new Jr}return Object(r.a)(t,[{key:"Create",value:function(t){function e(t,e,i){for(var n=0;n<e;++n)t[n]=i(n)}this.m_position.Copy(t.position),this.m_count=t.count,e(this.m_bindPositions,this.m_count,(function(){return new It})),e(this.m_ps,this.m_count,(function(){return new It})),e(this.m_p0s,this.m_count,(function(){return new It})),e(this.m_vs,this.m_count,(function(){return new It})),e(this.m_invMasses,this.m_count,(function(){return 0}));for(var i=0;i<this.m_count;++i){this.m_bindPositions[i].Copy(t.vertices[i]),this.m_ps[i].Copy(t.vertices[i]).SelfAdd(this.m_position),this.m_p0s[i].Copy(t.vertices[i]).SelfAdd(this.m_position),this.m_vs[i].SetZero();var n=t.masses[i];this.m_invMasses[i]=n>0?1/n:0}this.m_stretchCount=this.m_count-1,this.m_bendCount=this.m_count-2,e(this.m_stretchConstraints,this.m_stretchCount,(function(){return new Zr})),e(this.m_bendConstraints,this.m_bendCount,(function(){return new Ur}));for(var s=0;s<this.m_stretchCount;++s){var r=this.m_stretchConstraints[s],o=this.m_ps[s],a=this.m_ps[s+1];r.i1=s,r.i2=s+1,r.L=It.DistanceVV(o,a),r.invMass1=this.m_invMasses[s],r.invMass2=this.m_invMasses[s+1],r.lambda=0,r.damper=0,r.spring=0}for(var u=0;u<this.m_bendCount;++u){var l=this.m_bendConstraints[u],h=this.m_ps[u],_=this.m_ps[u+1],m=this.m_ps[u+2];l.i1=u,l.i2=u+1,l.i3=u+2,l.invMass1=this.m_invMasses[u],l.invMass2=this.m_invMasses[u+1],l.invMass3=this.m_invMasses[u+2],l.invEffectiveMass=0,l.L1=It.DistanceVV(h,_),l.L2=It.DistanceVV(_,m),l.lambda=0;var c=It.SubVV(_,h,new It),f=It.SubVV(m,_,new It),d=c.LengthSquared(),v=f.LengthSquared();if(d*v!==0){var y=(new It).Copy(c).SelfSkew().SelfMul(-1/d),p=(new It).Copy(f).SelfSkew().SelfMul(1/v),x=y.Clone().SelfNeg(),B=y.Clone().SelfSub(p),S=p.Clone();l.invEffectiveMass=l.invMass1*It.DotVV(x,x)+l.invMass2*It.DotVV(B,B)+l.invMass3*It.DotVV(S,S);var A=It.SubVV(m,h,new It),C=A.LengthSquared();0!==C&&(l.alpha1=It.DotVV(f,A)/C,l.alpha2=It.DotVV(c,A)/C)}}this.m_gravity.Copy(t.gravity),this.SetTuning(t.tuning)}},{key:"SetTuning",value:function(t){this.m_tuning.Copy(t);for(var e=2*v*this.m_tuning.bendHertz,i=0;i<this.m_bendCount;++i){var n=this.m_bendConstraints[i],s=n.L1*n.L1,r=n.L2*n.L2;if(s*r!==0){var o=1/n.L1+1/n.L2,a=n.invMass1/s+n.invMass2*o*o+n.invMass3/r;if(0!==a){var u=1/a;n.spring=u*e*e,n.damper=2*u*this.m_tuning.bendDamping*e}else n.spring=0,n.damper=0}else n.spring=0,n.damper=0}for(var l=2*v*this.m_tuning.stretchHertz,h=0;h<this.m_stretchCount;++h){var _=this.m_stretchConstraints[h],m=_.invMass1+_.invMass2;if(0!==m){var c=1/m;_.spring=c*l*l,_.damper=2*c*this.m_tuning.stretchDamping*l}}}},{key:"Step",value:function(t,e,i){if(0!==t){for(var n=1/t,s=Math.exp(-t*this.m_tuning.damping),r=0;r<this.m_count;++r)this.m_invMasses[r]>0?(this.m_vs[r].x*=s,this.m_vs[r].y*=s,this.m_vs[r].x+=t*this.m_gravity.x,this.m_vs[r].y+=t*this.m_gravity.y):(this.m_vs[r].x=n*(this.m_bindPositions[r].x+i.x-this.m_p0s[r].x),this.m_vs[r].y=n*(this.m_bindPositions[r].y+i.y-this.m_p0s[r].y));this.m_tuning.bendingModel===Er.b2_springAngleBendingModel&&this.ApplyBendForces(t);for(var o=0;o<this.m_bendCount;++o)this.m_bendConstraints[o].lambda=0;for(var a=0;a<this.m_stretchCount;++a)this.m_stretchConstraints[a].lambda=0;for(var u=0;u<this.m_count;++u)this.m_ps[u].x+=t*this.m_vs[u].x,this.m_ps[u].y+=t*this.m_vs[u].y;for(var l=0;l<e;++l)this.m_tuning.bendingModel===Er.b2_pbdAngleBendingModel?this.SolveBend_PBD_Angle():this.m_tuning.bendingModel===Er.b2_xpbdAngleBendingModel?this.SolveBend_XPBD_Angle(t):this.m_tuning.bendingModel===Er.b2_pbdDistanceBendingModel?this.SolveBend_PBD_Distance():this.m_tuning.bendingModel===Er.b2_pbdHeightBendingModel?this.SolveBend_PBD_Height():this.m_tuning.bendingModel===Er.b2_pbdTriangleBendingModel&&this.SolveBend_PBD_Triangle(),this.m_tuning.stretchingModel===zr.b2_pbdStretchingModel?this.SolveStretch_PBD():this.m_tuning.stretchingModel===zr.b2_xpbdStretchingModel&&this.SolveStretch_XPBD(t);for(var h=0;h<this.m_count;++h)this.m_vs[h].x=n*(this.m_ps[h].x-this.m_p0s[h].x),this.m_vs[h].y=n*(this.m_ps[h].y-this.m_p0s[h].y),this.m_p0s[h].Copy(this.m_ps[h])}}},{key:"Reset",value:function(t){this.m_position.Copy(t);for(var e=0;e<this.m_count;++e)this.m_ps[e].x=this.m_bindPositions[e].x+this.m_position.x,this.m_ps[e].y=this.m_bindPositions[e].y+this.m_position.y,this.m_p0s[e].x=this.m_bindPositions[e].x+this.m_position.x,this.m_p0s[e].y=this.m_bindPositions[e].y+this.m_position.y,this.m_vs[e].SetZero();for(var i=0;i<this.m_bendCount;++i)this.m_bendConstraints[i].lambda=0;for(var n=0;n<this.m_stretchCount;++n)this.m_stretchConstraints[n].lambda=0}},{key:"Draw",value:function(t){for(var e=new o(.4,.5,.7),i=new o(.1,.8,.1),n=new o(.7,.2,.4),s=0;s<this.m_count-1;++s){t.DrawSegment(this.m_ps[s],this.m_ps[s+1],e);var r=this.m_invMasses[s]>0?n:i;t.DrawPoint(this.m_ps[s],5,r)}var a=this.m_invMasses[this.m_count-1]>0?n:i;t.DrawPoint(this.m_ps[this.m_count-1],5,a)}},{key:"SolveStretch_PBD",value:function(){for(var t=this.m_tuning.stretchStiffness,e=0;e<this.m_stretchCount;++e){var i=this.m_stretchConstraints[e],n=this.m_ps[i.i1].Clone(),s=this.m_ps[i.i2].Clone(),r=s.Clone().SelfSub(n),o=r.Normalize(),a=i.invMass1+i.invMass2;if(0!==a){var u=i.invMass1/a,l=i.invMass2/a;n.x-=t*u*(i.L-o)*r.x,n.y-=t*u*(i.L-o)*r.y,s.x+=t*l*(i.L-o)*r.x,s.y+=t*l*(i.L-o)*r.y,this.m_ps[i.i1].Copy(n),this.m_ps[i.i2].Copy(s)}}}},{key:"SolveStretch_XPBD",value:function(t){for(var e=0;e<this.m_stretchCount;++e){var i=this.m_stretchConstraints[e],n=this.m_ps[i.i1].Clone(),s=this.m_ps[i.i2].Clone(),r=n.Clone().SelfSub(this.m_p0s[i.i1]),o=s.Clone().SelfSub(this.m_p0s[i.i2]),a=s.Clone().SelfSub(n),u=a.Normalize(),l=a.Clone().SelfNeg(),h=a,_=i.invMass1+i.invMass2;if(0!==_){var m=1/(i.spring*t*t),c=m*(t*t*i.damper)/t,f=u-i.L,d=It.DotVV(l,r)+It.DotVV(h,o),v=-(f+m*i.lambda+c*d)/((1+c)*_+m);n.x+=i.invMass1*v*l.x,n.y+=i.invMass1*v*l.y,s.x+=i.invMass2*v*h.x,s.y+=i.invMass2*v*h.y,this.m_ps[i.i1].Copy(n),this.m_ps[i.i2].Copy(s),i.lambda+=v}}}},{key:"SolveBend_PBD_Angle",value:function(){for(var t=this.m_tuning.bendStiffness,e=0;e<this.m_bendCount;++e){var i=this.m_bendConstraints[e],n=this.m_ps[i.i1],s=this.m_ps[i.i2],r=this.m_ps[i.i3],o=s.Clone().SelfSub(n),a=r.Clone().SelfSub(s),u=It.CrossVV(o,a),l=It.DotVV(o,a),h=Vt(u,l),_=0,m=0;if(this.m_tuning.isometric?(_=i.L1*i.L1,m=i.L2*i.L2):(_=o.LengthSquared(),m=a.LengthSquared()),_*m!==0){var c=(new It).Copy(o).SelfSkew().SelfMul(-1/_),f=(new It).Copy(a).SelfSkew().SelfMul(1/m),d=c.Clone().SelfNeg(),v=c.Clone().SelfSub(f),y=f,p=0;0===(p=this.m_tuning.fixedEffectiveMass?i.invEffectiveMass:i.invMass1*It.DotVV(d,d)+i.invMass2*It.DotVV(v,v)+i.invMass3*It.DotVV(y,y))&&(p=i.invEffectiveMass);var x=-t*h/p;n.x+=i.invMass1*x*d.x,n.y+=i.invMass1*x*d.y,s.x+=i.invMass2*x*v.x,s.y+=i.invMass2*x*v.y,r.x+=i.invMass3*x*y.x,r.y+=i.invMass3*x*y.y,this.m_ps[i.i1].Copy(n),this.m_ps[i.i2].Copy(s),this.m_ps[i.i3].Copy(r)}}}},{key:"SolveBend_XPBD_Angle",value:function(t){for(var e=0;e<this.m_bendCount;++e){var i=this.m_bendConstraints[e],n=this.m_ps[i.i1],s=this.m_ps[i.i2],r=this.m_ps[i.i3],o=n.Clone().SelfSub(this.m_p0s[i.i1]),a=s.Clone().SelfSub(this.m_p0s[i.i2]),u=r.Clone().SelfSub(this.m_p0s[i.i3]),l=s.Clone().SelfSub(n),h=r.Clone().SelfSub(s),_=void 0,m=void 0;if(this.m_tuning.isometric?(_=i.L1*i.L1,m=i.L2*i.L2):(_=l.LengthSquared(),m=h.LengthSquared()),_*m!==0){var c=It.CrossVV(l,h),f=It.DotVV(l,h),d=Vt(c,f),v=(new It).Copy(l).SelfSkew().SelfMul(-1/_),y=(new It).Copy(h).SelfSkew().SelfMul(1/m),p=v.Clone().SelfNeg(),x=v.Clone().SelfSub(y),B=y,S=void 0;if(0!==(S=this.m_tuning.fixedEffectiveMass?i.invEffectiveMass:i.invMass1*It.DotVV(p,p)+i.invMass2*It.DotVV(x,x)+i.invMass3*It.DotVV(B,B))){var A=1/(i.spring*t*t),C=A*(t*t*i.damper)/t,b=d,g=It.DotVV(p,o)+It.DotVV(x,a)+It.DotVV(B,u),V=-(b+A*i.lambda+C*g)/((1+C)*S+A);n.x+=i.invMass1*V*p.x,n.y+=i.invMass1*V*p.y,s.x+=i.invMass2*V*x.x,s.y+=i.invMass2*V*x.y,r.x+=i.invMass3*V*B.x,r.y+=i.invMass3*V*B.y,this.m_ps[i.i1].Copy(n),this.m_ps[i.i2].Copy(s),this.m_ps[i.i3].Copy(r),i.lambda+=V}}}}},{key:"SolveBend_PBD_Distance",value:function(){for(var t=this.m_tuning.bendStiffness,e=0;e<this.m_bendCount;++e){var i=this.m_bendConstraints[e],n=i.i1,s=i.i3,r=this.m_ps[n].Clone(),o=this.m_ps[s].Clone(),a=o.Clone().SelfSub(r),u=a.Normalize(),l=i.invMass1+i.invMass3;if(0!==l){var h=i.invMass1/l,_=i.invMass3/l;r.x-=t*h*(i.L1+i.L2-u)*a.x,r.y-=t*h*(i.L1+i.L2-u)*a.y,o.x+=t*_*(i.L1+i.L2-u)*a.x,o.y+=t*_*(i.L1+i.L2-u)*a.y,this.m_ps[n].Copy(r),this.m_ps[s].Copy(o)}}}},{key:"SolveBend_PBD_Height",value:function(){for(var t=this.m_tuning.bendStiffness,e=0;e<this.m_bendCount;++e){var i=this.m_bendConstraints[e],n=this.m_ps[i.i1].Clone(),s=this.m_ps[i.i2].Clone(),r=this.m_ps[i.i3].Clone(),o=new It;o.x=i.alpha1*n.x+i.alpha2*r.x-s.x,o.y=i.alpha1*n.y+i.alpha2*r.y-s.y;var a=o.Length();if(0!==a){var u=o.Clone().SelfMul(1/a),l=u.Clone().SelfMul(i.alpha1),h=u.Clone().SelfNeg(),_=u.Clone().SelfMul(i.alpha2),m=i.invMass1*i.alpha1*i.alpha1+i.invMass2+i.invMass3*i.alpha2*i.alpha2;if(0!==m){var c=-t*(1/m)*a;n.x+=i.invMass1*c*l.x,n.y+=i.invMass1*c*l.y,s.x+=i.invMass2*c*h.x,s.y+=i.invMass2*c*h.y,r.x+=i.invMass3*c*_.x,r.y+=i.invMass3*c*_.y,this.m_ps[i.i1].Copy(n),this.m_ps[i.i2].Copy(s),this.m_ps[i.i3].Copy(r)}}}}},{key:"SolveBend_PBD_Triangle",value:function(){for(var t=this.m_tuning.bendStiffness,e=0;e<this.m_bendCount;++e){var i=this.m_bendConstraints[e],n=this.m_ps[i.i1].Clone(),s=this.m_ps[i.i2].Clone(),r=this.m_ps[i.i3].Clone(),o=i.invMass1,a=i.invMass2,u=i.invMass3,l=t/(o+u+2*a),h=new It;h.x=s.x-1/3*(n.x+s.x+r.x),h.y=s.y-1/3*(n.y+s.y+r.y);var _=new It;_.x=2*o*l*h.x,_.y=2*o*l*h.y;var m=new It;m.x=-4*a*l*h.x,m.y=-4*a*l*h.y;var c=new It;c.x=2*u*l*h.x,c.y=2*u*l*h.y,n.SelfAdd(_),s.SelfAdd(m),r.SelfAdd(c),this.m_ps[i.i1].Copy(n),this.m_ps[i.i2].Copy(s),this.m_ps[i.i3].Copy(r)}}},{key:"ApplyBendForces",value:function(t){for(var e=2*v*this.m_tuning.bendHertz,i=0;i<this.m_bendCount;++i){var n=this.m_bendConstraints[i],s=this.m_ps[n.i1].Clone(),r=this.m_ps[n.i2].Clone(),o=this.m_ps[n.i3].Clone(),a=this.m_vs[n.i1],u=this.m_vs[n.i2],l=this.m_vs[n.i3],h=s.Clone().SelfSub(s),_=o.Clone().SelfSub(r),m=void 0,c=void 0;if(this.m_tuning.isometric?(m=n.L1*n.L1,c=n.L2*n.L2):(m=h.LengthSquared(),c=_.LengthSquared()),m*c!==0){var f=It.CrossVV(h,_),d=It.DotVV(h,_),y=Vt(f,d),p=(new It).Copy(h).SelfSkew().SelfMul(-1/m),x=(new It).Copy(_).SelfSkew().SelfMul(1/c),B=p.Clone().SelfNeg(),S=p.Clone().SelfSub(x),A=x,C=0;if(0!==(C=this.m_tuning.fixedEffectiveMass?n.invEffectiveMass:n.invMass1*It.DotVV(B,B)+n.invMass2*It.DotVV(S,S)+n.invMass3*It.DotVV(A,A))){var b=1/C,g=-t*(b*e*e*y+2*b*this.m_tuning.bendDamping*e*(It.DotVV(B,a)+It.DotVV(S,u)+It.DotVV(A,l)));this.m_vs[n.i1].x+=n.invMass1*g*B.x,this.m_vs[n.i1].y+=n.invMass1*g*B.y,this.m_vs[n.i2].x+=n.invMass2*g*S.x,this.m_vs[n.i2].y+=n.invMass2*g*S.y,this.m_vs[n.i3].x+=n.invMass3*g*A.x,this.m_vs[n.i3].y+=n.invMass3*g*A.y}}}}}]),t}(),Qr=function t(e,i){Object(n.a)(this,t),this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=e,this.body=i},Yr=function(){function t(){Object(n.a)(this,t),this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}return Object(r.a)(t,[{key:"GetNext",value:function(){return this.m_next}},{key:"GetPrev",value:function(){return this.m_prev}},{key:"GetBodyList",value:function(){return this.m_bodyList}},{key:"AddBody",value:function(t){var e=new Qr(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount}},{key:"RemoveBody",value:function(t){if(this.m_bodyCount<=0)throw new Error;for(var e=this.m_bodyList;e&&e.body!==t;)e=e.nextBody;if(null===e)throw new Error;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount}},{key:"Clear",value:function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0}}]),t}(),Kr=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.apply(this,arguments)).normal=new It(0,1),t.offset=0,t.density=0,t.velocity=new It(0,0),t.linearDrag=0,t.angularDrag=0,t.useDensity=!1,t.useWorldGravity=!0,t.gravity=new It(0,0),t}return Object(r.a)(i,[{key:"Step",value:function(t){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(i.IsAwake()){for(var n=new It,s=new It,r=0,o=0,a=i.GetFixtureList();a;a=a.m_next){var u=new It,l=a.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),u);r+=l,n.x+=l*u.x,n.y+=l*u.y;var h=0;o+=l*(h=this.useDensity?a.GetDensity():1),s.x+=l*u.x*h,s.y+=l*u.y*h}if(n.x/=r,n.y/=r,s.x/=o,s.y/=o,!(r<f)){var _=this.gravity.Clone().SelfNeg();_.SelfMul(this.density*r),i.ApplyForce(_,s);var m=i.GetLinearVelocityFromWorldPoint(n,new It);m.SelfSub(this.velocity),m.SelfMul(-this.linearDrag*r),i.ApplyForce(m,n),i.ApplyTorque(-i.GetInertia()/i.GetMass()*r*i.GetAngularVelocity()*this.angularDrag)}}}}}},{key:"Draw",value:function(t){var e=100,i=new It,n=new It;i.x=this.normal.x*this.offset+this.normal.y*e,i.y=this.normal.y*this.offset-this.normal.x*e,n.x=this.normal.x*this.offset-this.normal.y*e,n.y=this.normal.y*this.offset+this.normal.x*e;var s=new o(0,0,.8);t.DrawSegment(i,n,s)}}]),i}(Yr),Hr=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.apply(this,arguments)).A=new It(0,0),t}return Object(r.a)(i,[{key:"Step",value:function(t){for(var e=It.MulSV(t.dt,this.A,i.Step_s_dtA),n=this.m_bodyList;n;n=n.nextBody){var s=n.body;s.IsAwake()&&s.SetLinearVelocity(It.AddVV(s.GetLinearVelocity(),e,It.s_t0))}}},{key:"Draw",value:function(t){}}]),i}(Yr);Hr.Step_s_dtA=new It;var $r=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.apply(this,arguments)).F=new It(0,0),t}return Object(r.a)(i,[{key:"Step",value:function(t){for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;i.IsAwake()&&i.ApplyForce(this.F,i.GetWorldCenter())}}},{key:"Draw",value:function(t){}}]),i}(Yr),to=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.apply(this,arguments)).G=1,t.invSqr=!0,t}return Object(r.a)(i,[{key:"Step",value:function(t){if(this.invSqr)for(var e=this.m_bodyList;e;e=e.nextBody)for(var n=e.body,s=n.GetWorldCenter(),r=n.GetMass(),o=this.m_bodyList;o&&o!==e;o=o.nextBody){var a=o.body,u=a.GetWorldCenter(),l=a.GetMass(),h=u.x-s.x,_=u.y-s.y,m=h*h+_*_;if(!(m<f)){var c=i.Step_s_f.Set(h,_);c.SelfMul(this.G/m/pt(m)*r*l),n.IsAwake()&&n.ApplyForce(c,s),a.IsAwake()&&a.ApplyForce(c.SelfMul(-1),u)}}else for(var d=this.m_bodyList;d;d=d.nextBody)for(var v=d.body,y=v.GetWorldCenter(),p=v.GetMass(),x=this.m_bodyList;x&&x!==d;x=x.nextBody){var B=x.body,S=B.GetWorldCenter(),A=B.GetMass(),C=S.x-y.x,b=S.y-y.y,g=C*C+b*b;if(!(g<f)){var V=i.Step_s_f.Set(C,b);V.SelfMul(this.G/g*p*A),v.IsAwake()&&v.ApplyForce(V,y),B.IsAwake()&&B.ApplyForce(V.SelfMul(-1),S)}}}},{key:"Draw",value:function(t){}}]),i}(Yr);to.Step_s_f=new It;var eo=function(t){Object(Ze.a)(i,t);var e=Object(Ue.a)(i);function i(){var t;return Object(n.a)(this,i),(t=e.apply(this,arguments)).T=new Lt,t.maxTimestep=0,t}return Object(r.a)(i,[{key:"Step",value:function(t){var e=t.dt;if(!(e<=f)){e>this.maxTimestep&&this.maxTimestep>0&&(e=this.maxTimestep);for(var n=this.m_bodyList;n;n=n.nextBody){var s=n.body;if(s.IsAwake()){var r=s.GetWorldVector(Lt.MulMV(this.T,s.GetLocalVector(s.GetLinearVelocity(),It.s_t0),It.s_t1),i.Step_s_damping);s.SetLinearVelocity(It.AddVV(s.GetLinearVelocity(),It.MulSV(e,r,It.s_t0),It.s_t1))}}}}},{key:"Draw",value:function(t){}},{key:"SetAxisAligned",value:function(t,e){this.T.ex.x=-t,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-e,this.maxTimestep=t>0||e>0?1/mt(t,e):0}}]),i}(Yr);eo.Step_s_damping=new It;var io=Un.b2_staticBody,no=Un.b2_kinematicBody,so=Un.b2_dynamicBody,ro=Er.b2_springAngleBendingModel,oo=Er.b2_pbdAngleBendingModel,ao=Er.b2_xpbdAngleBendingModel,uo=Er.b2_pbdDistanceBendingModel,lo=Er.b2_pbdHeightBendingModel,ho=Er.b2_pbdTriangleBendingModel,_o=zr.b2_pbdStretchingModel,mo=zr.b2_xpbdStretchingModel}}]);